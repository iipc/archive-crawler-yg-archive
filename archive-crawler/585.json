{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":168599281,"authorName":"stack","from":"stack &lt;stack@...&gt;","replyTo":"LIST","senderId":"eKZ_i4h1MdTw0iad7ScGBtdjjUO-pu2ebk6-H6cFmhfM20TXW63fLWkbHcy3dxXW6NlbFuwLhZJRmjBbVyBDMw","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Re: [archive-crawler] Setting Accept headers in crawl","postDate":"1089215863","msgId":585,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDQwRUMxRDc3LjcwNjA0MDVAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PDE2NjE4LjU2MDYxLjEwNzQ4Ni42NTQ1MzFAdGlwaGFyZXMuYmFzaXN0ZWNoLm5ldD4=","referencesHeader":"PDE2NjE4LjU2MDYxLjEwNzQ4Ni42NTQ1MzFAdGlwaGFyZXMuYmFzaXN0ZWNoLm5ldD4="},"prevInTopic":583,"nextInTopic":586,"prevInTime":584,"nextInTime":586,"topicId":583,"numMessagesInTopic":3,"msgSnippet":"I tested the patch and committed.  Its pretty. Good stuff Tom. Thanks, St.Ack P.S. I added you as a project contributor: ","rawEmail":"Return-Path: &lt;stack@...&gt;\r\nX-Sender: stack@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 65435 invoked from network); 7 Jul 2004 15:57:38 -0000\r\nReceived: from unknown (66.218.66.167)\n  by m21.grp.scd.yahoo.com with QMQP; 7 Jul 2004 15:57:38 -0000\r\nReceived: from unknown (HELO dns.duboce.net) (63.203.238.114)\n  by mta6.grp.scd.yahoo.com with SMTP; 7 Jul 2004 15:57:37 -0000\r\nReceived: from archive.org ([192.168.1.105])\n\t(authenticated)\n\tby dns-eth1.duboce.net (8.10.2/8.10.2) with ESMTP id i67FJSq00883\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Wed, 7 Jul 2004 08:19:28 -0700\r\nMessage-ID: &lt;40EC1D77.7060405@...&gt;\r\nDate: Wed, 07 Jul 2004 08:57:43 -0700\r\nUser-Agent: Mozilla/5.0 (Macintosh; U; PPC Mac OS X Mach-O; en-US; rv:1.7b) Gecko/20040421\r\nX-Accept-Language: en-us, en\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;16618.56061.107486.654531@...&gt;\r\nIn-Reply-To: &lt;16618.56061.107486.654531@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-eGroups-Remote-IP: 63.203.238.114\r\nFrom: stack &lt;stack@...&gt;\r\nSubject: Re: [archive-crawler] Setting Accept headers in crawl\r\nX-Yahoo-Group-Post: member; u=168599281\r\n\r\nI tested the patch and committed.  Its pretty.\nGood stuff Tom.\nThanks,\nSt.Ack\n\nP.S. I added you as a project contributor: \nhttp://crawler.archive.org/team-list.html.  Hope you don&#39;t mind.\n\n\nTom Emerson wrote:\n\n&gt;[I sent this under separate cover to stack, but figured I&#39;d send it to\n&gt;the list as a whole as well]\n&gt;\n&gt;Attached is a patch to FetchHTTP.java that allows you to add Accept\n&gt;headers to the crawl (actually, as it turns out, it will let you add\n&gt;*any* header you want, even though the settings verbiage is Accept\n&gt;specific). I use this when crawling sites that I know do language\n&gt;negotiation, and I need text in a specific language.\n&gt;\n&gt;The setting is made available in the HTTP section of the\n&gt;&#39;fetch-processors&#39; settings when Expert Settings are shown.\n&gt;\n&gt;This is related to tracker item 945922 --- I was not able to attach\n&gt;the patch to it, though.\n&gt;\n&gt;Share and enjoy.\n&gt;\n&gt;    -tree\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; \n&gt;Yahoo! Groups Links\n&gt;\n&gt;\n&gt;\n&gt; \n&gt;  \n&gt;\n&gt;------------------------------------------------------------------------\n&gt;\n&gt;*** ../heritrix-0.10.0/src/java/org/archive/crawler/fetcher/FetchHTTP.java\tFri Jun  4 18:47:21 2004\n&gt;--- src/java/org/archive/crawler/fetcher/FetchHTTP.java\tMon Jul  5 14:43:33 2004\n&gt;***************\n&gt;*** 33,38 ****\n&gt;--- 33,39 ----\n&gt;  import java.io.RandomAccessFile;\n&gt;  import java.util.HashSet;\n&gt;  import java.util.Iterator;\n&gt;+ import java.util.ListIterator;\n&gt;  import java.util.List;\n&gt;  import java.util.Set;\n&gt;  import java.util.logging.Level;\n&gt;***************\n&gt;*** 67,72 ****\n&gt;--- 68,74 ----\n&gt;  import org.archive.crawler.settings.SettingsHandler;\n&gt;  import org.archive.crawler.settings.SimpleType;\n&gt;  import org.archive.crawler.settings.Type;\n&gt;+ import org.archive.crawler.settings.StringList;\n&gt;  import org.archive.httpclient.ConfigurableTrustManagerProtocolSocketFactory;\n&gt;  import org.archive.httpclient.HttpRecorderGetMethod;\n&gt;  import org.archive.httpclient.HttpRecorderPostMethod;\n&gt;***************\n&gt;*** 101,107 ****\n&gt;      public static final String ATTR_MAX_FETCH_ATTEMPTS = &quot;max-fetch-attempts&quot;;\n&gt;      public static final String ATTR_LOAD_COOKIES = &quot;load-cookies-from-file&quot;;\n&gt;      public static final String ATTR_SAVE_COOKIES = &quot;save-cookies-to-file&quot;;\n&gt;! \n&gt;      private static Integer DEFAULT_TIMEOUT_SECONDS = new Integer(1200);\n&gt;      private static Integer DEFAULT_SOTIMEOUT_MS = new Integer(20000);\n&gt;      private static Long DEFAULT_MAX_LENGTH_BYTES = new Long(Long.MAX_VALUE);\n&gt;--- 103,110 ----\n&gt;      public static final String ATTR_MAX_FETCH_ATTEMPTS = &quot;max-fetch-attempts&quot;;\n&gt;      public static final String ATTR_LOAD_COOKIES = &quot;load-cookies-from-file&quot;;\n&gt;      public static final String ATTR_SAVE_COOKIES = &quot;save-cookies-to-file&quot;;\n&gt;!     public static final String ATTR_ACCEPT_HEADERS = &quot;accept-headers&quot;;\n&gt;!     \n&gt;      private static Integer DEFAULT_TIMEOUT_SECONDS = new Integer(1200);\n&gt;      private static Integer DEFAULT_SOTIMEOUT_MS = new Integer(20000);\n&gt;      private static Long DEFAULT_MAX_LENGTH_BYTES = new Long(Long.MAX_VALUE);\n&gt;***************\n&gt;*** 184,189 ****\n&gt;--- 187,196 ----\n&gt;              ConfigurableX509TrustManager.LEVELS_AS_ARRAY));\n&gt;          e.setOverrideable(false);\n&gt;          e.setExpertSetting(true);\n&gt;+         e = addElementToDefinition(new StringList(ATTR_ACCEPT_HEADERS,\n&gt;+             &quot;Accept Headers to include in each request. Each must be the&quot;\n&gt;+             + &quot;complete header, e.g., &#39;Accept-Language: en&#39;&quot;));\n&gt;+         e.setExpertSetting(true);\n&gt;      }\n&gt;  \n&gt;      protected void innerProcess(CrawlURI curi) throws InterruptedException {\n&gt;***************\n&gt;*** 205,210 ****\n&gt;--- 212,218 ----\n&gt;              (HttpMethod)new HttpRecorderGetMethod(\n&gt;                  curi.getUURI().toString(), rec);\n&gt;          configureMethod(curi, method);\n&gt;+         maybeSetAcceptHeaders(curi, method);\n&gt;          boolean addedCredentials = populateCredentials(curi, method);\n&gt;          int immediateRetries = 0;\n&gt;          while (true) {\n&gt;***************\n&gt;*** 939,944 ****\n&gt;--- 947,973 ----\n&gt;          }\n&gt;      }\n&gt;      \n&gt;+     private void maybeSetAcceptHeaders(CrawlURI curi, HttpMethod get) {\n&gt;+         try {\n&gt;+             StringList accept_headers = (StringList) getAttribute(ATTR_ACCEPT_HEADERS, curi);\n&gt;+             if (!accept_headers.isEmpty()) {\n&gt;+                 for (ListIterator i = accept_headers.listIterator(); i.hasNext();) {\n&gt;+                     String hdr = (String) i.next();\n&gt;+                     String[] nvp = hdr.split(&quot;: +&quot;);\n&gt;+                     if (nvp.length == 2) {\n&gt;+                         get.setRequestHeader(nvp[0], nvp[1]);\n&gt;+                     }\n&gt;+                     else {\n&gt;+                         logger.warning(&quot;Invalid accept header: &quot; + hdr);\n&gt;+                     }\n&gt;+                 }\n&gt;+             }\n&gt;+         }\n&gt;+         catch (AttributeNotFoundException e) {\n&gt;+             logger.severe(e.getMessage());\n&gt;+         }\n&gt;+     }\n&gt;+ \n&gt;      // custom serialization\n&gt;      private void writeObject(ObjectOutputStream stream) throws IOException {\n&gt;          stream.defaultWriteObject();\n&gt;  \n&gt;\n&gt;------------------------------------------------------------------------\n&gt;\n&gt;\n&gt;  \n&gt;\n\n\n"}}