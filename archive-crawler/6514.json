{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":212342429,"authorName":"Pranay Pandey","from":"Pranay Pandey &lt;sspranay@...&gt;","profile":"sspranay","replyTo":"LIST","senderId":"oihl972XPLKxK5shrDNpLAvTE2PL23Avp074HyWgvKAdQlvcR83V1yj4vDDSgb6lBk3Q8q81j7SApgrqFrE-agu0WhWsRb7enA","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Re: [archive-crawler] retiring a Queue, using Groovy.","postDate":"1273002684","msgId":6514,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDg4MjgzNy44MDY4OC5xbUB3ZWI0MzEzMS5tYWlsLnNwMS55YWhvby5jb20+","inReplyToHeader":"PDRCREY5RTE3LjYwMzA1MDhAYXJjaGl2ZS5vcmc+"},"prevInTopic":6510,"nextInTopic":0,"prevInTime":6513,"nextInTime":6515,"topicId":6508,"numMessagesInTopic":4,"msgSnippet":"Thanks for the clarification, Gordon. And yes, it would be nice to have a little wiki on the recommended steps on how to retire a queue. Regards, Pranay ... ","rawEmail":"Return-Path: &lt;sspranay@...&gt;\r\nX-Sender: sspranay@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 85107 invoked from network); 4 May 2010 19:51:25 -0000\r\nX-Received: from unknown (66.196.94.106)\n  by m3.grp.sp2.yahoo.com with QMQP; 4 May 2010 19:51:25 -0000\r\nX-Received: from unknown (HELO web43131.mail.sp1.yahoo.com) (216.252.121.61)\n  by mta2.grp.re1.yahoo.com with SMTP; 4 May 2010 19:51:25 -0000\r\nX-Received: (qmail 81068 invoked by uid 60001); 4 May 2010 19:51:25 -0000\r\nMessage-ID: &lt;882837.80688.qm@...&gt;\r\nX-YMail-OSG: kjy9eisVM1mv2Ev6pyLjCC3UpQLNnQvX8Xm2.pTLso5EzbI\n NkP9gkKcURJHoII5zLr46oXgue6nLCXTEZTKUdmtxX.Jj0oP_21.yL0btRuN\n V3u.Ev1zTr6bN1c02Zz2ysaEXAQPAdBkY.LwdL8Z2ucda0rjmcCKASOw9ID.\n 1vwvxC0.J8iAak5ESQfB3i6S_UfK9w81YCzbDWm.jsLSebEyRVHyddtHflnZ\n 6oXZuTIq4poMu7E2gn..EoVqAul6O.573Bhyj6EP17F8C3I29hWKT3x4JtvI\n 2u9QdRt_X0fxvqAep_XRzujCCqV_uDvbr0qNWtPaLGSQBBB2PYppM_7t2ieV\n xddfIMIZuO8fBYdSsMRYu_k8tk2NtCPTZiLiCIUXjINsCFkrU\r\nX-Received: from [204.194.77.3] by web43131.mail.sp1.yahoo.com via HTTP; Tue, 04 May 2010 12:51:24 PDT\r\nX-Mailer: YahooMailClassic/10.1.11 YahooMailWebService/0.8.103.269680\r\nDate: Tue, 4 May 2010 12:51:24 -0700 (PDT)\r\nTo: archive-crawler@yahoogroups.com\r\nIn-Reply-To: &lt;4BDF9E17.6030508@...&gt;\r\nMIME-Version: 1.0\r\nContent-Type: multipart/alternative; boundary=&quot;0-2066173476-1273002684=:80688&quot;\r\nFrom: Pranay Pandey &lt;sspranay@...&gt;\r\nSubject: Re: [archive-crawler] retiring a Queue, using Groovy.\r\nX-Yahoo-Group-Post: member; u=212342429; y=Jz-nHf_w_WlxoF9MGDDgXkB3un73YTGw9O0qrV4GeXg_92A\r\nX-Yahoo-Profile: sspranay\r\n\r\n\r\n--0-2066173476-1273002684=:80688\r\nContent-Type: text/plain; charset=utf-8\r\nContent-Transfer-Encoding: quoted-printable\r\n\r\nThanks for the clarification, Gordon. \nAnd yes, it would be nice to have a =\r\nlittle wiki on the recommended steps on how to retire a queue.\n\nRegards,\nPr=\r\nanay\n\n--- On Tue, 5/4/10, Gordon Mohr &lt;gojomo@...&gt; wrote:\n\nFrom: Go=\r\nrdon Mohr &lt;gojomo@...&gt;\nSubject: Re: [archive-crawler] retiring a Qu=\r\neue, using Groovy.\nTo: archive-crawler@yahoogroups.com\nCc: &quot;Pranay Pandey&quot; =\r\n&lt;sspranay@...&gt;\nDate: Tuesday, May 4, 2010, 12:09 AM\n\n\n\n\n\n\n\n=C2=A0\n\n\n\n=\r\n  \n\n\n    \n      \n      \n      On 5/3/10 1:54 PM, Pranay Pandey wrote:\n\n&gt; I =\r\nam trying to retire a Queue that looks like a potential crawler-trap.\n\n&gt; I =\r\nam using groovy script (pretty much following the notes I took at the\n\n&gt; Fe=\r\nb SFO Conference).\n\n&gt;\n\n&gt; I am experimenting with just 1 seed.\n\n&gt; For the on=\r\nly Queue I have, after running the crawler for a while, I\n\n&gt; pause and setS=\r\nessionBalance to 2 (a very low value), also setTotalBudget( 2).\n\n&gt; After un=\r\npausing and letting the crawler download couple of more URLs\n\n&gt; (ensuring t=\r\nhat total expended exceeds the sessionBalance and the total\n\n&gt; Budget, I do=\r\nn&#39;t see the Queue being force retired.\n\n\n\nThis approach is supposed to work=\r\n; but after refreshing my recollection \n\nof what we tried at the SF Heritri=\r\nx Expert gathering, I think you&#39;re \n\nhitting the same confusing problems an=\r\nd bugs we did there.\n\n\n\nThere are at least two problems even in the latest =\r\nH3 code which prevent \n\nthe desired result:\n\n\n\nFirst, the actual should-ret=\r\nire check isn&#39;t happening everywhere it \n\nshould. Specifically, it only hap=\r\npens when a queue activates from the \n\neligible-but- inactive list -- and t=\r\nhat only happens in a crawl that is \n\nquite busy, with significantly more e=\r\nligible queues than threads.\n\n\n\nSecond, in order to be sensitive to mid-cra=\r\nwl changes to the global \n\ntotalBudget value, or to overlay values (differe=\r\nnt values to apply to \n\ndiffernt URIs), each queue&#39;s internal totalBudget v=\r\nalue is *reset* to \n\nthe current prevailing/overlaid value each time the qu=\r\neue the activated. \n\nSo, a value changed directly via the scripting facilit=\r\ny may not persist \n\nas long as desired.\n\n\n\nI&#39;ve created a new issue to addr=\r\ness these; see:\n\n\n\nhttps://webarchive. jira.com/ browse/HER- 1768\n\n\n\n&gt; How =\r\noften isOverBudget( ) runs for a queue?\n\n\n\nIt is checked each time URI is f=\r\ninished,but since it has two meanings -- \n\nover-session- budget (meaning, d=\r\neactivate temporarily to allow other \n\nqueues a chance), and over-total-bud=\r\nget (meaning, retire indefinitely) \n\n-- merely being isOverBudget( ) isn&#39;t =\r\ncurrently enough to force a queue \n\nto retired status.\n\n\n\n&gt; Am I failing to=\r\n understand the behavior of these parameters?\n\n&gt; total expended\n\n&gt; active b=\r\nalance\n\n&gt; total budget\n\n\n\nI think you&#39;ve got the right idea, but arcane det=\r\nails in how this is \n\nimplemented are causing the problem.\n\n\n\n&gt; I even trie=\r\nd queue.setRetired( true).\n\n\n\nThis, I would not recommend or expect to work=\r\n. Essentially, the \n\n&#39;isRetired&#39; flag is for recording whether other code h=\r\nas retired the \n\nqueue, *not* for triggering retirement. Setting it directl=\r\ny won&#39;t work, \n\nand may cause other problems.\n\n\n\n&gt; My script snippet:\n\n&gt; --=\r\n---------- -------\n\n&gt; frontier=3DappCtx. getBean(&quot; frontier&quot; )\n\n&gt; queue =3D=\r\n frontier.getQueueFo r(&quot;com,mySite, www,&quot;)\n\n&gt; queue.setSessionBal ance(2)\n\n=\r\n&gt; queue.setTotalBudge t(2)\n\n&gt; ------------ ------\n\n\n\nAs part of the work fo=\r\nr the issue HER-1768 just created, we&#39;ll provide a \n\nspecific recommended w=\r\nay to get this done for a single queue. (It may \n\ninvolve creating an overl=\r\nay-settings Sheet in the final recommendation. )\n\n\n\n&gt; Thanks for any pointe=\r\nrs!\n\n&gt;\n\n&gt; ps. How do I use rawOut?\n\n\n\nBoth the &#39;htmlOut&#39; and &#39;rawOut&#39; varia=\r\nbles are pre-initialized for use by \n\nscripts that are run in the web inter=\r\nface&#39;s Scripting Console. Each is a \n\nPrintWriter instance, and provide a w=\r\nay to return output to top of the \n\nweb page that is shown the operator aft=\r\ner script execution.\n\n\n\nYou can just message them as a PrintWriter in your =\r\nscript, for example:\n\n\n\nrawOut.println( &quot;hello&quot;);\n\n\n\nOutput printed to the =\r\n&#39;htmlOut&#39; PrintWriter is inserted into the \n\nresulting HTML page without an=\r\ny escaping -- so *may* use HTML \n\ntags/styling to affect browser presentati=\r\non.\n\n\n\nOutput printed to the &#39;rawOut&#39; PrintWriter is escaped and wrapped in=\r\n a \n\n&lt;PRE&gt; element in the resulting HTML page. So, any HTML tags are render=\r\ned \n\ninert.\n\n\n\nIf you&#39;re sure the output is very simple, or it is intention=\r\nally using \n\nHTML for styling, use &#39;htmlOut&#39;. If it might contain inadverte=\r\nnt HTML, \n\nor you want to see (rather than have the browser interpret) any =\r\nHTML in \n\nthe output, use &#39;rawOut&#39;.\n\n\n\n- Gordon @ IA\n\n\n\n    \n     \n\n    \n  =\r\n  \n\n\n \n\n\n\n  \n\n\n\n\n\n\n      \r\n--0-2066173476-1273002684=:80688\r\nContent-Type: text/html; charset=utf-8\r\nContent-Transfer-Encoding: quoted-printable\r\n\r\n&lt;table cellspacing=3D&quot;0&quot; cellpadding=3D&quot;0&quot; border=3D&quot;0&quot; &gt;&lt;tr&gt;&lt;td valign=3D&quot;=\r\ntop&quot; style=3D&quot;font: inherit;&quot;&gt;Thanks for the clarification, Gordon. &lt;br&gt;And=\r\n yes, it would be nice to have a little wiki on the recommended steps on ho=\r\nw to retire a queue.&lt;br&gt;&lt;br&gt;Regards,&lt;br&gt;Pranay&lt;br&gt;&lt;br&gt;--- On &lt;b&gt;Tue, 5/4/10=\r\n, Gordon Mohr &lt;i&gt;&lt;gojomo@...&gt;&lt;/i&gt;&lt;/b&gt; wrote:&lt;br&gt;&lt;blockquote s=\r\ntyle=3D&quot;border-left: 2px solid rgb(16, 16, 255); margin-left: 5px; padding-=\r\nleft: 5px;&quot;&gt;&lt;br&gt;From: Gordon Mohr &lt;gojomo@...&gt;&lt;br&gt;Subject: Re=\r\n: [archive-crawler] retiring a Queue, using Groovy.&lt;br&gt;To: archive-crawler@=\r\nyahoogroups.com&lt;br&gt;Cc: &quot;Pranay Pandey&quot; &lt;sspranay@...&gt;&lt;br&gt;Date: =\r\nTuesday, May 4, 2010, 12:09 AM&lt;br&gt;&lt;br&gt;&lt;div id=3D&quot;yiv37967708&quot;&gt;\n\n\n\n\n\n&lt;span s=\r\ntyle=3D&quot;display: none;&quot;&gt;&nbsp;&lt;/span&gt;\n\n\n\n    &lt;div id=3D&quot;ygrp-text&quot;&gt;\n      \n=\r\n      \n      &lt;p&gt;On 5/3/10 1:54 PM, Pranay Pandey wrote:&lt;br&gt;\n&gt; I am tryin=\r\ng to retire a Queue that looks like a potential crawler-trap.&lt;br&gt;\n&gt; I am=\r\n using groovy script (pretty much following the notes I took at the&lt;br&gt;\n&gt=\r\n; Feb SFO Conference).&lt;br&gt;\n&gt;&lt;br&gt;\n&gt; I am experimenting with just 1 see=\r\nd.&lt;br&gt;\n&gt; For the only Queue I have, after running the crawler for a whil=\r\ne, I&lt;br&gt;\n&gt; pause and setSessionBalance to 2 (a very low value), also set=\r\nTotalBudget( 2).&lt;br&gt;\n&gt; After unpausing and letting the crawler download =\r\ncouple of more URLs&lt;br&gt;\n&gt; (ensuring that total expended exceeds the sess=\r\nionBalance and the total&lt;br&gt;\n&gt; Budget, I don&#39;t see the Queue being force=\r\n retired.&lt;br&gt;\n&lt;br&gt;\nThis approach is supposed to work; but after refreshing =\r\nmy recollection &lt;br&gt;\nof what we tried at the SF Heritrix Expert gathering, =\r\nI think you&#39;re &lt;br&gt;\nhitting the same confusing problems and bugs we did the=\r\nre.&lt;br&gt;\n&lt;br&gt;\nThere are at least two problems even in the latest H3 code whi=\r\nch prevent &lt;br&gt;\nthe desired result:&lt;br&gt;\n&lt;br&gt;\nFirst, the actual should-retir=\r\ne check isn&#39;t happening everywhere it &lt;br&gt;\nshould. Specifically, it only ha=\r\nppens when a queue activates from the &lt;br&gt;\neligible-but- inactive list -- a=\r\nnd that only happens in a crawl that is &lt;br&gt;\nquite busy, with significantly=\r\n more eligible queues than threads.&lt;br&gt;\n&lt;br&gt;\nSecond, in order to be sensiti=\r\nve to mid-crawl changes to the global &lt;br&gt;\ntotalBudget value, or to overlay=\r\n values (different values to apply to &lt;br&gt;\ndiffernt URIs), each queue&#39;s int=\r\nernal totalBudget value is *reset* to &lt;br&gt;\nthe current prevailing/overlaid =\r\nvalue each time the queue the activated. &lt;br&gt;\nSo, a value changed directly =\r\nvia the scripting facility may not persist &lt;br&gt;\nas long as desired.&lt;br&gt;\n&lt;br=\r\n&gt;\nI&#39;ve created a new issue to address these; see:&lt;br&gt;\n&lt;br&gt;\n&lt;a rel=3D&quot;nofoll=\r\now&quot; target=3D&quot;_blank&quot; href=3D&quot;https://webarchive.jira.com/browse/HER-1768&quot;&gt;=\r\nhttps://webarchive. jira.com/ browse/HER- 1768&lt;/a&gt;&lt;br&gt;\n&lt;br&gt;\n&gt; How often =\r\nisOverBudget( ) runs for a queue?&lt;br&gt;\n&lt;br&gt;\nIt is checked each time URI is f=\r\ninished,but since it has two meanings -- &lt;br&gt;\nover-session- budget (meaning=\r\n, deactivate temporarily to allow other &lt;br&gt;\nqueues a chance), and over-tot=\r\nal-budget (meaning, retire indefinitely) &lt;br&gt;\n-- merely being isOverBudget(=\r\n ) isn&#39;t currently enough to force a queue &lt;br&gt;\nto retired status.&lt;br&gt;\n&lt;br&gt;=\r\n\n&gt; Am I failing to understand the behavior of these parameters?&lt;br&gt;\n&gt;=\r\n total expended&lt;br&gt;\n&gt; active balance&lt;br&gt;\n&gt; total budget&lt;br&gt;\n&lt;br&gt;\nI th=\r\nink you&#39;ve got the right idea, but arcane details in how this is &lt;br&gt;\nimple=\r\nmented are causing the problem.&lt;br&gt;\n&lt;br&gt;\n&gt; I even tried queue.setRetired=\r\n( true).&lt;br&gt;\n&lt;br&gt;\nThis, I would not recommend or expect to work. Essentiall=\r\ny, the &lt;br&gt;\n&#39;isRetired&#39; flag is for recording whether other code has retire=\r\nd the &lt;br&gt;\nqueue, *not* for triggering retirement. Setting it directly won&#39;=\r\nt work, &lt;br&gt;\nand may cause other problems.&lt;br&gt;\n&lt;br&gt;\n&gt; My script snippet:=\r\n&lt;br&gt;\n&gt; ------------ -------&lt;br&gt;\n&gt; frontier=3DappCtx. getBean(&quot; fronti=\r\ner&quot; )&lt;br&gt;\n&gt; queue =3D frontier.getQueueFo r(&quot;com,mySite, www,&quot;)&lt;br&gt;\n&gt;=\r\n queue.setSessionBal ance(2)&lt;br&gt;\n&gt; queue.setTotalBudge t(2)&lt;br&gt;\n&gt; ---=\r\n--------- ------&lt;br&gt;\n&lt;br&gt;\nAs part of the work for the issue HER-1768 just c=\r\nreated, we&#39;ll provide a &lt;br&gt;\nspecific recommended way to get this done for =\r\na single queue. (It may &lt;br&gt;\ninvolve creating an overlay-settings Sheet in =\r\nthe final recommendation. )&lt;br&gt;\n&lt;br&gt;\n&gt; Thanks for any pointers!&lt;br&gt;\n&gt;=\r\n&lt;br&gt;\n&gt; ps. How do I use rawOut?&lt;br&gt;\n&lt;br&gt;\nBoth the &#39;htmlOut&#39; and &#39;rawOut&#39;=\r\n variables are pre-initialized for use by &lt;br&gt;\nscripts that are run in the =\r\nweb interface&#39;s Scripting Console. Each is a &lt;br&gt;\nPrintWriter instance, and=\r\n provide a way to return output to top of the &lt;br&gt;\nweb page that is shown t=\r\nhe operator after script execution.&lt;br&gt;\n&lt;br&gt;\nYou can just message them as a=\r\n PrintWriter in your script, for example:&lt;br&gt;\n&lt;br&gt;\nrawOut.println( &quot;hello&quot;)=\r\n;&lt;br&gt;\n&lt;br&gt;\nOutput printed to the &#39;htmlOut&#39; PrintWriter is inserted into the=\r\n &lt;br&gt;\nresulting HTML page without any escaping -- so *may* use HTML &lt;br&gt;\nta=\r\ngs/styling to affect browser presentation.&lt;br&gt;\n&lt;br&gt;\nOutput printed to the &#39;=\r\nrawOut&#39; PrintWriter is escaped and wrapped in a &lt;br&gt;\n&lt;PRE&gt; element in=\r\n the resulting HTML page. So, any HTML tags are rendered &lt;br&gt;\ninert.&lt;br&gt;\n&lt;b=\r\nr&gt;\nIf you&#39;re sure the output is very simple, or it is intentionally using &lt;=\r\nbr&gt;\nHTML for styling, use &#39;htmlOut&#39;. If it might contain inadvertent HTML, =\r\n&lt;br&gt;\nor you want to see (rather than have the browser interpret) any HTML i=\r\nn &lt;br&gt;\nthe output, use &#39;rawOut&#39;.&lt;br&gt;\n&lt;br&gt;\n- Gordon @ IA&lt;br&gt;\n&lt;/p&gt;\n\n    &lt;/div=\r\n&gt;\n     \n\n\n\n \n\n\n&lt;/div&gt;&lt;/blockquote&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;br&gt;\n\n      \r\n--0-2066173476-1273002684=:80688--\r\n\n"}}