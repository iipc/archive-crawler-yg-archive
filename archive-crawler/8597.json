{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":563559132,"authorName":"Ahmed Alsum","from":"Ahmed Alsum &lt;aalsum@...&gt;","replyTo":"LIST","senderId":"LL5apJ6wZ4aI6H9djoUbrzul6JaVCe7IHcysQMGkWCtYQrF0gSOjbYWAm-FYhNjt9FS_XH1-fkTGabztqyykKs4dOpXSEn1j","spamInfo":{"isSpam":false,"reason":"12"},"subject":"Re: [archive-crawler] Killing hang up threads in Heritrix","postDate":"1409182592","msgId":8597,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PEQwMjNCODM3LkI3MjUlYWFsc3VtQHN0YW5mb3JkLmVkdT4=","inReplyToHeader":"PDUzRkU2N0JDLjcwMDA3MDhAYXJjaGl2ZS5vcmc+","referencesHeader":"PEQwMjM0QjRDLkI2Q0MlYWFsc3VtQHN0YW5mb3JkLmVkdT4gPENBQS16NzBKUFMrK3lUSnc5NENhYzlIS29OVVFlT3l0VVZmZ0Zwd1V6NVZOaXBIQWJRZ0BtYWlsLmdtYWlsLmNvbT4gPDUzRkU2N0JDLjcwMDA3MDhAYXJjaGl2ZS5vcmc+"},"prevInTopic":8596,"nextInTopic":8598,"prevInTime":8596,"nextInTime":8598,"topicId":8594,"numMessagesInTopic":7,"msgSnippet":"Thanks Noah and Gordon, You are right, there is no safe way to kill thread while running. Our system environment is java version 1.6.0_45 Java(TM) SE Runtime","rawEmail":"Return-Path: &lt;aalsum@...&gt;\r\nX-Sender: aalsum@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 93005 invoked by uid 102); 27 Aug 2014 23:36:41 -0000\r\nX-Received: from unknown (HELO mtaq6.grp.bf1.yahoo.com) (10.193.84.37)\n  by m7.grp.bf1.yahoo.com with SMTP; 27 Aug 2014 23:36:41 -0000\r\nX-Received: (qmail 31009 invoked from network); 27 Aug 2014 23:36:41 -0000\r\nX-Received: from unknown (HELO smtp.stanford.edu) (98.138.100.121)\n  by mtaq6.grp.bf1.yahoo.com with SMTP; 27 Aug 2014 23:36:41 -0000\r\nX-Received: from codegreen1.stanford.edu (codegreen1.Stanford.EDU [171.67.224.2])\n\t(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))\n\t(No client certificate requested)\n\tby smtp.stanford.edu (Postfix) with ESMTPS id 8EBA3101DA3\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Wed, 27 Aug 2014 16:36:40 -0700 (PDT)\r\nX-Received: from codegreen1.stanford.edu (localhost.localdomain [127.0.0.1])\n\tby codegreen1.stanford.edu (Postfix) with ESMTP id 8491D8B\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Wed, 27 Aug 2014 16:36:40 -0700 (PDT)\r\nX-Received: from smtp.stanford.edu (smtp2.Stanford.EDU [171.67.219.82])\n\t(using TLSv1 with cipher ADH-AES256-SHA (256/256 bits))\n\t(No client certificate requested)\n\tby codegreen1.stanford.edu (Postfix) with ESMTP id 666DD85\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Wed, 27 Aug 2014 16:36:40 -0700 (PDT)\r\nX-Received: from smtp.stanford.edu (localhost [127.0.0.1])\n\tby localhost (Postfix) with SMTP id 55A49341EAD\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Wed, 27 Aug 2014 16:36:40 -0700 (PDT)\r\nX-Received: from [10.35.51.102] (DN0a233366.SUNet [10.35.51.102])\n\t(using TLSv1 with cipher DES-CBC3-SHA (168/168 bits))\n\t(No client certificate requested)\n\t(Authenticated sender: aalsum)\n\tby smtp.stanford.edu (Postfix) with ESMTPSA id 1A20D341EAE\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Wed, 27 Aug 2014 16:36:37 -0700 (PDT)\r\nUser-Agent: Microsoft-MacOutlook/14.4.3.140616\r\nDate: Wed, 27 Aug 2014 16:36:32 -0700\r\nTo: &lt;archive-crawler@yahoogroups.com&gt;\r\nMessage-ID: &lt;D023B837.B725%aalsum@...&gt;\r\nThread-Topic: [archive-crawler] Killing hang up threads in Heritrix\r\nReferences: &lt;D0234B4C.B6CC%aalsum@...&gt;\n &lt;CAA-z70JPS++yTJw94Cac9HKoNUQeOytUVfgFpwUz5VNipHAbQg@...&gt;\n &lt;53FE67BC.7000708@...&gt;\r\nIn-Reply-To: &lt;53FE67BC.7000708@...&gt;\r\nMime-version: 1.0\r\nContent-type: multipart/alternative;\n\tboundary=&quot;B_3492002198_24356099&quot;\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nSubject: Re: [archive-crawler] Killing hang up threads in Heritrix\r\nX-Yahoo-Group-Post: member; u=563559132\r\nFrom: Ahmed Alsum &lt;aalsum@...&gt;\r\n\r\n\r\n--B_3492002198_24356099\r\nContent-type: text/plain;\n\tcharset=&quot;ISO-8859-1&quot;\r\nContent-transfer-encoding: quoted-printable\r\n\r\nThanks Noah and Gordon,\n\nYou are right, there is no safe way to kill thread=\r\n while running. Our system\nenvironment is \njava version &quot;1.6.0_45&quot;\n\nJava(TM=\r\n) SE Runtime Environment (build 1.6.0_45-b06)\n\nJava HotSpot(TM) 64-Bit Serv=\r\ner VM (build 20.45-b01, mixed mode)\n\nRed Hat Enterprise Linux Server releas=\r\ne 6.4 (Santiago)\n\n\nI=B9m running the jobs that hanged before and see how it=\r\n will behave. I will\ntry to capture the log and the thread status if it stu=\r\nck again.\n\n@Gordon, I will add your comment to the post in order to give th=\r\ne reader the\ncomplete picture.\n\nRegards,\nAhmed\n\n\nFrom:  &quot;Gordon Mohr gojomo=\r\n@... [archive-crawler]&quot;\n&lt;archive-crawler@yahoogroups.com&gt;\nReply-To:=\r\n  &lt;archive-crawler@yahoogroups.com&gt;\nDate:  Wednesday, August 27, 2014 at 4:=\r\n20 PM\nTo:  &lt;archive-crawler@yahoogroups.com&gt;\nSubject:  Re: [archive-crawler=\r\n] Killing hang up threads in Heritrix\n\n \n \n \n \n   \n\nIndeed I don&#39;t believe =\r\nthat generally, you can kill threads in this\nmanner and still be sure that =\r\nJava (including native JVM) data\nstructures are still in a consistent state=\r\n. So you could have mysterious\ncorruption or crashes, only evident arbitrar=\r\nily later.\n\nFully diagnosing and correcting the cause of any such hangs is =\r\na better\napproach. Essentially every step of the usual Heritrix operation a=\r\nlready\nhas designed-in timeouts or other limitations, so any indefinite han=\r\ng is\na defect that should be fixed rather than adapted-to.\n\nAs Noah request=\r\ns, representative stacks might give more ideas.\n\nNotably, exactly those pla=\r\nces that might be &#39;safest&#39; to do an\nout-of-band thread kill may also be the=\r\n easiest problems to diagnose/fix.\n\nAlso, I recall in the long-ago era of e=\r\narly JVMs and often-flaky Linux\nthreading (~2004ish; before/early-days-of N=\r\nPTL era), some JVM/OS\ncombinations were prone to threads transiently missin=\r\ng the &#39;wake&#39; signal\nfrom the OS.  In such cases, a workaround was to connec=\r\nt with gdb, and\nsend the right &#39;IO is ready&#39; signal to the thread - which t=\r\nhen resumed\nprogress. (I think it was SIGIO, but not sure.)\n\nWe&#39;re long sep=\r\narated from those bad old days, I hope =AD unless you&#39;re\nusing an older/aty=\r\npical OS/JVM combination, or some other mix of new\nhardware/filesystems tha=\r\nt might have similar undebugged multi-threaded\ntiming issues. So I wonder i=\r\nf a similar &quot;send the overlooked signal&quot;\ncould be tried here, to unstick ra=\r\nther than kill the thread.\n\n(For a few subsequent years, OpenJDK at least t=\r\nhrough 1.6 versions often\nhad mysterious thread hangs, that I tended to att=\r\nribute to some sort of\nsimilar issue - and tended to disappear when avoidin=\r\ng OpenJDK.)\n\n- Gordon\n\nOn 8/27/14, 10:16 AM, Noah Levitt nlevitt@...=\r\ng [archive-crawler]\nwrote:\n&gt;\n&gt;\n&gt; Hey Ahmed,\n&gt;\n&gt; Do you have a stack trace o=\r\nf these hung threads? It&#39;s not something I\n&gt; see very often. Usually they w=\r\nill finish if you wait them out.\n&gt;\n&gt; Noah\n&gt;\n&gt;\n&gt;\n&gt; On Wed, Aug 27, 2014 at 8=\r\n:46 AM, Ahmed Alsum aalsum@...\n&gt; &lt;mailto:aalsum@...&gt; [arc=\r\nhive-crawler]\n&gt; &lt;archive-crawler@yahoogroups.com\n&gt; &lt;mailto:archive-crawler@=\r\nyahoogroups.com&gt;&gt; wrote:\n&gt;\n&gt;\n&gt;\n&gt;     Hello,\n&gt;\n&gt;     Sometimes we face the p=\r\nroblem of hang up threads in Heritrix job\n&gt;     that may suspend the whole =\r\njob. I investigated in this issue and\n&gt;     came with a method to kill thes=\r\ne threads. I would like to share the\n&gt;     idea with you and looking forwar=\r\nd for your feedback if there is any\n&gt;     concern or if there are other met=\r\nhods that I may add to the post.\n&gt;\n&gt;     \nhttp://a-alsum.blogspot.com/2014/=\r\n08/killing-hang-up-threads-in-heritrix.html\n&gt;\n&gt;     Best regards,\n&gt;     Ahm=\r\ned AlSum, Ph.D.\n&gt;     Web Archiving Engineer\n&gt;     Digital Library System a=\r\nnd Services\n&gt;     Stanford University Library\n&gt;     Work: 650-868-7449 &lt;tel=\r\n:650-868-7449&gt;\n&gt;\n&gt;     &lt; /div&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; \n \n   \n\n \n\n\n\r\n--B_3492002198_24356099\r\nContent-type: text/html;\n\tcharset=&quot;ISO-8859-1&quot;\r\nContent-transfer-encoding: quoted-printable\r\n\r\n&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body style=3D&quot;word-wrap: break-word; -webkit-nbsp-mode:=\r\n space; -webkit-line-break: after-white-space; color: rgb(0, 0, 0); font-si=\r\nze: 14px; font-family: Calibri, sans-serif;&quot;&gt;&lt;div&gt;Thanks Noah and Gordon,&lt;/=\r\ndiv&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You are right, there is no safe way to kill thread =\r\nwhile running. Our system environment is&nbsp;&lt;/div&gt;\n&lt;p style=3D&quot;margin: 0p=\r\nx; font-size: 11px; font-family: Menlo;&quot;&gt;java version &quot;1.6.0_45&quot;&lt;/p&gt;\n&lt;p sty=\r\nle=3D&quot;margin: 0px; font-size: 11px; font-family: Menlo;&quot;&gt;Java(TM) SE Runtim=\r\ne Environment (build 1.6.0_45-b06)&lt;/p&gt;\n&lt;p style=3D&quot;margin: 0px; font-size: =\r\n11px; font-family: Menlo;&quot;&gt;Java HotSpot(TM) 64-Bit Server VM (build 20.45-b=\r\n01, mixed mode)&lt;/p&gt;\n&lt;p style=3D&quot;margin: 0px; font-size: 11px; font-family: =\r\nMenlo;&quot;&gt;Red Hat Enterprise Linux Server release 6.4 (Santiago)&lt;/p&gt;&lt;div&gt;&lt;br&gt;=\r\n&lt;/div&gt;&lt;div&gt;I&#8217;m running the jobs that hanged before and see how it wil=\r\nl behave. I will try to capture the log and the thread status if it stuck a=\r\ngain.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;@Gordon, I will add your comment to the post=\r\n in order to give the reader the complete picture.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div=\r\n&gt;Regards,&lt;/div&gt;&lt;div&gt;Ahmed&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;span id=3D&quot;OL=\r\nK_SRC_BODY_SECTION&quot;&gt;&lt;div style=3D&quot;font-family:Calibri; font-size:11pt; text=\r\n-align:left; color:black; BORDER-BOTTOM: medium none; BORDER-LEFT: medium n=\r\none; PADDING-BOTTOM: 0in; PADDING-LEFT: 0in; PADDING-RIGHT: 0in; BORDER-TOP=\r\n: #b5c4df 1pt solid; BORDER-RIGHT: medium none; PADDING-TOP: 3pt&quot;&gt;&lt;span sty=\r\nle=3D&quot;font-weight:bold&quot;&gt;From: &lt;/span&gt; &quot;Gordon Mohr &lt;a href=3D&quot;mailto:gojomo=\r\n@...&quot;&gt;gojomo@...&lt;/a&gt; [archive-crawler]&quot; &lt;&lt;a href=3D&quot;mail=\r\nto:archive-crawler@yahoogroups.com&quot;&gt;archive-crawler@yahoogroups.com&lt;/a&gt;&gt;=\r\n&lt;br&gt;&lt;span style=3D&quot;font-weight:bold&quot;&gt;Reply-To: &lt;/span&gt; &lt;&lt;a href=3D&quot;mailt=\r\no:archive-crawler@yahoogroups.com&quot;&gt;archive-crawler@yahoogroups.com&lt;/a&gt;&gt;&lt;=\r\nbr&gt;&lt;span style=3D&quot;font-weight:bold&quot;&gt;Date: &lt;/span&gt; Wednesday, August 27, 201=\r\n4 at 4:20 PM&lt;br&gt;&lt;span style=3D&quot;font-weight:bold&quot;&gt;To: &lt;/span&gt; &lt;&lt;a href=3D=\r\n&quot;mailto:archive-crawler@yahoogroups.com&quot;&gt;archive-crawler@yahoogroups.com&lt;/a=\r\n&gt;&gt;&lt;br&gt;&lt;span style=3D&quot;font-weight:bold&quot;&gt;Subject: &lt;/span&gt; Re: [archive-cra=\r\nwler] Killing hang up threads in Heritrix&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;\n\n\n\n=\r\n\n\n\n\n\n \n&lt;div style=3D&quot;background-color: #fff;&quot;&gt;&lt;span style=3D&quot;display:none&quot;&gt;=\r\n&nbsp;&lt;/span&gt;\n\n    &lt;div id=3D&quot;ygrp-text&quot;&gt;\n      \n      \n      &lt;p&gt;Indeed I d=\r\non&#39;t believe that generally, you can kill threads in this &lt;br&gt;\nmanner and s=\r\ntill be sure that Java (including native JVM) data &lt;br&gt;\nstructures are stil=\r\nl in a consistent state. So you could have mysterious &lt;br&gt;\ncorruption or cr=\r\nashes, only evident arbitrarily later.&lt;br&gt;&lt;br&gt;\nFully diagnosing and correct=\r\ning the cause of any such hangs is a better &lt;br&gt;\napproach. Essentially ever=\r\ny step of the usual Heritrix operation already &lt;br&gt;\nhas designed-in timeout=\r\ns or other limitations, so any indefinite hang is &lt;br&gt;\na defect that should=\r\n be fixed rather than adapted-to.&lt;br&gt;&lt;br&gt;\nAs Noah requests, representative =\r\nstacks might give more ideas.&lt;br&gt;&lt;br&gt;\nNotably, exactly those places that mi=\r\nght be &#39;safest&#39; to do an &lt;br&gt;\nout-of-band thread kill may also be the easie=\r\nst problems to diagnose/fix.&lt;br&gt;&lt;br&gt;\nAlso, I recall in the long-ago era of =\r\nearly JVMs and often-flaky Linux &lt;br&gt;\nthreading (~2004ish; before/early-day=\r\ns-of NPTL era), some JVM/OS &lt;br&gt;\ncombinations were prone to threads transie=\r\nntly missing the &#39;wake&#39; signal &lt;br&gt;\nfrom the OS.  In such cases, a workarou=\r\nnd was to connect with gdb, and &lt;br&gt;\nsend the right &#39;IO is ready&#39; signal to=\r\n the thread - which then resumed &lt;br&gt;\nprogress. (I think it was SIGIO, but =\r\nnot sure.)&lt;br&gt;&lt;br&gt;\nWe&#39;re long separated from those bad old days, I hope &#8=\r\n211; unless you&#39;re &lt;br&gt;\nusing an older/atypical OS/JVM combination, or some=\r\n other mix of new &lt;br&gt;\nhardware/filesystems that might have similar undebug=\r\nged multi-threaded &lt;br&gt;\ntiming issues. So I wonder if a similar &quot;send the o=\r\nverlooked signal&quot; &lt;br&gt;\ncould be tried here, to unstick rather than kill the=\r\n thread.&lt;br&gt;&lt;br&gt;\n(For a few subsequent years, OpenJDK at least through 1.6 =\r\nversions often &lt;br&gt;\nhad mysterious thread hangs, that I tended to attribute=\r\n to some sort of &lt;br&gt;\nsimilar issue - and tended to disappear when avoiding=\r\n OpenJDK.)&lt;br&gt;&lt;br&gt;\n- Gordon&lt;br&gt;&lt;br&gt;\nOn 8/27/14, 10:16 AM, Noah Levitt &lt;a hr=\r\nef=3D&quot;mailto:nlevitt@...&quot;&gt;nlevitt@...&lt;/a&gt; [archive-crawler]=\r\n &lt;br&gt;\nwrote:&lt;br&gt;\n&gt;&lt;br&gt;\n&gt;&lt;br&gt;\n&gt; Hey Ahmed,&lt;br&gt;\n&gt;&lt;br&gt;\n&gt; Do you=\r\n have a stack trace of these hung threads? It&#39;s not something I&lt;br&gt;\n&gt; se=\r\ne very often. Usually they will finish if you wait them out.&lt;br&gt;\n&gt;&lt;br&gt;\n&=\r\ngt; Noah&lt;br&gt;\n&gt;&lt;br&gt;\n&gt;&lt;br&gt;\n&gt;&lt;br&gt;\n&gt; On Wed, Aug 27, 2014 at 8:46 A=\r\nM, Ahmed Alsum &lt;a href=3D&quot;mailto:aalsum@...&quot;&gt;aalsum@...&lt;/=\r\na&gt;&lt;br&gt;\n&gt; &lt;&lt;a href=3D&quot;mailto:aalsum@...&quot;&gt;mailto:aalsum@stanfo=\r\nrd.edu&lt;/a&gt;&gt; [archive-crawler]&lt;br&gt;\n&gt; &lt;&lt;a href=3D&quot;mailto:archive-cra=\r\nwler@yahoogroups.com&quot;&gt;archive-crawler@yahoogroups.com&lt;/a&gt;&lt;br&gt;\n&gt; &lt;&lt;a h=\r\nref=3D&quot;mailto:archive-crawler@yahoogroups.com&gt;&quot;&gt;mailto:archive-crawler@y=\r\nahoogroups.com&gt;&lt;/a&gt;&gt; wrote:&lt;br&gt;\n&gt;&lt;br&gt;\n&gt;&lt;br&gt;\n&gt;&lt;br&gt;\n&gt;     H=\r\nello,&lt;br&gt;\n&gt;&lt;br&gt;\n&gt;     Sometimes we face the problem of hang up thread=\r\ns in Heritrix job&lt;br&gt;\n&gt;     that may suspend the whole job. I investigat=\r\ned in this issue and&lt;br&gt;\n&gt;     came with a method to kill these threads.=\r\n I would like to share the&lt;br&gt;\n&gt;     idea with you and looking forward f=\r\nor your feedback if there is any&lt;br&gt;\n&gt;     concern or if there are other=\r\n methods that I may add to the post.&lt;br&gt;\n&gt;&lt;br&gt;\n&gt;     &lt;a href=3D&quot;http:=\r\n//a-alsum.blogspot.com/2014/08/killing-hang-up-threads-in-heritrix.html&quot;&gt;ht=\r\ntp://a-alsum.blogspot.com/2014/08/killing-hang-up-threads-in-heritrix.html&lt;=\r\n/a&gt;&lt;br&gt;\n&gt;&lt;br&gt;\n&gt;     Best regards,&lt;br&gt;\n&gt;     Ahmed AlSum, Ph.D.&lt;br&gt;=\r\n\n&gt;     Web Archiving Engineer&lt;br&gt;\n&gt;     Digital Library System and Se=\r\nrvices&lt;br&gt;\n&gt;     Stanford University Library&lt;br&gt;\n&gt;     Work: 650-868-=\r\n7449 &lt;tel:650-868-7449&gt;&lt;br&gt;\n&gt;&lt;br&gt;\n&gt;     &lt; /div&gt;&lt;br&gt;\n&gt;&lt;=\r\nbr&gt;\n&gt;&lt;br&gt;\n&gt;&lt;br&gt;\n&gt;&lt;br&gt;\n&gt; &lt;br&gt;&lt;/p&gt;\n\n    &lt;/div&gt;\n     \n\n    &lt;/div&gt;&lt;=\r\n/div&gt;&lt;!-- end group email --&gt;&lt;/span&gt;&lt;/body&gt;&lt;/html&gt;\n\r\n--B_3492002198_24356099--\r\n\n"}}