{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr","from":"Gordon Mohr &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"jWReDfqk7rcC9geJkNmO7QHtuuYHcCIJxs9PYiLZ9NL7xRhKwXcNwLlaJRkhwJmxRNbd0_rp0Z62S33wod3i8FxCa_ZEcz8","spamInfo":{"isSpam":false,"reason":"6"},"subject":"Re: [archive-crawler] Killing hang up threads in Heritrix","postDate":"1409183286","msgId":8598,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDUzRkU2RTM2LjgwNjAyMDVAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PDUzRkU2N0JDLjcwMDA3MDhAYXJjaGl2ZS5vcmc+","referencesHeader":"PEQwMjM0QjRDLkI2Q0MlYWFsc3VtQHN0YW5mb3JkLmVkdT4gPENBQS16NzBKUFMrK3lUSnc5NENhYzlIS29OVVFlT3l0VVZmZ0Zwd1V6NVZOaXBIQWJRZ0BtYWlsLmdtYWlsLmNvbT4gPDUzRkU2N0JDLjcwMDA3MDhAYXJjaGl2ZS5vcmc+"},"prevInTopic":8597,"nextInTopic":8601,"prevInTime":8597,"nextInTime":8599,"topicId":8594,"numMessagesInTopic":7,"msgSnippet":"Having just looked more at jdb and the blog post you referenced, I see that the jdb kill is likely a bit safer than I thought - it injects an exception into","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 28740 invoked by uid 102); 27 Aug 2014 23:48:08 -0000\r\nX-Received: from unknown (HELO mtaq1.grp.bf1.yahoo.com) (10.193.84.32)\n  by m1.grp.bf1.yahoo.com with SMTP; 27 Aug 2014 23:48:08 -0000\r\nX-Received: (qmail 11718 invoked from network); 27 Aug 2014 23:48:08 -0000\r\nX-Received: from unknown (HELO relay01.pair.com) (98.139.245.163)\n  by mtaq1.grp.bf1.yahoo.com with SMTP; 27 Aug 2014 23:48:08 -0000\r\nX-Received: (qmail 93048 invoked by uid 0); 27 Aug 2014 23:48:07 -0000\r\nX-Received: from 142.254.51.72 (HELO probook.local) (142.254.51.72)\n  by relay01.pair.com with SMTP; 27 Aug 2014 23:48:07 -0000\r\nX-pair-Authenticated: 142.254.51.72\r\nMessage-ID: &lt;53FE6E36.8060205@...&gt;\r\nDate: Wed, 27 Aug 2014 16:48:06 -0700\r\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:24.0) Gecko/20100101 Thunderbird/24.6.0\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;D0234B4C.B6CC%aalsum@...&gt; &lt;CAA-z70JPS++yTJw94Cac9HKoNUQeOytUVfgFpwUz5VNipHAbQg@...&gt; &lt;53FE67BC.7000708@...&gt;\r\nIn-Reply-To: &lt;53FE67BC.7000708@...&gt;\r\nContent-Type: text/plain; charset=UTF-8; format=flowed\r\nContent-Transfer-Encoding: 8bit\r\nX-eGroups-Msg-Info: 1:6:0:0:0\r\nSubject: Re: [archive-crawler] Killing hang up threads in Heritrix\r\nX-Yahoo-Group-Post: member; u=137285340; y=0tLYHnGQQ2lrqkzrQ54DuW0U7FhkoVxhFBT5dh55ZDlx\r\nX-Yahoo-Profile: gojomo\r\nFrom: Gordon Mohr &lt;gojomo@...&gt;\r\n\r\nHaving just looked more at jdb and the blog post you referenced, I see \nthat the jdb &#39;kill&#39; is likely a bit safer than I thought - it injects an \nexception into the thread, rather than doing some sort of native kill \n(like say the old deprecated Thread.kill() method).\n\nIt&#39;d still depend on where it was injected, though - the ToeThread code \nhas some last-ditch catchall handlers that try to clean things up \nproperly, but I wouldn&#39;t rely on that in any particular recurring \nsituation without a closer look.\n\nAnother possibility that occurred to me is that the thread might not be \n&#39;hung&#39; idly, but rather in some busy-spin on some processing step.\n\nIn my experience this has been most common when a casually-constructed \nregex hits some unexpected worst-case input. And in such cases, you \nmight want to abort that match, but then also want to tighten the regex \n(most often with reluctant-match qualifiers or other quick-fail tricks) \nto prevent the same spin in the future.\n\nThe jdb method might be an OK method to break out of such runaway regex \nmatches... but I suspect you could do the same via the &#39;Scripting \nConsole&#39;: via the CrawlController & ToePool, get the offending thread, \nand call its ToeThread.kill() method.\n\n- Gordon\n\nOn 8/27/14, 4:20 PM, Gordon Mohr gojomo@... [archive-crawler] wrote:\n&gt; Indeed I don&#39;t believe that generally, you can kill threads in this\n&gt; manner and still be sure that Java (including native JVM) data\n&gt; structures are still in a consistent state. So you could have mysterious\n&gt; corruption or crashes, only evident arbitrarily later.\n&gt;\n&gt; Fully diagnosing and correcting the cause of any such hangs is a better\n&gt; approach. Essentially every step of the usual Heritrix operation already\n&gt; has designed-in timeouts or other limitations, so any indefinite hang is\n&gt; a defect that should be fixed rather than adapted-to.\n&gt;\n&gt; As Noah requests, representative stacks might give more ideas.\n&gt;\n&gt; Notably, exactly those places that might be &#39;safest&#39; to do an\n&gt; out-of-band thread kill may also be the easiest problems to diagnose/fix.\n&gt;\n&gt; Also, I recall in the long-ago era of early JVMs and often-flaky Linux\n&gt; threading (~2004ish; before/early-days-of NPTL era), some JVM/OS\n&gt; combinations were prone to threads transiently missing the &#39;wake&#39; signal\n&gt; from the OS.  In such cases, a workaround was to connect with gdb, and\n&gt; send the right &#39;IO is ready&#39; signal to the thread - which then resumed\n&gt; progress. (I think it was SIGIO, but not sure.)\n&gt;\n&gt; We&#39;re long separated from those bad old days, I hope â€“ unless you&#39;re\n&gt; using an older/atypical OS/JVM combination, or some other mix of new\n&gt; hardware/filesystems that might have similar undebugged multi-threaded\n&gt; timing issues. So I wonder if a similar &quot;send the overlooked signal&quot;\n&gt; could be tried here, to unstick rather than kill the thread.\n&gt;\n&gt; (For a few subsequent years, OpenJDK at least through 1.6 versions often\n&gt; had mysterious thread hangs, that I tended to attribute to some sort of\n&gt; similar issue - and tended to disappear when avoiding OpenJDK.)\n&gt;\n&gt; - Gordon\n&gt;\n&gt; On 8/27/14, 10:16 AM, Noah Levitt nlevitt@... [archive-crawler]\n&gt; wrote:\n&gt;&gt;\n&gt;&gt;\n&gt;&gt; Hey Ahmed,\n&gt;&gt;\n&gt;&gt; Do you have a stack trace of these hung threads? It&#39;s not something I\n&gt;&gt; see very often. Usually they will finish if you wait them out.\n&gt;&gt;\n&gt;&gt; Noah\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt; On Wed, Aug 27, 2014 at 8:46 AM, Ahmed Alsum aalsum@...\n&gt;&gt; &lt;mailto:aalsum@...&gt; [archive-crawler]\n&gt;&gt; &lt;archive-crawler@yahoogroups.com\n&gt;&gt; &lt;mailto:archive-crawler@yahoogroups.com&gt;&gt; wrote:\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;      Hello,\n&gt;&gt;\n&gt;&gt;      Sometimes we face the problem of hang up threads in Heritrix job\n&gt;&gt;      that may suspend the whole job. I investigated in this issue and\n&gt;&gt;      came with a method to kill these threads. I would like to share the\n&gt;&gt;      idea with you and looking forward for your feedback if there is any\n&gt;&gt;      concern or if there are other methods that I may add to the post.\n&gt;&gt;\n&gt;&gt;      http://a-alsum.blogspot.com/2014/08/killing-hang-up-threads-in-heritrix.html\n&gt;&gt;\n&gt;&gt;      Best regards,\n&gt;&gt;      Ahmed AlSum, Ph.D.\n&gt;&gt;      Web Archiving Engineer\n&gt;&gt;      Digital Library System and Services\n&gt;&gt;      Stanford University Library\n&gt;&gt;      Work: 650-868-7449 &lt;tel:650-868-7449&gt;\n&gt;&gt;\n&gt;&gt;      &lt; /div&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;\n&gt;\n&gt; ------------------------------------\n&gt; Posted by: Gordon Mohr &lt;gojomo@...&gt;\n&gt; ------------------------------------\n&gt;\n&gt;\n&gt; ------------------------------------\n&gt;\n&gt; Yahoo Groups Links\n&gt;\n&gt;\n&gt;\n\n"}}