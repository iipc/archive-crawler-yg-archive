{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr","from":"Gordon Mohr &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"7Li6FGBy4SJxlM2j3yPkpv6q_dfVdCcGcO1_5rIAez1ueRh9RZTECJGEB38qGkOhzvrq8pPsYHfeG7I3oVuRqsXBN1l8Qb0","spamInfo":{"isSpam":false,"reason":"12"},"subject":"Re: [archive-crawler] Exception in usage of BucketQueueAssignmentPolicy in Heritrix-2.0.0","postDate":"1210210648","msgId":5186,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDQ4MjI1OTU4LjkwNDA0MDhAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PDhDQTdFNUJCMzU4N0M1Ny01NkMtRjE3QHdlYm1haWwtbmMxMy5zeXNvcHMuYW9sLmNvbT4=","referencesHeader":"PDhDQTdDRTFEOTNBMDIwRC1GRTgtMzczOEB3ZWJtYWlsLWRkMTQuc3lzb3BzLmFvbC5jb20+IDw0ODFGQjM5MS4zMDMwMDA2QGFyY2hpdmUub3JnPiA8OENBN0Q2NTdGQzZEREUzLTEyNTAtNzk2NUB3ZWJtYWlsLW5mMTYuc2ltLmFvbC5jb20+IDw0ODIwQzcyMC4zMDkwNDA2QGFyY2hpdmUub3JnPiA8OENBN0UyMDE2ODRGODhDLTFGMjQtMzRFM0B3ZWJtYWlsLW5iMTEuc3lzb3BzLmFvbC5jb20+IDw0ODIxNjA4Ny43MDkwNDA2QGFyY2hpdmUub3JnPiA8OENBN0U1QkIzNTg3QzU3LTU2Qy1GMTdAd2VibWFpbC1uYzEzLnN5c29wcy5hb2wuY29tPg=="},"prevInTopic":5183,"nextInTopic":5187,"prevInTime":5185,"nextInTime":5187,"topicId":5174,"numMessagesInTopic":10,"msgSnippet":"I discovered why I could not reproduce your error. Although I had changed the root:queue-assignment-policy to be a BucketQueueAssignmentPolicy, the frontier","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 89290 invoked from network); 8 May 2008 01:37:25 -0000\r\nX-Received: from unknown (66.218.67.94)\n  by m55.grp.scd.yahoo.com with QMQP; 8 May 2008 01:37:25 -0000\r\nX-Received: from unknown (HELO relay01.pair.com) (209.68.5.15)\n  by mta15.grp.scd.yahoo.com with SMTP; 8 May 2008 01:37:24 -0000\r\nX-Received: (qmail 21843 invoked from network); 8 May 2008 01:37:23 -0000\r\nX-Received: from unknown (HELO ?192.168.1.15?) (unknown)\n  by unknown with SMTP; 8 May 2008 01:37:23 -0000\r\nX-pair-Authenticated: 67.180.197.118\r\nMessage-ID: &lt;48225958.9040408@...&gt;\r\nDate: Wed, 07 May 2008 18:37:28 -0700\r\nUser-Agent: Thunderbird 2.0.0.14 (Windows/20080421)\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;8CA7CE1D93A020D-FE8-3738@...&gt; &lt;481FB391.3030006@...&gt; &lt;8CA7D657FC6DDE3-1250-7965@...&gt; &lt;4820C720.3090406@...&gt; &lt;8CA7E201684F88C-1F24-34E3@...&gt; &lt;48216087.7090406@...&gt; &lt;8CA7E5BB3587C57-56C-F17@...&gt;\r\nIn-Reply-To: &lt;8CA7E5BB3587C57-56C-F17@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: Gordon Mohr &lt;gojomo@...&gt;\r\nSubject: Re: [archive-crawler] Exception in usage of BucketQueueAssignmentPolicy\n in Heritrix-2.0.0\r\nX-Yahoo-Group-Post: member; u=137285340; y=K_wbPFiSQV3OnJzB7VH5-4c8E7qYsiefHSZu_EMjqTCr\r\nX-Yahoo-Profile: gojomo\r\n\r\nI discovered why I could not reproduce your error. Although I had \nchanged the root:queue-assignment-policy to be a \nBucketQueueAssignmentPolicy, the frontier (root:controller:frontier:) \nwas still using the previous policy. Further -- and this is a separate \nbug -- the UI did not allow me to change \nroot:controller:frontier:queue-assignment-policy to be either a \nbackreference to root:queue-assignment-policy or a new instance.\n\nHowever, when I deleted the root:queue-assignment-policy, then I could \nset root:controller:frontier:queue-assignment-policy to be \nBucketQueueAssignmentPolicy, and saw the NullPointerExceptions you \nreported.\n\nI&#39;ve looked at your change. I agree that prior to the change, when the \ntest against MAX_QUEUES_TO_HOLD_ALLQUEUES_IN_MEMORY is true, the \nfrontier is incompletely initialized. Your change looks like it is safe \nand addresses the problem.\n\nIt does appear to cause the allQueues field to be assigned twice: once \nin the default manner with the early call to the no-argument \ninitAllQueues(), then again inside the conditional (causing the first \nmap to be dereferenced). I don&#39;t know for sure any problems that will \ncause, but it seems less than ideal.\n\nSo, I&#39;ve just committed on the heritrix2 codebase a slightly different \napproach, which includes renaming the relevant methods for clarity, and \nshould also ensure the right initialization occurs even when a \nBucketQueueAssignmentPolicy is in use. If you can work from the \nheritrix2 SVN trunk, you may want to try it.\n\nThanks for the bug reports and suggested fix! I&#39;ve made an issue for the \nvarious bugs you encountered trying to use BucketQueueAssignmentPolicy:\n\n   http://webteam.archive.org/jira/browse/HER-1494\n\n- Gordon @ IA\n\nPratyush Banerjee wrote:\n&gt; \n&gt; Gordon,\n&gt; \n&gt; After quite some agonizing hours i think i found out what was causing \n&gt; such a horrible crash in the system.\n&gt; \n&gt; While debugging the Heritrix-2.0.0 code  i was looking at the  files \n&gt; WorkQueueFrontier.java and BdbFrontier.java and found out that all the \n&gt; queues\n&gt; used within  WorkQueueFrontier.java were null. Hence somehow they \n&gt; weren&#39;t being initialized properly.\n&gt; \n&gt; I also found out that in BdbFrontier.java there was a function called \n&gt; InitAllQueues() which actually initiates all the queues. The \n&gt; initAllQueues(boolean) function in WorkQueueFrontier.java was calling \n&gt; the above conditionally. I made a slight modification in the code in \n&gt; order to call the same unconditionally and the code seems to work fine now.\n&gt; \n&gt; I even undid the change you suggested about  initializing server-cache \n&gt; prior to QueueAssignmentPolicy and the code still works.\n&gt; \n&gt; to be specific here is what i changed in the code...\n&gt; \n&gt; Initially the code was\n&gt; \n&gt;     protected void initAllQueues(boolean recycle)\n&gt;     throws IOException, DatabaseException {\n&gt;         this.initAllQueues(); //Added by Pratyush to ensure Queues \n&gt; aren&#39;t NULL\n&gt;         if (workQueueDataOnDisk()\n&gt;                 && get(QUEUE_ASSIGNMENT_POLICY).maximumNumberOfKeys() &gt;= 0\n&gt;                 && get(QUEUE_ASSIGNMENT_POLICY).maximumNumberOfKeys() &lt;=\n&gt;                     MAX_QUEUES_TO_HOLD_ALLQUEUES_IN_MEMORY) {\n&gt;             this.allQueues = Collections.synchronizedMap(\n&gt;                     new HashMap&lt;String,WorkQueue&gt;());\n&gt;         }/* else {  // commented out by Pratyush to allow normal flow.\n&gt;             this.initAllQueues();\n&gt;         }*/\n&gt;         initQueue(recycle);\n&gt;        \n&gt;     }\n&gt; \n&gt; Please do let me know if this looks okkay to you or not.\n&gt; \n&gt; ~regards\n&gt; \n&gt; Pratyush\n&gt; -----Original Message-----\n&gt; From: Gordon Mohr &lt;gojomo@...&gt;\n&gt; To: archive-crawler@yahoogroups.com\n&gt; Sent: Wed, 7 May 2008 1:25 pm\n&gt; Subject: Re: [archive-crawler] Exception in usage of \n&gt; BucketQueueAssignmentPolicy in Heritrix-2.0.0\n&gt; \n&gt; I was able to reproduce the problem starting from a working,\n&gt; nearly-default configuration and substituting\n&gt; BucketQueueAssignme ntPolicy via the web UI&#39;s &#39;details&#39; option for the\n&gt; &#39;root: .\n&gt; \n&gt; The problem appears to be that the definition of certain shared modules\n&gt; by name inside the root map -- specifically &#39;queue-assignment- policy&#39;\n&gt; and then &#39;server-cache&#39; -- is in a problematic order once a\n&gt; BucketQueueAssignme ntPolicy is introduced.\n&gt; \n&gt; The &#39;queue-assignment- policy&#39; comes first and unlike other policies,\n&gt; BucketQueueAssignme ntPolicy needs a reference to a ServerCache. There\n&gt; should only be one ServerCache, so an instance is created there, and all\n&gt; later ServerCache references should refer back to it. However, the\n&gt; immediately following &#39;server-cache&#39; definition inside the &#39;root&#39; map\n&gt; can&#39;t be filled by autowire references, as the exception indicates.\n&gt; \n&gt; I&#39;m not certain if that&#39;s a truly necessary restriction, but a\n&gt; workaround that removed the problem for me was to ensure that the\n&gt; &#39;root:server- cache&#39; definition comes right before, rather than right\n&gt; after, &#39;root:queue- assignment- policy&#39;.\n&gt; \n&gt; This can&#39;t be done via the web UI; I did it in the on-disk global.sheet\n&gt; before attempting to swap in BucketQueueAssignme ntPolicy.\n&gt; \n&gt; A small test crawl with BucketQueueAssignme ntPolicy then launched and\n&gt; completed.\n&gt; \n&gt; Hope this helps,\n&gt; \n&gt; - Gordon @ IA\n&gt; \n&gt; Pratyush Banerjee wrote:\n&gt;  &gt;\n&gt;  &gt; Hi Gordon,\n&gt;  &gt;\n&gt;  &gt; Initially my application crashed due to selection of the\n&gt;  &gt; BucketQueueAssignme ntPolicy. Obviously i had changed other default\n&gt;  &gt; options like the\n&gt;  &gt; Archiver, and the politeness settings including max-retry and\n&gt;  &gt; retry-del;ay and fetch-http-timeout.\n&gt;  &gt;\n&gt;  &gt; However after the application crashed i tried changing the\n&gt;  &gt; queueAssignmentPoli cy in a frtesh installation of heritrix-2.0 and i\n&gt;  &gt; chose the profile basic-seed-sites crawl. But still the app crashed with\n&gt;  &gt; the same errors.\n&gt;  &gt;\n&gt;  &gt; I also tried selecting optionally a BdbServerCache or a\n&gt;  &gt; DefaultServerCache along with the BucketQueueAssignme ntPolicy but to no\n&gt;  &gt; avail.\n&gt;  &gt;\n&gt;  &gt; Pratyush\n&gt;  &gt;\n&gt;  &gt;\n&gt;  &gt; -----Original Message-----\n&gt;  &gt; From: Gordon Mohr &lt;gojomo@archive. org &lt;mailto:gojomo%40archive.org&gt;&gt;\n&gt;  &gt; To: archive-crawler@ yahoogroups. com \n&gt; &lt;mailto:archive-crawler%40yahoogroups.com&gt;\n&gt;  &gt; Sent: Wed, 7 May 2008 2:31 am\n&gt;  &gt; Subject: Re: [archive-crawler] Exception in usage of\n&gt;  &gt; BucketQueueAssignme ntPolicy in Heritrix-2.0. 0\n&gt;  &gt;\n&gt;  &gt; I suspect this is a different issue entirely. Have you made other\n&gt;  &gt; changes to the default configuration, besides specifying a\n&gt;  &gt; BucketQueueAssignme ntPolicy?\n&gt;  &gt;\n&gt;  &gt; Or is starting with a default configuration and only changing to\n&gt;  &gt; BucketQueueAssignme ntPolicy enough to trigger this error on launch?\n&gt;  &gt;\n&gt;  &gt; - Gordon @ IA\n&gt;  &gt;\n&gt;  &gt; Pratyush Banerjee wrote:\n&gt;  &gt; &gt; Thanks Gordon for your prompt reply.\n&gt;  &gt; &gt;\n&gt;  &gt; &gt; I already tried the changes you suggested.? But that does not however\n&gt;  &gt; solve the problem. I tried making the Key public and getting a\n&gt;  &gt; KeyManager to add keys in a static block within the class.? The previous\n&gt;  &gt; error was gone? obviously.\n&gt;  &gt; &gt;\n&gt;  &gt; &gt; But when i ran that code it again crashed giving me the following \n&gt; error.\n&gt;  &gt; &gt;\n&gt;  &gt; &gt; java.lang.RuntimeEx ception: org.archive. settings. path.PathChangeE\n&gt;  &gt; xception: Can&#39;t autowire map elements.\n&gt;  &gt; &gt; ??? at org.archive. crawler.framewor k.EngineImpl. launchJob(\n&gt;  &gt; EngineImpl. java:378)\n&gt;  &gt; &gt; ??? at sun.reflect. NativeMethodAcce ssorImpl. invoke0(Native Method)\n&gt;  &gt; &gt; ??? at sun.reflect. NativeMethodAcce ssorImpl. invoke(NativeMet\n&gt;  &gt; hodAccessorImpl. java:39)\n&gt; Plan your next roadtrip with MapQuest.com \n&gt; &lt;http://www.mapquest.com/?ncid=mpqmap00030000000004&gt;: America&#39;s #1 \n&gt; Mapping Site.\n&gt; \n\n"}}