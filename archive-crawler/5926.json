{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr","from":"Gordon Mohr &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"xji9FE60GmUQMtnBDaM_W3DG8MCLsbN70Xz_1R8YNonCqbntrYVq2rWRvTMrb_T4TXoIrh_w_bIexmE2WJsuhPng5F41vSc","spamInfo":{"isSpam":false,"reason":"6"},"subject":"Re: [archive-crawler] Heritrix 3, Too Many Open Files.","postDate":"1247606784","msgId":5926,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDRBNUNGODAwLjQwMzA4MDBAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PGgzaTVqaitkaTdvQGVHcm91cHMuY29tPg==","referencesHeader":"PGgzaTVqaitkaTdvQGVHcm91cHMuY29tPg=="},"prevInTopic":5919,"nextInTopic":5928,"prevInTime":5925,"nextInTime":5927,"topicId":5919,"numMessagesInTopic":5,"msgSnippet":"... You can see an example of a ReplayInputStream ( RIS ) acquired and then properly closed in ARCWriterProcessor.innerProcessResult(). It s acquired via... ","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 62499 invoked from network); 14 Jul 2009 21:26:25 -0000\r\nX-Received: from unknown (69.147.108.202)\n  by m2.grp.sp2.yahoo.com with QMQP; 14 Jul 2009 21:26:25 -0000\r\nX-Received: from unknown (HELO relay00.pair.com) (209.68.5.9)\n  by mta3.grp.re1.yahoo.com with SMTP; 14 Jul 2009 21:26:25 -0000\r\nX-Received: (qmail 48686 invoked from network); 14 Jul 2009 21:26:24 -0000\r\nX-Received: from 67.188.14.54 (HELO ?192.168.1.72?) (67.188.14.54)\n  by relay00.pair.com with SMTP; 14 Jul 2009 21:26:24 -0000\r\nX-pair-Authenticated: 67.188.14.54\r\nMessage-ID: &lt;4A5CF800.4030800@...&gt;\r\nDate: Tue, 14 Jul 2009 14:26:24 -0700\r\nUser-Agent: Thunderbird 2.0.0.22 (Windows/20090605)\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;h3i5jj+di7o@...&gt;\r\nIn-Reply-To: &lt;h3i5jj+di7o@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-eGroups-Msg-Info: 1:6:0:0:0\r\nFrom: Gordon Mohr &lt;gojomo@...&gt;\r\nSubject: Re: [archive-crawler] Heritrix 3, Too Many Open Files.\r\nX-Yahoo-Group-Post: member; u=137285340; y=ZxMwSF7M9v-6N9cGHpifDnhc4yyKJMtE-E2QqTA7iy6w\r\nX-Yahoo-Profile: gojomo\r\n\r\nprogre55 wrote:\n&gt; Hi people!\n&gt; \n&gt; I&#39;m running a broad crawl, and after about 40-50 minutes getting a TMOE exception, followed by &quot;ROS/RIS Already open for ToeThread ##&quot; exceptions.\n&gt; Following the FAQs (http://crawler.archive.org/faq.html#toomanyopenfiles) I have increased the number of open files to 32768, but as I can monitor by &quot;lsof -p #h3_process | wc -l&quot;, the number of open files is growing dramatically (currently, after 20 mins running it&#39;s 2032). I assume I have a leak somewhere in the custom processors.\n&gt; \n&gt; Here is the spring-conf file:\n&gt; http://pastie.org/545485\n&gt; \n&gt; I dont use most of the default processors, but instead have two custom processors:\n&gt; MySQLScheduler - does almost exactly what FrontierScheduler does, but also schedules pre-collected URL&#39;s from a database with the frontier.\n&gt; MySQLWriter processes the pages fetched and stores the necessary parts into a MySQL database.\n&gt; \n&gt; Where are ROS and RIS files opened and where are they closed within the heritrix processor-chain? Because I&#39;m assuming, as I&#39;m not using most of the built-in processors, I am missing the part where these files should be closed.\n\nYou can see an example of a ReplayInputStream (&#39;RIS&#39;) acquired and then \nproperly closed in ARCWriterProcessor.innerProcessResult(). It&#39;s \nacquired via...\n\n                 ris = curi.getRecorder().getRecordedInput()\n                         .getReplayInputStream();\n\n...and in a later finally clause...\n\n         } finally {\n             IOUtils.closeQuietly(ris);\n         }\n\n(The RecordingOutputStream is used during the HTTP fetch, to save all \nreturned data to an in-memory buffer with disk overflow, for reuse by \nany number of later processors.)\n\nThe other usual way to look over the recorded output is via the \nReplayCharSequence (&#39;RCS&#39;). It, too, should be closed so the underlying \nfile handles can be released. An example of its use is in \nExtractorCSS.innerExtract(). The ReplayCharSequence is acquired by...\n\n            cs = curi.getRecorder().getReplayCharSequence();\n\n...and later closed by...\n\n         } finally {\n             if (cs != null) {\n                 try {\n                     cs.close();\n                 } catch (IOException ioe) {\n                     logger.warning(TextUtils.exceptionToString(\n                         &quot;Failed close of ReplayCharSequence.&quot;, ioe));\n                 }\n             }\n         }\n\n(We could probably make our own version of closeQuietly taking a \nReplayCharSequence to simplify this pattern.)\n\nIt&#39;s certainly possible that you&#39;re running into a bug in our code, too \n-- H3 is still in early testing after a lot of changes.\n\nIf the problem persists after making sure your use of RIS/RCS is cleaned \nup properly, I would try taking a few &#39;jmap -histo&#39; snapshots as your \ncrawl climbs towards exhausting all file descriptors. Some object count \nwill be growing in rough proportion to the file handles, and give a clue \nwhat code (in your additions or core H3) is to blame.\n\nHope this helps,\n\n- Gordon @ IA\n\n\n&gt; Here is the tail of lsof -p #h3_process\n&gt; http://pastie.org/545492\n&gt; \n&gt; Any suggestions are highly appreciated!\n&gt; Thanks a lot in advance!\n&gt; \n&gt; King regards,\n&gt; Ikrom\n&gt; \n&gt; \n&gt; \n&gt; ------------------------------------\n&gt; \n&gt; Yahoo! Groups Links\n&gt; \n&gt; \n&gt; \n\n"}}