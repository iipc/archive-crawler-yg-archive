{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":582247024,"authorName":"Colin Samuel Rosenthal","from":"Colin Samuel Rosenthal &lt;csr@...&gt;","replyTo":"LIST","senderId":"ZwNzc2hsvtJPbak_l-mw7sMZWo8gera8uYMs5XGIKwfWWvsgJ4fqYFY6-8wcYQax6dZuebr2p-3XflTVx4lwKBXu-WJc21vTTA","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Pathological Regex Behaviour in MatchesListRegexDecideRule","postDate":"1537941765","msgId":8947,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDU2MWI1YzNkZmFmZTRhOGI4NzhmMDU5NDlhYTk0MWNiQGtiLmRrPg=="},"prevInTopic":0,"nextInTopic":8948,"prevInTime":8946,"nextInTime":8948,"topicId":8947,"numMessagesInTopic":4,"msgSnippet":"This is a follow-up my recent email about hanging jobs. When we look at the ToeThreads on our hanging jobs, we often see a stacktrace like this: ","rawEmail":"Return-Path: &lt;csr@...&gt;\r\nX-Sender: csr@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 15353 invoked by uid 102); 26 Sep 2018 06:02:49 -0000\r\nX-Received: from unknown (HELO mtaq5.grp.bf1.yahoo.com) (10.198.29.78)\n  by m4.grp.bf1.yahoo.com with SMTP; 26 Sep 2018 06:02:49 -0000\r\nX-Received: (qmail 26727 invoked from network); 26 Sep 2018 06:02:49 -0000\r\nX-Received: from unknown (HELO mta4004.groups.mail.bf1.yahoo.com) (10.201.195.149)\n  by mtaq5.grp.bf1.yahoo.com with SMTP; 26 Sep 2018 06:02:49 -0000\r\nX-Original-Return-Path: &lt;csr@...&gt;\r\nX-Received-SPF: pass (domain of kb.dk designates 89.104.206.38 as permitted sender)\r\nX-YMailISG: rSoig1oWLDv48TNnnFSzKYfnbwAx7rIqzxREVF8qea306Oi8\n X3pCvP.Ff0lgjPsKzcD3ONdnGJO8zUaqy_ZyWej935vUMNU9yGhj66lbyWUO\n 6Jip4GDirJgG00byrMonAgui5IPAORoXvvZqQrg.qRijrTknTY6Oo6m4TBxQ\n KWe24f84wl2lH5LVR46KYeDQbonKwk_1yANhep.GN3GCoBzfloCwmnLpIAnD\n 0r0eBOWATOsowt1fqzbPU_jQVHri2pwCF3yEaALt7ArVc9f4btsg_OEXbBOU\n 3gFlitY4WHHTEx2elXNPEJVt73KsXYf_Wefmij2SMZTcn50KHIcWbceUZfOj\n lDX8cBizdhxZ35kD0lqnNK_BH9zW0xGUX4zUgZfn6Jm9xGFJitVgD.r71SQW\n LYi1Mnm0J2LgpC_Svp6G6YGdvK1T6169x1KbRxz_VnBaXtKyPEIbJxJkkCCp\n hi.O9Y3Y0Y_3a_KjHpFlMPXQ2wR_hw28teSc6fLyCnR0ALmAonB.pK1BEAim\n P.BYAUlzfHR2VFS4f5HInNLD8Ff770tLbw1nEsZu76G16bHTwd4444t8SzHi\n cnyQaq6xDIRooW.t0H.ZtptpLYh6HdCkyYZVKw1wt4IZUrwZxDHjBZDPhAXm\n 9SpUo19Y5Slcv2nKveBT6zPlAhJVCUnE4Az4TQ5jY2rgg26LIn0f4x2V4O2j\n tXqx0YKztdu.o9iivv39gCBfN_URUT8Y3WE_JWRJXj9iRtqurbXrarrnouEw\n W8ELTEyWJTgZVYt8m5jCWcA5TLhxGTcTIycwUieGoNgedHuPq7hICLhFiJI8\n D9UX9LUVUPki7Rpl4a8K_wQXZeXD.GISKxJVSn6qnW_CSSP0geOoc3RzSSzk\n DTyyS0H1DnLGhKHGBJG.jw0dykq5yyv56ZqP9NMpVulGrCO0OW7QbtXNj3hl\n 9AHtsvj8O9YmQ6DmNokxMCVBZPdG2xx4aDo84sfC.d2nKyEvrMn3vRo5VMqJ\n 996oL_GtkXW7vVWZD4IlHydg8qlP8Wsq9reOZJAge1j6\r\nAuthentication-Results: mta4004.groups.mail.bf1.yahoo.com  from=kb.dk; domainkeys=neutral (no sig);  from=kb.dk; dkim=neutral (no sig)\r\nX-Received: from 127.0.0.1  (EHLO smtp-out12.electric.net) (89.104.206.38)\n  by mta4004.groups.mail.bf1.yahoo.com with SMTPS; Wed, 26 Sep 2018 06:02:48 +0000\r\nX-Received: from 1g52uL-00018e-W7 by out12d.electric.net with emc1-ok (Exim 4.90_1)\n\t(envelope-from &lt;csr@...&gt;)\n\tid 1g52uM-00019v-Tk\n\tfor archive-crawler@yahoogroups.com; Tue, 25 Sep 2018 23:02:46 -0700\r\nX-Received: by emcmailer; Tue, 25 Sep 2018 23:02:46 -0700\r\nX-Received: from [130.226.226.11] (helo=post.kb.dk)\n\tby out12d.electric.net with esmtp (Exim 4.90_1)\n\t(envelope-from &lt;csr@...&gt;)\n\tid 1g52uL-00018e-W7\n\tfor archive-crawler@yahoogroups.com; Tue, 25 Sep 2018 23:02:45 -0700\r\nX-Received: from EXCH-02.kb.dk (unknown [10.5.0.112])\n\tby post.kb.dk (Postfix) with ESMTP id DE3DE91F58\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Wed, 26 Sep 2018 08:02:45 +0200 (CEST)\r\nX-Received: from EXCH-01.kb.dk (10.5.0.111) by EXCH-02.kb.dk (10.5.0.112) with\n Microsoft SMTP Server (version=TLS1_2,\n cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.1415.2; Wed, 26 Sep\n 2018 08:02:45 +0200\r\nX-Received: from EXCH-01.kb.dk ([fe80::a8df:9a7b:73b8:c7f]) by EXCH-01.kb.dk\n ([fe80::a8df:9a7b:73b8:c7f%3]) with mapi id 15.01.1415.002; Wed, 26 Sep 2018\n 08:02:45 +0200\r\nTo: &quot;archive-crawler@yahoogroups.com&quot; &lt;archive-crawler@yahoogroups.com&gt;\r\nCc: =?iso-8859-1?Q?K=E5re_Fiedler_Christiansen?= &lt;kfc@...&gt;, Jeppe Ravn-Grove\n\t&lt;jrg@...&gt;, =?iso-8859-1?Q?Knud_=C5ge_Hansen?= &lt;kaah@...&gt;\r\nThread-Topic: Pathological Regex Behaviour in MatchesListRegexDecideRule\r\nThread-Index: AQHUVV1HT3qpzAdKaE2GfeplBETIxg==\r\nDate: Wed, 26 Sep 2018 06:02:45 +0000\r\nMessage-ID: &lt;561b5c3dfafe4a8b878f05949aa941cb@...&gt;\r\nAccept-Language: en-US, da-DK\r\nContent-Language: en-US\r\nX-MS-Has-Attach:\r\nX-MS-TNEF-Correlator:\r\nContent-Type: multipart/alternative;\n\tboundary=&quot;_000_561b5c3dfafe4a8b878f05949aa941cbkbdk_&quot;\r\nMIME-Version: 1.0\r\nX-Outbound-IP: 130.226.226.11\r\nX-Env-From: csr@...\r\nX-Proto: esmtp\r\nX-Revdns: post-03.kb.dk\r\nX-HELO: post.kb.dk\r\nX-TLS: \r\nX-Authenticated_ID: \r\nX-PolicySMART: 10573177\r\nX-Virus-Status: Scanned by VirusSMART (c)\r\nX-Virus-Status: Scanned by VirusSMART (s)\r\nSubject: Pathological Regex Behaviour in MatchesListRegexDecideRule\r\nX-Yahoo-Group-Post: member; u=582247024\r\nFrom: Colin Samuel Rosenthal &lt;csr@...&gt;\r\n\r\n\r\n--_000_561b5c3dfafe4a8b878f05949aa941cbkbdk_\r\nContent-Type: text/plain; charset=&quot;iso-8859-1&quot;\r\nContent-Transfer-Encoding: quoted-printable\r\n\r\nThis is a follow-up my recent email about hanging jobs. When we look at the=\r\n ToeThreads on our hanging jobs, we often see a stacktrace like this:\n\n\n   =\r\n java.util.regex.Pattern$Branch.match(Pattern.java:4604)\n    java.util.rege=\r\nx.Pattern$GroupHead.match(Pattern.java:4658)\n    .\n\n    .\n\n    .\n    java.u=\r\ntil.regex.Pattern$Curly.match(Pattern.java:4234)\n    java.util.regex.Matche=\r\nr.match(Matcher.java:1270)\n    java.util.regex.Matcher.matches(Matcher.java=\r\n:604)\n    org.archive.modules.deciderules.MatchesListRegexDecideRule.evalua=\r\nte(MatchesListRegexDecideRule.java:94)\n    org.archive.modules.deciderules.=\r\nPredicatedDecideRule.innerDecide(PredicatedDecideRule.java:47)\n\nIn other wo=\r\nrds the thread is taking forever to match a regex with a url.\n\n\nOur first t=\r\nhought was that was the code was using Java Pattern/Matcher in a non-thread=\r\nsafe way. The actual code line (line 94 in MatchesListRegexDecideRule) is\n\n=\r\nboolean matches =3D p.matcher(str).matches();\n\nbut this looks ok. The Patte=\r\nrn (p) is reused across threads, but the Matcher p.matcher(str) is method l=\r\nocal. So there shouldn&#39;t be a problem.\n\n\nA second possibility is that we ha=\r\nve some pathological combination of uri and regex that just takes forever t=\r\no evaluate. But in that case it should be easy to reproduce the problem, wh=\r\nich we haven&#39;t been able to do.\n\n\nSo we&#39;re still confused. I&#39;m thinking abo=\r\nut modifying the code to place a timeout on the matches() call, but I&#39;d muc=\r\nh rather understand the problem. Does anyone have any insights?\n\n\ncheers,\n\n=\r\nColin\n\n\n\n\n--\nColin Rosenthal PhD\nSenior IT Consultant\nRoyal Danish Library =\r\n(Aarhus)\n\r\n--_000_561b5c3dfafe4a8b878f05949aa941cbkbdk_\r\nContent-Type: text/html; charset=&quot;iso-8859-1&quot;\r\nContent-Transfer-Encoding: quoted-printable\r\n\r\n&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=3D&quot;Content-Type&quot; content=3D&quot;text/html; chars=\r\net=3Diso-8859-1&quot;&gt;\n&lt;style type=3D&quot;text/css&quot; style=3D&quot;display:none;&quot;&gt;&lt;!-- P {=\r\nmargin-top:0;margin-bottom:0;} --&gt;&lt;/style&gt;\n&lt;/head&gt;\n&lt;body dir=3D&quot;ltr&quot;&gt;\n&lt;div =\r\nid=3D&quot;divtagdefaultwrapper&quot; style=3D&quot;font-size:12pt;color:#000000;font-fami=\r\nly:Calibri,Helvetica,sans-serif;&quot; dir=3D&quot;ltr&quot;&gt;\n&lt;p&gt;This is a follow-up my re=\r\ncent email about hanging jobs. When we look at the ToeThreads on our hangin=\r\ng jobs, we often see a stacktrace like this:&lt;/p&gt;\n&lt;p&gt;&lt;br&gt;\n&lt;/p&gt;\n&lt;p&gt;&lt;/p&gt;\n&lt;pre&gt;=\r\n    java.util.regex.Pattern$Branch.match(Pattern.java:4604)\n    java.util.r=\r\negex.Pattern$GroupHead.match(Pattern.java:4658)\n    .&lt;/pre&gt;\n&lt;pre&gt;    .&lt;/pre=\r\n&gt;\n&lt;pre&gt;    .\n    java.util.regex.Pattern$Curly.match(Pattern.java:4234)\n   =\r\n java.util.regex.Matcher.match(Matcher.java:1270)\n    java.util.regex.Match=\r\ner.matches(Matcher.java:604)\n    org.archive.modules.deciderules.MatchesLis=\r\ntRegexDecideRule.evaluate(MatchesListRegexDecideRule.java:94)\n    org.archi=\r\nve.modules.deciderules.PredicatedDecideRule.innerDecide(PredicatedDecideRul=\r\ne.java:47)&lt;/pre&gt;\nIn other words the thread is taking forever to match a reg=\r\nex with a url.&nbsp;\n&lt;p&gt;&lt;/p&gt;\n&lt;p&gt;&lt;br&gt;\n&lt;/p&gt;\n&lt;p&gt;Our first thought was that was=\r\n the code was using Java Pattern/Matcher in a non-threadsafe way. The actua=\r\nl code line (line 94 in MatchesListRegexDecideRule) is&lt;/p&gt;\n&lt;p&gt;&lt;/p&gt;\n&lt;pre sty=\r\nle=3D&quot;font-family: &quot;DejaVu Sans Mono&quot;; font-size: 12pt;&quot;&gt;&lt;span st=\r\nyle=3D&quot;color:#000080;font-weight:bold;&quot;&gt;boolean &lt;/span&gt;matches =3D p.matche=\r\nr(str).matches();&lt;/pre&gt;\nbut this looks ok. The Pattern (p) is reused across=\r\n threads, but the Matcher p.matcher(str) is method local. So there shouldn&#39;=\r\nt be a problem.\n&lt;p&gt;&lt;/p&gt;\n&lt;p&gt;&lt;br&gt;\n&lt;/p&gt;\n&lt;p&gt;A second possibility is that we hav=\r\ne some pathological combination of uri and regex that just takes forever to=\r\n evaluate. But in that case it should be easy to reproduce the problem, whi=\r\nch we haven&#39;t been able to do.&lt;/p&gt;\n&lt;p&gt;&lt;br&gt;\n&lt;/p&gt;\n&lt;p&gt;So we&#39;re still confused.=\r\n I&#39;m thinking about modifying the code to place a timeout on the matches() =\r\ncall, but I&#39;d much rather understand the problem. Does anyone have any insi=\r\nghts?&lt;/p&gt;\n&lt;p&gt;&lt;br&gt;\n&lt;/p&gt;\n&lt;p&gt;cheers,&lt;/p&gt;\n&lt;p&gt;Colin&lt;/p&gt;\n&lt;p&gt;&lt;br&gt;\n&lt;/p&gt;\n&lt;p&gt;&lt;br&gt;\n&lt;/p=\r\n&gt;\n&lt;p&gt;&lt;br&gt;\n&lt;/p&gt;\n&lt;div id=3D&quot;Signature&quot;&gt;\n&lt;div name=3D&quot;divtagdefaultwrapper&quot; st=\r\nyle=3D&quot;font-family:Calibri,Arial,Helvetica,sans-serif; font-size:; margin:0=\r\n&quot;&gt;\n&lt;div&gt;--&lt;/div&gt;\n&lt;div&gt;Colin Rosenthal PhD&lt;/div&gt;\n&lt;div&gt;Senior IT Consultant&lt;/=\r\ndiv&gt;\n&lt;div&gt;Royal Danish Library (Aarhus)&lt;/div&gt;\n&lt;/div&gt;\n&lt;/div&gt;\n&lt;/div&gt;\n&lt;/body&gt;\n=\r\n&lt;/html&gt;\n\r\n--_000_561b5c3dfafe4a8b878f05949aa941cbkbdk_--\r\n\n"}}