{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":164438524,"authorName":"Lars Clausen","from":"Lars Clausen &lt;lc@...&gt;","profile":"lrclause","replyTo":"LIST","senderId":"t8QVekB_xiArCspEg9v7M0rl-rEMSRt3lv9rNaM0vqU1Ug2i_ZEMzg7gBbOwq0-16eeghOiSLgb-XPp-6k3_G9DEWJmjUhT0tOfh1w","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Re: [archive-crawler] Memory problems","postDate":"1106735758","msgId":1431,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDExMDY3MzU3NTguMzI4OC4xMDIuY2FtZWxAcGM5Nzcuc2Iuc3RhdHNiaWJsaW90ZWtldC5kaz4=","inReplyToHeader":"PDQxRjY5OUE5LjcwNjA5QGFyY2hpdmUub3JnPg==","referencesHeader":"PDExMDY2NjY0NTQuMzI4OC42MC5jYW1lbEBwYzk3Ny5zYi5zdGF0c2JpYmxpb3Rla2V0LmRrPiA8NDFGNjk5QTkuNzA2MDlAYXJjaGl2ZS5vcmc+"},"prevInTopic":1430,"nextInTopic":1434,"prevInTime":1430,"nextInTime":1432,"topicId":1424,"numMessagesInTopic":6,"msgSnippet":"... Bjarne got the newest HEAD into our framework and saw an incredible improvement, it now seems to use about 5MB per job instead of 100.  This is way more","rawEmail":"Return-Path: &lt;lc@...&gt;\r\nX-Sender: lc@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 17341 invoked from network); 26 Jan 2005 10:36:00 -0000\r\nReceived: from unknown (66.218.66.172)\n  by m22.grp.scd.yahoo.com with QMQP; 26 Jan 2005 10:36:00 -0000\r\nReceived: from unknown (HELO luna.statsbiblioteket.dk) (130.225.24.87)\n  by mta4.grp.scd.yahoo.com with SMTP; 26 Jan 2005 10:35:59 -0000\r\nReceived: from pc977.sb.statsbiblioteket.dk\n (pc977.sb.statsbiblioteket.dk [130.225.24.199]) by luna.statsbiblioteket.dk\n (iPlanet Messaging Server 5.2 HotFix 1.16 (built May 14 2003))\n with ESMTP id &lt;0IAX00L5K6RYOO@...&gt; for\n archive-crawler@yahoogroups.com; Wed, 26 Jan 2005 11:35:58 +0100 (MET)\r\nDate: Wed, 26 Jan 2005 11:35:58 +0100\r\nIn-reply-to: &lt;41F699A9.70609@...&gt;\r\nTo: Heritrix mailing list &lt;archive-crawler@yahoogroups.com&gt;\r\nMessage-id: &lt;1106735758.3288.102.camel@...&gt;\r\nOrganization: Statsbiblioteket\r\nMIME-version: 1.0\r\nX-Mailer: Ximian Evolution 1.4.5 (1.4.5-9)\r\nContent-type: text/plain\r\nContent-transfer-encoding: 7BIT\r\nReferences: &lt;1106666454.3288.60.camel@...&gt;\n &lt;41F699A9.70609@...&gt;\r\nX-eGroups-Remote-IP: 130.225.24.87\r\nFrom: Lars Clausen &lt;lc@...&gt;\r\nSubject: Re: [archive-crawler] Memory problems\r\nX-Yahoo-Group-Post: member; u=164438524\r\nX-Yahoo-Profile: lrclause\r\n\r\nOn Tue, 2005-01-25 at 20:10, stack wrote:\n&gt; Lars Clausen wrote:\n&gt; \n&gt; &gt; I&#39;ve been doing a little investigation into the memory problems in\n&gt; &gt; Heritrix.  I&#39;m doing unit tests on Heritrix as part of our project, and\n&gt; &gt; there noticed that running Heritrix several times in a row used a lot of\n&gt; &gt; memory, about 100M per run.  I found a memory debugger for Java\n&gt; &gt; (http://jb2works.com/refscan/) &lt;http://jb2works.com/refscan/%29&gt; which \n&gt; &gt; showed me one thing that was in the\n&gt; &gt; archive packages and linear in the number of Heritrix runs:  The\n&gt; &gt; loggers.  For each run, there is one instance of each of\n&gt; &gt; org.archive.crawler.io.LocalErrorFormatter,\n&gt; &gt; org.archive.crawler.io.RuntimeErrorFormatter,\n&gt; &gt; org.archive.crawler.io.StatisticsLogFormatter,\n&gt; &gt; org.archive.crawler.io.UriErrorFormatter, and\n&gt; &gt; org.archive.crawler.io.UriProcessingFormatter, and 5 of\n&gt; &gt; org.archive.io.GenerationFileHandler.  Can&#39;t go much further as I don&#39;t\n&gt; &gt; have my system set up for compiling Heritrix, but maybe this will be\n&gt; &gt; useful to somebody.\n&gt; \n&gt; Thank you for the above Lars.  We were keeping around references to the \n&gt; job loggers.  I&#39;ve just added clearing of the references at end of job \n&gt; completion.  I did some more end-of-job housekeeping while I was at it.  \n&gt; There are still some processors that should register for end of job \n&gt; cleanup but I won&#39;t worry about them for now since memory retained is small.\n&gt; \n&gt; I&#39;ve not experienced Heritrix holding 100megs per job -- at least not \n&gt; since close of &#39;[1055592 ] terminated crawl still hogging memory, \n&gt; causing OOM&#39; \n&gt; (https://sourceforge.net/tracker/index.php?func=detail&aid=1055592&group_id=73833&atid=539099)\n&gt; This bug was fixed post-1.2.0 release on 2004-12-10 so fix is currently \n&gt; only in HEAD.  I can run at least ten jobs in series without OOME&#39;ing in \n&gt; a 128meg heap.  For sure there is a problem if you&#39;re seeing 100megs \n&gt; retained per job.  Lets try and figure it out.\n\nBjarne got the newest HEAD into our framework and saw an incredible\nimprovement, it now seems to use about 5MB per job instead of 100.  This\nis way more workable, and solves our problems for now.  Thank you!  In\ncase you or others want to look more closely at it, below is a list of\nhow many new objects came out of 10 crawls (after 2 crawls to get a\nbase).\n\nWe can highly recommend the reference scanner for Java memory problems,\nit allows full browsing around in the structures and overviews and\nstuff.  Only thing missing is seeing how much total memory the various\nobjects take.  We can&#39;t fold up the full info (it&#39;d be a about a hundred\nmegs anyway), but the below should give some hints.\n\n-Lars\n\n\n\n\n        +5433 ... java.util.HashMap$Entry\n        +3461 ... java.lang.Object[]\n        +3400 ... java.util.ArrayList\n        +2094 ... org.archive.crawler.settings.LegalValueTypeConstraint\n        +1907 ... java.util.HashMap$EntrySet\n        +1907 ... java.util.HashMap$Entry[]\n        +1503 ... org.archive.crawler.settings.ModuleAttributeInfo\n        +1421 ... org.archive.crawler.settings.SimpleType\n        +1385 ... java.util.HashMap\n        +673 .... java.lang.String[]\n        +563 .... java.lang.ref.WeakReference\n        +522 .... org.archive.crawler.settings.DataContainer\n        +412 .... java.lang.Boolean\n        +296 .... byte[]\n        +272 .... org.archive.crawler.settings.MapType\n        +270 .... com.sleepycat.je.latch.LatchStats\n        +260 .... com.sleepycat.je.latch.Latch\n        +200 .... java.util.Hashtable$Entry\n        +150 .... java.util.HashMap$KeySet\n        +150 .... java.util.HashSet\n        +137 .... char[]\n        +106 .... org.archive.crawler.admin.LongWrapper\n        +100 .... com.sleepycat.je.tree.Key\n        +100 .... java.lang.Long\n        +100 .... java.util.Hashtable$Entry[]\n        +98 ..... org.archive.crawler.settings.LegalValueListConstraint\n        +90 ..... java.util.Collections$SynchronizedSet\n        +90 ..... long[]\n        +83 ..... java.util.LinkedList$Entry\n        +80 ..... com.sleepycat.je.tree.Key[]\n        +80 ..... com.sleepycat.je.tree.Node[]\n        +80 ..... java.util.Hashtable\n        +59 .....\norg.archive.crawler.settings.SoftSettingsHash$SettingsEntry\n        +50 ..... com.sleepycat.je.log.LogBuffer\n        +50 ..... java.io.File\n        +50 ..... java.nio.HeapByteBuffer\n        +50 ..... org.archive.crawler.framework.ProcessorChain\n        +40 ..... com.sleepycat.je.dbi.DatabaseId\n        +40 ..... com.sleepycat.je.dbi.DatabaseImpl\n        +40 ..... com.sleepycat.je.tree.BIN\n        +40 ..... com.sleepycat.je.tree.ChildReference\n        +40 ..... com.sleepycat.je.tree.IN\n        +40 ..... com.sleepycat.je.tree.Tree\n        +40 ..... com.sleepycat.je.tree.TreeStats\n        +40 ..... java.lang.ThreadLocal\n        +40 ..... org.archive.crawler.settings.StringList\n        +32 ..... org.archive.crawler.filter.OrFilter\n        +31 ..... java.util.LinkedList\n        +30 .....\norg.archive.crawler.settings.RegularExpressionConstraint\n        +30 ..... org.archive.crawler.settings.TextField\n        +24 ..... org.archive.crawler.datamodel.UURIFactory$UURIImpl\n        +20 ..... com.sleepycat.je.tree.MapLN\n        +20 ..... com.sleepycat.je.tree.NameLN\n        +20 ..... java.lang.Object\n        +20 ..... java.lang.ref.ReferenceQueue$Lock\n        +20 ..... java.lang.ref.ReferenceQueue\n        +20 ..... java.util.Collections$SynchronizedRandomAccessList\n        +20 ..... java.util.Hashtable$EntrySet\n        +20 ..... java.util.Properties\n        +20 ..... java.util.TreeMap$3\n        +20 ..... java.util.TreeMap\n        +20 ..... org.archive.crawler.datamodel.CredentialStore\n        +20 ..... org.archive.crawler.datamodel.RobotsHonoringPolicy\n        +20 ..... org.archive.crawler.filter.TransclusionFilter\n        +20 .....\norg.archive.crawler.settings.SoftSettingsHash$SettingsEntry[]\n        +20 ..... org.archive.crawler.settings.SoftSettingsHash\n        +18 ..... org.archive.crawler.filter.FilePatternFilter\n        +13 ..... java.util.logging.LogManager$LogNode\n        +13 ..... java.util.logging.Logger\n        +10 ..... com.sleepycat.bind.serial.StoredClassCatalog\n        +10 ..... com.sleepycat.je.Database\n        +10 ..... com.sleepycat.je.DatabaseConfig\n        +10 ..... com.sleepycat.je.Environment\n        +10 ..... com.sleepycat.je.EnvironmentConfig\n        +10 ..... com.sleepycat.je.EnvironmentMutableConfig\n        +10 ..... com.sleepycat.je.TransactionConfig\n        +10 ..... com.sleepycat.je.cleaner.FileSummary\n        +10 ..... com.sleepycat.je.cleaner.TrackedFileSummary\n        +10 ..... com.sleepycat.je.cleaner.TrackedFileSummary[]\n        +10 ..... com.sleepycat.je.cleaner.UtilizationProfile\n        +10 ..... com.sleepycat.je.cleaner.UtilizationTracker\n        +10 ..... com.sleepycat.je.dbi.DbConfigManager\n        +10 ..... com.sleepycat.je.dbi.DbTree\n        +10 ..... com.sleepycat.je.dbi.EnvironmentImpl\n        +10 ..... com.sleepycat.je.dbi.INList\n        +10 ..... com.sleepycat.je.dbi.MemoryBudget\n        +10 ..... com.sleepycat.je.latch.SharedLatch\n        +10 ..... com.sleepycat.je.log.CheckpointMonitor\n        +10 ..... com.sleepycat.je.log.FSyncManager$FSyncGroup\n        +10 ..... com.sleepycat.je.log.FSyncManager\n        +10 ..... com.sleepycat.je.log.FileManager$FileCache\n        +10 ..... com.sleepycat.je.log.FileManager$LogEndFileDescriptor\n        +10 ..... com.sleepycat.je.log.FileManager\n        +10 ..... com.sleepycat.je.log.LogBufferPool\n        +10 ..... com.sleepycat.je.log.SyncedLogManager\n        +10 ..... com.sleepycat.je.log.TraceLogHandler\n        +10 ..... com.sleepycat.je.recovery.RecoveryInfo\n        +10 ..... com.sleepycat.je.tree.FileSummaryLN\n        +10 ..... com.sleepycat.je.tree.LN\n        +10 ..... com.sleepycat.je.txn.BasicLocker\n        +10 ..... com.sleepycat.je.txn.SyncedLockManager\n        +10 ..... com.sleepycat.je.txn.TxnManager\n        +10 ..... java.io.FileDescriptor\n        +10 ..... java.io.RandomAccessFile\n        +10 ..... java.lang.StringBuffer\n        +10 ..... java.lang.Thread[]\n        +10 ..... java.util.Collections$SynchronizedCollection\n        +10 ..... java.util.HashMap$Values\n        +10 ..... java.util.Hashtable$ValueCollection\n        +10 ..... java.util.TreeMap$1\n        +10 ..... java.util.TreeMap$Entry\n        +10 ..... java.util.TreeSet\n        +10 ..... java.util.Vector\n        +10 ..... java.util.logging.ErrorManager\n        +10 .....\norg.apache.commons.collections.CursorableLinkedList$Listable\n        +10 ..... org.apache.commons.collections.CursorableLinkedList\n        +10 ..... org.apache.commons.pool.impl.GenericObjectPool\n        +10 ..... org.archive.crawler.admin.StatisticsTracker\n        +10 ..... org.archive.crawler.datamodel.CrawlOrder\n        +10 ..... org.archive.crawler.datamodel.SeedList\n        +10 ..... org.archive.crawler.extractor.ExtractorCSS\n        +10 ..... org.archive.crawler.extractor.ExtractorHTML\n        +10 ..... org.archive.crawler.extractor.ExtractorHTTP\n        +10 ..... org.archive.crawler.extractor.ExtractorJS\n        +10 ..... org.archive.crawler.extractor.ExtractorSWF\n        +10 ..... org.archive.crawler.fetcher.FetchDNS\n        +10 ..... org.archive.crawler.fetcher.FetchHTTP\n        +10 ..... org.archive.crawler.filter.PathDepthFilter\n        +10 ..... org.archive.crawler.filter.PathologicalPathFilter\n        +10 ..... org.archive.crawler.framework.CrawlController\n        +10 ..... org.archive.crawler.framework.CrawlScope\n        +10 ..... org.archive.crawler.framework.ProcessorChainList\n        +10 ..... org.archive.crawler.framework.ToePool\n        +10 .....\norg.archive.crawler.frontier.HostQueuesFrontier$ThreadLocalQueue\n        +10 ..... org.archive.crawler.frontier.HostQueuesFrontier\n        +10 ..... org.archive.crawler.postprocessor.CrawlStateUpdater\n        +10 ..... org.archive.crawler.postprocessor.Postselector\n        +10 ..... org.archive.crawler.prefetch.PreconditionEnforcer\n        +10 ..... org.archive.crawler.prefetch.Preselector\n        +10 ..... org.archive.crawler.settings.CrawlerSettings\n        +10 ..... org.archive.crawler.settings.ModuleType\n        +10 ..... org.archive.crawler.settings.SettingsCache\n        +10 ..... org.archive.crawler.settings.XMLSettingsHandler\n        +10 ..... org.archive.crawler.url.canonicalize.FixupQueryStr\n        +10 ..... org.archive.crawler.url.canonicalize.LowercaseRule\n        +10 ..... org.archive.crawler.url.canonicalize.StripSessionIDs\n        +10 ..... org.archive.crawler.url.canonicalize.StripUserinfoRule\n        +10 ..... org.archive.crawler.url.canonicalize.StripWWWRule\n        +10 ..... org.archive.crawler.writer.ARCWriterProcessor\n        +10 ..... org.archive.io.arc.ARCWriterPool$ARCWriterFactory\n        +10 ..... org.archive.io.arc.ARCWriterPool\n        +10 ..... sun.nio.ch.FileChannelImpl\n        +10 ..... sun.nio.ch.FileLockImpl\n        +10 ..... sun.nio.ch.NativeThreadSet\n        +9 ...... java.util.regex.Pattern$Dot\n        +9 ...... java.util.regex.Pattern$Slice\n        +9 ...... org.archive.crawler.scope.DomainScope\n        +6 ...... int[]\n        +3 ...... java.util.regex.Matcher\n        +3 ...... java.util.regex.Pattern$Branch\n        +3 ...... java.util.regex.Pattern$Curly\n        +3 ...... java.util.regex.Pattern$GroupHead\n        +3 ...... java.util.regex.Pattern$GroupTail\n        +3 ...... org.xbill.DNS.Name\n        +2 ...... com.sleepycat.je.ForeignKeyDeleteAction\n        +2 ...... java.util.Arrays$ArrayList\n        +2 ...... java.util.regex.Pattern$Range\n        +1 ......\nEDU.oswego.cs.dl.util.concurrent.ConcurrentReaderHashMap$Entry\n        +1 ...... java.util.Stack\n        +1 ...... java.util.regex.Pattern$Start\n        +1 ...... java.util.regex.Pattern\n        +1 ...... javax.management.MBeanParameterInfo[]\n        +1 ...... org.apache.commons.logging.impl.Jdk14Logger\n        +1 ...... org.archive.crawler.filter.URIRegExpFilter\n        +1 ...... org.archive.crawler.scope.FilterScope\n        +1 ...... org.archive.util.PatternMatcherRecycler\n        +1 ...... org.xbill.DNS.ARecord\n        +1 ...... org.xbill.DNS.Cache$PositiveElement\n        +1 ...... org.xbill.DNS.RRset\n\n\n"}}