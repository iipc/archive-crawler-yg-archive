{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr","from":"Gordon Mohr &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"_bgTE1xkTUsDVzjC2ErUa0ko6pLWIG8PjpdnRu9RpMKZZ6O7Mj_ucQ2gxTizC4Kueeki-OFKz_SK1GEOyJJdbHpDO0KQqwQ","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Re: [archive-crawler] Checkpoint recover problem","postDate":"1296118247","msgId":6991,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDRENDEzMUU3LjEwNTAyMDdAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PDRENDEyOTQ2LjUwNDA2MDNAYmliYWxleC5vcmc+","referencesHeader":"PDRENDAyRkZBLjMwNzA4MDNAYmliYWxleC5vcmc+IDw0RDQwNzk5NC45MDIwNTAxQGFyY2hpdmUub3JnPiA8NEQ0MTI5NDYuNTA0MDYwM0BiaWJhbGV4Lm9yZz4="},"prevInTopic":6990,"nextInTopic":7034,"prevInTime":6990,"nextInTime":6992,"topicId":6988,"numMessagesInTopic":6,"msgSnippet":"... At the moment the checkpoint is made, all the necessary files are available as .JDB files. Then later, as the crawl continues to run, some will be renamed","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 82048 invoked from network); 27 Jan 2011 08:50:50 -0000\r\nX-Received: from unknown (66.196.94.106)\n  by m16.grp.re1.yahoo.com with QMQP; 27 Jan 2011 08:50:50 -0000\r\nX-Received: from unknown (HELO relay00.pair.com) (209.68.5.9)\n  by mta2.grp.re1.yahoo.com with SMTP; 27 Jan 2011 08:50:50 -0000\r\nX-Received: (qmail 2496 invoked by uid 0); 27 Jan 2011 08:50:48 -0000\r\nX-Received: from 67.188.34.83 (HELO silverbook.local) (67.188.34.83)\n  by relay00.pair.com with SMTP; 27 Jan 2011 08:50:48 -0000\r\nX-pair-Authenticated: 67.188.34.83\r\nMessage-ID: &lt;4D4131E7.1050207@...&gt;\r\nDate: Thu, 27 Jan 2011 00:50:47 -0800\r\nUser-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.2.13) Gecko/20101207 Thunderbird/3.1.7\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nCc: Mahmoud Mubarak &lt;mahmoud.mubarak@...&gt;\r\nReferences: &lt;4D402FFA.3070803@...&gt; &lt;4D407994.9020501@...&gt; &lt;4D412946.5040603@...&gt;\r\nIn-Reply-To: &lt;4D412946.5040603@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nFrom: Gordon Mohr &lt;gojomo@...&gt;\r\nSubject: Re: [archive-crawler] Checkpoint recover problem\r\nX-Yahoo-Group-Post: member; u=137285340; y=4sT2nPlBnDduh_jzBgFV_5oDkPNBpb7X0_5wB_ULLBlp\r\nX-Yahoo-Profile: gojomo\r\n\r\nOn 1/27/11 12:13 AM, Mahmoud Mubarak wrote:\n&gt; On 01/26/2011 09:44 PM, Gordon Mohr wrote:\n&gt;&gt; You do need to keep the &#39;DEL&#39; files that correspond to checkpoints you\n&gt;&gt; want to recover. (The active crawl renames JDB files as DEL when it no\n&gt;&gt; longer needs them, but checkpoints may still need them.) So, that may be\n&gt;&gt; your problem.\n&gt; Is it possible to determine which .DEL files representing .JDB files\n&gt; referenced by the checkpoint?\n&gt; Another question, is it enough to stop the cron job before making a\n&gt; checkpoint?\n\nAt the moment the checkpoint is made, all the necessary files are \navailable as .JDB files. Then later, as the crawl continues to run, some \nwill be renamed as .DEL files, meaning they aren&#39;t necessary for the \nin-progress crawl. However, they may still be necessary to resume from \nthe prior checkpoint.\n\nThe list of JDB files required for a particular checkpoint is stored in \na file &#39;jdbfiles.manifest&#39;, stored in checkpoint-specific subdirectory \nof the checkpointed &#39;state&#39; directory. (The names in this manifest \nalways end &#39;JDB&#39;, even if the files have been renamed &#39;DEL&#39; by \nsubsequent activity. The resumption code will automatically rename them \nback.)\n\n&gt;&gt; (A future version may make checkpoint directories with hard links to all\n&gt;&gt; necessary files, so that necessary files cannot be easily deleted, and\n&gt;&gt; add better checkpoint-file-management to the web UI.)\n&gt;&gt;\n&gt;&gt; Without a checkpoint, you could still use any &#39;frontier-recover&#39; logs to\n&gt;&gt; *roughly* reproduce the crawl state as of a certain point in time. (Not\n&gt;&gt; all stats/reporting is reproduced, but the accounting of URIs\n&gt;&gt; already-fetched and needing-fetching is correct.) Note that in H3 you\n&gt;&gt; make a launch consult a recovery-log by placing a copy of it in the\n&gt;&gt; &#39;action&#39; directory, rather than specifying its path in an optional\n&gt;&gt; settings field.\n&gt; Do I need to place a copy of &#39;frontier-recover.gz&#39; only in &#39;action&#39;\n&gt; directory, or I need also to place a copy of crawl.log?\n\nJust the &#39;frontier-recover&#39; log. However, I just noticed something \nthat&#39;s tricky about the way this works in H3 when checkpointing is also \noccurring that may not be documented anywhere.\n\nLike other logs, the &#39;frontier-recover&#39; log is auto-rotated whenever a \ncheckpoint occurs. The log so far gets renamed, with the checkpoint \nsuffix, and the logging continues into the active-log name (until \nanother checkpoint occurs).\n\nTo work for &#39;replaying&#39; a frontier state, the &#39;frontier-recover&#39; log \nshould be *all* the segments from the exact crawl you want to mimic, in \nthe proper order. So if the crawl ran through many checkpoints, you&#39;ll \nwant to concatenate all the &#39;frontier-recover.gz.cpNNNNN-DDDDDDDDDDDDDD&#39; \nthat came from one prior run together, in order, before dropping into \nthe &#39;action&#39; directory. And, the final composite log should end \n&#39;.recover&#39; if uncompressed or &#39;recover.gz&#39; if compressed, to be handled \nproperly.\n\nIf there have been many runs of the same crawl from the same job \ndirectory, and each was checkpointed multiple times, you&#39;ll have \n&#39;frontier-recover.gz.cpNNNNN-DDDDDDDDDDDDDD&#39; files from the many runs \nintermixed in lexicographical order. Still, you&#39;ll only want to combine \nthe ones that came from the same run -- one series of ascending \ncontiguous NNNNN numbers and ascending adjacent DDDDDDDDDDDDDD timestamps.\n\n- Gordon @ IA\n\n&gt;&gt; - Gordon @ IA\n&gt;&gt;\n&gt;&gt; On 1/26/11 6:30 AM, Mahmoud Mubarak wrote:\n&gt;&gt;&gt; I used to make a checkpoint for backing up the crawling in case of any\n&gt;&gt;&gt; crash. When I tried to launch Heritrix from the latest check point, this\n&gt;&gt;&gt; error arises:\n&gt;&gt;&gt;\n&gt;&gt;&gt; 2011-01-26T13:01:22.449Z SEVERE IllegalStateException:\n&gt;&gt;&gt; com.sleepycat.je.EnvironmentFailureException: (JE 4.0.71) Environment\n&gt;&gt;&gt; must be closed, caused by: com.sleepycat.je.EnvironmentFailureException:\n&gt;&gt;&gt; Environment invalid because of previous exception: (JE 4.0.71)\n&gt;&gt;&gt; /usr/local/heritrix-3.1.1-SNAPSHOT/./jobs/arab-league/state\n&gt;&gt;&gt; java.io.FileNotFoundException:\n&gt;&gt;&gt; /usr/local/heritrix-3.1.1-SNAPSHOT/./jobs/arab-league/state/000026b4.jdb\n&gt;&gt;&gt; (No such file or directory) LOG_FILE_NOT_FOUND: Log file missing, log is\n&gt;&gt;&gt; likely invalid. Environment is invalid and must be closed. (in thread\n&gt;&gt;&gt; &#39;arab-league launchthread&#39;)\n&gt;&gt;&gt;\n&gt;&gt;&gt; 2011-01-26T13:01:21.989Z SEVERE needed log files missing: [00002673.jdb,\n&gt;&gt;&gt; 0000266d.jdb, 0000257a.jdb, 000026a8.jdb, 00002684.jdb, 0000254d.jdb,\n&gt;&gt;&gt; 00002651.jdb, 00002683.jdb, 00002627.jdb, 00002574.jdb, 0000259c.jdb,\n&gt;&gt;&gt; 00002647.jdb, 00000d9a.jdb, 0000263c.jdb, 00002553.jdb, 000025f7.jdb,\n&gt;&gt;&gt; 0000260b.jdb, 000001cb.jdb, 000025ba.jdb] (in thread &#39;arab-league\n&gt;&gt;&gt; launchthread&#39;)\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt; I use a crontab to delete .del files only, does that make a porblem in\n&gt;&gt;&gt; the recovery?\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; ------------------------------------\n&gt;\n&gt; Yahoo! Groups Links\n&gt;\n&gt;\n&gt;\n\n"}}