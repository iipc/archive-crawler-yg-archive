{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":4480673,"authorName":"Dave Skinner","from":"Dave Skinner &lt;dave@...&gt;","profile":"frodobay","replyTo":"LIST","senderId":"jnOz3MWJ6LhWpM3qLR9tQD2lESFSyWzfNJGeV--Cb_hvzxqOl16aO1ZCbDOPyi1p6BVgdDIoEjb3Zp3JXKxlDzRXwOY","spamInfo":{"isSpam":false,"reason":"0"},"subject":"coding style, philosophy, and a heritrix midfetch-filter","postDate":"1107302981","msgId":1465,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDYuMS4yLjAuMC4yMDA1MDIwMTE1MjI0OC4wM2EyNjZkMEAyMDYuMTYzLjEwMy40Pg==","inReplyToHeader":"PDIwMDUwMjAxMjMyMi5qMTFOTTkyMjAwNTk0OUBsb2NhbGhvc3QubG9jYWxkb21haW4+","referencesHeader":"PDIwMDUwMjAxMjMyMi5qMTFOTTkyMjAwNTk0OUBsb2NhbGhvc3QubG9jYWxkb21haW4+"},"prevInTopic":0,"nextInTopic":1495,"prevInTime":1464,"nextInTime":1466,"topicId":1465,"numMessagesInTopic":7,"msgSnippet":"I ve got a midfetch filter that looks at the content-length and last-modified headers and pretends that a disk directory structure (as could be produced by","rawEmail":"Return-Path: &lt;dave@...&gt;\r\nX-Sender: dave@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 15792 invoked from network); 2 Feb 2005 00:09:48 -0000\r\nReceived: from unknown (66.218.66.166)\n  by m24.grp.scd.yahoo.com with QMQP; 2 Feb 2005 00:09:48 -0000\r\nReceived: from unknown (HELO solid.net) (206.163.103.1)\n  by mta5.grp.scd.yahoo.com with SMTP; 2 Feb 2005 00:09:47 -0000\r\nReceived: from t_laptop.solid.net (or-65-40-222-124.dyn.sprint-hsd.net [65.40.222.124])\n\tby solid.net (8.12.8/8.12.8) with ESMTP id j1209jHf025291\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Tue, 1 Feb 2005 16:09:46 -0800\r\nMessage-Id: &lt;6.1.2.0.0.20050201152248.03a266d0@206.163.103.4&gt;\r\nX-Sender: dave@206.163.103.4 (Unverified)\r\nX-Mailer: QUALCOMM Windows Eudora Version 6.1.2.0\r\nDate: Tue, 01 Feb 2005 16:09:41 -0800\r\nTo: archive-crawler@yahoogroups.com\r\nIn-Reply-To: &lt;200502012322.j11NM922005949@...&gt;\r\nReferences: &lt;200502012322.j11NM922005949@...&gt;\r\nMime-Version: 1.0\r\nContent-Type: text/plain; charset=&quot;us-ascii&quot;; format=flowed\r\nX-eGroups-Remote-IP: 206.163.103.1\r\nFrom: Dave Skinner &lt;dave@...&gt;\r\nSubject: coding style, philosophy, and a heritrix midfetch-filter\r\nX-Yahoo-Group-Post: member; u=4480673\r\nX-Yahoo-Profile: frodobay\r\n\r\nI&#39;ve got a midfetch filter that looks at the content-length and \nlast-modified headers and pretends that a disk directory structure (as \ncould be produced by MirrorWriter) is a database.  It could easily be \nmodified so that some other database (and the etag) could be used instead \nor in addition to the existing code.\n\nIt&#39;s in what I consider an *alpha* stage.  ie. it seems to work but no one \nexcept the author has used it and the code needs cleaning \nup.  Additionally, the stats reporting has been mangled because documents \nare sometimes coming from the local disk instead of the net.  It possibly \nmesses with frontier scheduling in an indirect manner because the fetch \ntiming is not caused by what frontier thinks it was.\n\nAs part of the clean up stage, some issues have come up.\n\nI&#39;ve got the following code in CrawlURI.java\n\n&gt;/////////////dave skinner//////////////\n&gt;     // if true writers should not write this document\n&gt;     private boolean dontArchive = false ;\n&gt;     private boolean midFiltered = false ;          // remember for stats\n&gt;     private String etag = null;\n&gt;     // Last-Modified converted to milliseconds  -1 indicates no date\n&gt;     private long lastModDate = -1;\n&gt;     private String earlyContentLength = null;\n&gt;     private String localFileName = null;\n&gt;\n&gt;     public void setLastModDate(long d) {\n&gt;         this.lastModDate = d ;\n&gt;     }\n&gt;     public long getLastModDate() {\n&gt;         return (lastModDate) ;\n&gt;\n&gt;     plus more getter&#39;s and setters\n\nand in FetchHTTP.java\n\n&gt;     protected void addResponseContent (HttpMethod method, CrawlURI curi) {\n&gt;         curi.setFetchStatus(method.getStatusCode());\n&gt;         Header ct = method.getResponseHeader(&quot;content-type&quot;);\n&gt;         curi.setContentType((ct == null)? null: ct.getValue());\n&gt;///////////////dave skinner/////////////////\n&gt;         Header et = method.getResponseHeader(&quot;Etag&quot;);\n&gt;         curi.setEtag((et==null)?null: et.getValue()) ;\n&gt;         Header cl = method.getResponseHeader(&quot;Content-Length&quot;);\n&gt;         curi.setEarlyContentLength((cl==null)?null: cl.getValue()) ;\n&gt;         Header lmd = method.getResponseHeader(&quot;Last-Modified&quot;);\n&gt;         if (lmd!=null) {\n&gt;             long d ;\n&gt;             try {\n&gt;                 SimpleDateFormat df = new SimpleDateFormat(&quot;EEE, dd MMM \n&gt; yyyy HH:mm:ss zzz&quot;);\n&gt;                 d = df.parse(lmd.getValue()).getTime() ;\n&gt;                 curi.setLastModDate(d) ;\n&gt;             } catch (Exception e) {\n&gt;             //  we caught the error but (almost) ignore it\n&gt;             curi.setLastModDate(-1) ;\n&gt;             }\n&gt;         }\n&gt;///////////////end dave skinner////////////////\n\nthe questions that immediately come up are:\n\n1) should these variables be defined in crawlURI or be part of the Alist or \neven somewhere else?\n\n2) if they are in the Alist, should there be centrally defined setter&#39;s and \ngetter&#39;s or should the code just do what needs to be done every time to \naccess them?\n\n3) once upon a time the date variable was the string returned by the \nserver.  then it became a Date object. Now its milliseconds because every \ntime I needed it, I needed the millisecond value.  Is there a preference to \nwhat format things like this *should* be kept in?\n\n4) I think that the headers need to be read where they are in \nreadResponseContent because its a central spot and its known that the \nHTTPreader that read them still exists etc.  But should the date (and \ncontent-length) processing be done there or somewhere else where it could \nbe suppressed if not needed.  But figuring out if things are not needed \ncould be a problem.  There is at least one type of server that mangles the \ncontent-length header, so the conversion code should be done in just one \nplace because its going to be full of error checks and the result can be \nconsistent.  I think MirrorWriter should be changed or at least \nparameterized to set the file creation date to the last-modified date (I&#39;ve \ndone this).\n\n5) I&#39;m keeping the content-length separate from the *other* content length \nvalue.  I&#39;m not sure this is required.  By the time there could be a \nconflict the real value should be known.  Can anyone think of a reason to \nkeep them separate?  Right now, my preference would be to use the existing \nvariable.\n\n6) I have no ego attached to the variable names.  If someone thinks \nsomething else would be better, I&#39;ll make the changes.\n\n\n\nDave Skinner   dave at solid dot net\n    High Performance Programming---assembly (lots of them), C, java, perl\n    Database and Non-trivial web site implementations\n    Real-time and embedded systems are my specialty\n\n\n\n"}}