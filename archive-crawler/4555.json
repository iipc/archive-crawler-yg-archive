{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr","from":"Gordon Mohr &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"URdziesKA2KGuzb7E77g7VgtmnVxua3-diNK5-nt4fpkAFSMZHK-TRAmCBWTXvD3qCxRxLQJcAPO5Uaex059M0FetUhrGUs","spamInfo":{"isSpam":false,"reason":"12"},"subject":"Re: [archive-crawler] Extend QueueAssignmentPolicy","postDate":"1190153785","msgId":4555,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDQ2RjA0RTM5LjgwNjA1MDRAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PGZjODJhZCtibmxuQGVHcm91cHMuY29tPg==","referencesHeader":"PGZjODJhZCtibmxuQGVHcm91cHMuY29tPg=="},"prevInTopic":4540,"nextInTopic":4557,"prevInTime":4554,"nextInTime":4556,"topicId":4540,"numMessagesInTopic":3,"msgSnippet":"Nick, From your later message, I assume you succeeded in making your NicknameQueueAssignmentPolicy appear in the web UI. (FYI, it is not necessary to edit","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 51547 invoked from network); 18 Sep 2007 22:17:38 -0000\r\nReceived: from unknown (66.218.66.71)\n  by m50.grp.scd.yahoo.com with QMQP; 18 Sep 2007 22:17:38 -0000\r\nReceived: from unknown (HELO mail.archive.org) (207.241.233.246)\n  by mta13.grp.scd.yahoo.com with SMTP; 18 Sep 2007 22:17:38 -0000\r\nReceived: from localhost (localhost [127.0.0.1])\n\tby mail.archive.org (Postfix) with ESMTP id 0CC49141997CC\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Tue, 18 Sep 2007 15:16:27 -0700 (PDT)\r\nReceived: from mail.archive.org ([127.0.0.1])\n\tby localhost (mail.archive.org [127.0.0.1]) (amavisd-new, port 10024)\n\twith LMTP id 17518-06-57 for &lt;archive-crawler@yahoogroups.com&gt;;\n\tTue, 18 Sep 2007 15:16:26 -0700 (PDT)\r\nReceived: from [192.168.1.203] (c-76-102-230-209.hsd1.ca.comcast.net [76.102.230.209])\n\tby mail.archive.org (Postfix) with ESMTP id 217041416BFF8\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Tue, 18 Sep 2007 15:16:26 -0700 (PDT)\r\nMessage-ID: &lt;46F04E39.8060504@...&gt;\r\nDate: Tue, 18 Sep 2007 15:16:25 -0700\r\nUser-Agent: Thunderbird 1.5.0.13 (X11/20070824)\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;fc82ad+bnln@...&gt;\r\nIn-Reply-To: &lt;fc82ad+bnln@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-Virus-Scanned: Debian amavisd-new at archive.org\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: Gordon Mohr &lt;gojomo@...&gt;\r\nSubject: Re: [archive-crawler] Extend QueueAssignmentPolicy\r\nX-Yahoo-Group-Post: member; u=137285340; y=wLR8rjif2-kQh13YXyCi8ol8j8ZfY_kag05Nf1xEdQsL\r\nX-Yahoo-Profile: gojomo\r\n\r\nNick,\n\n From your later message, I assume you succeeded in making your \nNicknameQueueAssignmentPolicy appear in the web UI. (FYI, it is not \nnecessary to edit AbstractFrontier. You can do this just by providing a \nwhitespace-delimited list of implementation classes in the property \n&#39;org.archive.crawler.frontier.AbstractFrontier.queue-assignment-policy&#39;. )\n\nA QueueAssignmentPolicy which splits the content of a single host into \nseparate queues can be problematic. Heritrix generally assumes that all \nURIs from the same host land in the same queue.\n\nA basic form of politeness to others&#39; sites, opening only a single \nconnection at once, comes naturally from this assumption.\n\nAlso, the common need to request certain prerequisite URIs (DNS and \nrobots fetches) before anything else is accomplished by pushing these at \nthe top of the same-host queue. Then, they are guaranteed to finish -- \nsucceed or fail -- before other URIs on the same host are tried.\n\nIf different URIs from the same host land in different queues, the \nprerequisites might be redundantly scheduled or not finished when other \nURIs are tried, or a site might be overloaded with traffic via multiple \nconnections. Only if you are sure the site can handle the load, for \nexample it is your own site, should you risk generating such traffic.\n\nRegarding your specific policy:\n\nPrior QueueAssignmentPolicies have typically loaded multiple hosts into \na single queue, rather than splitting one host over many queues.\n\nI suspect if you&#39;re seeing an initially-fast but then-very-slow effect \nwith your custom policy, that some of your queues have, as their topmost \nitems, unfetchable URIs. Certain kinds of failed-fetches go into a \nslow-timeout retry-cycle, and while a URI is in this cycle, nothing else \nfrom the same queue will be tried. This is a reasonable approach when \nall URIs in a queue are subject to the same network failures, but can \ncause problems if the queues are mixed, and the deeper URIs would \nsucceed quickly, but are stuck behind topmost URIs.\n\nYou may wish to change your policy so that no URIs on different hosts \nland in the same queue. Still, this may not work, or may create problems \nas described above, because your custom policy is operating outside the \nassumptions of Heritrix.\n\n- Gordon @ IA\n\nnickzwk wrote:\n&gt; i wanted to extend QueueAssignmentPolicy\n&gt; i create my own QueueAssignmentPolicy NicknameQueueAssignmentPolicy\n&gt; /* NicknameQueueAssignmentPolicy\n&gt; *\n&gt; * $Id: HostnameQueueAssignmentPolicy.java 3838 2005-09-21 23:00:47Z \n&gt; gojomo $\n&gt; *\n&gt; * Created on Oct 5, 2004\n&gt; *\n&gt; * Copyright (C) 2004 Internet Archive.\n&gt; *\n&gt; * This file is part of the Heritrix web crawler (crawler.archive.org).\n&gt; *\n&gt; * Heritrix is free software; you can redistribute it and/or modify\n&gt; * it under the terms of the GNU Lesser Public License as published by\n&gt; * the Free Software Foundation; either version 2.1 of the License, or\n&gt; * any later version.\n&gt; *\n&gt; * Heritrix is distributed in the hope that it will be useful,\n&gt; * but WITHOUT ANY WARRANTY; without even the implied warranty of\n&gt; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n&gt; * GNU Lesser Public License for more details.\n&gt; *\n&gt; * You should have received a copy of the GNU Lesser Public License\n&gt; * along with Heritrix; if not, write to the Free Software\n&gt; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-\n&gt; 1307  USA\n&gt; */ \n&gt; package org.archive.crawler.frontier;\n&gt; \n&gt; import java.util.logging.Logger;\n&gt; import org.archive.crawler.datamodel.CandidateURI;\n&gt; import org.archive.crawler.framework.CrawlController;\n&gt; \n&gt; \n&gt; /**\n&gt;  * QueueAssignmentPolicy based on the hostname:port evident in the \n&gt; given\n&gt;  * CrawlURI.\n&gt;  * \n&gt;  * @author nick\n&gt;  */\n&gt; public class NicknameQueueAssignmentPolicy extends \n&gt; QueueAssignmentPolicy {\n&gt;     private static final Logger logger = Logger\n&gt;         .getLogger(NicknameQueueAssignmentPolicy.class.getName());\n&gt;     /**\n&gt;      * \n&gt;      */\n&gt;     public String getClassKey(CrawlController controller, \n&gt; CandidateURI cauri) {\n&gt;         String uri = cauri.getUURI().toString();\n&gt;         long hash = ELFHash(uri);\n&gt;         String a = Long.toString(hash % 100);\n&gt;         return a;\n&gt;     }\n&gt;     public long ELFHash(String str)\n&gt;     {\n&gt;        long hash = 0;\n&gt;        long x    = 0;\n&gt;        for(int i = 0; i &lt; str.length(); i++)\n&gt;        {\n&gt;           hash = (hash &lt;&lt; 4) + str.charAt(i);\n&gt;           if((x = hash & 0xF0000000L) != 0)\n&gt;           {\n&gt;              hash ^= (x &gt;&gt; 24);\n&gt;              hash &= ~x;\n&gt;           }\n&gt;        }\n&gt;        return (hash & 0x7FFFFFFF);\n&gt;     }\n&gt; \n&gt; \n&gt; }\n&gt; \n&gt; my heritrix version is 1.12.1\n&gt; and i changed the AbstractFrontier as below:\n&gt; \n&gt; String queueStr = System.getProperty(AbstractFrontier.class.getName() \n&gt; +\n&gt;                 &quot;.&quot; + ATTR_QUEUE_ASSIGNMENT_POLICY,\n&gt;                 NicknameQueueAssignmentPolicy.class.getName() + &quot; &quot; +\n&gt;                 HostnameQueueAssignmentPolicy.class.getName() + &quot; &quot; +\n&gt;                 IPQueueAssignmentPolicy.class.getName() + &quot; &quot; +\n&gt;                 BucketQueueAssignmentPolicy.class.getName() + &quot; &quot; +\n&gt;                 SurtAuthorityQueueAssignmentPolicy.class.getName());\n&gt;         Pattern p = Pattern.compile(&quot;&#92;&#92;s*,&#92;&#92;s*|&#92;&#92;s+&quot;);\n&gt;         String [] queues = p.split(queueStr);\n&gt;         if (queues.length &lt;= 0) {\n&gt;             throw new RuntimeException(&quot;Failed parse of &quot; +\n&gt;                     &quot; assignment queue policy string: &quot; + queueStr);\n&gt;         }\n&gt;         t = addElementToDefinition(new SimpleType\n&gt; (ATTR_QUEUE_ASSIGNMENT_POLICY,\n&gt;                 &quot;Defines how to assign URIs to queues. Can assign by \n&gt; host, &quot; +\n&gt;                 &quot;by ip, and into one of a fixed set of buckets (1k).&quot;,\n&gt;                 queues[0], queues));\n&gt;         t.setExpertSetting(true);\n&gt;         t.setOverrideable(true);\n&gt; \n&gt; i also change the heritrix.properties as below:\n&gt; \n&gt; org.archive.crawler.frontier.AbstractFrontier.queue-assignment-policy \n&gt; = &#92;\n&gt;     org.archive.crawler.frontier.NicknameQueueAssignmentPolicy &#92;\n&gt;     org.archive.crawler.frontier.HostnameQueueAssignmentPolicy &#92;\n&gt;     org.archive.crawler.frontier.IPQueueAssignmentPolicy &#92;\n&gt;     org.archive.crawler.frontier.BucketQueueAssignmentPolicy &#92;\n&gt;     org.archive.crawler.frontier.SurtAuthorityQueueAssignmentPolicy \n&gt; org.archive.crawler.frontier.BdbFrontier.level = INFO\n&gt; \n&gt; but when reset the heritrix,i find the order.xml didn&#39;t accept my \n&gt; changes,\n&gt;  &lt;newObject name=&quot;frontier&quot; \n&gt; class=&quot;org.archive.crawler.frontier.BdbFrontier&quot;&gt;\n&gt;       &lt;float name=&quot;delay-factor&quot;&gt;5.0&lt;/float&gt;\n&gt;       &lt;integer name=&quot;max-delay-ms&quot;&gt;30000&lt;/integer&gt;\n&gt;       &lt;integer name=&quot;min-delay-ms&quot;&gt;3000&lt;/integer&gt;\n&gt;       &lt;integer name=&quot;max-retries&quot;&gt;30&lt;/integer&gt;\n&gt;       &lt;long name=&quot;retry-delay-seconds&quot;&gt;900&lt;/long&gt;\n&gt;       &lt;integer name=&quot;preference-embed-hops&quot;&gt;1&lt;/integer&gt;\n&gt;       &lt;integer name=&quot;total-bandwidth-usage-KB-sec&quot;&gt;0&lt;/integer&gt;\n&gt;       &lt;integer name=&quot;max-per-host-bandwidth-usage-KB-sec&quot;&gt;0&lt;/integer&gt;\n&gt;       &lt;string name=&quot;queue-assignment-\n&gt; policy&quot;&gt;org.archive.crawler.frontier.HostnameQueueAssignmentPolicy&lt;/st\n&gt; ring&gt;\n&gt;       &lt;string name=&quot;force-queue-assignment&quot;&gt;&lt;/string&gt;\n&gt;       &lt;boolean name=&quot;pause-at-start&quot;&gt;false&lt;/boolean&gt;\n&gt;       &lt;boolean name=&quot;pause-at-finish&quot;&gt;false&lt;/boolean&gt;\n&gt;       &lt;boolean name=&quot;source-tag-seeds&quot;&gt;false&lt;/boolean&gt;\n&gt;       &lt;boolean name=&quot;recovery-log-enabled&quot;&gt;true&lt;/boolean&gt;\n&gt;       &lt;boolean name=&quot;hold-queues&quot;&gt;true&lt;/boolean&gt;\n&gt;       &lt;integer name=&quot;balance-replenish-amount&quot;&gt;3000&lt;/integer&gt;\n&gt;       &lt;integer name=&quot;error-penalty-amount&quot;&gt;100&lt;/integer&gt;\n&gt;       &lt;long name=&quot;queue-total-budget&quot;&gt;-1&lt;/long&gt;\n&gt;       &lt;string name=&quot;cost-\n&gt; policy&quot;&gt;org.archive.crawler.frontier.UnitCostAssignmentPolicy&lt;/string&gt;\n&gt;       &lt;long name=&quot;snooze-deactivate-ms&quot;&gt;300000&lt;/long&gt;\n&gt;       &lt;integer name=&quot;target-ready-backlog&quot;&gt;50&lt;/integer&gt;\n&gt;       &lt;string name=&quot;uri-included-\n&gt; structure&quot;&gt;org.archive.crawler.util.BdbUriUniqFilter&lt;/string&gt;\n&gt;     &lt;/newObject&gt;\n&gt; \n&gt; i wonder how can i change the QueueAssignmentPolicy \n&gt; because when crawl one site,there is 1 active thread ,it is too slow \n&gt; and i want to speed heritrix \n&gt; i&#39;m looking forward to the answer\n&gt; \n&gt; \n&gt; \n&gt;  \n&gt; Yahoo! Groups Links\n&gt; \n&gt; \n&gt; \n\n\n"}}