{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":168599281,"authorName":"stack","from":"stack &lt;stack@...&gt;","profile":"stackarchiveorg","replyTo":"LIST","senderId":"7ypNDvlzptDOkU3rPj5WGyElXhxpsOaHoPHJtiDm2XdFli17n2b9qDlTHjshNUEjXV92sW7VvQBSdftbBL0qZg","spamInfo":{"isSpam":false,"reason":"12"},"subject":"Re: [archive-crawler] How to create arcfiles with ARC-entries based on files?","postDate":"1132158714","msgId":2365,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDQzN0I1RUZBLjkwNjA4MDZAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PGRsZGFqNitrbm84QGVHcm91cHMuY29tPg==","referencesHeader":"PGRsZGFqNitrbm84QGVHcm91cHMuY29tPg=="},"prevInTopic":2364,"nextInTopic":0,"prevInTime":2364,"nextInTime":2366,"topicId":2364,"numMessagesInTopic":2,"msgSnippet":"... Søren: Unlike ARCReader, ARCWriter suffers in that usage has been by the crawler only.  Its API could do with improvement so its easier to incorporate","rawEmail":"Return-Path: &lt;stack@...&gt;\r\nX-Sender: stack@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 26992 invoked from network); 16 Nov 2005 16:43:06 -0000\r\nReceived: from unknown (66.218.66.172)\n  by m26.grp.scd.yahoo.com with QMQP; 16 Nov 2005 16:43:06 -0000\r\nReceived: from unknown (HELO dns.duboce.net) (63.203.238.114)\n  by mta4.grp.scd.yahoo.com with SMTP; 16 Nov 2005 16:43:05 -0000\r\nReceived: from [192.168.1.105] ([192.168.1.105])\n\t(authenticated)\n\tby dns-eth1.duboce.net (8.10.2/8.10.2) with ESMTP id jAGFS0I31276\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Wed, 16 Nov 2005 07:28:00 -0800\r\nMessage-ID: &lt;437B5EFA.9060806@...&gt;\r\nDate: Wed, 16 Nov 2005 08:31:54 -0800\r\nUser-Agent: Mozilla/5.0 (Macintosh; U; PPC Mac OS X Mach-O; en-US; rv:1.7.8) Gecko/20050511\r\nX-Accept-Language: en-us, en\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;dldaj6+kno8@...&gt;\r\nIn-Reply-To: &lt;dldaj6+kno8@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 8bit\r\nX-eGroups-Msg-Info: 2:12:4:0\r\nFrom: stack &lt;stack@...&gt;\r\nSubject: Re: [archive-crawler] How to create arcfiles with ARC-entries based\n on files?\r\nX-Yahoo-Group-Post: member; u=168599281; y=i38OtO1uTQm-_lNb6tqOxNn--0l7wzsQWPLUyDOePxnubeDChvCShpaS\r\nX-Yahoo-Profile: stackarchiveorg\r\n\r\nS�ren Vejrup Carlsen wrote:\n\n&gt; Dear all.\n&gt; We want to embed the heritrix-logs into ARC-files.\n&gt; And the only way seems to convert the files to ByteArrayOutputStreams.\n\nS�ren:\n\nUnlike ARCReader, ARCWriter suffers in that usage has been by the \ncrawler only.  Its API could do with improvement so its easier to \nincorporate elsewhere.  Send over a patch if you have ideas for making \nthe API more amenable.\n\nSee also comments below.\n\n&gt; The following code maybe does the trick, but it seems very akward\n&gt; this way. Any help would be appreciated:\n&gt;\n&gt; ################# Code begins ######################\n&gt;\n&gt; ARCWriter aw = new ARCWriter(arcsDirs, prefix, suffix, compress,\n&gt;                 maxSize, metadata);\n&gt; Iterator filesToIncludeIterator = filesToInclude.iterator();\n&gt;\n&gt; while (filesToIncludeIterator.hasNext()) {\n&gt; try {\n&gt;      String contentType = &quot;text/plain&quot;;\n&gt;      String hostIP = InetAddress.getLocalHost().getHostAddress();\n\nYou might assign these once only outside of the while loop.\n\n&gt;      long fetchBeginTimeStamp = System.currentTimeMillis();\n&gt;      ByteArrayOutputStream baos;\n&gt;      int recordLength;\n&gt;\n&gt;      String fileName = (String) filesToIncludeIterator.next();\n&gt;      System.out.println(&quot;filename:&quot; + fileName);\n&gt;      if (fileName == null) {\n&gt;              continue;\n&gt;      }\n&gt;      File theFile = new File(crawldir, fileName);\n&gt;      String uri = new String(RECORD_PREFIX + jobId + &quot;/&quot; + fileName);\n&gt;\nI don&#39;t see RECORD_PREFIX.  Will the resultant &#39;uri&#39; parse as a URL?\n\n&gt;      baos = createBaosFromFile(theFile);\n&gt;\n&gt;      // We have to read the whole file to know the length of the\n&gt;      // file, or do we take this information\n&gt;      // from theFile.length()\n\nFile is complete on disk.  Assuming you&#39;re not still writing the file, \nshould be safe doing theFile.length() rather than reading whole file. \n\n&gt;      recordLength = baos.toByteArray().length;\n&gt;     \n&gt;       /**\n&gt;         * @see ARCWriter#write(java.lang.String, java.lang.String,\n&gt;         *      java.lang.String, long, int,\n&gt;         *      java.io.ByteArrayOutputStream)\n&gt;         */\n&gt;       aw.write(uri, contentType, hostIP, fetchBeginTimeStamp,\n&gt;                         recordLength, baos);\n\nDid you try this method:\nhttp://crawler.archive.org/apidocs/org/archive/io/arc/ARCWriter.html#write(java.lang.String,%20java.lang.String,%20java.lang.String,%20long,%20int,%20java.io.InputStream)\n\nCode would become:\n\naw.write(uri, contentType, hostIP, fetchBeginTimeStamp, \ntheFile.length(), new FileInputStream(theFile));\n\n&gt;\n&gt;      } catch (IOException e) {\n&gt;                 throw new IOFailure(&quot;IOexception was caught: &quot;, e);\n&gt;      }\n&gt;    } // end while\n&gt;\n&gt;    /**\n&gt;      * @param theFile\n&gt;      * @return a ByteArrayOutputStream from a file\n&gt;      * @throws IOException\n&gt;      */\n&gt;     public static ByteArrayOutputStream createBaosFromFile(File\n&gt; theFile)\n&gt;             throws IOException {\n&gt;         // TODO: Need to write a header as well to the baos??\n\nNo.  Don&#39;t bother with the header.  Should be fine without it.   Test by \nusing an ARCReader against the produced ARC of logs.\n\nBut if you did want to write a header before your logs, one suggestion \nwould be to create a header per record in a byte array, then get an \nInputStream onto the header byte array and the header onto the file, \nthen feed to ARCWriter, the two streams \nhttp://java.sun.com/j2se/1.5.0/docs/api/java/io/SequenceInputStream.html \n(See the following constructor in particular: \nhttp://java.sun.com/j2se/1.5.0/docs/api/java/io/SequenceInputStream.html#SequenceInputStream(java.io.InputStream,%20java.io.InputStream).\n\nHope this helps,\nSt.Ack\n\n&gt;\n&gt;         InputStream stream = new FileInputStream(theFile); // throws\n&gt;         // IOException (or\n&gt;         // rather\n&gt;         // FileNotFoundException)\n&gt;         ByteArrayOutputStream baos = new ByteArrayOutputStream();\n&gt;         byte[] buffer = new byte[8192];\n&gt;         int bytesRead = 0;\n&gt;\n&gt;         final String HTTP = &quot;HTTP/1.0 200 Ok&quot;;\n&gt;         final String date = &quot;Date: &quot; + new Date();\n&gt;         final String contentType = &quot;Content-type: &quot; + &quot;text/plain&quot;;\n&gt;         final String contentLength = &quot;Content-length: &quot; +\n&gt; theFile.length();\n&gt;         StringBuffer http_header = new StringBuffer();\n&gt;\n&gt;         http_header.append(HTTP + &quot;&#92;n&quot;);\n&gt;         http_header.append(date + &quot;&#92;n&quot;);\n&gt;         http_header.append(contentType + &quot;&#92;n&quot;);\n&gt;         http_header.append(contentLength + &quot;&#92;n&#92;n&quot;);\n&gt;         System.out.println(&quot;header: &quot; + http_header.toString());\n&gt;         baos.write(http_header.toString().getBytes());\n&gt;         while ((bytesRead = stream.read(buffer, 0, 8192)) != -1) { //\n&gt; throws\n&gt;             // IOException\n&gt;             baos.write(buffer, 0, bytesRead);\n&gt;         }\n&gt;         return baos;\n&gt;     }\n&gt; ############### Code ends #########################\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; ------------------------------------------------------------------------\n&gt; YAHOO! GROUPS LINKS\n&gt;\n&gt;     *  Visit your group &quot;archive-crawler\n&gt;       &lt;http://groups.yahoo.com/group/archive-crawler&gt;&quot; on the web.\n&gt;        \n&gt;     *  To unsubscribe from this group, send an email to:\n&gt;        archive-crawler-unsubscribe@yahoogroups.com\n&gt;       &lt;mailto:archive-crawler-unsubscribe@yahoogroups.com?subject=Unsubscribe&gt;\n&gt;        \n&gt;     *  Your use of Yahoo! Groups is subject to the Yahoo! Terms of\n&gt;       Service &lt;http://docs.yahoo.com/info/terms/&gt;.\n&gt;\n&gt;\n&gt; ------------------------------------------------------------------------\n&gt;\n\n\n"}}