{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr","from":"Gordon Mohr &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"GE0T7if1X6Y9IfcGsVbtWmE6FTDJDRRva6njhqOM_4JsiUx2V1SB45R1HIRaPFLJY2qd-EYv9sGX6i_2AXqzJ2rY3tXmTr4","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Re: [archive-crawler] Re: Heritrix &quot;hangs&quot; and doesn&#39;t finish its job","postDate":"1151703552","msgId":2996,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDQ0QTU5QTAwLjQwNzA0MDdAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PGU4MnQ3aStnY3J1QGVHcm91cHMuY29tPg==","referencesHeader":"PGU4MnQ3aStnY3J1QGVHcm91cHMuY29tPg=="},"prevInTopic":2994,"nextInTopic":0,"prevInTime":2995,"nextInTime":2997,"topicId":2822,"numMessagesInTopic":9,"msgSnippet":"The frontier report indicates that IP-based queueing isn t working for you, either -- or else the queue names would be IP addresses. So that s a separate bug,","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 10525 invoked from network); 30 Jun 2006 21:38:00 -0000\r\nReceived: from unknown (66.218.67.34)\n  by m40.grp.scd.yahoo.com with QMQP; 30 Jun 2006 21:38:00 -0000\r\nReceived: from unknown (HELO mail.archive.org) (207.241.227.188)\n  by mta8.grp.scd.yahoo.com with SMTP; 30 Jun 2006 21:38:00 -0000\r\nReceived: from localhost (localhost [127.0.0.1])\n\tby mail.archive.org (Postfix) with ESMTP id 75A8D141568E1\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Fri, 30 Jun 2006 14:38:02 -0700 (PDT)\r\nReceived: from mail.archive.org ([127.0.0.1])\n\tby localhost (mail.archive.org [127.0.0.1]) (amavisd-new, port 10024)\n\twith LMTP id 20653-01-6 for &lt;archive-crawler@yahoogroups.com&gt;;\n\tFri, 30 Jun 2006 14:38:01 -0700 (PDT)\r\nReceived: from [192.168.1.203] (unknown [67.170.222.19])\n\tby mail.archive.org (Postfix) with ESMTP id 76AA214156993\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Fri, 30 Jun 2006 14:38:01 -0700 (PDT)\r\nMessage-ID: &lt;44A59A00.4070407@...&gt;\r\nDate: Fri, 30 Jun 2006 14:39:12 -0700\r\nUser-Agent: Mail/News 1.5 (X11/20060309)\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;e82t7i+gcru@...&gt;\r\nIn-Reply-To: &lt;e82t7i+gcru@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-Virus-Scanned: Debian amavisd-new at archive.org\r\nX-eGroups-Msg-Info: 1:0:0:0\r\nFrom: Gordon Mohr &lt;gojomo@...&gt;\r\nSubject: Re: [archive-crawler] Re: Heritrix &quot;hangs&quot; and doesn&#39;t finish its\n job\r\nX-Yahoo-Group-Post: member; u=137285340; y=UVgb4XbvXuRrVqz0RGomyoM2iiVkIyrFaD3Y0PMZ6QpQ\r\nX-Yahoo-Profile: gojomo\r\n\r\nThe frontier report indicates that IP-based queueing isn&#39;t working for \nyou, either -- or else the queue names would be IP addresses. So that&#39;s \na separate bug, though not one that&#39;s caused the end-of-crawl hang.\n\nOfflist, could you send me your recovery.log? I&#39;d like to compare your \norder of URL discovery with my (failed) attempts to reproduce the \nproblem here.\n\n- Gordon @ IA\n\npandae667 wrote:\n&gt; Hi Gordon,\n&gt; \n&gt; first of all, here is the full frontier report I get:\n&gt; \n&gt;  Job being crawled: hangup\n&gt; \n&gt;  -----===== STATS =====-----\n&gt;  Discovered:    237\n&gt;  Queued:        4\n&gt;  Finished:      24\n&gt;   Successfully: 24\n&gt;   Failed:       0\n&gt;   Disregarded:  0\n&gt; \n&gt;  -----===== QUEUES =====-----\n&gt;  Already included size:     237\n&gt;                pending:     0\n&gt; \n&gt;  All class queues map size: 4\n&gt;              Active queues: 0\n&gt;                     In-process: 0\n&gt;                          Ready: 0\n&gt;                        Snoozed: 0\n&gt;            Inactive queues: 0\n&gt;             Retired queues: 4\n&gt;           Exhausted queues: 0\n&gt; \n&gt;  -----===== IN-PROCESS QUEUES =====-----\n&gt; \n&gt;  -----===== READY QUEUES =====-----\n&gt; \n&gt;  -----===== SNOOZED QUEUES =====-----\n&gt; \n&gt;  -----===== LONGEST QUEUE =====-----\n&gt; Queue www.chip.de\n&gt;   169 items\n&gt;     last enqueued:\n&gt; http://www.chip.de/news/http%3A%2F%2Fwww.chip.de%2Fnews%2Fc1_news_20547236.html%3Ftid1%3D9226%26tid2%3D0\n&gt;       last peeked:\n&gt; http://www.chip.de/news/c1_news_20546431.html?tid1=9226&tid2=0\n&gt;    total expended: 6 (total budget: 5)\n&gt;    active balance: 5\n&gt;    last(avg) cost: 1(1.0)\n&gt; \n&gt; \n&gt;  -----===== INACTIVE QUEUES =====-----\n&gt; \n&gt;  -----===== RETIRED QUEUES =====-----\n&gt; Queue r.chip.de\n&gt;   5 items\n&gt;     last enqueued:\n&gt; http://r.chip.de/images/pic.gif?m=c1&uid=0&c=20547236&b=2711826&l=3071&tc=019001003&tid=9240&tp=9223,9226&random=%22+Math.random()+%22&json=1&con=%22+con+%22&tit=News%20-%20MP3-Player%20inklusive%20H%26ouml%3Brb%26uuml%3Bchern&r=%22+escape(document.referrer)+%22&sz=%22+r2sz+%22&tn=M%E4rkte%20%26%20Unternehmen&url=http%3A%2F%2Fwww.chip.de%2Fnews%2Fc1_news_20547236.html%3Ftid1%3D9240%26amp%3Btid2%3D0&cs=1\n&gt;       last peeked:\n&gt; http://r.chip.de/images/pic.gif?m=c1&uid=&c=17215088&b=1868041&l=3661&tc=019039&tid=&tp=&tit=Homepage&r=http%3A%2F%2Fwww.chip.de%2Fc1_navseite_12648189.html&random=716829837&tn=&url=http%3A%2F%2Farchiv.chip.de%2Findex.html%3Ftid1%3D%26amp%3Btid2%3D&cs=1\n&gt;    total expended: 6 (total budget: 5)\n&gt;    active balance: 5\n&gt;    last(avg) cost: 1(1.0)\n&gt; \n&gt; Queue ad.chip.de\n&gt;   3 items\n&gt;     last enqueued:\n&gt; http://ad.chip.de/wb/adjs.php?what=webtipp&n=439136166&exclude=1&p=chip.de&nbpp=9223,9226,9226&pbpp=1&uri=%2Fnews%2Fc1_news_20547236.html&pos=webtipp&ressort=9226&rubrik=9226&tid2=0\n&gt;       last peeked:\n&gt; http://ad.chip.de/wb/adjs.php?what=footer&n=905642610&exclude=1&p=chip.de&nbpp=9223,9226,9226&pbpp=1&uri=%2Fnews%2Fc1_news_20562075.html&pos=footer&ressort=9226&rubrik=9226&tid2=0\n&gt;    total expended: 6 (total budget: 5)\n&gt;    active balance: 5\n&gt;    last(avg) cost: 1(1.0)\n&gt; \n&gt; Queue archiv.chip.de\n&gt;   36 items\n&gt;     last enqueued: http://archiv.chip.de/http%3A%2F%2Farchiv.chip.de%2F\n&gt;       last peeked: http://archiv.chip.de/http%3A%2F%2Farchiv.chip.de%2F\n&gt;    total expended: 6 (total budget: 5)\n&gt;    active balance: 5\n&gt;    last(avg) cost: 1(1.0)\n&gt; \n&gt; Queue www.chip.de\n&gt;   169 items\n&gt;     last enqueued:\n&gt; http://www.chip.de/news/http%3A%2F%2Fwww.chip.de%2Fnews%2Fc1_news_20547236.html%3Ftid1%3D9226%26tid2%3D0\n&gt;       last peeked:\n&gt; http://www.chip.de/news/c1_news_20546431.html?tid1=9226&tid2=0\n&gt;    total expended: 6 (total budget: 5)\n&gt;    active balance: 5\n&gt;    last(avg) cost: 1(1.0)\n&gt; \n&gt; \n&gt; The JVm I am using is a 32bit Sun JDK 1.5.0.06 on one system and a AMD\n&gt; 64bit Sun JDK 1.5.0.07 on another one.\n&gt; \n&gt; About you suspecting the cause in IPQueueAssignement - it also happens\n&gt; to me when using a HostnameQueueAssignementPolicy,\n&gt; BucketQueueAssignementPolicy or SortAuthorityQueueAssignementPolicy.\n&gt; \n&gt; Hope those details help you in tracking down this really annoying problem.\n&gt; \n&gt; Thanks in advance\n&gt;   Olaf Freyer\n&gt; \n&gt; --- In archive-crawler@yahoogroups.com, Gordon Mohr &lt;gojomo@...&gt; wrote:\n&gt;&gt; Olaf -\n&gt;&gt;\n&gt;&gt; I can see a potential cause of your problem -- an interaction between \n&gt;&gt; the IP-based queueing and retired queues -- but I can&#39;t reproduce it.\n&gt;&gt;\n&gt;&gt; Specifically, with the IP-based queueing, URIs first go onto a \n&gt;&gt; domain-name queue (before IP is known), then get moved to an IP-based \n&gt;&gt; queue. It appears possible that this handoff between queues might not \n&gt;&gt; maintain the proper queued count in all situations. (Also, that the\n&gt;&gt;\n&gt;&gt; However, my attempts to reproduce with the URI you provided and similar \n&gt;&gt; settings have not yet succeeded. Indeed, I even ran into another\n&gt; problem \n&gt;&gt; with IPQueueAssignmentPolicy not working at all, given the difference \n&gt;&gt; between its getClassKey() signature and the superclass signature.\n&gt;&gt;\n&gt;&gt; What JVM are you using?\n&gt;&gt;\n&gt;&gt; Can you forward the contents of the full frontier report for your\n&gt; latest \n&gt;&gt; mini-reproduction run?\n&gt;&gt;\n&gt;&gt; - Gordon @ IA\n&gt;&gt;\n&gt;&gt; pandae667 wrote:\n&gt;&gt;&gt; Hi everyone,\n&gt;&gt;&gt;\n&gt;&gt;&gt; I tried to find the cause of the problem for a while by now, but I&#39;m\n&gt;&gt;&gt; still stuck. \n&gt;&gt;&gt; I added some debug output to heritrix so each time the queuedUriCount\n&gt;&gt;&gt; gets increased I get an info in the log, same when it is increased.\n&gt;&gt;&gt;\n&gt;&gt;&gt; Using the previous example of mine I see the following in my logs:\n&gt;&gt;&gt;\n&gt;&gt;&gt; queued count increased by 1:  231\n&gt;&gt;&gt; queued count decreased by 1:   24 (it have been 4 queues, max total\n&gt;&gt;&gt; cost of 5 - thus 5 plus DNS query for each?)\n&gt;&gt;&gt;\n&gt;&gt;&gt; and in the end, 4 queues are retired, reducing the queued count by: 1,\n&gt;&gt;&gt; 2, 36, 164\n&gt;&gt;&gt;\n&gt;&gt;&gt; So a total of 231 objects were queued, but only 227 were dequeued,\n&gt;&gt;&gt; resulting in 4 remaining &quot;queued&quot; URIs in no queue that feels\n&gt; responsible.\n&gt;&gt;&gt; As the number of single decreases seems sane, the single increases\n&gt;&gt;&gt; seem correct, too (no URI seems to have been enqueued twice) I suspect\n&gt;&gt;&gt; the problem must be with the WorkQueues. Is there any chance that the\n&gt;&gt;&gt; getCount() method might return the wrong value?\n&gt;&gt;&gt;\n&gt;&gt;&gt; I&#39;d be thankful for any help as I&#39;m desperated by now..\n&gt;&gt;&gt;\n&gt;&gt;&gt; Thanks in advance\n&gt;&gt;&gt;   Olaf Freyer\n&gt;&gt;&gt;\n&gt;&gt;&gt; --- In archive-crawler@yahoogroups.com, &quot;pandae667&quot; &lt;aaron667@&gt; wrote:\n&gt;&gt;&gt;&gt; Hi everyone,\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; its me again. I have managed to reproduce this problem with just one\n&gt;&gt;&gt;&gt; seed.\n&gt;&gt;&gt;&gt; The seed in question is: \n&gt; http://www.chip.de/c1_navseite_12648189.html\n&gt;&gt;&gt;&gt; The order.xml to trigger the problem can be found at:\n&gt;&gt;&gt;&gt; http://user.cs.tu-berlin.de/~aaron/order.xml\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; With this order.xml it takes about 5 seconds to trigger the\n&gt; problem for\n&gt;&gt;&gt;&gt; me (100% reproducable).\n&gt;&gt;&gt;&gt; I&#39;m using an out-of-the-box heritrix-1.8.0 release without any\n&gt; special\n&gt;&gt;&gt;&gt; tweaks or changes.\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; Here is the queue report I get:\n&gt;&gt;&gt;&gt; -----===== STATS =====-----\n&gt;&gt;&gt;&gt; Discovered:    492\n&gt;&gt;&gt;&gt; Queued:        134\n&gt;&gt;&gt;&gt; Finished:      30\n&gt;&gt;&gt;&gt; Successfully: 30\n&gt;&gt;&gt;&gt; Failed:       0\n&gt;&gt;&gt;&gt; Disregarded:  0\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; -----===== QUEUES =====-----\n&gt;&gt;&gt;&gt; Already included size:     492\n&gt;&gt;&gt;&gt; pending:     0\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; All class queues map size: 5\n&gt;&gt;&gt;&gt; Active queues: 0\n&gt;&gt;&gt;&gt; In-process: 0\n&gt;&gt;&gt;&gt; Ready: 0\n&gt;&gt;&gt;&gt; Snoozed: 0\n&gt;&gt;&gt;&gt; Inactive queues: 0\n&gt;&gt;&gt;&gt; Retired queues: 5\n&gt;&gt;&gt;&gt; Exhausted queues: 0\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; -----===== IN-PROCESS QUEUES =====-----\n&gt;&gt;&gt;&gt; heritrix_out.log shows once again no sign of an exception.\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; Thx for any further help in resolving this problem\n&gt;&gt;&gt;&gt;    Olaf Freyer\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; --- In archive-crawler@yahoogroups.com, &quot;pandae667&quot; &lt;aaron667@&gt;\n&gt;&gt;&gt;&gt; wrote:\n&gt;&gt;&gt;&gt;&gt; Hi everyone,\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt; I&#39;v dug some more through the Heritrix sources to track down the\n&gt;&gt;&gt;&gt;&gt; problem but haven&#39;t found a solution yet. This problem starts to get\n&gt;&gt;&gt;&gt;&gt; really annoying as it happens on almost every big crawl I&#39;m running\n&gt;&gt;&gt;&gt;&gt; (500+ seeds) but rarly on small ones with less seeds.\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt; I haven&#39;t found a cause yet but have some theories what might\n&gt; cause it\n&gt;&gt;&gt;&gt;&gt; (even though I might be totally wrong).\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt; The most propable theory so far is the following:\n&gt;&gt;&gt;&gt;&gt; Two ToeThreads working on different URIs from different queues come\n&gt;&gt;&gt;&gt;&gt; accross the same (so far unseen) URI at more or less &quot;the exact same\n&gt;&gt;&gt;&gt;&gt; moment&quot;. Both threads come to the conclusion that their URI is\n&gt; new and\n&gt;&gt;&gt;&gt;&gt; try to enqueue it in the currect queue. While doing this both of\n&gt; them\n&gt;&gt;&gt;&gt;&gt; increment to queuedUriCount by 1 but the queue itself being smart\n&gt;&gt;&gt;&gt;&gt; enough only contains one of them.\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt; I&#39;ll increase logging to see if my theory might be true and report\n&gt;&gt;&gt;&gt;&gt; back later.\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt; If anyone has any other idea in the meantime I&#39;ll be happy to hear\n&gt;&gt;&gt;&gt;&gt; about it.\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt; Thanks alot\n&gt;&gt;&gt;&gt;&gt;   Olaf Freyer\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt; --- In archive-crawler@yahoogroups.com, &quot;pandae667&quot; aaron667@ wrote:\n&gt;&gt;&gt;&gt;&gt;&gt; Hi everyone here at archive-crawler,\n&gt;&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;&gt; I&#39;m experiencing a strange problem with my crawler (heritrix cvs +\n&gt;&gt;&gt;&gt;&gt;&gt; AddRedirectFromRootServerToScope fix from Gordon). It happened\n&gt; to me\n&gt;&gt;&gt;&gt;&gt;&gt; twice so far.\n&gt;&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;&gt; After about 1 hour it has fetched (allmost?) all the documents\n&gt; it is\n&gt;&gt;&gt;&gt;&gt;&gt; supposed to (about 9000 seeds and a limit of 100 documents per\n&gt; host)\n&gt;&gt;&gt;&gt;&gt;&gt; and then just &quot;hangs&quot;.\n&gt;&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;&gt; The Frontier Report tells me:\n&gt;&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;&gt;  -----===== STATS =====-----\n&gt;&gt;&gt;&gt;&gt;&gt;  Discovered:    1008968\n&gt;&gt;&gt;&gt;&gt;&gt;  Queued:        24\n&gt;&gt;&gt;&gt;&gt;&gt;  Finished:      432424\n&gt;&gt;&gt;&gt;&gt;&gt;   Successfully: 426289\n&gt;&gt;&gt;&gt;&gt;&gt;   Failed:       1565\n&gt;&gt;&gt;&gt;&gt;&gt;   Disregarded:  4570\n&gt;&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;&gt;  -----===== QUEUES =====-----\n&gt;&gt;&gt;&gt;&gt;&gt;  Already included size:     1008968\n&gt;&gt;&gt;&gt;&gt;&gt;                pending:     0\n&gt;&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;&gt;  All class queues map size: 12872\n&gt;&gt;&gt;&gt;&gt;&gt;              Active queues: 0\n&gt;&gt;&gt;&gt;&gt;&gt;                     In-process: 0\n&gt;&gt;&gt;&gt;&gt;&gt;                          Ready: 0\n&gt;&gt;&gt;&gt;&gt;&gt;                        Snoozed: 0\n&gt;&gt;&gt;&gt;&gt;&gt;            Inactive queues: 0\n&gt;&gt;&gt;&gt;&gt;&gt;             Retired queues: 2226\n&gt;&gt;&gt;&gt;&gt;&gt;           Exhausted queues: 10646\n&gt;&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;&gt;  -----===== IN-PROCESS QUEUES =====-----\n&gt;&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;&gt; So there are still 24 queued URIs - but no active queue left (last\n&gt;&gt;&gt;&gt;&gt;&gt; time a queue did anything was about 12 hours ago).\n&gt;&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;&gt; Thanks in advance for any ideas\n&gt;&gt;&gt;&gt;&gt;&gt;   Olaf Freyer\n&gt;&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;  \n&gt;&gt;&gt; Yahoo! Groups Links\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;  \n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt; \n&gt; \n&gt; \n&gt; \n&gt; \n&gt; \n&gt; \n&gt; \n&gt;  \n&gt; Yahoo! Groups Links\n&gt; \n&gt; \n&gt; \n&gt;  \n&gt; \n&gt; \n&gt; \n\n\n"}}