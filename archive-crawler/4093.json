{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr","from":"Gordon Mohr &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"Jc_wsTLGHGh58BAaP8JWSzhHod22JOzpJwDl5iSBmHK2NBYAweYVviC6Z8NKo40pIu-7D3jNI0akpS2mZZ-nW2gOuEz2BIA","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Re: [archive-crawler] Re: questions about heritrix memory consumption","postDate":"1176326080","msgId":4093,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDQ2MUQ0RkMwLjgwNTAzMDZAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PGV2aWsyMStzbWdqQGVHcm91cHMuY29tPg==","referencesHeader":"PGV2aWsyMStzbWdqQGVHcm91cHMuY29tPg=="},"prevInTopic":4087,"nextInTopic":4105,"prevInTime":4092,"nextInTime":4094,"topicId":4079,"numMessagesInTopic":8,"msgSnippet":"Olaf - There s definitely something amiss here, and it looks related to the BDB-JE library. I ve asked the Sleepycat experts about some fishy code related to","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 44469 invoked from network); 11 Apr 2007 21:13:01 -0000\r\nReceived: from unknown (66.218.67.34)\n  by m31.grp.scd.yahoo.com with QMQP; 11 Apr 2007 21:13:01 -0000\r\nReceived: from unknown (HELO mail.archive.org) (207.241.233.246)\n  by mta8.grp.scd.yahoo.com with SMTP; 11 Apr 2007 21:13:01 -0000\r\nReceived: from localhost (localhost [127.0.0.1])\n\tby mail.archive.org (Postfix) with ESMTP id B55111415FFA6\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Wed, 11 Apr 2007 14:12:09 -0700 (PDT)\r\nReceived: from mail.archive.org ([127.0.0.1])\n\tby localhost (mail.archive.org [127.0.0.1]) (amavisd-new, port 10024)\n\twith LMTP id 05456-07-11 for &lt;archive-crawler@yahoogroups.com&gt;;\n\tWed, 11 Apr 2007 14:12:09 -0700 (PDT)\r\nReceived: from [192.168.1.203] (c-76-102-230-209.hsd1.ca.comcast.net [76.102.230.209])\n\tby mail.archive.org (Postfix) with ESMTP id E54531415FFA8\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Wed, 11 Apr 2007 14:12:08 -0700 (PDT)\r\nMessage-ID: &lt;461D4FC0.8050306@...&gt;\r\nDate: Wed, 11 Apr 2007 14:14:40 -0700\r\nUser-Agent: Thunderbird 1.5.0.10 (X11/20070306)\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;evik21+smgj@...&gt;\r\nIn-Reply-To: &lt;evik21+smgj@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-Virus-Scanned: Debian amavisd-new at archive.org\r\nX-eGroups-Msg-Info: 1:0:0:0\r\nFrom: Gordon Mohr &lt;gojomo@...&gt;\r\nSubject: Re: [archive-crawler] Re: questions about heritrix memory consumption\r\nX-Yahoo-Group-Post: member; u=137285340; y=ku1hmBnbQ3hU9xP7abyTi5wDxmk-iZ3skD5uAhVhcbIK\r\nX-Yahoo-Profile: gojomo\r\n\r\nOlaf -\n\nThere&#39;s definitely something amiss here, and it looks related to the \nBDB-JE library. I&#39;ve asked the Sleepycat experts about some fishy code \nrelated to the lingering Environments, see...\n\nhttp://forums.oracle.com/forums/thread.jspa?threadID=495531&tstart=0\n\nI&#39;ll report back to the list with what they say and I find.\n\nI think the ToePool issue is separate; it looks like we should be doing \na ThreadGroup.setDaemon() on the ToePool.\n\n- Gordon @ IA\n\npandae667 wrote:\n&gt; Hi Gordon,\n&gt; \n&gt; I spend some more time looking into the issue, made some heap dumps,\n&gt; tried to understand their content (first using &#39;jhat&#39;, but finally\n&gt; decided to use the convenience of netbeans profiler)... but I still\n&gt; don&#39;t have a real explaination for what I&#39;m seeing.\n&gt; \n&gt; But there is one thing that confused me alot. I had about 50 jobs\n&gt; running on that machine (53 to be exact) , all of them finished just fine.\n&gt; But what I find are 53 instances of EnhancedEnvironment still in\n&gt; memory, 53 instances of com.sleepycat.je.Database and also 53\n&gt; instances of org.archive.crawler.framework.ToePool.\n&gt; \n&gt; So its either some cleanup code not being called - or the GC is god\n&gt; damn lazy... \n&gt; \n&gt; (I&#39;ll use &#39;jmap -histo:live&#39; next time the machine is in a similar\n&gt; state to be 100% sure only to see live object in my dumps)\n&gt; \n&gt; Regards\n&gt;   Olaf Freyer\n&gt; \n&gt; \n&gt; \n&gt; --- In archive-crawler@yahoogroups.com, &quot;pandae667&quot; &lt;aaron667@...&gt; wrote:\n&gt;&gt; Hi Gordon,\n&gt;&gt;\n&gt;&gt; its once again me. \n&gt;&gt; I were able to trigger a GC via a JMX call and now the reports of\n&gt;&gt; &#39;jmap -histo&#39; seem to be more consistent with the report of the webUI.\n&gt;&gt; (or maybe I just copied&pasted the wrong report last time)\n&gt;&gt;\n&gt;&gt; num   #instances    #bytes  class name\n&gt;&gt; --------------------------------------\n&gt;&gt;   1:    674736   292760720  [B\n&gt;&gt;   2:    451626    18065040  com.sleepycat.je.tree.LN\n&gt;&gt;   3:      7239     7580688  [[B\n&gt;&gt;   4:      7233     7580184  [Lcom.sleepycat.je.tree.Node;\n&gt;&gt;   5:     39884     5859680  &lt;constMethodKlass&gt;\n&gt;&gt;   6:     39884     4794544  &lt;methodKlass&gt;\n&gt;&gt;   7:     28497     4725848  [Ljava.util.HashMap$Entry;\n&gt;&gt;   8:      3704     4580736  &lt;constantPoolKlass&gt;\n&gt;&gt;   9:     47991     4553240  [Ljava.lang.Object;\n&gt;&gt;  10:     79118     3797664  java.util.HashMap$Entry\n&gt;&gt;\n&gt;&gt; (summing up all the #bytes only differs by a few % to what the webUI\n&gt;&gt; reports)\n&gt;&gt;\n&gt;&gt; But still... What I&#39;m seeing is about half the memory consumption\n&gt;&gt; being caused by JBDB data structures - whilest heritrix says:\n&gt;&gt;\n&gt;&gt; Jobs\n&gt;&gt; None available\n&gt;&gt; 0 pending, 53 completed\n&gt;&gt;\n&gt;&gt; This doesn&#39;t seem all too reasonable to me (or maybe I still just\n&gt;&gt; can&#39;t stand garbage collectors?).\n&gt;&gt;\n&gt;&gt; I&#39;ll try to get a heap dump to retrieve some more informations about\n&gt;&gt; what is going on.\n&gt;&gt;\n&gt;&gt; Regards\n&gt;&gt;   Olaf Freyer\n&gt;&gt;\n&gt;&gt; --- In archive-crawler@yahoogroups.com, &quot;pandae667&quot; &lt;aaron667@&gt; wrote:\n&gt;&gt;&gt; Hi Gordon,\n&gt;&gt;&gt;\n&gt;&gt;&gt; thanks for your quick reply.\n&gt;&gt;&gt; (1) I think it might be true, that &#39;jmap -histo&#39; doesn&#39;t force a GC.\n&gt;&gt;&gt; I&#39;ll look into this and try if things change after a forced GC.\n&gt;&gt;&gt; (2) The last 50 jobs all are in the &quot;Finished&quot; state, so I&#39;d presume\n&gt;&gt;&gt; everything finished just fine. (This machine only does &quot;small&quot; jobs)\n&gt;&gt;&gt;\n&gt;&gt;&gt; The main reason why I&#39;m mentioning all this is that my machines\n&gt;&gt;&gt; running the big crawls tend to &quot;die&quot; after about a week.\n&gt;&gt;&gt; Or to be more correct, they run fine for one week. Then their task is\n&gt;&gt;&gt; either finished - or I finish it via JMX. Now I enqueue the next job\n&gt;&gt;&gt; which runs OOME within 1 or 2 days.\n&gt;&gt;&gt;\n&gt;&gt;&gt; After the first job has finished heritrix remains in a state of 4.5GB\n&gt;&gt;&gt; of 5GB heap used -  so I think it seems reasonable to believe that\n&gt;&gt;&gt; something from the previous job still remains in-memory.\n&gt;&gt;&gt;\n&gt;&gt;&gt; I&#39;m not sure why this happens - if this is either a real memory leak\n&gt;&gt;&gt; or just the GC going nuts.\n&gt;&gt;&gt;\n&gt;&gt;&gt; I have to admit that I still don&#39;t understand all of heritrix\n&gt;&gt;&gt; internals, but I found this blog entry\n&gt;&gt;&gt; (http://blogs.oracle.com/charleslamb/2007/02/22) interesting\n&gt;&gt;&gt; concerning java BDB and OOME issues. Not sure if it applies to\n&gt;&gt;&gt; heritrix as I&#39;, not sure if we have one or multiple environments.\n&gt;&gt;&gt;\n&gt;&gt;&gt; Regards\n&gt;&gt;&gt;   Olaf Freyer\n&gt;&gt;&gt;\n&gt;&gt;&gt; --- In archive-crawler@yahoogroups.com, Gordon Mohr &lt;gojomo@&gt; wrote:\n&gt;&gt;&gt;&gt; Two possibilities come to mind:\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; (1) I don&#39;t think &#39;jmap -histo&#39; forces a GC first. And, its output\n&gt;&gt;&gt; seems \n&gt;&gt;&gt;&gt; peculiar given the webUI figures: it&#39;s showing over 1GB of byte\n&gt;&gt; arrays \n&gt;&gt;&gt;&gt; (&quot;[B&quot;), though the webUi reports only ~400MB heap in use. So I think\n&gt;&gt;&gt; the \n&gt;&gt;&gt;&gt; &#39;jmap -histo&#39; figures contain dead objects. Maybe a forced GC would\n&gt;&gt;&gt; give \n&gt;&gt;&gt;&gt; more sensible figures.\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; (2) The crawl didn&#39;t finish completely or cleanly. It&#39;s not \n&gt;&gt;&gt;&gt; paused-at-finish waiting for a possible resume with more URIs,\n&gt; is it?\n&gt;&gt;&gt;&gt; - Gordon @ IA\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; pandae667 wrote:\n&gt;&gt;&gt;&gt;&gt; Dear IA-Team,\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt; whilest analysing the results of a previous crawl I decided to\n&gt; also\n&gt;&gt;&gt;&gt;&gt; take a closer look at heritrix. To be more specific a closer\n&gt; look at\n&gt;&gt;&gt;&gt;&gt; the state heritrix was in after finishing the job.\n&gt;&gt;&gt;&gt;&gt; (basically heritrix-1.12 with some minor patches running under\n&gt;&gt;&gt; java 1.6)\n&gt;&gt;&gt;&gt;&gt; The webUI showed me the following stats:\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt; Memory\n&gt;&gt;&gt;&gt;&gt; 402591 KB used\n&gt;&gt;&gt;&gt;&gt; 950456 KB current heap\n&gt;&gt;&gt;&gt;&gt; 3063488 KB max heap\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt; Now this is quite a lot memory being used while sitting there\n&gt; idle.\n&gt;&gt;&gt;&gt;&gt; So I wondered what is eating up all my precious memory and this is\n&gt;&gt;&gt;&gt;&gt; what jmap -histo &lt;pid&gt; was able to tell me:\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt; num   #instances    #bytes  class name\n&gt;&gt;&gt;&gt;&gt; --------------------------------------\n&gt;&gt;&gt;&gt;&gt;   1:   7716610   1352335640  [B\n&gt;&gt;&gt;&gt;&gt;   2:   5202265   208090600  com.sleepycat.je.tree.LN\n&gt;&gt;&gt;&gt;&gt;   3:     78155    81900656  [[B\n&gt;&gt;&gt;&gt;&gt;   4:     78149    81900152  [Lcom.sleepycat.je.tree.Node;\n&gt;&gt;&gt;&gt;&gt;   5:    469864    72832376  [C\n&gt;&gt;&gt;&gt;&gt;   6:     24169    25050392  [J\n&gt;&gt;&gt;&gt;&gt;   7:    421191    20217168  java.util.Hashtable$Entry\n&gt;&gt;&gt;&gt;&gt;   8:    467772    18710880  java.lang.String\n&gt;&gt;&gt;&gt;&gt;   9:     75246    12641328  com.sleepycat.je.tree.BIN\n&gt;&gt;&gt;&gt;&gt;  10:    259687    12464976  org.archive.crawler.admin.SeedRecord\n&gt;&gt;&gt;&gt;&gt;  ...\n&gt;&gt;&gt;&gt;&gt;  ...\n&gt;&gt;&gt;&gt;&gt;  ...\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt; So what I&#39;m asking myself is: why do I still see about 5 million\n&gt;&gt;&gt;&gt;&gt; instances of com.sleepycat.je.tree.LN in memory whilest sitting\n&gt;&gt; there\n&gt;&gt;&gt;&gt;&gt; idle and the last job having finished about 3 days ago ?\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt; Anyone able to share some insights with me?\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt; Regards\n&gt;&gt;&gt;&gt;&gt;   Olaf Freyer\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;  \n&gt;&gt;&gt;&gt;&gt; Yahoo! Groups Links\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt;&gt;\n&gt; \n&gt; \n&gt; \n&gt; \n&gt;  \n&gt; Yahoo! Groups Links\n&gt; \n&gt; \n&gt; \n\n\n"}}