{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr","from":"Gordon Mohr &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"WSfQURwJzl6UhGX7qVyk5Ev3CVA7iGJxbjSZfRtPZQ9cs_1cxg8EN05A7-b7LdWFezbpVnurF_nioq1FZPfMdS55KM6lXW8","spamInfo":{"isSpam":false,"reason":"6"},"subject":"Re: [archive-crawler] Decide rules","postDate":"1262736385","msgId":6259,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDRCNDNENDAxLjUwOTAyMDZAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PDJEMTI3RjExREM3OTcxNEU5QjZBNDNBQzk0NTgxNDdGMzI3NkIzMDlAc3VleDA3LW1ieC0wMy5hZC5zeXIuZWR1Pg==","referencesHeader":"PDJEMTI3RjExREM3OTcxNEU5QjZBNDNBQzk0NTgxNDdGMzI3NkIyRkJAc3VleDA3LW1ieC0wMy5hZC5zeXIuZWR1PgkgPDZhMDI5ZTJkMDkxMjI2MTAyOG03MGJkNTE5YW0zNGNhMzRmNDEwNmZkMjFAbWFpbC5nbWFpbC5jb20+CSA8MkQxMjdGMTFEQzc5NzE0RTlCNkE0M0FDOTQ1ODE0N0YzMjc2QjMwM0BzdWV4MDctbWJ4LTAzLmFkLnN5ci5lZHU+IDw2YTAyOWUyZDA5MTIyODA4MzVzNTAxMzZmZjB4NzgwNmZlZTMyMmVjZjRlOEBtYWlsLmdtYWlsLmNvbT4gPDJEMTI3RjExREM3OTcxNEU5QjZBNDNBQzk0NTgxNDdGMzI3NkIzMDlAc3VleDA3LW1ieC0wMy5hZC5zeXIuZWR1Pg=="},"prevInTopic":6252,"nextInTopic":6261,"prevInTime":6258,"nextInTime":6260,"topicId":6240,"numMessagesInTopic":14,"msgSnippet":"A bit of background: We used to have a system of composable Filter URI-test classes, with AND/OR/NOT options. However, to implement common needs, the nesting","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 44243 invoked from network); 6 Jan 2010 00:06:28 -0000\r\nX-Received: from unknown (66.196.94.105)\n  by m4.grp.sp2.yahoo.com with QMQP; 6 Jan 2010 00:06:28 -0000\r\nX-Received: from unknown (HELO relay01.pair.com) (209.68.5.15)\n  by mta1.grp.re1.yahoo.com with SMTP; 6 Jan 2010 00:06:28 -0000\r\nX-Received: (qmail 15795 invoked from network); 6 Jan 2010 00:06:27 -0000\r\nX-Received: from 67.188.14.54 (HELO ?192.168.23.128?) (67.188.14.54)\n  by relay01.pair.com with SMTP; 6 Jan 2010 00:06:27 -0000\r\nX-pair-Authenticated: 67.188.14.54\r\nMessage-ID: &lt;4B43D401.5090206@...&gt;\r\nDate: Tue, 05 Jan 2010 16:06:25 -0800\r\nUser-Agent: Thunderbird 2.0.0.23 (Windows/20090812)\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;2D127F11DC79714E9B6A43AC9458147F3276B2FB@...&gt;\t &lt;6a029e2d0912261028m70bd519am34ca34f4106fd21@...&gt;\t &lt;2D127F11DC79714E9B6A43AC9458147F3276B303@...&gt; &lt;6a029e2d0912280835s50136ff0x7806fee322ecf4e8@...&gt; &lt;2D127F11DC79714E9B6A43AC9458147F3276B309@...&gt;\r\nIn-Reply-To: &lt;2D127F11DC79714E9B6A43AC9458147F3276B309@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-eGroups-Msg-Info: 1:6:0:0:0\r\nFrom: Gordon Mohr &lt;gojomo@...&gt;\r\nSubject: Re: [archive-crawler] Decide rules\r\nX-Yahoo-Group-Post: member; u=137285340; y=GlnXX3P7DMZKuezC970Y_Hl5kWVl6P11o6BwfpTL1TAC\r\nX-Yahoo-Profile: gojomo\r\n\r\nA bit of background:\n\nWe used to have a system of composable &#39;Filter&#39; URI-test classes, with \nAND/OR/NOT options.\n\nHowever, to implement common needs, the nesting got to be pretty deep \nand complicated. Inside the setup, it wasn&#39;t very easy to understand \nwhether &#39;true&#39; or &#39;false&#39; meant &#39;ok to get&#39; or &#39;not ok to get&#39; or &#39;no \nopinion&#39;.\n\nWe observed that it was very common to need rules where, if a test \npasses, a URI is definitively &quot;in&quot; or &quot;out&quot; -- while if the test does \nnot pass, no opinion is expressed either way. (Doing a series of these \nin nested boolean expressions can get quite confusing.)\n\nSo, we transitioned to scoping (and other per-URI go/no-go actions) as a \nflat series of &#39;DecideRules&#39;, where the last to express an opinion wins. \nThat makes a lot of common needs a matter of ordering the rules (rather \nthan nesting) -- first rule-in everything of general interest, then \nrule-out those known to have problems.\n\nWhich brings us to now.\n\nThe series-of-DecideRules approach has worked well for our usual needs. \nI thought we might eventually implement OR and AND rules, and they would \nbe relatively easy to add, but our internal crawls haven&#39;t had a \npressing need for that yet.\n\nThat said, you have a number of options to implement what you need:\n\n- create generic AND/OR/etc rules in Java, then compose your tests with them\n\n- create a custom DecideRule class in Java which does exactly the \ntest(s) you need, applying a decision if appropriate\n\n- use the BeanShellDecideRule (Heritrix 1.x) or ScriptedDecideRule (H3) \nto write your custom test in a scripting language\n\n(If you do wind up implementing generic AND/etc composing-rules, we&#39;d \nwelcome the code-contribution to the core project, even as I would \nsuggest people avoid that complexity in their scope rules whenever \npossible.)\n\nHope this helps,\n\n- Gordon @ IA\n\n\nSteven A Rowe wrote:\n&gt; Hi Anas,\n&gt; \n&gt; You&#39;re right, the sequence effect is not OR.  I don&#39;t know enough about the language of process flows to put the right label on what Heritrix is doing :).\n&gt; \n&gt; I would like to be able to write rules (not code) that allow me to stamp REJECT on URIs that have content type text/html AND are larger than 10MB, and PASS for everything else.  How can I do that?\n&gt; \n&gt; Steve\n&gt; \n&gt; On 12/28/2009 at 11:35 AM, anas elghafari wrote:\n&gt;&gt;\n&gt;&gt; I don&#39;t think the effect of the sequence is OR. Every rule stamps the\n&gt;&gt; URI with ACCEPT, REJECT or PASS. And the last non-pass is the operative\n&gt;&gt; judgment. So I don&#39;t quite understand the problem. Just have your rules\n&gt;&gt; stamp REJECT on what you don&#39;t like, and PASS on everything else... and\n&gt;&gt; this gives the effect of combining the reject rules with &quot;AND&quot;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt; On Sat, Dec 26, 2009 at 9:05 PM, Steven A Rowe &lt;sarowe@...&gt; wrote:\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt; \tHi Anas,\n&gt;&gt;\n&gt;&gt; \tI was hoping that you (or someone else on this list) would say\n&gt;&gt; that I was missing something that would allow me to only write rules,\n&gt;&gt; and not have to write code.\n&gt;&gt;\n&gt;&gt; \tCombining multiple conditions together seems like such a basic\n&gt;&gt; requirement I&#39;m surprised it doesn&#39;t already exist - something like the\n&gt;&gt; ability to override the logical operator on DecideRuleSequence\n&gt;&gt; (currently hardwired to OR) to other possibilities like AND. Then I\n&gt;&gt; could write something like (pardon the pseudocode):\n&gt;&gt;\n&gt;&gt; \tOrDecideRuleSequence : decision=LASTMATCH \tRejectDecideRule\n&gt;&gt; \tSurtPrefixedDecideRule : seedsAsSurtPrefixes=true ; decision=ACCEPT\n&gt;&gt; \tAndDecideRuleSequence : decision=REJECT\n&gt;&gt; \tContentTypeMatchesRegexDecideRule : regex=text/html\n&gt;&gt; \tExceedsDocumentLengthThresholdDecideRule \t:\n&gt;&gt; contentLengthThreshold=10000000 \tAndDecideRuleSequence : decision=REJECT\n&gt;&gt; \tContentTypeMatchesRegexDecideRule : regex=text/plain\n&gt;&gt; \tExceedsDocumentLengthThresholdDecideRule \t:\n&gt;&gt; contentLengthThreshold=100000\n&gt;&gt;\n&gt;&gt; \tIs this a bad idea?\n&gt;&gt;\n&gt;&gt; \tSteve\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt; \tOn 12/26/2009 at 1:28 PM, anas elghafari wrote: \t&gt; \t&gt; \t&gt; You can write\n&gt;&gt; your own decideRules that subclass the DecideRule, and you \t&gt; overwrite\n&gt;&gt; the decisionFor(Object o) method. In the decisionFor(Object o) \t&gt; you\n&gt;&gt; check if the Object is a CrawlURI, if so you typecast into CrawlURI \t&gt;\n&gt;&gt; and then you will be able to check the contenttype and content size \t&gt;\n&gt;&gt; (look at CrawlURI API). And you can issue decesion REJECT for the uris\n&gt;&gt; \t&gt; that don&#39;t fulfill you criteria. \t&gt; \t&gt; You can also do this by adding\n&gt;&gt; a processor, where -in your overwriting \t&gt; of innerProcess(CrawlURI\n&gt;&gt; curi)- you check the type and size and then you \t&gt; reject those URIs you\n&gt;&gt; don&#39;t want to process by calling \t&gt;\n&gt;&gt; curi.skipToProcessorChain(getCrawlController().getPostProcessorChain())\n&gt;&gt; \t&gt; \t&gt; beware that DecideRules/Filter inserted before the extraction will\n&gt;&gt; \t&gt; prevent the CrawlJob from ever getting to Uris that are acceptable,\n&gt;&gt; \t&gt; because the path to them goes through URIs that are not. \t&gt; \t&gt; Anas\n&gt;&gt; \t&gt; \t&gt; On Wed, Dec 23, 2009 at 1:48 AM, Steven A Rowe &lt;sarowe@...\n&gt;&gt; &lt;mailto:sarowe%40syr.edu&gt; &gt; wrote: \t&gt; \t&gt; Hi, \t&gt; \t&gt; I want to write\n&gt;&gt; decide-rules that reject resources based on two \t&gt; conditions:\n&gt;&gt; content-length and content-type (e.g., text/html resources \t&gt; larger\n&gt;&gt; than 10MB, and text/plain resources larger than 100KB), but I \t&gt; can&#39;t\n&gt;&gt; find any way to logically AND rule subsets together. \t&gt; \t&gt; Is there a\n&gt;&gt; way to write decide-rules that would achieve what I \t&gt; want? Should I be\n&gt;&gt; using ScriptedDecideRules? \t&gt; \t&gt; Thanks (for your patience with a\n&gt;&gt; newbie), \t&gt; Steve\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt; \n&gt; \n&gt; \n&gt; \n&gt; ------------------------------------\n&gt; \n&gt; Yahoo! Groups Links\n&gt; \n&gt; \n&gt; \n\n"}}