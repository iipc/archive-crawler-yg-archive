{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":225011788,"authorName":"Karl Wright","from":"Karl Wright &lt;kwright@...&gt;","profile":"daddywri","replyTo":"LIST","senderId":"bg9SmpJT3AYDyrkU3UlEbIF6ScGFwDjvDbLa-ULfPbSUjrbND9AS-5QooMaowO8tlkD58iEQSzQ1Q1inY5our71jBXQy3SxV1Ew","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Re: Contribution: Ability to specify webapp context and whether the UI is directly accessible off-box via heritrix.properties","postDate":"1150998696","msgId":2964,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDQ0OUFEOEE4LjEwNjA1MDVAbWV0YWNhcnRhLmNvbT4=","inReplyToHeader":"PDQ0OUFENTYwLjkwNjAwMDJAYXJjaGl2ZS5vcmc+","referencesHeader":"PDQ0OUFBRTNELjYwMDAyMDJAbWV0YWNhcnRhLmNvbT4gPDQ0OUFENTYwLjkwNjAwMDJAYXJjaGl2ZS5vcmc+"},"prevInTopic":0,"nextInTopic":2966,"prevInTime":2963,"nextInTime":2965,"topicId":2964,"numMessagesInTopic":4,"msgSnippet":"... Ah, ok. ... Looks fine as far as I can tell. ... The only issue for the other changes we ve made is that it s hard to peel out just one at a time.  I trust","rawEmail":"Return-Path: &lt;kwright@...&gt;\r\nX-Sender: kwright@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 21543 invoked from network); 22 Jun 2006 17:51:00 -0000\r\nReceived: from unknown (66.218.66.216)\n  by m22.grp.scd.yahoo.com with QMQP; 22 Jun 2006 17:51:00 -0000\r\nReceived: from unknown (HELO silene.metacarta.com) (65.77.47.18)\n  by mta1.grp.scd.yahoo.com with SMTP; 22 Jun 2006 17:51:00 -0000\r\nReceived: from localhost (silene.metacarta.com [65.77.47.18])\n\tby silene.metacarta.com (Postfix) with ESMTP id A50519F72F;\n\tThu, 22 Jun 2006 13:50:07 -0400 (EDT)\r\nReceived: from silene.metacarta.com ([65.77.47.18])\n\tby localhost (silene.metacarta.com [65.77.47.18]) (amavisd-new, port 10024)\n\twith ESMTP id 26444-01; Thu, 22 Jun 2006 13:50:07 -0400 (EDT)\r\nX-Auth-Received: from [65.77.47.197] (dhcp-65-77-47-197.metacarta.com [65.77.47.197])\n\t(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))\n\t(No client certificate requested)\n\tby silene.metacarta.com (Postfix) with ESMTP id 066B49F702;\n\tThu, 22 Jun 2006 13:50:07 -0400 (EDT)\r\nMessage-ID: &lt;449AD8A8.1060505@...&gt;\r\nDate: Thu, 22 Jun 2006 13:51:36 -0400\r\nUser-Agent: Mozilla Thunderbird 1.0.2 (Windows/20050317)\r\nX-Accept-Language: en-us, en\r\nMIME-Version: 1.0\r\nTo: Michael Stack &lt;stack@...&gt;\r\nCc: archive-crawler@yahoogroups.com\r\nReferences: &lt;449AAE3D.6000202@...&gt; &lt;449AD560.9060002@...&gt;\r\nIn-Reply-To: &lt;449AD560.9060002@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-Virus-Scanned: by amavisd-new-20030616-p10 (Debian) at metacarta.com\r\nX-eGroups-Msg-Info: 1:0:0:0\r\nFrom: Karl Wright &lt;kwright@...&gt;\r\nSubject: Re: Contribution: Ability to specify webapp context and whether the\n UI is directly accessible off-box via heritrix.properties\r\nX-Yahoo-Group-Post: member; u=225011788; y=gcRSWGqm3ObqrKaGk8I9uxoN_AzcKO1Z2L02jDojvrbgCmw\r\nX-Yahoo-Profile: daddywri\r\n\r\nMichael Stack wrote:\n&gt; Karl Wright wrote:\n&gt; \n&gt;&gt; Hi Michael,\n&gt;&gt;\n&gt;&gt; This diff (based on Heritrix 1.8) allows you to hook up the Heritrix \n&gt;&gt; UI using Apache for security.\n&gt; \n&gt; \n&gt; Good stuff.  Thanks for the contrib.  I committed with some changes \n&gt; (Removed tabs, made lines 80 characters wide, changed names of system \n&gt; properties removing the &#39;cmdline&#39; from middle so its \n&gt; heritrix.localhostonly now.  FYI: The &#39;cmdline&#39; is for system properties \n&gt; that duplicate actual command-line options: i.e. the system property \n&gt; that does what the -nowui command  line option does).\n&gt; \n\nAh, ok.\n\n&gt; Here is the issue: \n&gt; http://sourceforge.net/tracker/index.php?func=detail&aid=1510807&group_id=73833&atid=539102.  \n&gt; Confirm I haven&#39;t broken anything.\n\nLooks fine as far as I can tell.\n\n&gt; \n&gt;&gt;\n&gt;&gt; If you would like, I can also resubmit the other modifications we made \n&gt;&gt; here that were previously submitted that did not get into 1.8, as \n&gt;&gt; diffs based on 1.8.\n&gt; \n&gt; \n&gt; Yes please.  Best to make the patch from $HERITRIX_HOME rather than from \n&gt; beside the java class -- e.g. $HERITRIX_HOME/src/java/org/archive/crawler.\n&gt; \n&gt; No tabs.\n&gt; \n&gt; 80 lines if you can.\n&gt; \n&gt; Bit of doc. too if applicable and perhaps suggested commit message.\n&gt; \n&gt; Otherwise, thanks for the help.\n&gt; \n\nThe only issue for the other changes we&#39;ve made is that it&#39;s hard to \npeel out just one at a time.  I trust you don&#39;t want 3-4 features all \nsubmitted in one go?\n\n\n&gt; Oh, lets have this back and forth up on the list.  I would like it if \n&gt; others saw that its possible to get stuff into Heritrix -- and so you \n&gt; get seen as contributor.\n\nDone.\nKarl\n\n&gt; \n&gt; Thanks K,\n&gt; St.Ack\n&gt; \n&gt;&gt;\n&gt;&gt; Thanks,\n&gt;&gt; Karl\n&gt;&gt; ------------------------------------------------------------------------\n&gt;&gt;\n&gt;&gt; Index: Heritrix.java\n&gt;&gt; ===================================================================\n&gt;&gt; --- Heritrix.java    (revision 43165)\n&gt;&gt; +++ Heritrix.java    (working copy)\n&gt;&gt; @@ -242,6 +242,11 @@\n&gt;&gt;      private static final String JAR_SUFFIX = &quot;.jar&quot;;\n&gt;&gt;           private AlertManager alertManager;\n&gt;&gt; +\n&gt;&gt; +    /**\n&gt;&gt; +     * The context of the GUI webapp.  Default is root.\n&gt;&gt; +     */\n&gt;&gt; +    private static String adminContext = ROOT_CONTEXT;\n&gt;&gt;           /**\n&gt;&gt;       * True if we&#39;re to put up a GUI.\n&gt;&gt; @@ -255,7 +260,13 @@\n&gt;&gt;       * Cmdline processing can override.\n&gt;&gt;       */\n&gt;&gt;      private static int guiPort = SimpleHttpServer.DEFAULT_PORT;\n&gt;&gt; -    +\n&gt;&gt; +    /**\n&gt;&gt; +     * True if the gui should listen only to connections from localhost\n&gt;&gt; +     * (which will be the case if proxying through Apache)\n&gt;&gt; +     */\n&gt;&gt; +    private static boolean localhostOnly = false;\n&gt;&gt; +\n&gt;&gt;      // OpenMBean support.\n&gt;&gt;      /**\n&gt;&gt;       * The MBean server we&#39;re registered with (May be null).\n&gt;&gt; @@ -531,7 +542,15 @@\n&gt;&gt;      protected static String doCmdLineArgs(final String [] args)\n&gt;&gt;      throws Exception {\n&gt;&gt;          // Get defaults for commandline arguments from the properties \n&gt;&gt; file.\n&gt;&gt; -        String tmpStr =\n&gt;&gt; +        String tmpStr;\n&gt;&gt; +    tmpStr = \n&gt;&gt; PropertyUtils.getPropertyOrNull(&quot;heritrix.cmdline.context&quot;);\n&gt;&gt; +    if (tmpStr != null)\n&gt;&gt; +        Heritrix.adminContext = tmpStr;\n&gt;&gt; +    tmpStr = \n&gt;&gt; PropertyUtils.getPropertyOrNull(&quot;heritrix.cmdline.localhostonly&quot;);\n&gt;&gt; +    if (tmpStr != null)\n&gt;&gt; +        Heritrix.localhostOnly = \n&gt;&gt; PropertyUtils.getBooleanProperty(&quot;heritrix.cmdline.localhostonly&quot;);\n&gt;&gt; +\n&gt;&gt; +    tmpStr =\n&gt;&gt;              PropertyUtils.getPropertyOrNull(&quot;heritrix.cmdline.port&quot;);\n&gt;&gt;          if (tmpStr != null) {\n&gt;&gt;              Heritrix.guiPort = Integer.parseInt(tmpStr);\n&gt;&gt; @@ -647,7 +666,7 @@\n&gt;&gt;              status = h.doOneCrawl(crawlOrderFile);\n&gt;&gt;          } else {\n&gt;&gt;              status =\n&gt;&gt; -                startEmbeddedWebserver(Heritrix.guiPort, \n&gt;&gt; adminLoginPassword);\n&gt;&gt; +                startEmbeddedWebserver(Heritrix.guiPort, \n&gt;&gt; Heritrix.localhostOnly, adminLoginPassword);\n&gt;&gt;              Heritrix h = new Heritrix(true);\n&gt;&gt;                           String tmp = h.launch(crawlOrderFile, runMode);\n&gt;&gt; @@ -916,7 +935,7 @@\n&gt;&gt;          throws Exception {\n&gt;&gt;          // Put up the webserver w/ the root and selftest webapps only.\n&gt;&gt;          final String SELFTEST = &quot;selftest&quot;;\n&gt;&gt; -        Heritrix.httpServer = new SimpleHttpServer(SELFTEST, \n&gt;&gt; ROOT_CONTEXT,\n&gt;&gt; +        Heritrix.httpServer = new SimpleHttpServer(false, SELFTEST, \n&gt;&gt; ROOT_CONTEXT,\n&gt;&gt;              port, true);\n&gt;&gt;          // Set up digest auth for a section of the server so selftest \n&gt;&gt; can run\n&gt;&gt;          // auth tests.  Looks like can only set one login realm going \n&gt;&gt; by the\n&gt;&gt; @@ -1063,14 +1082,14 @@\n&gt;&gt;       * @return Status on webserver startup.\n&gt;&gt;       */\n&gt;&gt;      protected static String startEmbeddedWebserver(final int port,\n&gt;&gt; -        final String adminLoginPassword)\n&gt;&gt; +        final boolean localhostOnly, final String adminLoginPassword)\n&gt;&gt;      throws Exception {\n&gt;&gt;          String adminUN =\n&gt;&gt;              adminLoginPassword.substring(0, \n&gt;&gt; adminLoginPassword.indexOf(&quot;:&quot;));\n&gt;&gt;          String adminPW =\n&gt;&gt;              \n&gt;&gt; adminLoginPassword.substring(adminLoginPassword.indexOf(&quot;:&quot;) + 1);\n&gt;&gt;          Heritrix.httpServer =\n&gt;&gt; -            new SimpleHttpServer(&quot;admin&quot;, ROOT_CONTEXT, port, false);\n&gt;&gt; +            new SimpleHttpServer(localhostOnly, &quot;admin&quot;, \n&gt;&gt; adminContext, port, false);\n&gt;&gt;                   final String DOTWAR = &quot;.war&quot;;\n&gt;&gt;          final String ADMIN = &quot;admin&quot;;\n&gt;&gt; @@ -1095,7 +1114,7 @@\n&gt;&gt;          // Name of passed &#39;realm&#39; must match what is in configured in \n&gt;&gt; web.xml.\n&gt;&gt;          // We&#39;ll use ROLE for &#39;realm&#39; and &#39;role&#39;.\n&gt;&gt;          final String ROLE = ADMIN;\n&gt;&gt; -        Heritrix.httpServer.setAuthentication(ROLE, ROOT_CONTEXT, \n&gt;&gt; adminUN,\n&gt;&gt; +        Heritrix.httpServer.setAuthentication(ROLE, adminContext, \n&gt;&gt; adminUN,\n&gt;&gt;              adminPW, ROLE);\n&gt;&gt;          Heritrix.httpServer.startServer();\n&gt;&gt;          InetAddress addr = InetAddress.getLocalHost();\n&gt;&gt; Index: SimpleHttpServer.java\n&gt;&gt; ===================================================================\n&gt;&gt; --- SimpleHttpServer.java    (revision 43165)\n&gt;&gt; +++ SimpleHttpServer.java    (working copy)\n&gt;&gt; @@ -100,10 +100,10 @@\n&gt;&gt;       * @param expandWebapps True if we&#39;re to expand the webapp passed.\n&gt;&gt;       * @throws Exception\n&gt;&gt;       */\n&gt;&gt; -    public SimpleHttpServer(String name, String context, int port,\n&gt;&gt; +    public SimpleHttpServer(boolean localhostOnly, String name, \n&gt;&gt; String context, int port,\n&gt;&gt;          boolean expandWebapps)\n&gt;&gt;      throws Exception {\n&gt;&gt; -        initialize(port);\n&gt;&gt; +        initialize(port,localhostOnly);\n&gt;&gt;          addWebapp(name, context, expandWebapps);\n&gt;&gt;          this.server.setRequestLog(getServerLogging());\n&gt;&gt;      }\n&gt;&gt; @@ -116,7 +116,7 @@\n&gt;&gt;       */\n&gt;&gt;      public SimpleHttpServer(List webapps, int port, boolean \n&gt;&gt; expandWebapps)\n&gt;&gt;      throws Exception {\n&gt;&gt; -        initialize(port);\n&gt;&gt; +        initialize(port,false);\n&gt;&gt;                   // Add each of the webapps in turn. If we&#39;re passed \n&gt;&gt; the root webapp,\n&gt;&gt;          // give it special handling -- assume its meant to be server \n&gt;&gt; root and\n&gt;&gt; @@ -167,11 +167,28 @@\n&gt;&gt;       * Called from constructors.\n&gt;&gt;       * @param port Port to start the server on.\n&gt;&gt;       */\n&gt;&gt; -    protected void initialize(int port) {\n&gt;&gt; +    protected void initialize(int port, boolean localhostOnly) {\n&gt;&gt;          this.server = new Server();\n&gt;&gt;          this.port = port;\n&gt;&gt; -        SocketListener listener = new SocketListener();\n&gt;&gt; -        listener.setPort(port);\n&gt;&gt; +    SocketListener listener;\n&gt;&gt; +    if (localhostOnly)\n&gt;&gt; +    {\n&gt;&gt; +        try\n&gt;&gt; +        {\n&gt;&gt; +            org.mortbay.util.InetAddrPort localInetAddr = new \n&gt;&gt; org.mortbay.util.InetAddrPort(java.net.InetAddress.getLocalHost(),port);\n&gt;&gt; +                listener = new SocketListener(localInetAddr);\n&gt;&gt; +        }\n&gt;&gt; +        catch (java.net.UnknownHostException e)\n&gt;&gt; +        {\n&gt;&gt; +            listener = new SocketListener();\n&gt;&gt; +            listener.setPort(port);\n&gt;&gt; +        }\n&gt;&gt; +    }\n&gt;&gt; +    else\n&gt;&gt; +    {\n&gt;&gt; +        listener = new SocketListener();\n&gt;&gt; +            listener.setPort(port);\n&gt;&gt; +    }\n&gt;&gt;          this.server.addListener(listener);\n&gt;&gt;      }\n&gt;&gt;        \n&gt; \n&gt; \n&gt; \n\n\n"}}