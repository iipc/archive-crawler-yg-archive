{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr","from":"Gordon Mohr &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"hC0qZgNE1JF3JcwsZcqiX41YxUyGePFpTVeNigIjArd6thTQyf5JbwtW88W6PhGdWJjCBn0l3o_jdzwN7mOv_-ybiKb8UYg","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Re: [archive-crawler] Too many open files Exception","postDate":"1293083880","msgId":6939,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDREMTJFNEU4LjUwMTA5MDhAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PDREMTI4NzdELjUwMzA4MDhAZ21haWwuY29tPg==","referencesHeader":"PEFBTkxrVGk9ZjYwK3QwNDZuelZna3gzcGhodThHcUo1ZjZ3MTlfRDVBa3FSQUBtYWlsLmdtYWlsLmNvbT4gPDREMTI4NzdELjUwMzA4MDhAZ21haWwuY29tPg=="},"prevInTopic":6938,"nextInTopic":6940,"prevInTime":6938,"nextInTime":6940,"topicId":6936,"numMessagesInTopic":5,"msgSnippet":"Based on prior exchanges with Adam, I think his problem is other than hitting the low-default 1024 open-files limit, which I believe he s already raised.","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 19509 invoked from network); 23 Dec 2010 05:58:03 -0000\r\nX-Received: from unknown (66.196.94.105)\n  by m17.grp.re1.yahoo.com with QMQP; 23 Dec 2010 05:58:03 -0000\r\nX-Received: from unknown (HELO relay02.pair.com) (209.68.5.16)\n  by mta1.grp.re1.yahoo.com with SMTP; 23 Dec 2010 05:58:03 -0000\r\nX-Received: (qmail 62519 invoked by uid 0); 23 Dec 2010 05:58:01 -0000\r\nX-Received: from 67.188.34.83 (HELO silverbook.local) (67.188.34.83)\n  by relay02.pair.com with SMTP; 23 Dec 2010 05:58:01 -0000\r\nX-pair-Authenticated: 67.188.34.83\r\nMessage-ID: &lt;4D12E4E8.5010908@...&gt;\r\nDate: Wed, 22 Dec 2010 21:58:00 -0800\r\nUser-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.2.13) Gecko/20101207 Thunderbird/3.1.7\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nCc: Kenji Nagahashi &lt;knagahashi@...&gt;\r\nReferences: &lt;AANLkTi=f60+t046nzVgkx3phhu8GqJ5f6w19_D5AkqRA@...&gt; &lt;4D12877D.5030808@...&gt;\r\nIn-Reply-To: &lt;4D12877D.5030808@...&gt;\r\nContent-Type: text/plain; charset=UTF-8; format=flowed\r\nContent-Transfer-Encoding: 8bit\r\nFrom: Gordon Mohr &lt;gojomo@...&gt;\r\nSubject: Re: [archive-crawler] Too many open files Exception\r\nX-Yahoo-Group-Post: member; u=137285340; y=vMjrsf0_xLdy7Rs3CrBP6GhrJTj2LwG7ZZ4d_w0KIsyu\r\nX-Yahoo-Profile: gojomo\r\n\r\nBased on prior exchanges with Adam, I think his problem is other than \nhitting the low-default 1024 open-files limit, which I believe he&#39;s \nalready raised. (Notably, my understanding is that his crawl ran for \nweeks with 300 threads before encountering problems -- though perhaps, \nsomething has reverted the limit.) I&#39;ve asked him separately for more \ninformation that might narrow down the cause.\n\nAnyone doing non-trivial crawling should increase their open-files limit \nbefore launching Heritrix, as noted in the older H1-based FAQ...\n\nhttp://crawler.archive.org/faq.html#toomanyopenfiles\n\nYou&#39;ll find similar advice for many other IO-intensive packages -- for \nexample the Lucene, HBase, Hypertable, and other FAQs have similar entries.\n\nWe should probably add a more prominent warning in the various H1/H3 \ngetting started docs, and (if practical) even do a sanity-check on \nlaunch that warns people who haven&#39;t already raised this limit.\n\nHistorically, most crawling machines at IA have had this limit raised to \n32768, though it can harmlessly be much larger as well. Kenji, I&#39;m not \nsure why your machines would have still had the impractically-small \ndefault limit.\n\n- Gordon @ IA\n\nOn 12/22/10 3:19 PM, Kenji Nagahashi wrote:\n&gt; Hi Adam,\n&gt;\n&gt; Coincidentally, I&#39;ve been investigating the same &quot;too many open files&quot;\n&gt; error in our crawl projects. Based on what I&#39;ve found so far, it appears\n&gt; Heritrix hit per-process maximum of open file descriptors (1024 in our\n&gt; case). Following is what I learned from monitoring 5 hour test crawl\n&gt; (Heritrix 3) - probably the something similar must be happening in your\n&gt; crawl project, too.\n&gt;\n&gt; Heritrix 3 has ~80 always-open file descriptors for JARs, log files,\n&gt; ARC/WARCs, BDB and listening sockets.\n&gt;\n&gt; Each active crawling thread can open up to 3 file descriptors at one\n&gt; time for fetching and recording HTTP request/response. Our crawler is\n&gt; configured with max 200 threads, so there can be up to 600 open file\n&gt; descriptors at one time, but usually much less than that (max 318 in our\n&gt; case).\n&gt;\n&gt; In addition to total 400 open fds above, there are other 4 kinds of file\n&gt; descriptors, which reached 400 in total during the test. Now it is\n&gt; pretty close to per-process limit of 1024.\n&gt;\n&gt; One of &quot;additional&quot; open descriptors is UDP socket for DNS query. I saw\n&gt; max 75 sockets open at one time. If DNS server gets overloaded and slows\n&gt; down, there could be more.\n&gt;\n&gt; Also as crawl job proceed, BDB gets bigger and BDB seems to keep more\n&gt; database files open.\n&gt;\n&gt; Summing up, with following factors combined, Heritrix could run out of\n&gt; file descriptors and start failing severely:\n&gt;\n&gt; - many threads\n&gt; - shallow crawl on many web sites (such crawl can go very fast, too)\n&gt; - long-running crawl\n&gt; - slow DNS queries\n&gt;\n&gt; Probably crawling with less threads is the easiest (but not so reliable)\n&gt; way to prevent this problem, but Heritrix could do a kind of throttling\n&gt; by limiting the number of concurrent DNS queries.\n&gt;\n&gt; Kenji @ Internet Archive\n&gt;\n&gt; (12/22/10 4:17 AM), Adam Broke≈° wrote:\n&gt;&gt; [Attachment(s)&lt;#TopText&gt;  from =?UTF-8?B?QWRhbSBCcm9rZcWh?= included below]\n&gt;&gt;\n&gt;&gt; Hallo folks,\n&gt;&gt;\n&gt;&gt; I am working on domain crawl and I have encounter few strange\n&gt;&gt; problems. First of all, the crawl has some rapid slowdown (ten times\n&gt;&gt; slower). This was caused by managing (or comparing) cookies. Well, we\n&gt;&gt; have decided that disabling cookies for bulk crawl is not big issue.\n&gt;&gt; After few days, when 4 TB was harvested, heritrix threw too many open\n&gt;&gt; files exception. I tried to recover, but all my attempts failed. I\n&gt;&gt; restarted heritrix, build new job based on the old one. Lower the\n&gt;&gt; toethreads to 250 and started. This order xml is quite the same as I\n&gt;&gt; used last year for crawling 9.5 TB. After two and half days with 1TB\n&gt;&gt; crawled heritrix suddenly stop with exception threw on all threads. I\n&gt;&gt; have attached the exception in the bottom. The limit on the open files\n&gt;&gt; in the system is set to more than one million. Frankly, I am not sure\n&gt;&gt; how to track down this problem. Especially when this setting was\n&gt;&gt; working last year (probably on 1.14.3).\n&gt;&gt;\n&gt;&gt; Thank you very much.\n&gt;&gt;\n&gt;&gt; Best regards.\n&gt;&gt;\n&gt;&gt; Brokes\n&gt;&gt;\n&gt;&gt; HW&  SW config\n&gt;&gt;\n&gt;&gt; 3485312 KB max heap\n&gt;&gt; 32bit java6 update22\n&gt;&gt; heritrix 1.14.4\n&gt;&gt; 4 core Intel(R) Xeon(R) CPU E5420 @ 2.50GHz\n&gt;&gt; 8 GiB RAM\n&gt;&gt; 64bit Debian 5.0.6\n&gt;&gt;\n&gt;&gt; Exception\n&gt;&gt;\n&gt;&gt; Fatal exception in ToeThread #181: (in thread &#39;ToeThread #181: &#39;)\n&gt;&gt; Exception:\n&gt;&gt; com.sleepycat.util.RuntimeExceptionWrapper: (JE 3.3.82) fetchTarget of\n&gt;&gt; 0x32/0x1ed6a7 parent IN=1266390 IN class=com.sleepycat.je.tree.BIN\n&gt;&gt; lastFullVersion=0x8b2/0x56a066 parent.getDirty()=false state=0\n&gt;&gt; com.sleepycat.je.log.LogFileNotFoundException: (JE 3.3.82)\n&gt;&gt; 0x32/0x1ed6a7 (JE 3.3.82) Couldn&#39;t open file\n&gt;&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb:\n&gt;&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb (Too many open files)\n&gt;&gt; Cause: com.sleepycat.je.DatabaseException: (JE 3.3.82) fetchTarget of\n&gt;&gt; 0x32/0x1ed6a7 parent IN=1266390 IN class=com.sleepycat.je.tree.BIN\n&gt;&gt; lastFullVersion=0x8b2/0x56a066 parent.getDirty()=false state=0\n&gt;&gt; com.sleepycat.je.log.LogFileNotFoundException: (JE 3.3.82)\n&gt;&gt; 0x32/0x1ed6a7 (JE 3.3.82) Couldn&#39;t open file\n&gt;&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb:\n&gt;&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb (Too many open files)\n&gt;&gt; at com.sleepycat.je.tree.IN.fetchTarget(IN.java:1230)\n&gt;&gt; at com.sleepycat.je.dbi.CursorImpl.searchAndPosition(CursorImpl.java:2103)\n&gt;&gt; at com.sleepycat.je.Cursor.searchInternal(Cursor.java:1778)\n&gt;&gt; at com.sleepycat.je.Cursor.searchAllowPhantoms(Cursor.java:1748)\n&gt;&gt; at com.sleepycat.je.Cursor.search(Cursor.java:1615)\n&gt;&gt; at com.sleepycat.je.Cursor.getSearchKey(Cursor.java:1067)\n&gt;&gt; at\n&gt;&gt; com.sleepycat.util.keyrange.RangeCursor.doGetSearchKey(RangeCursor.java:965)\n&gt;&gt; at\n&gt;&gt; com.sleepycat.util.keyrange.RangeCursor.getSearchKey(RangeCursor.java:592)\n&gt;&gt; at com.sleepycat.collections.DataCursor.doGetSearchKey(DataCursor.java:577)\n&gt;&gt; at com.sleepycat.collections.DataCursor.getSearchKey(DataCursor.java:559)\n&gt;&gt; at\n&gt;&gt; com.sleepycat.collections.StoredContainer.getValue(StoredContainer.java:299)\n&gt;&gt; at com.sleepycat.collections.StoredMap.get(StoredMap.java:227)\n&gt;&gt; at\n&gt;&gt; org.archive.util.ObjectIdentityBdbCache.getOrUse(ObjectIdentityBdbCache.java:264)\n&gt;&gt; at\n&gt;&gt; org.archive.util.ObjectIdentityBdbCache.get(ObjectIdentityBdbCache.java:217)\n&gt;&gt; at\n&gt;&gt; org.archive.util.ObjectIdentityBdbCache.get(ObjectIdentityBdbCache.java:75)\n&gt;&gt; at\n&gt;&gt; org.archive.crawler.frontier.WorkQueueFrontier.activateInactiveQueue(WorkQueueFrontier.java:732)\n&gt;&gt; at\n&gt;&gt; org.archive.crawler.frontier.WorkQueueFrontier.next(WorkQueueFrontier.java:634)\n&gt;&gt; at org.archive.crawler.framework.ToeThread.run(ToeThread.java:147)\n&gt;&gt;\n&gt;&gt; Stacktrace: com.sleepycat.util.RuntimeExceptionWrapper: (JE 3.3.82)\n&gt;&gt; fetchTarget of 0x32/0x1ed6a7 parent IN=1266390 IN\n&gt;&gt; class=com.sleepycat.je.tree.BIN lastFullVersion=0x8b2/0x56a066\n&gt;&gt; parent.getDirty()=false state=0\n&gt;&gt; com.sleepycat.je.log.LogFileNotFoundException: (JE 3.3.82)\n&gt;&gt; 0x32/0x1ed6a7 (JE 3.3.82) Couldn&#39;t open file\n&gt;&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb:\n&gt;&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb (Too many open files)\n&gt;&gt; at\n&gt;&gt; com.sleepycat.collections.StoredContainer.convertException(StoredContainer.java:466)\n&gt;&gt; at\n&gt;&gt; com.sleepycat.collections.StoredContainer.getValue(StoredContainer.java:306)\n&gt;&gt; at com.sleepycat.collections.StoredMap.get(StoredMap.java:227)\n&gt;&gt; at\n&gt;&gt; org.archive.util.ObjectIdentityBdbCache.getOrUse(ObjectIdentityBdbCache.java:264)\n&gt;&gt; at\n&gt;&gt; org.archive.util.ObjectIdentityBdbCache.get(ObjectIdentityBdbCache.java:217)\n&gt;&gt; at\n&gt;&gt; org.archive.util.ObjectIdentityBdbCache.get(ObjectIdentityBdbCache.java:75)\n&gt;&gt; at\n&gt;&gt; org.archive.crawler.frontier.WorkQueueFrontier.activateInactiveQueue(WorkQueueFrontier.java:732)\n&gt;&gt; at\n&gt;&gt; org.archive.crawler.frontier.WorkQueueFrontier.next(WorkQueueFrontier.java:634)\n&gt;&gt; at org.archive.crawler.framework.ToeThread.run(ToeThread.java:147)\n&gt;&gt; Caused by: com.sleepycat.je.DatabaseException: (JE 3.3.82) fetchTarget\n&gt;&gt; of 0x32/0x1ed6a7 parent IN=1266390 IN class=com.sleepycat.je.tree.BIN\n&gt;&gt; lastFullVersion=0x8b2/0x56a066 parent.getDirty()=false state=0\n&gt;&gt; com.sleepycat.je.log.LogFileNotFoundException: (JE 3.3.82)\n&gt;&gt; 0x32/0x1ed6a7 (JE 3.3.82) Couldn&#39;t open file\n&gt;&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb:\n&gt;&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb (Too many open files)\n&gt;&gt; at com.sleepycat.je.tree.IN.fetchTarget(IN.java:1230)\n&gt;&gt; at com.sleepycat.je.dbi.CursorImpl.searchAndPosition(CursorImpl.java:2103)\n&gt;&gt; at com.sleepycat.je.Cursor.searchInternal(Cursor.java:1778)\n&gt;&gt; at com.sleepycat.je.Cursor.searchAllowPhantoms(Cursor.java:1748)\n&gt;&gt; at com.sleepycat.je.Cursor.search(Cursor.java:1615)\n&gt;&gt; at com.sleepycat.je.Cursor.getSearchKey(Cursor.java:1067)\n&gt;&gt; at\n&gt;&gt; com.sleepycat.util.keyrange.RangeCursor.doGetSearchKey(RangeCursor.java:965)\n&gt;&gt; at\n&gt;&gt; com.sleepycat.util.keyrange.RangeCursor.getSearchKey(RangeCursor.java:592)\n&gt;&gt; at com.sleepycat.collections.DataCursor.doGetSearchKey(DataCursor.java:577)\n&gt;&gt; at com.sleepycat.collections.DataCursor.getSearchKey(DataCursor.java:559)\n&gt;&gt; at\n&gt;&gt; com.sleepycat.collections.StoredContainer.getValue(StoredContainer.java:299)\n&gt;&gt; ... 7 more\n&gt;&gt; --\n&gt;&gt; Adam Broke≈°\n&gt;&gt; http://www.brokes.net\n&gt;&gt; adam.brokes@...&lt;mailto:adam.brokes%40gmail.com&gt;\n&gt;&gt; 42799740\n&gt;&gt;\n&gt;&gt;\n&gt;\n&gt;\n&gt;\n&gt; ------------------------------------\n&gt;\n&gt; Yahoo! Groups Links\n&gt;\n&gt;\n&gt;\n\n"}}