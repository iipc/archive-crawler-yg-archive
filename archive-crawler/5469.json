{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":280593181,"authorName":"Erik Hetzner","from":"Erik Hetzner &lt;erik.hetzner@...&gt;","profile":"e_hetzner","replyTo":"LIST","senderId":"DYd_BR9wc1OGWG_zQplbHqrFhmqs5OckQULPelKoZfpyG4a6N87QXhoI0BbDUb_TosgXY6waFCZ0rc_BH7pKzayqMwNwr60WguKj","spamInfo":{"isSpam":false,"reason":"12"},"subject":"Re: [archive-crawler] Lowering stack size (-Xss)?","postDate":"1221169856","msgId":5469,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PFAtSVJDLUVYQkUwMXE2RHFhSlkwMDAwMTdjMkBFWC5VQ09QLkVEVT4=","inReplyToHeader":"PDQ4Qzk3NUFELjcwNDA1MDhAYXJjaGl2ZS5vcmc+","referencesHeader":"PFAtSVJDLUVYQkUwMUF3MTlEQnEwMDAwMTY4OUBFWC5VQ09QLkVEVT4JPDQ4Qzk3NUFELjcwNDA1MDhAYXJjaGl2ZS5vcmc+"},"prevInTopic":5468,"nextInTopic":5470,"prevInTime":5468,"nextInTime":5470,"topicId":5467,"numMessagesInTopic":5,"msgSnippet":"At Thu, 11 Sep 2008 12:46:53 -0700, ... Sure. This is with: java version 1.6.0_06 Java(TM) SE Runtime Environment (build 1.6.0_06-b02) Java HotSpot(TM)","rawEmail":"Return-Path: &lt;Erik.Hetzner@...&gt;\r\nX-Sender: Erik.Hetzner@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 12723 invoked from network); 11 Sep 2008 21:50:47 -0000\r\nX-Received: from unknown (66.218.67.97)\n  by m48.grp.scd.yahoo.com with QMQP; 11 Sep 2008 21:50:47 -0000\r\nX-Received: from unknown (HELO MAILGATE.UCOP.EDU) (128.48.123.92)\n  by mta18.grp.scd.yahoo.com with SMTP; 11 Sep 2008 21:50:46 -0000\r\nX-WSS-ID: 0K71WOQ-01-SLS-01\r\nX-Received: from EX.UCOP.EDU (p-irc-exbe01.ucop.edu [128.48.122.86])\n\tby MAILGATE.UCOP.EDU (Tumbleweed MailGate 3.6.0) with ESMTP id 2456CB2119F;\n\tThu, 11 Sep 2008 14:50:49 -0700 (PDT)\r\nX-Received: from gales.cdlib.org ([128.48.204.228]) by EX.UCOP.EDU with Microsoft SMTPSVC(6.0.3790.3959);\n\t Thu, 11 Sep 2008 14:50:44 -0700\r\nDate: Thu, 11 Sep 2008 14:50:56 -0700\r\nTo: archive-crawler@yahoogroups.com\r\nCc: Gordon Mohr &lt;gojomo@...&gt;\r\nIn-Reply-To: &lt;48C975AD.7040508@...&gt;\r\nReferences: &lt;P-IRC-EXBE01Aw19DBq00001689@...&gt;\n\t&lt;48C975AD.7040508@...&gt;\r\nUser-Agent: Wanderlust/2.15.5 (Almost Unreal) SEMI/1.14.6 (Maruoka)\n FLIM/1.14.9 (=?ISO-8859-4?Q?Goj=F2?=) APEL/10.7 Emacs/22.1\n (i486-pc-linux-gnu) MULE/5.0 (SAKAKI)\r\nMIME-Version: 1.0 (generated by SEMI 1.14.6 - &quot;Maruoka&quot;)\r\nContent-Type: multipart/signed;\n boundary=&quot;pgp-sign-Multipart_Thu_Sep_11_14:50:55_2008-1&quot;; micalg=pgp-sha1;\n protocol=&quot;application/pgp-signature&quot;\r\nContent-Transfer-Encoding: 7bit\r\nReturn-Path: erik.hetzner@...\r\nMessage-ID: &lt;P-IRC-EXBE01q6DqaJY000017c2@...&gt;\r\nX-OriginalArrivalTime: 11 Sep 2008 21:50:44.0665 (UTC) FILETIME=[7142CA90:01C91458]\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: Erik Hetzner &lt;erik.hetzner@...&gt;\r\nSubject: Re: [archive-crawler] Lowering stack size (-Xss)?\r\nX-Yahoo-Group-Post: member; u=280593181; y=5HY1oxsn374XLrA-2ec2R9cSxVtLEUOdVKJLeSiSonDPzaV4\r\nX-Yahoo-Profile: e_hetzner\r\n\r\n\r\n--pgp-sign-Multipart_Thu_Sep_11_14:50:55_2008-1\r\nContent-Type: multipart/mixed;\n boundary=&quot;Multipart_Thu_Sep_11_14:50:55_2008-1&quot;\r\n\r\n\r\n--Multipart_Thu_Sep_11_14:50:55_2008-1\r\nContent-Type: text/plain; charset=UTF-8\r\nContent-Transfer-Encoding: quoted-printable\r\n\r\nAt Thu, 11 Sep 2008 12:46:53 -0700,\nGordon Mohr wrote:\n&gt; \n&gt; Thoughts:\n&gt; \n&gt; =\r\nWhat out-of-memory error do you get, exactly? (Can you trigger the same \n&gt; =\r\nerror under Java 1.6, which sometimes gives more informative OOME/error \n&gt; =\r\nmessages?)\n\nSure. This is with:\n\njava version &quot;1.6.0_06&quot;\nJava(TM) SE Runtim=\r\ne Environment (build 1.6.0_06-b02)\nJava HotSpot(TM) Server VM (build 10.0-b=\r\n22, mixed mode)\n\nException in thread &quot;StartNextJob&quot; java.lang.OutOfMemoryEr=\r\nror: unable to create new native thread\n        at java.lang.Thread.start0(=\r\nNative Method)\n        at java.lang.Thread.start(Thread.java:597)\n        a=\r\nt com.sleepycat.je.utilint.DaemonThread.runOrPause(DaemonThread.java:73)\n  =\r\n      at com.sleepycat.je.cleaner.Cleaner.runOrPause(Cleaner.java:307)\n    =\r\n    at com.sleepycat.je.dbi.EnvironmentImpl.runOrPauseDaemons(EnvironmentIm=\r\npl.java:475)\n        at com.sleepycat.je.dbi.EnvironmentImpl.envConfigUpdat=\r\ne(EnvironmentImpl.java:420)\n        at com.sleepycat.je.dbi.EnvironmentImpl=\r\n.&lt;init&gt;(EnvironmentImpl.java:387)\n        at com.sleepycat.je.dbi.DbEnvPool=\r\n.getEnvironment(DbEnvPool.java:102)\n        at com.sleepycat.je.dbi.DbEnvPo=\r\nol.getEnvironment(DbEnvPool.java:54)\n        at com.sleepycat.je.Environmen=\r\nt.&lt;init&gt;(Environment.java:103)\n        at org.archive.util.bdbje.EnhancedEn=\r\nvironment.&lt;init&gt;(EnhancedEnvironment.java:53)\n        at org.archive.crawle=\r\nr.framework.CrawlController.setupBdb(CrawlController.java:485)\n        at o=\r\nrg.archive.crawler.framework.CrawlController.initialize(CrawlController.jav=\r\na:372)\n        at org.archive.crawler.admin.CrawlJob.setupForCrawlStart(Cra=\r\nwlJob.java:848)\n        at org.archive.crawler.admin.CrawlJobHandler.startN=\r\nextJobInternal(CrawlJobHandler.java:1142)\n        at org.archive.crawler.ad=\r\nmin.CrawlJobHandler$3.run(CrawlJobHandler.java:1125)\n        at java.lang.T=\r\nhread.run(Thread.java:619)\n\nI presume that it is just coincidence that it h=\r\nappens to be bdbje\nmaxing out the threads here and not the toethreads.\n \n&gt; =\r\nSince the stack space is used per thread, by configuring your crawls\n&gt; to u=\r\nse fewer ToeThreads, you may also be able to expand the number\n&gt; of simulta=\r\nneous crawlers in a JVM. (Heritrix currently launches the\n&gt; configured numb=\r\ner of threads, and keeps them idle, even if unneeded.\n&gt; This behavior could=\r\n be changed if the cost of idle threads was\n&gt; deemed high, but it would not=\r\n be a simple low-risk change. More\n&gt; radically, the number of threads could=\r\n be set per JVM, and any\n&gt; number of crawls could share the same pool of wo=\r\nrker threads, if\n&gt; this threads/stacksize was commonly the critical deploym=\r\nent\n&gt; bottleneck.)\n\nI=E2=80=99d forgotten that I could configure ToeThreads=\r\n. I have been using\nmax-toe-threads=3D50 which is probably overkill since w=\r\ne are crawling\nsingle sites here. Having set to 5, I have now got at least =\r\n102\ncrawlers in one JVM. This instance has only ~1000 threads in it, as\ncom=\r\npared with another instance with max-toe-threads=3D50 running 20\ncrawls whi=\r\nch has ~1100 threads.\n \n&gt; Because stack space comes from non-heap memory, t=\r\nhis may be a case where \n&gt; making your heap space smaller paradoxically all=\r\nows you to launch more \n&gt; crawlers/threads, given a specific -Xss setting, =\r\nwithout hitting an error.\n\nThanks for this. I think that I have noticed a d=\r\nifference between\nrunning with -Xmx3000m vs. -Xmx2048m.\n\n&gt; The risk of usin=\r\ng smaller stack size settings would be hitting\n&gt; StackOveflowErrors in craw=\r\nler code. In my experience, the deepest\n&gt; recursion that happens in Heritri=\r\nx is in the regular-expression\n&gt; link-extraction, against certain worst-cas=\r\ne input. We&#39;ve added a\n&gt; number of guards against this risk -- capping matc=\r\nh sizes and adding\n&gt; explicit catch-and-recover code against StackOverflowE=\r\nrror in\n&gt; Extractors -- but I still suspect that&#39;s the most likely first pl=\r\nace\n&gt; to hit problems with smaller -Xss values.\n\nThanks! This is good to lo=\r\nok out for. The test site that I use the\ncrawlers on is not going to exerci=\r\nse this, unfortunately.\n\nBut if I am not mistaken, even a stack overflow th=\r\nat kills a thread\nwill not endanger the crawl or the JVM, right?\n\nIt seems,=\r\n though, that reducing max-toe-threads has improved things so\nmuch I might =\r\nbe able to get away with not modifying -Xss. We will\nprobably run out of he=\r\nap before we run out of threads. In the past I\nhave used a rule of thumb of=\r\n about .1G / crawler. Using this, I will\nneed 10G for a 100 crawler JVM, wh=\r\nich will be getting to the limits of\nwhat I want to run on one machine. (Of=\r\n course this necessitates 64bit\nJVM; see below.)\n\n&gt; Does 64bit Solaris have=\r\n the option of running 32bit JVMs in a \n&gt; compatibility mode? While this wo=\r\nuld limit the heap size any one JVM \n&gt; could use, the same objects take sig=\r\nnificantly less space in a 32bit JVM \n&gt; compred to a 64bit JVM. (I&#39;ve heard=\r\n an estimate that a heap with the \n&gt; same objects in it can be around 40% l=\r\narger in a 64bit JVM than a 32bit \n&gt; JVM. I suspect the same inflation is p=\r\nresent in stack sizes.) So, you \n&gt; might effectively get more crawlers by r=\r\nunning 4-to-8 32bit JVMs than 1 \n&gt; 64bit JVM.\n\nIn fact this is a 32-bit JVM=\r\n; I should have specified that. I will\nhave install the 64-bit JVM & run so=\r\nme experiments with that as well,\nsince I think that we will need a heap gr=\r\neater than 10G to squeeze out\nthe crawlers that we want.\n\n&gt; Hope this helps=\r\n,\n\nVery much! Thanks for everything, Gordon. I will let the list know\nwhat =\r\nwe can squeeze out of Heritrix.\n\nbest,\nErik\n\r\n--Multipart_Thu_Sep_11_14:50:55_2008-1\r\nContent-Type: text/plain; charset=US-ASCII\r\n\r\n;; Erik Hetzner, California Digital Library\n;; gnupg key id: 1024D/01DB07E3\n\r\n--Multipart_Thu_Sep_11_14:50:55_2008-1--\r\n\n\r\n--pgp-sign-Multipart_Thu_Sep_11_14:50:55_2008-1\r\nContent-Type: application/pgp-signature\r\n\r\n[ Attachment content not displayed ]\r\n--pgp-sign-Multipart_Thu_Sep_11_14:50:55_2008-1--\r\n\n"}}