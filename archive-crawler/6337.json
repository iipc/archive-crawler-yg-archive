{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":430631168,"authorName":"t.schoellhorn","from":"&quot;t.schoellhorn&quot; &lt;t.schoellhorn@...&gt;","profile":"t.schoellhorn","replyTo":"LIST","senderId":"X0l5BKhrskE6wAz7fMYEiPxL-_GrrMaX9h4qs1XRBR4KszAGgh3xV2cwXg47zO92vH0BSMqSGnqXy7e53J1GfJYSNO_pQ5m0ShXuuniVc9U","spamInfo":{"isSpam":false,"reason":"6"},"subject":"Re: Usage of QuotaEnforcer in H3","postDate":"1264669850","msgId":6337,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PGhqcmthcSs3b2JrQGVHcm91cHMuY29tPg==","inReplyToHeader":"PDRCNjBFREE2LjcwMjAxMDVAYXJjaGl2ZS5vcmc+"},"prevInTopic":6336,"nextInTopic":0,"prevInTime":6336,"nextInTime":6338,"topicId":6335,"numMessagesInTopic":3,"msgSnippet":"Dear Gordon, thanks for your reply. I could have figured out that myself when looking at my crawls. But obviously it is not at all trivial and it helps a lot","rawEmail":"Return-Path: &lt;t.schoellhorn@...&gt;\r\nX-Sender: t.schoellhorn@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 97500 invoked from network); 28 Jan 2010 09:16:16 -0000\r\nX-Received: from unknown (98.137.34.46)\n  by m12.grp.re1.yahoo.com with QMQP; 28 Jan 2010 09:16:16 -0000\r\nX-Received: from unknown (HELO n43d.bullet.mail.sp1.yahoo.com) (66.163.169.157)\n  by mta3.grp.sp2.yahoo.com with SMTP; 28 Jan 2010 09:16:16 -0000\r\nX-Received: from [69.147.65.151] by n43.bullet.mail.sp1.yahoo.com with NNFMP; 28 Jan 2010 09:10:50 -0000\r\nX-Received: from [98.137.34.184] by t5.bullet.mail.sp1.yahoo.com with NNFMP; 28 Jan 2010 09:10:50 -0000\r\nDate: Thu, 28 Jan 2010 09:10:50 -0000\r\nTo: archive-crawler@yahoogroups.com\r\nMessage-ID: &lt;hjrkaq+7obk@...&gt;\r\nIn-Reply-To: &lt;4B60EDA6.7020105@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=&quot;ISO-8859-1&quot;\r\nContent-Transfer-Encoding: quoted-printable\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-compose\r\nX-eGroups-Msg-Info: 1:6:0:0:0\r\nFrom: &quot;t.schoellhorn&quot; &lt;t.schoellhorn@...&gt;\r\nSubject: Re: Usage of QuotaEnforcer in H3\r\nX-Yahoo-Group-Post: member; u=430631168; y=xkvjbTemQJ9vIyfh45Y03UeYeghmJ-l1GQw74OO7UCZxXqEoacveJw\r\nX-Yahoo-Profile: t.schoellhorn\r\n\r\nDear Gordon,\n\nthanks for your reply. I could have figured out that myself w=\r\nhen looking at my crawls. But obviously it is not at all trivial and it hel=\r\nps a lot to get a better understanding of the general design ideas of Herit=\r\nrix.\n\nThanks again.\n\nCheers,\nTino\n\n--- In archive-crawler@yahoogroups.com, =\r\nGordon Mohr &lt;gojomo@...&gt; wrote:\n&gt;\n&gt; The QuotaEnforcer examines the URI pass=\r\ned to the processor, and checks \n&gt; to see if the host/server/group(aka queu=\r\ne) tallies associated with it \n&gt; are over the configued quotas.\n&gt; \n&gt; If ove=\r\nr a quota, the QuotaEnforcer...\n&gt; - gives the URI a S_BLOCKED_BY_QUOTA (-50=\r\n03) status-code\n&gt; - returns a ProcessResult.FINISH status from the Processo=\r\nr, causing all \n&gt; subsequent processors in the same &#39;chain&#39; to be skipped\n&gt;=\r\n - (if configured) adds a notation to the URI signalling the frontier to \n&gt;=\r\n &#39;retire&#39; the associated queue -- moving out of the rotation where it \n&gt; pr=\r\novides more eligible-to-crawl URIs\n&gt; \n&gt; In H1, it would go into the process=\r\ning chain *before* an attempt to \n&gt; fetch the URI -- because its design goa=\r\nl is to cancel all processing of \n&gt; URIs from categories that are over-quot=\r\na. In H3, that would mean early \n&gt; in the &#39;fetch&#39; chain.\n&gt; \n&gt; It should sti=\r\nll work there as before, with the only inefficiency being \n&gt; that URIs are =\r\nenqueued even if they are destined to be ruled as over-quota.\n&gt; \n&gt; The cand=\r\nidates chain is only run on discovered outlink URIs, after their \n&gt; discove=\r\nry, before they are enqueued into the frontier. That is, \n&gt; &#39;candidates&#39; fo=\r\nr enqueuing (that might not be). I&#39;ve just tested \n&gt; QuotaEnforcer position=\r\ned there, as in your example, and it still works \n&gt; -- though perhaps not a=\r\ns straightforwardly.\n&gt; \n&gt; It&#39;s checking a not-yet-enqueued URI against the =\r\ntotal successes so far. \n&gt; If over-quota, that URI is assigned the negative=\r\n status, which *prevents \n&gt; it from being enqueued at all*. This has severa=\r\nl implications:\n&gt; \n&gt; (1) there will be no crawl.log-line for that URI -- it=\r\n never passed \n&gt; candidate status, was never enqueued, and so never gets a =\r\n\n&gt; success/failure try (and log line) of its own.\n&gt; \n&gt; (2) since the URI is=\r\n never passed to the frontier for enqueuing the \n&gt; &#39;forceRetire&#39; request to=\r\n the frontier has no effect.\n&gt; \n&gt; (3) a batch of candidate URIs all evaluat=\r\ned before the host-successes \n&gt; goes over quota will all be enqueued (and l=\r\nater tried) -- even if the \n&gt; host goes over-quota before they are all trie=\r\nd.\n&gt; \n&gt; I suspect this last point is what you&#39;ve seen that makes you think =\r\nit&#39;s \n&gt; not working -- whereas it is working, but only at enqueue-time, so =\r\nthe \n&gt; totals are approximate rather than exact. You could move the QE to e=\r\narly \n&gt; in the fetch chain (or put a second instance there) for precise con=\r\ntrol.\n&gt; \n&gt; One last note: I recommend following the example of our bundled =\r\n\n&gt; configurations, and always declaring Processor beans as top-level, named=\r\n \n&gt; beans -- then placing them into the chains by reference. The Spring \n&gt; =\r\n&#39;Lifecycle&#39; callbacks are most cleanly and reliably handled for \n&gt; top-leve=\r\nl named beans. (We try to pass those callbacks along to \n&gt; Processors in th=\r\ne chain&#39;s lifecycle methods, but that may be more \n&gt; fragile for some compo=\r\nnents and features, like checkpointing, so I think \n&gt; &#39;all processors as to=\r\np-level beans&#39; is a good rule-of-thumb.)\n&gt; \n&gt; - Gordon @ IA\n&gt; \n&gt; \n&gt; t.schoe=\r\nllhorn wrote:\n&gt; &gt; Hi,\n&gt; &gt; \n&gt; &gt; currently I am struggling with the usage of =\r\nthe QuotaEnforcer. As I understand, the QE can be used to restrict the down=\r\nload of to many documents per host/server.\n&gt; &gt; \n&gt; &gt; Currently I am placing =\r\nthe QuotaEnforcer as a bean in the candidateProcessor. But nonetheless the =\r\nrestrictions don&#39;t seem to get applied. Currently I am using something like=\r\n this:\n&gt; &gt; \n&gt; &gt; &lt;bean id=3D&quot;candidateProcessors&quot; class=3D&quot;org.archive.modul=\r\nes.CandidateChain&quot;&gt;\n&gt; &gt;   &lt;property name=3D&quot;processors&quot;&gt;\n&gt; &gt;    &lt;list&gt;\n&gt; &gt; =\r\n    &lt;!-- apply scoping rules to each individual candidate URI... --&gt;\n&gt; &gt;   =\r\n  &lt;ref bean=3D&quot;candidateScoper&quot;/&gt;\n&gt; &gt;     &lt;!-- ...then prepare those ACCEPT=\r\ned for enqueuing to frontier. --&gt;\n&gt; &gt;     &lt;ref bean=3D&quot;preparer&quot;/&gt;\n&gt; &gt; \n&gt; &gt;=\r\n     &lt;bean class=3D&quot;org.archive.crawler.prefetch.QuotaEnforcer&quot;&gt;\n&gt; &gt;       =\r\n&lt;property name=3D&quot;hostMaxFetchSuccesses&quot; value=3D&quot;10&quot;/&gt;\n&gt; &gt;     &lt;/bean&gt;\n&gt; &gt;=\r\n    &lt;/list&gt;\n&gt; &gt;   &lt;/property&gt;\n&gt; &gt;  &lt;/bean&gt;\n&gt; &gt; \n&gt; &gt; \n&gt; &gt; Are there any exam=\r\nples or any suggestion where I should place that enforcer?\n&gt; &gt; \n&gt; &gt; Cheers,=\r\n\n&gt; &gt; Tino\n&gt; &gt; \n&gt; &gt; \n&gt; &gt; \n&gt; &gt; \n&gt; &gt; \n&gt; &gt; ------------------------------------=\r\n\n&gt; &gt; \n&gt; &gt; Yahoo! Groups Links\n&gt; &gt; \n&gt; &gt; \n&gt; &gt;\n&gt;\n\n\n\n"}}