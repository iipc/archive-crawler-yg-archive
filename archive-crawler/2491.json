{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr (archive.org)","from":"&quot;Gordon Mohr (archive.org)&quot; &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"D6EjoZdHzP2hoCHDFA06vBi6lMQWRwZ5R_vbqORf9lSPYba3kTgr52LJB-pz3BXmyqSbliMZeOhn_IWXpTSUKtL6R5HrOqe7rfx67sg08JFEXFrv4fVu","spamInfo":{"isSpam":false,"reason":"12"},"subject":"Re: [archive-crawler] Re: How to deal with runaway thread?","postDate":"1136336748","msgId":2491,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDQzQkIxRjZDLjEwNzA0MDVAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PGRwZjRucisxaGszQGVHcm91cHMuY29tPg==","referencesHeader":"PGRwZjRucisxaGszQGVHcm91cHMuY29tPg=="},"prevInTopic":2489,"nextInTopic":2508,"prevInTime":2490,"nextInTime":2492,"topicId":2485,"numMessagesInTopic":7,"msgSnippet":"... If it was busy in regex extraction, rather than a network fetch, there s probably a reproduceable problem with our regex expressions, where they perform","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 87149 invoked from network); 4 Jan 2006 01:06:58 -0000\r\nReceived: from unknown (66.218.66.172)\n  by m27.grp.scd.yahoo.com with QMQP; 4 Jan 2006 01:06:58 -0000\r\nReceived: from unknown (HELO ia00524.archive.org) (207.241.224.171)\n  by mta4.grp.scd.yahoo.com with SMTP; 4 Jan 2006 01:06:58 -0000\r\nReceived: (qmail 12146 invoked by uid 100); 4 Jan 2006 01:00:55 -0000\r\nReceived: from adsl-71-130-102-78.dsl.pltn13.pacbell.net (HELO ?192.168.1.10?) (gojomo@...@71.130.102.78)\n  by mail-dev.archive.org with SMTP; 4 Jan 2006 01:00:55 -0000\r\nMessage-ID: &lt;43BB1F6C.1070405@...&gt;\r\nDate: Tue, 03 Jan 2006 17:05:48 -0800\r\nUser-Agent: Mozilla Thunderbird 1.0.7-1.1.fc3 (X11/20050929)\r\nX-Accept-Language: en-us, en\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;dpf4nr+1hk3@...&gt;\r\nIn-Reply-To: &lt;dpf4nr+1hk3@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-Spam-DCC: : \r\nX-Spam-Checker-Version: SpamAssassin 2.63 (2004-01-11) on ia00524.archive.org\r\nX-Spam-Level: \r\nX-Spam-Status: No, hits=-80.9 required=7.0 tests=AWL,USER_IN_WHITELIST \n\tautolearn=no version=2.63\r\nX-eGroups-Msg-Info: 2:12:4:0\r\nFrom: &quot;Gordon Mohr (archive.org)&quot; &lt;gojomo@...&gt;\r\nSubject: Re: [archive-crawler] Re: How to deal with runaway thread?\r\nX-Yahoo-Group-Post: member; u=137285340; y=xP8bIiuH8CwWQRSM0C2zDRTDemBmpDK6Lt3iRtOiFsT7\r\nX-Yahoo-Profile: gojomo\r\n\r\njoehung302 wrote:\n&gt; I finally logged in to the web console and looked at the thread \n&gt; report. It looks like the thread is stuck at one regular expression \n&gt; call (java.uitl.regex) and I did use the &quot;kill thread&quot; functionality \n&gt; (and it worked!).\n\nIf it was busy in regex extraction, rather than a network fetch,\nthere&#39;s probably a reproduceable problem with our regex expressions,\nwhere they perform inefficiently against challenging input.\n\nDid you make note of the URI(s) affected, or can you find them again?\nFeel free to send them to me directly if you&#39;d like.\n\nWe&#39;d like to tighten our extraction regexes to avoid any such problems,\nas we&#39;ve had to do a number of times in the past. In addition to\nholding the thread, these kinds of problems also tend to monopolize the\nCPU, noticeably slowing the whole crawler.\n\nThe &#39;kill thread&#39; option may leave things in an inconsistent state,\nand so should be avoided if possible.\n\n- Gordon @ IA\n\n\n&gt; I was able to checkpoint after that. I guess what I&#39;d do is, add a \n&gt; check in the script so that if I cannot pause a crawl job within an \n&gt; hour, I&#39;ll send out an email and *manually* get rid of the hung \n&gt; thread.\n&gt; \n&gt; Cheers,\n&gt; -joe\n&gt; \n&gt; --- In archive-crawler@yahoogroups.com, Vishwesh Thakur \n&gt; &lt;vishwesh@g...&gt; wrote:\n&gt; \n&gt;&gt;Hello Joe/Community,\n&gt;&gt; I believe you can make use of the JMX call exposed by Heritrix\n&gt;&gt;&quot;interrupt(String threadName&quot;) to kill a runaway thread.\n&gt;&gt;The call effectively makes a call Thread.interrput(). Looking at \n&gt; \n&gt; the code it\n&gt; \n&gt;&gt;appears that this call should do the job.\n&gt;&gt; However I&#39;ve been into a situation where I was unable to kill a \n&gt; \n&gt; thread in\n&gt; \n&gt;&gt;the way I&#39;ve mentioned.\n&gt;&gt;\n&gt;&gt; Did you investigate why you thread was busy for more than an hour?\n&gt;&gt;Threaddump and the ToeThread Report taken together should give you \n&gt; \n&gt; a good\n&gt; \n&gt;&gt;picture of the problem.\n&gt;&gt;\n&gt;&gt; I&#39;d want to report a problem that I came across. I was using Sun \n&gt; \n&gt; jdk\n&gt; \n&gt;&gt;1.5.0_04 and was running around 50 toe threads. Slowly the threads \n&gt; \n&gt; were\n&gt; \n&gt;&gt;getting hung up for the lock on &quot;snoozedClassQueues&quot; member \n&gt; \n&gt; variable of\n&gt; \n&gt;&gt;WorkQueueFrontier class.\n&gt;&gt;\n&gt;&gt; Upon investigation I found that the case is not of a deadlock or \n&gt; \n&gt; or one\n&gt; \n&gt;&gt;thread having aquired it and not giving up the same. To my \n&gt; \n&gt; surprise few\n&gt; \n&gt;&gt;other ToeThreads were able to aquire the lock \n&gt; \n&gt; of &quot;snoozedClassQueues&quot; and\n&gt; \n&gt;&gt;were able to come out repeatedly whereas around 35-40 ToeThreads \n&gt; \n&gt; were hung\n&gt; \n&gt;&gt;waiting for the lock for more than half an hour. I stopped the \n&gt; \n&gt; crawl and\n&gt; \n&gt;&gt;restarted the crawl again. This time the same issue cropped up but \n&gt; \n&gt; for the\n&gt; \n&gt;&gt;lock on some other object (I don&#39;t remember now). It led me to \n&gt; \n&gt; conclude that\n&gt; \n&gt;&gt;the lock allocation of the particular jdk I was using is bad.\n&gt;&gt;\n&gt;&gt; I updagraded my jdk to next build (Build 5) and never saw the \n&gt; \n&gt; problem\n&gt; \n&gt;&gt;again.\n&gt;&gt;\n&gt;&gt;Regards\n&gt;&gt;Thakur\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;On 1/1/06, joehung302 &lt;joe.hung@c...&gt; wrote:\n&gt;&gt;\n&gt;&gt;&gt; While I was testing my &quot;checkpointing&quot; script\n&gt;&gt;&gt;(pause-&gt;checkpoint-&gt;resume thru JMX client), I encounter a \n&gt; \n&gt; problem\n&gt; \n&gt;&gt;&gt;where one thread just won&#39;t quit...the crawler keep saying\n&gt;&gt;&gt;\n&gt;&gt;&gt;&quot;Status: Pausing - Waiting for threads to finish&quot;\n&gt;&gt;&gt;(ThreadCount is 1)\n&gt;&gt;&gt;\n&gt;&gt;&gt;for more than an hour. I finally had to &quot;resume&quot; the crawl (and \n&gt; \n&gt; give\n&gt; \n&gt;&gt;&gt;up on checkpointing) because I need to go on.\n&gt;&gt;&gt;\n&gt;&gt;&gt;Will I encounter the problem again if I restart the crawl from \n&gt; \n&gt; the\n&gt; \n&gt;&gt;&gt;last checkpoint? In general how do people address this issue?\n&gt;&gt;&gt;\n&gt;&gt;&gt;Cheers,\n&gt;&gt;&gt;-joe\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt; ------------------------------\n&gt;&gt;&gt;YAHOO! GROUPS LINKS\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;   -  Visit your group &quot;archive-\n&gt; \n&gt; crawler&lt;http://groups.yahoo.com/group/archive-crawler&gt;&quot;\n&gt; \n&gt;&gt;&gt;   on the web.\n&gt;&gt;&gt;\n&gt;&gt;&gt;   -  To unsubscribe from this group, send an email to:\n&gt;&gt;&gt;    archive-crawler-unsubscribe@yahoogroups.com&lt;archive-crawler-\n&gt; \n&gt; unsubscribe@yahoogroups.com?subject=Unsubscribe&gt;\n&gt; \n&gt;&gt;&gt;   -  Your use of Yahoo! Groups is subject to the Yahoo! Terms of\n&gt;&gt;&gt;   Service &lt;http://docs.yahoo.com/info/terms/&gt;.\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt; ------------------------------\n&gt;&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;--\n&gt;&gt;Thakur Vishwesh Singh\n&gt;&gt;\n&gt; \n&gt; \n&gt; \n&gt; \n&gt; \n&gt; \n&gt; \n&gt;  \n&gt; Yahoo! Groups Links\n&gt; \n&gt; \n&gt; \n&gt;  \n&gt; \n&gt; \n\n\n"}}