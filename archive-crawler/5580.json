{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":362973207,"authorName":"Juergen Umbrich","from":"Juergen Umbrich &lt;juergen@...&gt;","replyTo":"LIST","senderId":"kwYtHf8SJkQBjiWVZcyfHqNqlJc-st-OjsmnI9aSehnAH5eTENHZn-p9nkp019BbDrztgXJM7RuxMxdqJAcRP_hEV7rGin1GO4OfBg","spamInfo":{"isSpam":false,"reason":"12"},"subject":"Re: [archive-crawler] TooManyOpenFiles with 1M seed and 300 ToeThreads","postDate":"1227015356","msgId":5580,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDQ5MjJDNEJDLjgwMTA0MDRAdW1icmljaC5uZXQ+","inReplyToHeader":"PDQ5MjIwMERFLjgwMzAwMDNAYXJjaGl2ZS5vcmc+","referencesHeader":"PDQ5MUIxRDIwLjQwNzAzMDBAdW1icmljaC5uZXQ+IDw0OTIyMDBERS44MDMwMDAzQGFyY2hpdmUub3JnPg=="},"prevInTopic":5578,"nextInTopic":0,"prevInTime":5579,"nextInTime":5581,"topicId":5572,"numMessagesInTopic":5,"msgSnippet":"Hi all, ... Yes, that is correct. All tests were performed on the same server with the same version of heritrix. ... The only difference in the heritrix setup","rawEmail":"Return-Path: &lt;juergen@...&gt;\r\nX-Sender: juergen@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 91964 invoked from network); 18 Nov 2008 13:37:47 -0000\r\nX-Received: from unknown (66.218.67.94)\n  by m56.grp.scd.yahoo.com with QMQP; 18 Nov 2008 13:37:47 -0000\r\nX-Received: from unknown (HELO mx1.nuigalway.ie) (140.203.201.100)\n  by mta15.grp.scd.yahoo.com with SMTP; 18 Nov 2008 13:37:47 -0000\r\nX-IronPort-Anti-Spam-Filtered: true\r\nX-IronPort-Anti-Spam-Result: ApoEAGxTIkkKhJ0L/2dsb2JhbADSMIJ5\r\nX-IronPort-AV: E=Sophos;i=&quot;4.33,625,1220223600&quot;; \n   d=&quot;scan&#39;208&quot;;a=&quot;270010660&quot;\r\nX-Received: from exbe1.ac.nuigalway.ie (HELO EVS1.ac.nuigalway.ie) ([10.132.157.11])\n  by mx1.nuigalway.ie with ESMTP; 18 Nov 2008 13:37:46 +0000\r\nX-Received: from EVS1.ac.nuigalway.ie ([10.132.157.14]) by EVS1.ac.nuigalway.ie with Microsoft SMTPSVC(6.0.3790.3959);\n\t Tue, 18 Nov 2008 13:37:46 +0000\r\nX-Received: from [10.2.17.73] ([140.203.154.12]) by EVS1.ac.nuigalway.ie over TLS secured channel with Microsoft SMTPSVC(6.0.3790.3959);\n\t Tue, 18 Nov 2008 13:37:45 +0000\r\nMessage-ID: &lt;4922C4BC.8010404@...&gt;\r\nDate: Tue, 18 Nov 2008 13:35:56 +0000\r\nUser-Agent: Mozilla-Thunderbird 2.0.0.17 (X11/20081018)\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;491B1D20.4070300@...&gt; &lt;492200DE.8030003@...&gt;\r\nIn-Reply-To: &lt;492200DE.8030003@...&gt;\r\nContent-Type: text/plain; charset=UTF-8; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nReturn-Path: juergen@...\r\nX-OriginalArrivalTime: 18 Nov 2008 13:37:45.0943 (UTC) FILETIME=[D70EFE70:01C94982]\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: Juergen Umbrich &lt;juergen@...&gt;\r\nSubject: Re: [archive-crawler] TooManyOpenFiles with 1M seed and 300 ToeThreads\r\nX-Yahoo-Group-Post: member; u=362973207\r\n\r\nHi all,\n&gt; You previous message reported running several successful crawls that \n&gt; collected ~10M pages a day, starting from 1M seed URLs.\n&gt;   \nYes, that is correct. All tests were performed on the same server with \nthe same version of heritrix.\n&gt; What is different about the machine or crawl configuration on this crawl \n&gt; that dies after only 458 crawl.log entries, compared to the prior \n&gt; successes? (Might there be some other runaway use of file handles on the \n&gt; same machine?)\n&gt;\n&gt;   \nThe only difference in the heritrix setup was that we increased the \nnumber of threads to 300 compared to the 200 threads in the previous \ntest crawls. We copied the job and just increased the numbers of threads.\nAnd, as far as I know, the server was not used from other applications \nduring the crawl.\nWe were also surprised that the same crawl on the same machine was \nsuccessful with 200 threads but run into the TMOFException with 300 \nthreads, without obvious reason, like OS background processes or other \napplication running in parallel.\n\nWe will further investigate this and especially monitor the of file \nhandlers of other applications.\nPerhaps, just a simple question:\nIs there a rule of thumb to set a reasonable ulimit value for heritrix \n2.0.2 depending on the number of threads and processor.\n(similar to the FAQ entry)?\n\nThanks in advance and I ll send the report of our next tests.\n\nbest juergen\n\n&gt; - Gordon @ IA\n&gt;\n&gt; Juergen Umbrich wrote:\n&gt;   \n&gt;&gt; Hi all,\n&gt;&gt;\n&gt;&gt; we had a TMOF-Excetpion while we tried to run a crawl with 300 \n&gt;&gt; ToeThreads, 1M seed URIs, and a\n&gt;&gt; #ulimit -l = 32768. (global sheet attached)\n&gt;&gt; The execption happens just at the beginning, when the URIs from the seed \n&gt;&gt; list were parsed and loaded and the crawler started.\n&gt;&gt; The crawl.log contains 458 entries, with 380 dns - lookups.\n&gt;&gt; All the other log files are empty.\n&gt;&gt;\n&gt;&gt; I think with a ulimit of 32768 this should not happen! Or am I wrong?\n&gt;&gt;\n&gt;&gt; Best juergen\n&gt;&gt;\n&gt;&gt;\n&gt;&gt; alerts.log:\n&gt;&gt; ------------------------------------------------------------------------------------------------------------------------\n&gt;&gt;\n&gt;&gt;  org.archive.modules.fetcher.FetchDNS storeDNSRecord\n&gt;&gt; SEVERE: Failed store of DNS Record for dns:breakers.typepad.com (in \n&gt;&gt; thread &#39;ToeThread #88: dns:breakers.typepad.com&#39;; in processor &#39;DNS&#39;)\n&gt;&gt; java.io.FileNotFoundException: \n&gt;&gt; /home/heritrix/heritrix-2.0.1/jobs/active-BenchmarkCrawl-20081026023802/scratch/tt88http.ris \n&gt;&gt; (Too many open files)\n&gt;&gt;     at java.io.FileOutputStream.open(Native Method)\n&gt;&gt;     at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:179)\n&gt;&gt;     at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:70)\n&gt;&gt;     at \n&gt;&gt; org.archive.io.RecordingOutputStream.open(RecordingOutputStream.java:207)\n&gt;&gt;     at \n&gt;&gt; org.archive.io.RecordingOutputStream.open(RecordingOutputStream.java:173)\n&gt;&gt;     at \n&gt;&gt; org.archive.io.RecordingInputStream.open(RecordingInputStream.java:92)\n&gt;&gt;     at org.archive.util.Recorder.inputWrap(Recorder.java:150)\n&gt;&gt;     at org.archive.modules.fetcher.FetchDNS.recordDNS(FetchDNS.java:270)\n&gt;&gt;     at \n&gt;&gt; org.archive.modules.fetcher.FetchDNS.storeDNSRecord(FetchDNS.java:215)\n&gt;&gt;     at org.archive.modules.fetcher.FetchDNS.innerProcess(FetchDNS.java:170)\n&gt;&gt;     at org.archive.modules.Processor.innerProcessResult(Processor.java:157)\n&gt;&gt;     at org.archive.modules.Processor.process(Processor.java:123)\n&gt;&gt;     at \n&gt;&gt; org.archive.crawler.framework.ToeThread.processCrawlUri(ToeThread.java:310)\n&gt;&gt;     at org.archive.crawler.framework.ToeThread.run(ToeThread.java:157)\n&gt;&gt; 26-Oct-2008 04:00:49 org.archive.modules.fetcher.FetchDNS storeDNSRecord\n&gt;&gt; SEVERE: Failed store of DNS Record for dns:depts.drew.edu (in thread \n&gt;&gt; &#39;ToeThread #88: dns:depts.drew.edu&#39;; in processor &#39;DNS&#39;)\n&gt;&gt; java.io.IOException: RIS already open for ToeThread #88: dns:depts.drew.edu\n&gt;&gt;     at \n&gt;&gt; org.archive.io.RecordingInputStream.open(RecordingInputStream.java:88)\n&gt;&gt;     at org.archive.util.Recorder.inputWrap(Recorder.java:150)\n&gt;&gt;     at org.archive.modules.fetcher.FetchDNS.recordDNS(FetchDNS.java:270)\n&gt;&gt;     at \n&gt;&gt; org.archive.modules.fetcher.FetchDNS.storeDNSRecord(FetchDNS.java:215)\n&gt;&gt;     at org.archive.modules.fetcher.FetchDNS.innerProcess(FetchDNS.java:170)\n&gt;&gt;     at org.archive.modules.Processor.innerProcessResult(Processor.java:157)\n&gt;&gt;     at org.archive.modules.Processor.process(Processor.java:123)\n&gt;&gt;     at \n&gt;&gt; org.archive.crawler.framework.ToeThread.processCrawlUri(ToeThread.java:310)\n&gt;&gt;     at org.archive.crawler.framework.ToeThread.run(ToeThread.java:157)\n&gt;&gt;     \n&gt;\n&gt;   \n\n"}}