{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":325624130,"authorName":"Noah Levitt","from":"Noah Levitt &lt;nlevitt@...&gt;","profile":"nlevitt0","replyTo":"LIST","senderId":"3uEmNcAAuM1Ik3a52T-ik9VFQP2U1p9AzaEwRhcYxEyKEOi7dxjiftXUeEW-OvwKREXYsNj2OYVyJPFa6bnHsWwr37ggNSRq","spamInfo":{"isSpam":false,"reason":"12"},"subject":"Re: [archive-crawler] Support for encoding","postDate":"1212651591","msgId":5286,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDQ4NDc5ODQ3LjgwMTA5MDRAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PDQ4NDc4QjE1LjYwMzAxMDFAYXJjaGl2ZS5vcmc+","referencesHeader":"PGQ2MWM1NzMwMDgwNjAyMTEyN2wyMDMxOWRiZmsxNGNmNjhhMmI5Y2Q4ZDIyQG1haWwuZ21haWwuY29tPgkgPDQ4NDQ2N0Y1LjkwMjAwQGFyY2hpdmUub3JnPiA8ZDYxYzU3MzAwODA2MDQwNDM1aDNiYThmMTljcWVlNmQ4NmU1MGU2NjY3NWRAbWFpbC5nbWFpbC5jb20+IDw0ODQ3OEIxNS42MDMwMTAxQGFyY2hpdmUub3JnPg=="},"prevInTopic":5285,"nextInTopic":5288,"prevInTime":5285,"nextInTime":5287,"topicId":5266,"numMessagesInTopic":9,"msgSnippet":"(commented on the jira issue) I don t think the problem here is the mask (which looks like 8 bits to me). What s happening with, for example, the euro","rawEmail":"Return-Path: &lt;nlevitt@...&gt;\r\nX-Sender: nlevitt@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 63851 invoked from network); 5 Jun 2008 07:39:36 -0000\r\nX-Received: from unknown (66.218.67.96)\n  by m46.grp.scd.yahoo.com with QMQP; 5 Jun 2008 07:39:36 -0000\r\nX-Received: from unknown (HELO mail.archive.org) (207.241.231.239)\n  by mta17.grp.scd.yahoo.com with SMTP; 5 Jun 2008 07:39:36 -0000\r\nX-Received: from localhost (localhost [127.0.0.1])\n\tby mail.archive.org (Postfix) with ESMTP id 235BB19B0E0\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Thu,  5 Jun 2008 00:35:40 -0700 (PDT)\r\nX-Received: from mail.archive.org ([127.0.0.1])\n\tby localhost (mail.archive.org [127.0.0.1]) (amavisd-new, port 10024)\n\twith LMTP id gm-EqjOtKFRE for &lt;archive-crawler@yahoogroups.com&gt;;\n\tThu,  5 Jun 2008 00:35:39 -0700 (PDT)\r\nX-Received: from noah-levitts-computer.local (adsl-67-119-15-92.dsl.snfc21.pacbell.net [67.119.15.92])\n\tby mail.archive.org (Postfix) with ESMTPSA id 18E6812DE31\n\tfor &lt;archive-crawler@yahoogroups.com&gt;; Thu,  5 Jun 2008 00:35:39 -0700 (PDT)\r\nMessage-ID: &lt;48479847.8010904@...&gt;\r\nDate: Thu, 05 Jun 2008 00:39:51 -0700\r\nUser-Agent: Thunderbird 2.0.0.14 (Macintosh/20080421)\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;d61c57300806021127l20319dbfk14cf68a2b9cd8d22@...&gt;\t &lt;484467F5.90200@...&gt; &lt;d61c57300806040435h3ba8f19cqee6d86e50e66675d@...&gt; &lt;48478B15.6030101@...&gt;\r\nIn-Reply-To: &lt;48478B15.6030101@...&gt;\r\nContent-Type: text/plain; charset=UTF-8; format=flowed\r\nContent-Transfer-Encoding: 8bit\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: Noah Levitt &lt;nlevitt@...&gt;\r\nSubject: Re: [archive-crawler] Support for encoding\r\nX-Yahoo-Group-Post: member; u=325624130; y=PpuodPIJKLYJpPwojVF2pJXhS-q6Jef2SzDs1oV2Rk9i4uY\r\nX-Yahoo-Profile: nlevitt0\r\n\r\n(commented on the jira issue) I don&#39;t think the problem here is the mask \n(which looks like 8 bits to me). What&#39;s happening with, for example, the \neuro character (€) on a windows-1252 encoded page (0x80) is that when \nyou cast it to char it takes the numeric value as a unicode codepoint. \n0x80 is a control character in unicode. The correct conversion would be \nto 0x20ac, which can be obtained with new String(byte[] {0x80}, \n&quot;windows-1252&quot;), or maybe more efficiently with a CharsetDecoder.\n\nNoah\n\nGordon Mohr wrote:\n&gt; Jean-Noël Rivasseau wrote:\n&gt;   \n&gt;&gt; Hello.\n&gt;&gt;\n&gt;&gt; My problem was that I had a page that was actually encoded in\n&gt;&gt; windows-1252 cp, but advertised itself as a ISO-8859-1 page (although\n&gt;&gt; it did this only in the HTML content of the page, not on the\n&gt;&gt; appropriate place - the HTTP headers, but anyway as you pointed\n&gt;&gt; Heritrix probably picked ISO-8859-1 as default).\n&gt;&gt;     \n&gt;\n&gt; Was there any hint or declaration that windows-1252 was the proper \n&gt; encoding, or would it have to be deduced by statistical guesswork from \n&gt; that page if you didn&#39;t already know the expected encoding? (Is this a \n&gt; public URL you can share?)\n&gt;\n&gt;   \n&gt;&gt; In my Processor I manually forced the encoding like this (uri is a\n&gt;&gt; ProcessorURI):\n&gt;&gt;\n&gt;&gt; uri.getRecorder().setCharacterEncoding(&quot;windows-1252&quot;);\n&gt;&gt;\n&gt;&gt; However, although my JVM perfectly supports this encoding (I checked),\n&gt;&gt; things were still not working, specifically, the Euro currency\n&gt;&gt; character/symbol, coded by the byte 80 in hex in Windows-1252,\n&gt;&gt; appeared garbled when I converted the uri to a String via\n&gt;&gt;\n&gt;&gt; String content = uri.getRecorder().getReplayCharSequence().toString();\n&gt;&gt;\n&gt;&gt; I looked at the source and found this strange comment in the\n&gt;&gt; getReplayCharSequence() of RecordingOutputStream :\n&gt;&gt;\n&gt;&gt; // TODO: take into account single-byte encoding may be non-default\n&gt;&gt;\n&gt;&gt; Closer examination of the code reveals that the comment is right - the\n&gt;&gt; encoding is downright ignored for single-byte encodings... this can be\n&gt;&gt; seen immediately by the fact that the encoding argument is not passed\n&gt;&gt; down to further methods in the chain.\n&gt;&gt;\n&gt;&gt; So the stream of bytes is not correctly converted to a char (actual\n&gt;&gt; conversion appears in the charAt method of ByteReplayCharSequence):\n&gt;&gt;\n&gt;&gt; return (char)(c & 0xff);\n&gt;&gt;\n&gt;&gt; where c is an int. I guess this formula is correct only for ISO-8859-1.\n&gt;&gt;     \n&gt;\n&gt; This is definitely a problem; I&#39;ve created a new bug:\n&gt;\n&gt;    http://webteam.archive.org/jira/browse/HER-1506\n&gt;\n&gt; I think it&#39;s gone unnoticed for a while because:\n&gt;   - this masking won&#39;t hurt single-byte characters &lt;= 0x7F\n&gt;   - prevalent single-byte encodings are very similar in this range \n&gt; inherited from ASCII\n&gt;   - our usual configurations only use the ReplayCharSequence for link \n&gt; extraction, and link delimiters and link characters are often limited to \n&gt; ASCII, even when other content on the page varies\n&gt;\n&gt;   \n&gt;&gt; Maybe this could be easily fixed by a patch, but currently this\n&gt;&gt; clearly means only ISO-8859-1 is supported as a single byte encoding (\n&gt;&gt; I did not look much at multibyte encoding support but hope it is\n&gt;&gt; better).\n&gt;&gt;     \n&gt;\n&gt; Actually, it&#39;s a little worse than that: only bytes &lt;=0x7F are read \n&gt; properly from a (Single)ByteReplayCharSequence.\n&gt;\n&gt;   \n&gt;&gt; As getting back the actual bytes is also quite difficult, the priority\n&gt;&gt; of this fix should be high IMHO.\n&gt;&gt;     \n&gt;\n&gt; It&#39;s actually quite easy to get the raw bytes: use the \n&gt; RecordingOutputStream.getReplayInputStream method (or \n&gt; getContentReplayInputStream to skip the HTTP headers). That will give a \n&gt; raw byte stream of the recorded fetched content.\n&gt;\n&gt; - Gordon @ IA\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;   \n&gt;&gt; Jean-Noel\n&gt;&gt;\n&gt;&gt;\n&gt;&gt; On Mon, Jun 2, 2008 at 11:36 PM, Gordon Mohr &lt;gojomo@...&gt; wrote:\n&gt;&gt;     \n&gt;&gt;&gt; Jean-Noël Rivasseau wrote:\n&gt;&gt;&gt;       \n&gt;&gt;&gt;&gt; Hello,\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; I had a problem with encoding today and took a look at Heritrix code.\n&gt;&gt;&gt;&gt; Unfortunately it seems to me (from my understanding of the code) that\n&gt;&gt;&gt;&gt; Heritrix supports only ISO-8859-1 pages and UTF-8 pages. I have a page\n&gt;&gt;&gt;&gt; encoded in windows-1252, and Heritrix is not able to read it\n&gt;&gt;&gt;&gt; correctly.\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; Is better encoding support planned in the reasonable near future? This\n&gt;&gt;&gt;&gt; seems not a totally trivial thing to do (else I coul have tried) as\n&gt;&gt;&gt;&gt; the code is rather low level (ReplayCharSequence is probably the place\n&gt;&gt;&gt;&gt; that would need to be fixed) and I am not sure how to proceed.\n&gt;&gt;&gt;&gt;         \n&gt;&gt;&gt; Heritrix should already support many other encodings -- limited mainly\n&gt;&gt;&gt; by what support is in your Java VM.\n&gt;&gt;&gt;\n&gt;&gt;&gt; As per HTTP/1.1, when no other charset is specified, ISO-8859-1 is\n&gt;&gt;&gt; assumed. See:\n&gt;&gt;&gt;\n&gt;&gt;&gt; http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.7.1\n&gt;&gt;&gt;\n&gt;&gt;&gt; Can you be more specific about the problem you encountered? What did\n&gt;&gt;&gt; Heritrix not read that you tried?\n&gt;&gt;&gt;\n&gt;&gt;&gt; - Gordon @ IA\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;       \n&gt;&gt; ------------------------------------\n&gt;&gt;\n&gt;&gt; Yahoo! Groups Links\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;     \n&gt;\n&gt; ------------------------------------\n&gt;\n&gt; Yahoo! Groups Links\n&gt;\n&gt;\n&gt;\n&gt;   \n\n"}}