{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":168599281,"authorName":"stack","from":"stack &lt;stack@...&gt;","profile":"stackarchiveorg","replyTo":"LIST","senderId":"jxbONsFdoIvcKddhhlJgrAghfMJE-2kT_WaCpPpV4kqNPcl2CQDyuHZHdsgYbU_l5QhnXUKp468xY0qwu14sJA","spamInfo":{"isSpam":false,"reason":"12"},"subject":"Re: [archive-crawler] Recovering a Job","postDate":"1134445881","msgId":2417,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDQzOUU0NTM5LjcwOTA5MDVAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PDAwMTYwMWM1ZmY0ZCRlYWMzYzNiMCQ3OTAxMTkwYUB4c2JpbnRlcm5hbC5jb20+","referencesHeader":"PDAwMTYwMWM1ZmY0ZCRlYWMzYzNiMCQ3OTAxMTkwYUB4c2JpbnRlcm5hbC5jb20+"},"prevInTopic":2413,"nextInTopic":2422,"prevInTime":2416,"nextInTime":2418,"topicId":2368,"numMessagesInTopic":19,"msgSnippet":"... The javadoc comment says its only used by selftest.  Making it public probably ain t the right solution.  I played around adding a constructor that allows","rawEmail":"Return-Path: &lt;stack@...&gt;\r\nX-Sender: stack@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 40659 invoked from network); 13 Dec 2005 04:04:38 -0000\r\nReceived: from unknown (66.218.66.172)\n  by m27.grp.scd.yahoo.com with QMQP; 13 Dec 2005 04:04:38 -0000\r\nReceived: from unknown (HELO dns.duboce.net) (63.203.238.114)\n  by mta4.grp.scd.yahoo.com with SMTP; 13 Dec 2005 04:04:38 -0000\r\nReceived: from [192.168.1.105] ([192.168.1.105])\n\t(authenticated)\n\tby dns-eth1.duboce.net (8.10.2/8.10.2) with ESMTP id jBD2k6e08680;\n\tMon, 12 Dec 2005 18:46:07 -0800\r\nMessage-ID: &lt;439E4539.7090905@...&gt;\r\nDate: Mon, 12 Dec 2005 19:51:21 -0800\r\nUser-Agent: Thunderbird 1.5 (Macintosh/20051025)\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;001601c5ff4d$eac3c3b0$7901190a@...&gt;\r\nIn-Reply-To: &lt;001601c5ff4d$eac3c3b0$7901190a@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-eGroups-Msg-Info: 2:12:4:0\r\nFrom: stack &lt;stack@...&gt;\r\nSubject: Re: [archive-crawler] Recovering a Job\r\nX-Yahoo-Group-Post: member; u=168599281; y=l6WH24XyWkRJRhOJg5RJcd4ofsgAdXuB-n-IDfCPH8J3-hgJ5cs3OXHk\r\nX-Yahoo-Profile: stackarchiveorg\r\n\r\nAlex wrote:\n&gt; Hi Stack,\n&gt; \n&gt; I wrote some code that automates the task of checkpointing at certain points\n&gt; of time during the crawl.  My method was a little more complicated than the\n&gt; one you suggested.  Some modifications to the code is required such as\n&gt; Heritrix.setJobHandler needs to be public.  \n\nThe javadoc comment says its only used by selftest.  Making it public \nprobably ain&#39;t the right solution.  I played around adding a constructor \nthat allows passing in a CrawlJobHandler -- which would mean I could \njust remove this &#39;odd&#39; method altogether -- but that won&#39;t work for your \ncase where you want to call Heritrix.main  (See below for more on this).\n\nI created a JobHandler that\n&gt; deals with checkpointing the job at certain points during the run.  I am\n&gt; attaching the first draft of my code, if you could let me know what you\n&gt; think. \n&gt; \n&gt; 1. I did find a &#39;bug&#39; with the base code, in the class\n&gt; \n&gt; org.archive.crawler.framework.CrawlController\n&gt; \n&gt; The method\n&gt; \n&gt; writeCheckpoint()\n&gt; \n&gt; Calls\n&gt; \n&gt; checkpointTo(Context)\n&gt; \n&gt; Which at the end of the method calls completePause which invokes a Pause\n&gt; event to be fired, which I am listening for, but after this is called\n&gt; The status is set to PAUSE back in the finally of\n&gt; \n&gt; writeCheckpoint()\n&gt; \n&gt; ------------------- Current Implementation -------------------------\n&gt;   protected void writeCheckpoint() {\n&gt;         cpContext.begin();\n&gt;         try {\n&gt;             this.checkpointTo(cpContext);  // calls completePause() (this\n&gt; shouldn&#39;t happen in this method)\n&gt;         } catch (Exception e) {\n&gt;             cpContext.checkpointFailed(e);\n&gt;         } finally {\n&gt;             cpContext.end();\n&gt;             this.state = PAUSED;           \n&gt;         }\n&gt;     }\n&gt; \n&gt; \n&gt; ------------------- Should be -------------------------\n&gt; \n&gt;   protected void writeCheckpoint() {\n&gt;         cpContext.begin();\n&gt;         try {\n&gt;             this.checkpointTo(cpContext); // should not call\n&gt; completePause!!!\n&gt;         } catch (Exception e) {\n&gt;             cpContext.checkpointFailed(e);\n&gt;         } finally {\n&gt;             cpContext.end();\n&gt;             // this.state = PAUSED;\n&gt;             completePause();\n&gt;         }\n&gt;     }\n&gt; \n&gt; ----------------------------------------\n&gt; \n&gt; I use the event handling to determine the state, and since it is in pause, I\n&gt; call requestCrawlResume\n&gt; but then it sets it back to PAUSED without a notification, causing it to be\n&gt; in a weird state.\n\nThanks for the above. The line &#39;this.state = PAUSED&#39; is redundant -- and \nit looks like its causing you grief.  I removed it.  Thanks for reporting.\n\nOn your classes:\n\nLooks like you&#39;ve added to the crawlPaused method in your \nCrawlJobHandler override a check to see if a request to checkpoint has \nbeen set and if so, you run checkpointing. Checkpointing runs, \ncrawlCheckpoint is called in your CJH override and you set \n&#39;shouldResume&#39; to true so that when crawlPaused is called again after \ncheckpointing has completed, you&#39;re override invokes resume (I like your \nuse of java.util.Timer).\n\nOne suggestion I&#39;d make is that changing/managing crawler state should \nbe done by the CrawlController rather than out of the state change \nmethods in CJH (CrawlController is overrideable. See \nCrawlJob#setupForCrawlStart where we override CC so we can remove \nregistered MBeans).\n\nWould also suggest using a java.util logger in place of calls to \nSystem.out.err.\n\nCalling Heritrix#main is working fine for you?  Any reason you don&#39;t \nwant to do &#39;new Heritrix()&#39; only?  Did you try it?\n\nYours,\nSt.Ack\n\n\n\n&gt; \n&gt; \n&gt; 2. The other problem I did run across was setting the JobHandler seemed to\n&gt; have a race condition, on which was used, the original or the new one being\n&gt; set.  Not sure why.\n&gt; \n&gt; Alex\n&gt; \n&gt; \n&gt; \n&gt; \n&gt; \n&gt; SPONSORED LINKS\n&gt; Computer internet security \n&gt; &lt;http://groups.yahoo.com/gads?t=ms&k=Computer+internet+security&w1=Computer+internet+security&w2=Computer+internet+business&w3=Computer+internet+access&w4=Computer+internet+help&c=4&s=122&.sig=fQlbV6UXiuarNtoxIqj5Ew&gt; \n&gt; \tComputer internet business \n&gt; &lt;http://groups.yahoo.com/gads?t=ms&k=Computer+internet+business&w1=Computer+internet+security&w2=Computer+internet+business&w3=Computer+internet+access&w4=Computer+internet+help&c=4&s=122&.sig=TJtUvUPdqjaz8ZJRC_SQ2A&gt; \n&gt; \tComputer internet access \n&gt; &lt;http://groups.yahoo.com/gads?t=ms&k=Computer+internet+access&w1=Computer+internet+security&w2=Computer+internet+business&w3=Computer+internet+access&w4=Computer+internet+help&c=4&s=122&.sig=GtMYFi2Aij3DpAAcG75g1Q&gt; \n&gt; \n&gt; Computer internet help \n&gt; &lt;http://groups.yahoo.com/gads?t=ms&k=Computer+internet+help&w1=Computer+internet+security&w2=Computer+internet+business&w3=Computer+internet+access&w4=Computer+internet+help&c=4&s=122&.sig=AphsIa89Q01m6trU2VeGlA&gt; \n&gt; \n&gt; \n&gt; \n&gt; ------------------------------------------------------------------------\n&gt; YAHOO! GROUPS LINKS\n&gt; \n&gt;     *  Visit your group &quot;archive-crawler\n&gt;       &lt;http://groups.yahoo.com/group/archive-crawler&gt;&quot; on the web.\n&gt;        \n&gt;     *  To unsubscribe from this group, send an email to:\n&gt;        archive-crawler-unsubscribe@yahoogroups.com\n&gt;       &lt;mailto:archive-crawler-unsubscribe@yahoogroups.com?subject=Unsubscribe&gt;\n&gt;        \n&gt;     *  Your use of Yahoo! Groups is subject to the Yahoo! Terms of\n&gt;       Service &lt;http://docs.yahoo.com/info/terms/&gt;. \n&gt; \n&gt; \n&gt; ------------------------------------------------------------------------\n&gt; \n\n\n"}}