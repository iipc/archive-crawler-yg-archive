{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr","from":"Gordon Mohr &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"2v_glGcMHf_GNKhTlD3vlqjLzuTJGFxi_YcIee1SaB11f-TwfDFzcLwKNU3a1OkxjlcYBTe_Ws1-gnn8YcMUrmuRV70GtVE","spamInfo":{"isSpam":false,"reason":"6"},"subject":"Checkpoint issue Re: [archive-crawler] robots.txt problem","postDate":"1325629534","msgId":7490,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDRGMDM4MDVFLjQwMDAwMDRAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PDRGMDMyQjBCLjQwODA4MDhAY3MuY211LmVkdT4=","referencesHeader":"PGpjNThodCt1Z3VwQGVHcm91cHMuY29tPiA8NEVFODA5RDcuNzAxMDEwMEBhcmNoaXZlLm9yZz4gPDRFRjM4RDk5LjEwODA0MDZAY3MuY211LmVkdT4gPDRFRjNBRTJCLjUwMTA5MDdAYXJjaGl2ZS5vcmc+IDw0RUYzQjdCRC42MDgwNTA2QGNzLmNtdS5lZHU+IDw0RUYzRjEyMS4xMDAwNDA1QGFyY2hpdmUub3JnPiA8NEYwMzJCMEIuNDA4MDgwOEBjcy5jbXUuZWR1Pg=="},"prevInTopic":7487,"nextInTopic":7491,"prevInTime":7489,"nextInTime":7491,"topicId":7379,"numMessagesInTopic":23,"msgSnippet":"It looks like the last SEVERE error ( 2011-12-27 13:18:50.197 ) due to filesystem problems left state that prevents further checkpoint attempts. It *might* be","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 48296 invoked from network); 3 Jan 2012 22:25:37 -0000\r\nX-Received: from unknown (98.137.35.162)\n  by m2.grp.sp2.yahoo.com with QMQP; 3 Jan 2012 22:25:37 -0000\r\nX-Received: from unknown (HELO relay02.pair.com) (209.68.5.16)\n  by mta6.grp.sp2.yahoo.com with SMTP; 3 Jan 2012 22:25:37 -0000\r\nX-Received: (qmail 48142 invoked by uid 0); 3 Jan 2012 22:25:35 -0000\r\nX-Received: from 76.218.213.38 (HELO silverbook.local) (76.218.213.38)\n  by relay02.pair.com with SMTP; 3 Jan 2012 22:25:35 -0000\r\nX-pair-Authenticated: 76.218.213.38\r\nMessage-ID: &lt;4F03805E.4000004@...&gt;\r\nDate: Tue, 03 Jan 2012 14:25:34 -0800\r\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:8.0) Gecko/20111105 Thunderbird/8.0\r\nMIME-Version: 1.0\r\nTo: David Pane &lt;dpane@...&gt;\r\nCc: archive-crawler@yahoogroups.com\r\nReferences: &lt;jc58ht+ugup@...&gt; &lt;4EE809D7.7010100@...&gt; &lt;4EF38D99.1080406@...&gt; &lt;4EF3AE2B.5010907@...&gt; &lt;4EF3B7BD.6080506@...&gt; &lt;4EF3F121.1000405@...&gt; &lt;4F032B0B.4080808@...&gt;\r\nIn-Reply-To: &lt;4F032B0B.4080808@...&gt;\r\nContent-Type: text/plain; charset=windows-1252; format=flowed\r\nContent-Transfer-Encoding: 8bit\r\nX-eGroups-Msg-Info: 1:6:0:0:0\r\nFrom: Gordon Mohr &lt;gojomo@...&gt;\r\nSubject: Checkpoint issue Re: [archive-crawler] robots.txt problem\r\nX-Yahoo-Group-Post: member; u=137285340; y=RmQe2pqVhvdlRvBE2i_iFTECoERTHu02iPltnc3B5Qp5\r\nX-Yahoo-Profile: gojomo\r\n\r\nIt looks like the last SEVERE error (&quot;2011-12-27 13:18:50.197&quot;) due to \nfilesystem problems left state that prevents further checkpoint attempts.\n\nIt *might* be possible, with some custom heap surgery via the Scripting \nConsole, to resolve that and thus give a new checkpoint a chance to \nsucceed.\n\nThis would involve looking closely at what wasn&#39;t done because of that \nSEVERE &quot;java.io.IOException: Failed to create directory&quot;, and manually \ncleaning that up until the CheckpointService.requestCrawlCheckpoint() \ncheck (and subsequent steps) can proceed.\n\nAt first glance, this might be simply: the \nCheckpointService.checkpointInProgress field needs to be null. Pausing \nthe crawl, nulling that field, then manually requesting a checkpoint \n*might* create a viable checkpoint.\n\nBut, such ad hoc emergency tampering can easily go awry ï¿½ for example, \nyou think you&#39;ve fixed everything, your next try hits a new error that \nthen fouls things unfixably. Or, it looks like it succeeds, but whatever \nhad caused the earlier IO-related SEVERE errors (&quot;unable to create \nrequired checkpoint link&quot; and &quot;Failed to create directory&quot;) had already \nfouled on-disk state enough that you still don&#39;t have a truly \nrecoverable checkpoint. (If there are any other IO-related exceptions in \nyour logs that appear deep in BDB-JE code, such damage is probably the \ncase. But if the only IO-exceptions are the ones you&#39;ve forwarded, \nthere&#39;s at least a little hope.)\n\nThe surest approach would be to try resuming from the last checkpoint \nbefore any SEVERE errors. (Perhaps, &quot;cp00086&quot;.) So you might want to \nsave all of that state aside before trying anything to rescue the live \nstate.\n\nAlso, I would look closely at heritrix and system logs to better \nunderstand why the linking/directory-creation might have failed in the \noriginal timeframe. (Disk full or other volume errors? Filehandle \nexhaustion? These may still be a problem and foul your next checkpoint \nattempt even if the heap can be tampered back to working order.) Every \nSEVERE alert/log-event is, by our severity conventions, something that \ncould mean lingering crawl/data corruption and a completely fouled \ncrawl, so every SEVERE event should be reviewed as soon as possible \nafter it occurs.\n\nLooking at CheckpointService.requestCrawlCheckpoint, it seems the \nerror-recovery there should be more robust. Perhaps exceptions at the \ngenerateFrom() step (like 228) need a different catch/finally than the \nlater steps (where the per-Checkpointable finishCheckpoint() calls make \nsense). And perhaps even each finishCheckpoint() call should be able to \nfail independently, in the case where the exception meant a \nless-than-full set of Checkpointables got the start/do calls. I&#39;ve made \na bug report to improve this error-recovery:\n\nhttps://webarchive.jira.com/browse/HER-1980\n\nHope this helps,\n\n- Gordon\n\nOn 1/3/12 8:21 AM, David Pane wrote:\n&gt; I have been running a 5 instance crawl since December 23rd. I noticed\n&gt; today, that the hourly checkpoints stopped occurring for instance 0, on\n&gt; cp00102\n&gt;\n&gt; crawl.log.cp00102-20111227121847\n&gt; frontier.recover.gz.cp00102-20111227121847\n&gt; nonfatal-errors.log.cp00102-20111227121847\n&gt; progress-statistics.log.cp00102-20111227121847\n&gt; runtime-errors.log.cp00102-20111227121847\n&gt; uri-errors.log.cp00102-20111227121847\n&gt;\n&gt;\n&gt; Attempting to manually create a checkpoint produced the error below.\n&gt;\n&gt; The crawler appears to be capturing URIs even though the checkpoints are\n&gt; not happening.\n&gt;\n&gt; I have also included excerpts from heritrix_out.log\n&gt;\n&gt; It appears that from the log that cp00103-20111227131848 directory could\n&gt; not be created, but that directory (which is empty) was created.\n&gt;\n&gt; Is there anyway that I can get around this problem so that I don&#39;t loose\n&gt; all of the crawling data between when it stopped creating checkpoints\n&gt; and now?\n&gt;\n&gt;\n&gt; --David\n&gt;\n&gt;\n&gt; An error occured\n&gt; You may be able to recover and try something else by going back.\n&gt; Cause: java.lang.IllegalStateException: Checkpoint already running.\n&gt;\n&gt; java.lang.IllegalStateException: Checkpoint already running.\n&gt; at\n&gt; org.archive.crawler.framework.CheckpointService.requestCrawlCheckpoint(CheckpointService.java:212)\n&gt;\n&gt; at\n&gt; org.archive.crawler.restlet.JobResource.acceptRepresentation(JobResource.java:578)\n&gt;\n&gt; at org.restlet.resource.Resource.post(Resource.java:683)\n&gt; at org.restlet.resource.Resource.handlePost(Resource.java:537)\n&gt; at org.restlet.Finder.handle(Finder.java:357)\n&gt; at org.restlet.Filter.doHandle(Filter.java:150)\n&gt; at org.restlet.Filter.handle(Filter.java:195)\n&gt; at org.restlet.Router.handle(Router.java:504)\n&gt; at org.restlet.Filter.doHandle(Filter.java:150)\n&gt; at org.restlet.Filter.handle(Filter.java:195)\n&gt; at org.restlet.Filter.doHandle(Filter.java:150)\n&gt; at org.restlet.Filter.handle(Filter.java:195)\n&gt; at org.restlet.Filter.doHandle(Filter.java:150)\n&gt; at com.noelios.restlet.StatusFilter.doHandle(StatusFilter.java:130)\n&gt; at org.restlet.Filter.handle(Filter.java:195)\n&gt; at org.restlet.Filter.doHandle(Filter.java:150)\n&gt; at org.restlet.Filter.handle(Filter.java:195)\n&gt; at com.noelios.restlet.ChainHelper.handle(ChainHelper.java:124)\n&gt; at\n&gt; com.noelios.restlet.application.ApplicationHelper.handle(ApplicationHelper.java:112)\n&gt;\n&gt; at org.restlet.Application.handle(Application.java:341)\n&gt; at org.restlet.Filter.doHandle(Filter.java:150)\n&gt; at org.restlet.Guard.accept(Guard.java:198)\n&gt; at org.restlet.Guard.doHandle(Guard.java:354)\n&gt; at org.restlet.Filter.handle(Filter.java:195)\n&gt; at org.restlet.Filter.doHandle(Filter.java:150)\n&gt; at org.restlet.Filter.handle(Filter.java:195)\n&gt; at org.restlet.Router.handle(Router.java:504)\n&gt; at org.restlet.Filter.doHandle(Filter.java:150)\n&gt; at org.restlet.Filter.handle(Filter.java:195)\n&gt; at org.restlet.Router.handle(Router.java:504)\n&gt; at org.restlet.Filter.doHandle(Filter.java:150)\n&gt; at com.noelios.restlet.StatusFilter.doHandle(StatusFilter.java:130)\n&gt; at org.restlet.Filter.handle(Filter.java:195)\n&gt; at org.restlet.Filter.doHandle(Filter.java:150)\n&gt; at org.restlet.Filter.handle(Filter.java:195)\n&gt; at com.noelios.restlet.ChainHelper.handle(ChainHelper.java:124)\n&gt; at org.restlet.Component.handle(Component.java:673)\n&gt; at org.restlet.Server.handle(Server.java:331)\n&gt; at com.noelios.restlet.ServerHelper.handle(ServerHelper.java:68)\n&gt; at\n&gt; com.noelios.restlet.http.HttpServerHelper.handle(HttpServerHelper.java:147)\n&gt; at\n&gt; com.noelios.restlet.ext.jetty.JettyServerHelper$WrappedServer.handle(JettyServerHelper.java:174)\n&gt;\n&gt; at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:534)\n&gt; at\n&gt; org.mortbay.jetty.HttpConnection$RequestHandler.content(HttpConnection.java:879)\n&gt;\n&gt; at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:741)\n&gt; at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:213)\n&gt; at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:403)\n&gt; at\n&gt; org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:228)\n&gt;\n&gt; at\n&gt; org.mortbay.jetty.security.SslSocketConnector$SslConnection.run(SslSocketConnector.java:636)\n&gt;\n&gt; at\n&gt; org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:522)\n&gt;\n&gt;\n&gt;\n&gt; heritrix_out.log\n&gt;\n&gt; .\n&gt; .\n&gt; .\n&gt; 2011-12-26 20:58:16.216 SEVERE thread-14\n&gt; org.archive.bdb.BdbModule.doCheckpoint() unable to create required\n&gt; checkpoint link\n&gt; /scratch/heritrix-3.1.1-DAPv1.2/./jobs/2011-12-23/state/cp00087-20111226205645/00001af2.jdb,9998924\n&gt;\n&gt; 2011-12-26 20:58:31.925 INFO thread-14\n&gt; org.archive.crawler.framework.CrawlJob.onApplicationEvent() CHECKPOINTED\n&gt; cp00087-20111226205645\n&gt; 2011-12-26 20:58:31.948 INFO thread-14\n&gt; org.archive.crawler.framework.CheckpointService.requestCrawlCheckpoint()\n&gt; finished checkpoint cp00087-20111226205645\n&gt;\n&gt; .\n&gt; .\n&gt; .\n&gt; 2011-12-27 00:58:00.022 SEVERE thread-14\n&gt; org.archive.bdb.BdbModule.doCheckpoint() unable to create required\n&gt; checkpoint link\n&gt; /scratch/heritrix-3.1.1-DAPv1.2/./jobs/2011-12-23/state/cp00091-20111227005647/00011576.jdb,9999930\n&gt;\n&gt; 2011-12-27 00:58:04.130 INFO thread-14\n&gt; org.archive.crawler.framework.CrawlJob.onApplicationEvent() CHECKPOINTED\n&gt; cp00091-20111227005647\n&gt; 2011-12-27 00:58:04.145 INFO thread-14\n&gt; org.archive.crawler.framework.CheckpointService.requestCrawlCheckpoint()\n&gt; finished checkpoint cp00091-20111227005647\n&gt; .\n&gt; .\n&gt; .\n&gt; 2011-12-27 02:00:32.585 INFO thread-14\n&gt; org.archive.crawler.framework.CrawlJob.onApplicationEvent() CHECKPOINTED\n&gt; cp00092-20111227015918\n&gt; 2011-12-27 02:00:32.597 INFO thread-14\n&gt; org.archive.crawler.framework.CheckpointService.requestCrawlCheckpoint()\n&gt; finished checkpoint cp00092-20111227015918\n&gt; .\n&gt; .\n&gt; .\n&gt; 2011-12-27 12:20:06.982 INFO thread-14\n&gt; org.archive.crawler.framework.CrawlJob.onApplicationEvent() CHECKPOINTED\n&gt; cp00102-20111227121847\n&gt; 2011-12-27 12:20:06.987 INFO thread-14\n&gt; org.archive.crawler.framework.CheckpointService.requestCrawlCheckpoint()\n&gt; finished checkpoint cp00102-20111227121847\n&gt; .\n&gt; .\n&gt; .\n&gt; 2011-12-27 13:18:50.197 SEVERE thread-14\n&gt; org.archive.crawler.framework.CheckpointService.checkpointFailed()\n&gt; Checkpoint failed\n&gt; java.io.IOException: Failed to create directory:\n&gt; /scratch/heritrix-3.1.1-DAPv1.2/./jobs/2011-12-23/checkpoints/cp00103-20111227131848\n&gt;\n&gt; at org.archive.util.FileUtils.ensureWriteableDirectory(FileUtils.java:677)\n&gt; at org.archive.checkpointing.Checkpoint.generateFrom(Checkpoint.java:90)\n&gt; at\n&gt; org.archive.crawler.framework.CheckpointService.requestCrawlCheckpoint(CheckpointService.java:228)\n&gt;\n&gt; at\n&gt; org.archive.crawler.framework.CheckpointService$1.run(CheckpointService.java:180)\n&gt;\n&gt; at java.util.TimerThread.mainLoop(Timer.java:512)\n&gt; at java.util.TimerThread.run(Timer.java:462)\n\n\n&gt; Exception in thread &quot;Timer-0&quot; java.lang.IllegalMonitorStateException\n&gt; at\n&gt; java.util.concurrent.locks.ReentrantReadWriteLock$Sync.tryRelease(ReentrantReadWriteLock.java:317)\n&gt;\n&gt; at\n&gt; java.util.concurrent.locks.AbstractQueuedSynchronizer.release(AbstractQueuedSynchronizer.java:1239)\n&gt;\n&gt; at\n&gt; java.util.concurrent.locks.ReentrantReadWriteLock$WriteLock.unlock(ReentrantReadWriteLock.java:992)\n&gt;\n&gt; at\n&gt; org.archive.crawler.frontier.BdbFrontier.finishCheckpoint(BdbFrontier.java:276)\n&gt;\n&gt; at\n&gt; org.archive.crawler.framework.CheckpointService.requestCrawlCheckpoint(CheckpointService.java:255)\n&gt;\n&gt; at\n&gt; org.archive.crawler.framework.CheckpointService$1.run(CheckpointService.java:180)\n&gt;\n&gt; at java.util.TimerThread.mainLoop(Timer.java:512)\n&gt; at java.util.TimerThread.run(Timer.java:462)\n&gt;\n\n"}}