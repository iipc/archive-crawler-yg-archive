{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr","from":"Gordon Mohr &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"Gw2hyZWRl9ffup1YRwr2Gkqg0SmItH_7d5ia4We7Mcmf-u4qI3EYb4c342D_d4_AeiXgX9WcMLO3e2zJi583OLn5GK5ahUA","spamInfo":{"isSpam":false,"reason":"12"},"subject":"Re: [archive-crawler] Best way to throttle down Heritrix for a period","postDate":"1351288058","msgId":7834,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDUwOEIwNEZBLjUwNzA0MDhAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PENBRlI3Mkhtb1RGM2JTLTlXQXoyaS04dWZSendreU41Y2NHRlVwZldjUmNXWTI1c0p0UUBtYWlsLmdtYWlsLmNvbT4=","referencesHeader":"PGs1czJkMCtwdXVhQGVHcm91cHMuY29tPiA8NTA4NzA3QzAuNzA1MDcwN0BhcmNoaXZlLm9yZz4gPENBRlI3Mkhtb1RGM2JTLTlXQXoyaS04dWZSendreU41Y2NHRlVwZldjUmNXWTI1c0p0UUBtYWlsLmdtYWlsLmNvbT4="},"prevInTopic":7833,"nextInTopic":0,"prevInTime":7833,"nextInTime":7835,"topicId":7826,"numMessagesInTopic":4,"msgSnippet":"... The most common use of DecideRules is inside the list of rules used as a crawl scope -- the definition of which URIs to enqueue/collect, and which to","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 43195 invoked from network); 26 Oct 2012 21:47:41 -0000\r\nX-Received: from unknown (98.137.35.162)\n  by m9.grp.sp2.yahoo.com with QMQP; 26 Oct 2012 21:47:41 -0000\r\nX-Received: from unknown (HELO relay00.pair.com) (209.68.5.9)\n  by mta6.grp.sp2.yahoo.com with SMTP; 26 Oct 2012 21:47:40 -0000\r\nX-Received: (qmail 13226 invoked by uid 0); 26 Oct 2012 21:47:39 -0000\r\nX-Received: from 70.36.143.78 (HELO silverbook.local) (70.36.143.78)\n  by relay00.pair.com with SMTP; 26 Oct 2012 21:47:39 -0000\r\nX-pair-Authenticated: 70.36.143.78\r\nMessage-ID: &lt;508B04FA.5070408@...&gt;\r\nDate: Fri, 26 Oct 2012 14:47:38 -0700\r\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:16.0) Gecko/20121010 Thunderbird/16.0.1\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;k5s2d0+puua@...&gt; &lt;508707C0.7050707@...&gt; &lt;CAFR72HmoTF3bS-9WAz2i-8ufRzwkyN5ccGFUpfWcRcWY25sJtQ@...&gt;\r\nIn-Reply-To: &lt;CAFR72HmoTF3bS-9WAz2i-8ufRzwkyN5ccGFUpfWcRcWY25sJtQ@...&gt;\r\nContent-Type: text/plain; charset=UTF-8; format=flowed\r\nContent-Transfer-Encoding: 8bit\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: Gordon Mohr &lt;gojomo@...&gt;\r\nSubject: Re: [archive-crawler] Best way to throttle down Heritrix for a period\r\nX-Yahoo-Group-Post: member; u=137285340; y=sgLGyRNqIrD0MxfLOHtt7UwHUis4cn651NK_6gKbe3MD\r\nX-Yahoo-Profile: gojomo\r\n\r\nOn 10/26/12 10:28 AM, Juan Manuel Caicedo Carvajal wrote:\n&gt; Thank you for your reply Gordon, it was very useful.\n&gt;\n&gt; I initially did not consider to address the problem at the OS level or\n&gt; with a proxy, but I agree that those solutions are more direct and\n&gt; reliable ways of limiting the bandwidth used.\n&gt;\n&gt; I have a question though regarding the DecideRule. I just started\n&gt; learning about Heritrix and it seems to me that they are used to\n&gt; decide whether a discovered URL should be added to the queue or not;\n&gt; that is, if they are rejected they are not stored anywhere. However, I\n&gt; don&#39;t want to discard completely URLs based on the time of the day, so\n&gt; I wonder if there is a way of keeping or storing those URLs.\n&gt;\n&gt; Should I add that logic to my DecideRule or does Heritrix already\n&gt; provide a way of doing that?\n\nThe most common use of DecideRules is inside the list of rules used as a \ncrawl &#39;scope&#39; -- the definition of which URIs to enqueue/collect, and \nwhich to ignore.\n\nHowever, because each rule is some useful bit of evaluation code, they \nare also less-often used other places, to enable to disable \nfunctionality conditionally. In those roles, they don&#39;t cause URIs to be \nskipped... just for something (for example a Processor step or a set of \nalternate Sheet settings) to be enabled/disabled.\n\nSpecifically, there are two built-in ways to trigger when a Sheet of \nalternate settings takes effect for a certain URI. (That is, to \n&#39;associate&#39; some Sheet of overlay settings with a URI.) Those are \nSurtPrefixesSheetAssociation and the DecideRuledSheetAssociation. As the \nnames indicate, the SurtPrefixesSheetAssociation applies a Sheet to URIs \nmatching some set of SURT prefixes, and the DecideRuledSheetAssociation \napplies a sheet if a URI winds up with an &#39;ACCEPT&#39; from one or more \nDecideRules.\n\nSo, in the context of varying politeness values based on time-of-day, \nyou would only add such a time-sensitive DecideRule inside a \nDecideRuledSheetAssociation, and so it would only enable/disable the \nalternate setting... not do a scope ACCEPT/REJECT.\n\nThere is no existing DecideRule with time-of-day parameters but you \ncould add it either as (1) a new Java class on your classpath, modeled \nafter the existing DecideRules; or more easily (2) a ScriptedDecideRule \nwhich uses any of the available JVM scripting languages (beanshell, \nGroovy, and ECMAScript are bundled with the JVM or Heritrix and JRuby or \nJython are also possibilities) and supplies the script as a big text \nblock to be evaluated. The benefit of the 2nd approach is all the code \ncan be in your crawl configuration -- no messing with Java source or \nclasspaths.\n\nHope that helps to clarify,\n\n- Gordon\n\n\n\n\n\n\n&gt; Thanks again,\n&gt;\n&gt; Juan Manuel Caicedo\n&gt;\n&gt; On Tue, Oct 23, 2012 at 5:10 PM, Gordon Mohr &lt;gojomo@...&gt; wrote:\n&gt;&gt; On 10/19/12 10:24 AM, juanmcc wrote:\n&gt;&gt;&gt; I would like to be able to control the bandwidth used by Heritrix\n&gt;&gt;&gt; during certain hours.\n&gt;&gt;&gt;\n&gt;&gt;&gt; So far, I have seen that I could use sheet overlays to increase the\n&gt;&gt;&gt; values of properties such as disposition.minDelayMs or\n&gt;&gt;&gt; disposition.maxPerHostBandwidthUsageKbSec, so that the politeness\n&gt;&gt;&gt; delay for all the URLs increases. With higher delays, the crawler\n&gt;&gt;&gt; will make less requests and thus this will control (indirectly) the\n&gt;&gt;&gt; bandwidth.\n&gt;&gt;&gt;\n&gt;&gt;&gt; I also have seen that I can use the scripting engine to manage sheet\n&gt;&gt;&gt; overlays, so I could write a script that uses the REST API and makes\n&gt;&gt;&gt; the changes when they are needed (without stopping the job).\n&gt;&gt;&gt;\n&gt;&gt;&gt; Although my approach does not seem to be complicated to implement\n&gt;&gt;&gt; (and I try to do it today), I would like to know what would be the\n&gt;&gt;&gt; potential problems and if there is a better way of doing that.\n&gt;&gt;&gt;\n&gt;&gt;&gt; Do you have any advice or have you done anything similar?\n&gt;&gt;\n&gt;&gt; If you&#39;re considering external scripting, you might also want to\n&gt;&gt; consider options at the OS level, or intervening network. That is,\n&gt;&gt; Heritrix wouldn&#39;t know any limits or time-of-day changes itself, but\n&gt;&gt; some external system would change the maximum bandwidth that Heritrix\n&gt;&gt; could use.\n&gt;&gt;\n&gt;&gt; Some things to consider in that realm:\n&gt;&gt;\n&gt;&gt; • on Linux OSes, look into &#39;iptables&#39; filtering for some local shaping\n&gt;&gt; capabilities\n&gt;&gt;\n&gt;&gt; • alternatively, Heritrix can be configured to send all its requests\n&gt;&gt; through an outbound HTTP proxy. Many such proxies exist, and many have\n&gt;&gt; configuration options like total or per-origin-IP bandwidth limits\n&gt;&gt;\n&gt;&gt; The bandwidth-throttling facilities inside Heritrix are relatively crude\n&gt;&gt; and less-often used. They keep raw totals of data transferred, overall\n&gt;&gt; or per-host, and when recent activity exceeds the preferred\n&gt;&gt; rate-since-crawl-start, Heritrix adds whatever delay is necessary to get\n&gt;&gt; under the target.\n&gt;&gt;\n&gt;&gt; So note that this means no particular *second* or even *range of\n&gt;&gt; seconds* is guaranteed to be under your target rates, just the long-term\n&gt;&gt; average. (Individual requests in progress will transfer data as fast as\n&gt;&gt; the OS/network-paths allow.) So if your concern is total or average\n&gt;&gt; transferred data, the Heritrix settings may work well for you, but if\n&gt;&gt; the concern is avoiding even temporary saturation inconveniencing\n&gt;&gt; network neighbors, you&#39;ll want to use OS/network shaping mechanisms\n&gt;&gt; instead.\n&gt;&gt;\n&gt;&gt; As far as changing Heritrix configuration values by time-of-day, there&#39;s\n&gt;&gt; no built-in mechanism for doing that. Your suggestion of having an\n&gt;&gt; external script poke changes into the configuration values should work\n&gt;&gt; -- though note per above that because the bandwidth settings are\n&gt;&gt; *average-since-crawl-launch* rather than *recent-period-usage*, a simple\n&gt;&gt; alternation between values is unlikely to have the desired effect.\n&gt;&gt;\n&gt;&gt; Another option would be to create a custom DecideRule (either in Java or\n&gt;&gt; using the ScriptedDecideRule) that gives an ACCEPT decision based on the\n&gt;&gt; time of day, and use that DecideRule via a  DecideRuleSheetAssociation\n&gt;&gt; to apply a certain overlay Sheet with different politeness delays. If\n&gt;&gt; you want to go this way and the mention of these class names isn&#39;t\n&gt;&gt; enough to get you started, let me know.\n&gt;&gt;\n&gt;&gt; Hope this helps,\n&gt;&gt;\n&gt;&gt; - Gordon\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;&gt; Thanks,\n&gt;&gt;&gt;\n&gt;&gt;&gt; Juan Manuel Caicedo\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt; ------------------------------------\n&gt;&gt;&gt;\n&gt;&gt;&gt; Yahoo! Groups Links\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt; ------------------------------------\n&gt;&gt;\n&gt;&gt; Yahoo! Groups Links\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;\n&gt;\n&gt; ------------------------------------\n&gt;\n&gt; Yahoo! Groups Links\n&gt;\n&gt;\n&gt;\n\n"}}