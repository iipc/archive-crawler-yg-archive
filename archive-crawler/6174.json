{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr","from":"Gordon Mohr &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"UazyKHB663rewHCxQbrrB-0f7IJ7GAx0zszvQI_DnPMHUZZj1oBD_qoWkhWuytTuJn5UCXJF9JeHHVG_aGT99_j3DRC0nSE","spamInfo":{"isSpam":false,"reason":"6"},"subject":"Re: SV: [archive-crawler] Re: Avoiding overloading webservers hosting many virtual servers","postDate":"1259189099","msgId":6174,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDRCMERCMzZCLjQwNjAyMDBAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PEE4NzMyRUZCMTQzREU1NDU5OUJFMTlCMjY3MDEzRUFCMDEwNDM1NDA4Mjk5QFNCTUFJTEJPWDEuc2Iuc3RhdHNiaWJsaW90ZWtldC5kaz4=","referencesHeader":"PEE4NzMyRUZCMTQzREU1NDU5OUJFMTlCMjY3MDEzRUFCMDEwNDM1NDA4Mjk5QFNCTUFJTEJPWDEuc2Iuc3RhdHNiaWJsaW90ZWtldC5kaz4="},"prevInTopic":6160,"nextInTopic":6175,"prevInTime":6173,"nextInTime":6175,"topicId":6160,"numMessagesInTopic":3,"msgSnippet":"... FYI, we ve started to use the term assignment-level-domain (or ALD ) for what you re calling TLD here. Of course, a true TLD is only the","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 3204 invoked from network); 25 Nov 2009 22:45:01 -0000\r\nX-Received: from unknown (98.137.34.46)\n  by m4.grp.sp2.yahoo.com with QMQP; 25 Nov 2009 22:45:01 -0000\r\nX-Received: from unknown (HELO relay01.pair.com) (209.68.5.15)\n  by mta3.grp.sp2.yahoo.com with SMTP; 25 Nov 2009 22:45:01 -0000\r\nX-Received: (qmail 47824 invoked from network); 25 Nov 2009 22:44:59 -0000\r\nX-Received: from 70.137.163.132 (HELO ?10.0.13.17?) (70.137.163.132)\n  by relay01.pair.com with SMTP; 25 Nov 2009 22:44:59 -0000\r\nX-pair-Authenticated: 70.137.163.132\r\nMessage-ID: &lt;4B0DB36B.4060200@...&gt;\r\nDate: Wed, 25 Nov 2009 14:44:59 -0800\r\nUser-Agent: Thunderbird 2.0.0.23 (Windows/20090812)\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;A8732EFB143DE54599BE19B267013EAB010435408299@...&gt;\r\nIn-Reply-To: &lt;A8732EFB143DE54599BE19B267013EAB010435408299@...&gt;\r\nContent-Type: text/plain; charset=windows-1252; format=flowed\r\nContent-Transfer-Encoding: 8bit\r\nX-eGroups-Msg-Info: 1:6:0:0:0\r\nFrom: Gordon Mohr &lt;gojomo@...&gt;\r\nSubject: Re: SV: [archive-crawler] Re: Avoiding overloading webservers hosting\n many virtual servers\r\nX-Yahoo-Group-Post: member; u=137285340; y=z85PqkBwvVAQ4AfZ-3Rs_shSUCO2FlYCK0XwxZaCjFjl\r\nX-Yahoo-Profile: gojomo\r\n\r\nBjarne Andersen wrote:\n&gt; Our main challenge is that we need the queues sperated on TLD (foo.com \n&gt; and bar.com) to use the quota-enforcer to limit number of bytes on each \n&gt; TLD but at the same time calculate politeness based on the IP-number so \n&gt; that thousands of TLDs on the same IP-number does not overload the server.\n&gt; Will this be easier to implement with heritrix 3.x ??\n\nFYI, we&#39;ve started to use the term &#39;assignment-level-domain&#39; (or\n&#39;ALD&#39;) for what you&#39;re calling &#39;TLD&#39; here. Of course, a true &#39;TLD&#39; is\nonly the last/&#39;topmost&#39; domain, such as .COM or .DK. And the\n&#39;second-level-domain&#39; isn&#39;t necessarily the level of\nassignment/hostname-sale -- it&#39;s sometimes 3rd-level, and occasionally\neven 4th- or more. So &#39;assignment-level-domain&#39; can be used to\ncommunicate: whatever level has been registered/sold by a registrar to a\nsingle entity.\n\nH3 isn&#39;t going to solve this issue outright, but does open a few new \npossibilities, because the politeness delay is calculated outside the \nfrontier, and thus easily adjustable by a custom Processor (instead of \ndeeper frontier customization). Also, the ScriptedProcessor can be \ncustomized in Javascript/Beanshell/Groovy without requiring any Java \nchanges or new libraries.\n\nFor example, one of the workarounds we&#39;ve sometimes applied manually \nafter noticing there&#39;s a problem is setting a much-longer politeness \ndelay for affected domains. Then the average rate certain IPs are hit \nstays reasonable -- even though it&#39;s not as strictly enforced as the \nbuilt-in politeness mechanism.\n\nCode to automate this process could in H3 be dropped in as an optional \ncustom Processor -- increasing delays on any queue that it notices (via \nits own rolling tracking) is offering URLs against an over-trafficked IP.\n\nAnother thing you could consider -- in H1 or H3 -- is trying the \nexisting IPQueueAssignmentPolicy, for exact IP-based politeness, but \nreplacing or extending QuotaEnforcer so that it bases its cutoff \ndecision on a separate tally that is completely independent of the \nfrontier queue-groupings.\n\nThis might be a good idea because overloading the frontier queues to \nserve as both the atom of serialized-request/politeness calculations, \nand other reporting/allocation decisions, will always involve some \ntradeoffs/conflicts. (For example, what if you&#39;ve arranged both \nA.FOO.COM and B.FOO.COM to go into a single FOO.COM ALD frontier queue \n-- but B.FOO.COM is on a completely different, perhaps overloaded or \nunresponsive host. Connection timeouts or politeness delays applied \nbecause of B.FOO.COM&#39;s behavior might then interfere with the collection \nof A.FOO.COM URLs more than you&#39;d like.)\n\nWe may yet come up with a good design for freely mixing whatever \nqueue-groupings are most convenient with other completely-orthogonal \npoliteness/quota rules... but investigation so far suggests that&#39;s hard \nto do without making the frontier even more complicated, and adding new \nrisks of deadlock or imbalanced progress. I hope the ideas above can \nhelp in the meantime.\n\n- Gordon @ IA\n\n&gt; Best\n&gt; Bjarne andersen\n&gt; Netarchive.dk\n&gt; \n&gt; Sent fra min HTC Touch Pro\n&gt; \n&gt; ------------------------------------------------------------------------\n&gt; Fra: kristsi25 &lt;kris@...&gt;\n&gt; Sendt: 19. november 2009 17:09\n&gt; Til: archive-crawler@yahoogroups.com &lt;archive-crawler@yahoogroups.com&gt;\n&gt; Emne: [archive-crawler] Re: Avoiding overloading webservers hosting many \n&gt; virtual servers\n&gt; \n&gt;  \n&gt; \n&gt; John pretty much sums up the problem.\n&gt; \n&gt; The way I&#39;ve dealt with this has been on a case by case basis. Each time \n&gt; we detect this situation, we override the frontier&#39;s \n&gt; &quot;force-queue-assignment&quot; setting to ensure that all the domains are \n&gt; dumped in the same politeness bucket.\n&gt; \n&gt; This is quite simple when you are dealing with a multitude of \n&gt; sub-domains as you can just throw in the override on the parent domain.\n&gt; \n&gt; - Kris\n&gt; \n&gt; --- In archive-crawler@yahoogroups.com \n&gt; &lt;mailto:archive-crawler%40yahoogroups.com&gt;, John Lekashman &lt;lekash@...&gt; \n&gt; wrote:\n&gt;  &gt;\n&gt;  &gt; Hi,\n&gt;  &gt;\n&gt;  &gt; It is not actually possible to guarantee this.\n&gt;  &gt; There is no real way to distinguish for sure where the actual physical\n&gt;  &gt; hardware that hosts a name is.\n&gt;  &gt;\n&gt;  &gt; There has been some discussion of adding IP addresses to the politeness\n&gt;  &gt; capability, which\n&gt;  &gt; would do some of it.\n&gt;  &gt;\n&gt;  &gt; But, that would be defeated if the provider doing the service has given\n&gt;  &gt; separate IP addresses\n&gt;  &gt; to each virtual server, e.g. as would be done if they had ssl clients on\n&gt;  &gt; each virtual machine.\n&gt;  &gt;\n&gt;  &gt; Another thing that can be considered is to extend politeness behavior\n&gt;  &gt; into parent domains,\n&gt;  &gt; e.g. act polite across all of:\n&gt;  &gt; *.foo.com\n&gt;  &gt;\n&gt;  &gt; Which would again handle some of it, if the virtual servers all had a\n&gt;  &gt; common parent.\n&gt;  &gt; Of course, this would be wrong for large scale domains spread across\n&gt;  &gt; multiple disparate\n&gt;  &gt; locations.\n&gt;  &gt;\n&gt;  &gt; If your scope is relatively small, you can also put those things you\n&gt;  &gt; detect as virtual servers in a separate\n&gt;  &gt; crawl job, turn off in the other job, increase the inter arrival time,\n&gt;  &gt; and limit the number of threads to slow it all down.\n&gt;  &gt;\n&gt;  &gt; These are all workarounds for the problem, that may help a little.\n&gt;  &gt; There are probably others you can try.\n&gt;  &gt;\n&gt;  &gt; Its just that the Internet architecture was designed such that the\n&gt;  &gt; bandwidth limiting\n&gt;  &gt; should happen lower in the stack, like at the border router to that\n&gt;  &gt; actual virtualized machine,\n&gt;  &gt; or on the overloaded host itself, and most ISPs have no incentive to do\n&gt;  &gt; so. (Some guy is using extra bandwidth, so I\n&gt;  &gt; can bill more? Great. . .) Or no clue that they even should.\n&gt;  &gt;\n&gt;  &gt; John\n&gt;  &gt;\n&gt;  &gt;\n&gt;  &gt; Sï¿½ren Vejrup Carlsen wrote:\n&gt;  &gt;\n&gt;  &gt; &gt; Hi all.\n&gt;  &gt; &gt; Is it possible in Heritrix 1.14.3 to avoid overloading webservers\n&gt;  &gt; &gt; hosting many virtual servers.\n&gt;  &gt; &gt; We currently have the problem that those webservers often choose to\n&gt;  &gt; &gt; ban our harvesters from their site.\n&gt;  &gt; &gt; And we would very much like to avoid that.\n&gt;  &gt; &gt;\n&gt;  &gt; &gt; best regards\n&gt;  &gt; &gt; ----------------------------------------------------------\n&gt;  &gt; &gt; Sï¿½ren Vejrup Carlsen, NetarchiveSuite developer\n&gt;  &gt; &gt; Department of Digital Preservation, Royal Library, Copenhagen, Denmark\n&gt;  &gt; &gt; tlf: (+45) 33 47 48 41\n&gt;  &gt; &gt; email: svc@... &lt;mailto:svc%40kb.dk&gt;\n&gt;  &gt; &gt; ----------------------------------------------------------\n&gt;  &gt; &gt; Non omnia possumus omnes\n&gt;  &gt; &gt; --- Macrobius, Saturnalia, VI, 1, 35 -------\n&gt;  &gt; &gt;\n&gt;  &gt; &gt;\n&gt;  &gt;\n&gt; \n&gt; \n&gt; \n&gt; \n\n\n"}}