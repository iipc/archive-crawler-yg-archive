{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":323364166,"authorName":"nick zhang","from":"nick zhang &lt;nickzwk@...&gt;","profile":"nickzwk","replyTo":"LIST","senderId":"dHi6WsnIOZhjp_D_Ao5IN8XAvf3jCBd6Fip1CNfIVKFU0RYNpaJFK3HD7denz7CE5eqHOY-Sqe_2MRoVFfWwgfs5w8CS","spamInfo":{"isSpam":false,"reason":"6"},"subject":"Re: [archive-crawler] Extend QueueAssignmentPolicy","postDate":"1190166551","msgId":4557,"canDelete":false,"contentTrasformed":false,"systemMessage":true,"headers":{"messageIdInHeader":"PDIyMzM4MS44MTQyNy5xbUB3ZWI0NTUwMS5tYWlsLnNwMS55YWhvby5jb20+","inReplyToHeader":"PDQ2RjA0RTM5LjgwNjA1MDRAYXJjaGl2ZS5vcmc+"},"prevInTopic":4555,"nextInTopic":0,"prevInTime":4556,"nextInTime":4558,"topicId":4540,"numMessagesInTopic":3,"msgSnippet":"Mr.Mohr, From your response,NicknameQueueAssignmentPolicy will be problematic, And I understand why the download speed initially-fast and then very-slow. Your","rawEmail":"Return-Path: &lt;nickzwk@...&gt;\r\nReceived: (qmail 68537 invoked from network); 19 Sep 2007 04:13:15 -0000\r\nReceived: from unknown (66.218.66.70)\n  by m43.grp.scd.yahoo.com with QMQP; 19 Sep 2007 04:13:15 -0000\r\nReceived: from unknown (HELO n15b.bullet.sp1.yahoo.com) (69.147.64.119)\n  by mta12.grp.scd.yahoo.com with SMTP; 19 Sep 2007 04:13:15 -0000\r\nReceived: from [216.252.122.219] by n15.bullet.sp1.yahoo.com with NNFMP; 19 Sep 2007 04:11:18 -0000\r\nReceived: from [209.73.164.83] by t4.bullet.sp1.yahoo.com with NNFMP; 19 Sep 2007 04:11:18 -0000\r\nReceived: from [66.218.66.73] by t7.bullet.scd.yahoo.com with NNFMP; 19 Sep 2007 04:11:17 -0000\r\nX-Sender: nickzwk@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 3511 invoked from network); 19 Sep 2007 01:50:55 -0000\r\nReceived: from unknown (66.218.66.70)\n  by m1.grp.re1.yahoo.com with QMQP; 19 Sep 2007 01:50:55 -0000\r\nReceived: from unknown (HELO n10.bullet.sp1.yahoo.com) (69.147.64.207)\n  by mta12.grp.scd.yahoo.com with SMTP; 19 Sep 2007 01:50:54 -0000\r\nReceived: from [216.252.122.217] by n10.bullet.sp1.yahoo.com with NNFMP; 19 Sep 2007 01:49:12 -0000\r\nReceived: from [69.147.84.99] by t2.bullet.sp1.yahoo.com with NNFMP; 19 Sep 2007 01:49:12 -0000\r\nReceived: from [127.0.0.1] by as606.mail.sp1.yahoo.com with NNFMP; 19 Sep 2007 01:49:12 -0000\r\nX-Yahoo-Newman-Property: groups-system\r\nX-Yahoo-Newman-Id: 417847.8250.bm@...\r\nReceived: (qmail 82023 invoked by uid 60001); 19 Sep 2007 01:49:12 -0000\r\nX-YMail-OSG: JeerNHQVM1kbGbDSHnJpRcKTWcNpnJK67vnpujFX\r\nReceived: from [202.101.116.155] by web45501.mail.sp1.yahoo.com via HTTP; Tue, 18 Sep 2007 18:49:11 PDT\r\nDate: Tue, 18 Sep 2007 18:49:11 -0700 (PDT)\r\nTo: archive-crawler@yahoogroups.com\r\nIn-Reply-To: &lt;46F04E39.8060504@...&gt;\r\nMIME-Version: 1.0\r\nContent-Type: multipart/alternative; boundary=&quot;0-1522537890-1190166551=:81427&quot;\r\nContent-Transfer-Encoding: 8bit\r\nMessage-ID: &lt;223381.81427.qm@...&gt;\r\nX-eGroups-Msg-Info: 1:6:0:0\r\nFrom: nick zhang &lt;nickzwk@...&gt;\r\nSubject: Re: [archive-crawler] Extend QueueAssignmentPolicy\r\nX-Yahoo-Group-Post: member; u=323364166; y=eUu3VqPgvRDh0AIb6ZzR-USW0dzlxnwyyMMiAJKZjxrYfQ\r\nX-Yahoo-Profile: nickzwk\r\nX-eGroups-Approved-By: gojomo &lt;gojomo@...&gt; via web; 19 Sep 2007 04:11:16 -0000\r\n\r\n\r\n--0-1522537890-1190166551=:81427\r\nContent-Type: text/plain; charset=iso-8859-1\r\nContent-Transfer-Encoding: 8bit\r\n\r\nMr.Mohr,\n   \n  From your response,NicknameQueueAssignmentPolicy will be problematic,\n  And I understand why the download speed initially-fast and then very-slow.\n  Your suggestion is the same host should in a queue.\n   \n  But my question is if there are 20 thousand URLS download in the same queue,\n  and there is just one active thread,I can&#39;t estimate the time to finished it.\n   \n  And there are different QueueAssignmentPolicy in the Heritrix WebUI ,but i don&#39;t know\n  in what case i should use different QueueAssignmentPolicy.Could you give me some \n  advise,\n   \n  thanks for your mail,i learn a lot from it ,\n   \n  I&#39;m looking froword to your answer,\n   \n  Best wishes\n   \n   \n  \n\nGordon Mohr &lt;gojomo@...&gt; wrote:\n          Nick,\n\nFrom your later message, I assume you succeeded in making your \nNicknameQueueAssignmentPolicy appear in the web UI. (FYI, it is not \nnecessary to edit AbstractFrontier. You can do this just by providing a \nwhitespace-delimited list of implementation classes in the property \n&#39;org.archive.crawler.frontier.AbstractFrontier.queue-assignment-policy&#39;. )\n\nA QueueAssignmentPolicy which splits the content of a single host into \nseparate queues can be problematic. Heritrix generally assumes that all \nURIs from the same host land in the same queue.\n\nA basic form of politeness to others&#39; sites, opening only a single \nconnection at once, comes naturally from this assumption.\n\nAlso, the common need to request certain prerequisite URIs (DNS and \nrobots fetches) before anything else is accomplished by pushing these at \nthe top of the same-host queue. Then, they are guaranteed to finish -- \nsucceed or fail -- before other URIs on the same host are tried.\n\nIf different URIs from the same host land in different queues, the \nprerequisites might be redundantly scheduled or not finished when other \nURIs are tried, or a site might be overloaded with traffic via multiple \nconnections. Only if you are sure the site can handle the load, for \nexample it is your own site, should you risk generating such traffic.\n\nRegarding your specific policy:\n\nPrior QueueAssignmentPolicies have typically loaded multiple hosts into \na single queue, rather than splitting one host over many queues.\n\nI suspect if you&#39;re seeing an initially-fast but then-very-slow effect \nwith your custom policy, that some of your queues have, as their topmost \nitems, unfetchable URIs. Certain kinds of failed-fetches go into a \nslow-timeout retry-cycle, and while a URI is in this cycle, nothing else \nfrom the same queue will be tried. This is a reasonable approach when \nall URIs in a queue are subject to the same network failures, but can \ncause problems if the queues are mixed, and the deeper URIs would \nsucceed quickly, but are stuck behind topmost URIs.\n\nYou may wish to change your policy so that no URIs on different hosts \nland in the same queue. Still, this may not work, or may create problems \nas described above, because your custom policy is operating outside the \nassumptions of Heritrix.\n\n- Gordon @ IA\n\nnickzwk wrote:\n&gt; i wanted to extend QueueAssignmentPolicy\n&gt; i create my own QueueAssignmentPolicy NicknameQueueAssignmentPolicy\n&gt; /* NicknameQueueAssignmentPolicy\n&gt; *\n&gt; * $Id: HostnameQueueAssignmentPolicy.java 3838 2005-09-21 23:00:47Z \n&gt; gojomo $\n&gt; *\n&gt; * Created on Oct 5, 2004\n&gt; *\n&gt; * Copyright (C) 2004 Internet Archive.\n&gt; *\n&gt; * This file is part of the Heritrix web crawler (crawler.archive.org).\n&gt; *\n&gt; * Heritrix is free software; you can redistribute it and/or modify\n&gt; * it under the terms of the GNU Lesser Public License as published by\n&gt; * the Free Software Foundation; either version 2.1 of the License, or\n&gt; * any later version.\n&gt; *\n&gt; * Heritrix is distributed in the hope that it will be useful,\n&gt; * but WITHOUT ANY WARRANTY; without even the implied warranty of\n&gt; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n&gt; * GNU Lesser Public License for more details.\n&gt; *\n&gt; * You should have received a copy of the GNU Lesser Public License\n&gt; * along with Heritrix; if not, write to the Free Software\n&gt; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-\n&gt; 1307 USA\n&gt; */ \n&gt; package org.archive.crawler.frontier;\n&gt; \n&gt; import java.util.logging.Logger;\n&gt; import org.archive.crawler.datamodel.CandidateURI;\n&gt; import org.archive.crawler.framework.CrawlController;\n&gt; \n&gt; \n&gt; /**\n&gt; * QueueAssignmentPolicy based on the hostname:port evident in the \n&gt; given\n&gt; * CrawlURI.\n&gt; * \n&gt; * @author nick\n&gt; */\n&gt; public class NicknameQueueAssignmentPolicy extends \n&gt; QueueAssignmentPolicy {\n&gt; private static final Logger logger = Logger\n&gt; .getLogger(NicknameQueueAssignmentPolicy.class.getName());\n&gt; /**\n&gt; * \n&gt; */\n&gt; public String getClassKey(CrawlController controller, \n&gt; CandidateURI cauri) {\n&gt; String uri = cauri.getUURI().toString();\n&gt; long hash = ELFHash(uri);\n&gt; String a = Long.toString(hash % 100);\n&gt; return a;\n&gt; }\n&gt; public long ELFHash(String str)\n&gt; {\n&gt; long hash = 0;\n&gt; long x = 0;\n&gt; for(int i = 0; i &lt; str.length(); i++)\n&gt; {\n&gt; hash = (hash &lt;&lt; 4) + str.charAt(i);\n&gt; if((x = hash & 0xF0000000L) != 0)\n&gt; {\n&gt; hash ^= (x &gt;&gt; 24);\n&gt; hash &= ~x;\n&gt; }\n&gt; }\n&gt; return (hash & 0x7FFFFFFF);\n&gt; }\n&gt; \n&gt; \n&gt; }\n&gt; \n&gt; my heritrix version is 1.12.1\n&gt; and i changed the AbstractFrontier as below:\n&gt; \n&gt; String queueStr = System.getProperty(AbstractFrontier.class.getName() \n&gt; +\n&gt; &quot;.&quot; + ATTR_QUEUE_ASSIGNMENT_POLICY,\n&gt; NicknameQueueAssignmentPolicy.class.getName() + &quot; &quot; +\n&gt; HostnameQueueAssignmentPolicy.class.getName() + &quot; &quot; +\n&gt; IPQueueAssignmentPolicy.class.getName() + &quot; &quot; +\n&gt; BucketQueueAssignmentPolicy.class.getName() + &quot; &quot; +\n&gt; SurtAuthorityQueueAssignmentPolicy.class.getName());\n&gt; Pattern p = Pattern.compile(&quot;&#92;&#92;s*,&#92;&#92;s*|&#92;&#92;s+&quot;);\n&gt; String [] queues = p.split(queueStr);\n&gt; if (queues.length &lt;= 0) {\n&gt; throw new RuntimeException(&quot;Failed parse of &quot; +\n&gt; &quot; assignment queue policy string: &quot; + queueStr);\n&gt; }\n&gt; t = addElementToDefinition(new SimpleType\n&gt; (ATTR_QUEUE_ASSIGNMENT_POLICY,\n&gt; &quot;Defines how to assign URIs to queues. Can assign by \n&gt; host, &quot; +\n&gt; &quot;by ip, and into one of a fixed set of buckets (1k).&quot;,\n&gt; queues[0], queues));\n&gt; t.setExpertSetting(true);\n&gt; t.setOverrideable(true);\n&gt; \n&gt; i also change the heritrix.properties as below:\n&gt; \n&gt; org.archive.crawler.frontier.AbstractFrontier.queue-assignment-policy \n&gt; = &#92;\n&gt; org.archive.crawler.frontier.NicknameQueueAssignmentPolicy &#92;\n&gt; org.archive.crawler.frontier.HostnameQueueAssignmentPolicy &#92;\n&gt; org.archive.crawler.frontier.IPQueueAssignmentPolicy &#92;\n&gt; org.archive.crawler.frontier.BucketQueueAssignmentPolicy &#92;\n&gt; org.archive.crawler.frontier.SurtAuthorityQueueAssignmentPolicy \n&gt; org.archive.crawler.frontier.BdbFrontier.level = INFO\n&gt; \n&gt; but when reset the heritrix,i find the order.xml didn&#39;t accept my \n&gt; changes,\n&gt; &lt;newObject name=&quot;frontier&quot; \n&gt; class=&quot;org.archive.crawler.frontier.BdbFrontier&quot;&gt;\n&gt; &lt;float name=&quot;delay-factor&quot;&gt;5.0&lt;/float&gt;\n&gt; &lt;integer name=&quot;max-delay-ms&quot;&gt;30000&lt;/integer&gt;\n&gt; &lt;integer name=&quot;min-delay-ms&quot;&gt;3000&lt;/integer&gt;\n&gt; &lt;integer name=&quot;max-retries&quot;&gt;30&lt;/integer&gt;\n&gt; &lt;long name=&quot;retry-delay-seconds&quot;&gt;900&lt;/long&gt;\n&gt; &lt;integer name=&quot;preference-embed-hops&quot;&gt;1&lt;/integer&gt;\n&gt; &lt;integer name=&quot;total-bandwidth-usage-KB-sec&quot;&gt;0&lt;/integer&gt;\n&gt; &lt;integer name=&quot;max-per-host-bandwidth-usage-KB-sec&quot;&gt;0&lt;/integer&gt;\n&gt; &lt;string name=&quot;queue-assignment-\n&gt; policy&quot;&gt;org.archive.crawler.frontier.HostnameQueueAssignmentPolicy&lt;/st\n&gt; ring&gt;\n&gt; &lt;string name=&quot;force-queue-assignment&quot;&gt;&lt;/string&gt;\n&gt; &lt;boolean name=&quot;pause-at-start&quot;&gt;false&lt;/boolean&gt;\n&gt; &lt;boolean name=&quot;pause-at-finish&quot;&gt;false&lt;/boolean&gt;\n&gt; &lt;boolean name=&quot;source-tag-seeds&quot;&gt;false&lt;/boolean&gt;\n&gt; &lt;boolean name=&quot;recovery-log-enabled&quot;&gt;true&lt;/boolean&gt;\n&gt; &lt;boolean name=&quot;hold-queues&quot;&gt;true&lt;/boolean&gt;\n&gt; &lt;integer name=&quot;balance-replenish-amount&quot;&gt;3000&lt;/integer&gt;\n&gt; &lt;integer name=&quot;error-penalty-amount&quot;&gt;100&lt;/integer&gt;\n&gt; &lt;long name=&quot;queue-total-budget&quot;&gt;-1&lt;/long&gt;\n&gt; &lt;string name=&quot;cost-\n&gt; policy&quot;&gt;org.archive.crawler.frontier.UnitCostAssignmentPolicy&lt;/string&gt;\n&gt; &lt;long name=&quot;snooze-deactivate-ms&quot;&gt;300000&lt;/long&gt;\n&gt; &lt;integer name=&quot;target-ready-backlog&quot;&gt;50&lt;/integer&gt;\n&gt; &lt;string name=&quot;uri-included-\n&gt; structure&quot;&gt;org.archive.crawler.util.BdbUriUniqFilter&lt;/string&gt;\n&gt; &lt;/newObject&gt;\n&gt; \n&gt; i wonder how can i change the QueueAssignmentPolicy \n&gt; because when crawl one site,there is 1 active thread ,it is too slow \n&gt; and i want to speed heritrix \n&gt; i&#39;m looking forward to the answer\n&gt; \n&gt; \n&gt; \n&gt; \n&gt; Yahoo! Groups Links\n&gt; \n&gt; \n&gt; \n\n\n\n                         \n\n       \n---------------------------------\nBoardwalk for $500? In 2007? Ha! \nPlay Monopoly Here and Now (it&#39;s updated for today&#39;s economy) at Yahoo! Games.\r\n--0-1522537890-1190166551=:81427\r\nContent-Type: text/html; charset=iso-8859-1\r\nContent-Transfer-Encoding: 8bit\r\n\r\n&lt;div&gt;Mr.Mohr,&lt;/div&gt;  &lt;div&gt;&nbsp;&lt;/div&gt;  &lt;div&gt;From your response,NicknameQueueAssignmentPolicy will be problematic,&lt;/div&gt;  &lt;div&gt;And I understand why the download speed initially-fast and then very-slow.&lt;/div&gt;  &lt;div&gt;Your suggestion is the same host should in a queue.&lt;/div&gt;  &lt;div&gt;&nbsp;&lt;/div&gt;  &lt;div&gt;But my question is if there are 20 thousand URLS download in the same queue,&lt;/div&gt;  &lt;div&gt;and there is just one active thread,I can&#39;t estimate the time to finished it.&lt;/div&gt;  &lt;div&gt;&nbsp;&lt;/div&gt;  &lt;div&gt;And there are different QueueAssignmentPolicy in the Heritrix WebUI ,but i don&#39;t know&lt;/div&gt;  &lt;div&gt;in what case i should use different QueueAssignmentPolicy.Could you give me some &lt;/div&gt;  &lt;div&gt;advise,&lt;/div&gt;  &lt;div&gt;&nbsp;&lt;/div&gt;  &lt;div&gt;thanks for your mail,i learn a lot from it ,&lt;/div&gt;  &lt;div&gt;&nbsp;&lt;/div&gt;  &lt;div&gt;I&#39;m looking froword to your answer,&lt;/div&gt;  &lt;div&gt;&nbsp;&lt;/div&gt;  &lt;div&gt;Best wishes&lt;/div&gt;  &lt;div&gt;&nbsp;&lt;/div&gt;  &lt;div&gt;&nbsp;&lt;/div&gt;  &lt;div&gt;&lt;BR&gt;&lt;BR&gt;&lt;B&gt;&lt;I&gt;Gordon Mohr\n &lt;gojomo@...&gt;&lt;/I&gt;&lt;/B&gt; wrote:&lt;/div&gt;  &lt;BLOCKQUOTE class=replbq style=&quot;PADDING-LEFT: 5px; MARGIN-LEFT: 5px; BORDER-LEFT: #1010ff 2px solid&quot;&gt;  &lt;DIV id=ygrp-text&gt;  &lt;div&gt;Nick,&lt;BR&gt;&lt;BR&gt;From your later message, I assume you succeeded in making your &lt;BR&gt;NicknameQueueAssign&lt;WBR&gt;mentPolicy appear in the web UI. (FYI, it is not &lt;BR&gt;necessary to edit AbstractFrontier. You can do this just by providing a &lt;BR&gt;whitespace-delimite&lt;WBR&gt;d list of implementation classes in the property &lt;BR&gt;&#39;org.archive.&lt;WBR&gt;crawler.frontier&lt;WBR&gt;.AbstractFrontie&lt;WBR&gt;r.queue-assignme&lt;WBR&gt;nt-policy&#39;&lt;WBR&gt;. )&lt;BR&gt;&lt;BR&gt;A QueueAssignmentPoli&lt;WBR&gt;cy which splits the content of a single host into &lt;BR&gt;separate queues can be problematic.\n Heritrix generally assumes that all &lt;BR&gt;URIs from the same host land in the same queue.&lt;BR&gt;&lt;BR&gt;A basic form of politeness to others&#39; sites, opening only a single &lt;BR&gt;connection at once, comes naturally from this assumption.&lt;BR&gt;&lt;BR&gt;Also, the common need to request certain prerequisite URIs (DNS and &lt;BR&gt;robots fetches) before anything else is accomplished by pushing these at &lt;BR&gt;the top of the same-host queue. Then, they are guaranteed to finish -- &lt;BR&gt;succeed or fail -- before other URIs on the same host are tried.&lt;BR&gt;&lt;BR&gt;If different URIs from the same host land in different queues, the &lt;BR&gt;prerequisites might be redundantly scheduled or not finished when other &lt;BR&gt;URIs are tried, or a site might be overloaded with traffic via multiple &lt;BR&gt;connections. Only if you are sure the site can handle the load, for &lt;BR&gt;example it is your own site, should you risk generating such traffic.&lt;BR&gt;&lt;BR&gt;Regarding your specific policy:&lt;BR&gt;&lt;BR&gt;Prior QueueAssignmentPoli&lt;WBR&gt;cies have typically\n loaded multiple hosts into &lt;BR&gt;a single queue, rather than splitting one host over many queues.&lt;BR&gt;&lt;BR&gt;I suspect if you&#39;re seeing an initially-fast but then-very-slow effect &lt;BR&gt;with your custom policy, that some of your queues have, as their topmost &lt;BR&gt;items, unfetchable URIs. Certain kinds of failed-fetches go into a &lt;BR&gt;slow-timeout retry-cycle, and while a URI is in this cycle, nothing else &lt;BR&gt;from the same queue will be tried. This is a reasonable approach when &lt;BR&gt;all URIs in a queue are subject to the same network failures, but can &lt;BR&gt;cause problems if the queues are mixed, and the deeper URIs would &lt;BR&gt;succeed quickly, but are stuck behind topmost URIs.&lt;BR&gt;&lt;BR&gt;You may wish to change your policy so that no URIs on different hosts &lt;BR&gt;land in the same queue. Still, this may not work, or may create problems &lt;BR&gt;as described above, because your custom policy is operating outside the &lt;BR&gt;assumptions of Heritrix.&lt;BR&gt;&lt;BR&gt;- Gordon @ IA&lt;BR&gt;&lt;BR&gt;nickzwk wrote:&lt;BR&gt;&gt; i\n wanted to extend QueueAssignmentPoli&lt;WBR&gt;cy&lt;BR&gt;&gt; i create my own QueueAssignmentPoli&lt;WBR&gt;cy NicknameQueueAssign&lt;WBR&gt;mentPolicy&lt;BR&gt;&gt; /* NicknameQueueAssign&lt;WBR&gt;mentPolicy&lt;BR&gt;&gt; *&lt;BR&gt;&gt; * $Id: HostnameQueueAssign&lt;WBR&gt;mentPolicy.&lt;WBR&gt;java 3838 2005-09-21 23:00:47Z &lt;BR&gt;&gt; gojomo $&lt;BR&gt;&gt; *&lt;BR&gt;&gt; * Created on Oct 5, 2004&lt;BR&gt;&gt; *&lt;BR&gt;&gt; * Copyright (C) 2004 Internet Archive.&lt;BR&gt;&gt; *&lt;BR&gt;&gt; * This file is part of the Heritrix web crawler (crawler.archive.&lt;WBR&gt;org).&lt;BR&gt;&gt; *&lt;BR&gt;&gt; * Heritrix is free software; you can redistribute it and/or modify&lt;BR&gt;&gt; * it under the terms of the GNU Lesser Public License as published by&lt;BR&gt;&gt; * the Free Software Foundation; either version 2.1 of the License, or&lt;BR&gt;&gt; * any later version.&lt;BR&gt;&gt; *&lt;BR&gt;&gt; * Heritrix is distributed in the hope that it will be useful,&lt;BR&gt;&gt; * but WITHOUT ANY WARRANTY; without even the implied warranty of&lt;BR&gt;&gt; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the&lt;BR&gt;&gt; *\n GNU Lesser Public License for more details.&lt;BR&gt;&gt; *&lt;BR&gt;&gt; * You should have received a copy of the GNU Lesser Public License&lt;BR&gt;&gt; * along with Heritrix; if not, write to the Free Software&lt;BR&gt;&gt; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-&lt;BR&gt;&gt; 1307 USA&lt;BR&gt;&gt; */ &lt;BR&gt;&gt; package org.archive.&lt;WBR&gt;crawler.frontier&lt;WBR&gt;;&lt;BR&gt;&gt; &lt;BR&gt;&gt; import java.util.logging.&lt;WBR&gt;Logger;&lt;BR&gt;&gt; import org.archive.&lt;WBR&gt;crawler.datamode&lt;WBR&gt;l.CandidateURI;&lt;BR&gt;&gt; import org.archive.&lt;WBR&gt;crawler.framewor&lt;WBR&gt;k.CrawlControlle&lt;WBR&gt;r;&lt;BR&gt;&gt; &lt;BR&gt;&gt; &lt;BR&gt;&gt; /**&lt;BR&gt;&gt; * QueueAssignmentPoli&lt;WBR&gt;cy based on the hostname:port evident in the &lt;BR&gt;&gt; given&lt;BR&gt;&gt; * CrawlURI.&lt;BR&gt;&gt; * &lt;BR&gt;&gt; * @author nick&lt;BR&gt;&gt; */&lt;BR&gt;&gt; public class NicknameQueueAssign&lt;WBR&gt;mentPolicy extends &lt;BR&gt;&gt; QueueAssignmentPoli&lt;WBR&gt;cy {&lt;BR&gt;&gt; private static final Logger logger = Logger&lt;BR&gt;&gt;\n .getLogger(Nickname&lt;WBR&gt;QueueAssignmentP&lt;WBR&gt;olicy.class.&lt;WBR&gt;getName()&lt;WBR&gt;);&lt;BR&gt;&gt; /**&lt;BR&gt;&gt; * &lt;BR&gt;&gt; */&lt;BR&gt;&gt; public String getClassKey(&lt;WBR&gt;CrawlController controller, &lt;BR&gt;&gt; CandidateURI cauri) {&lt;BR&gt;&gt; String uri = cauri.getUURI(&lt;WBR&gt;).toString(&lt;WBR&gt;);&lt;BR&gt;&gt; long hash = ELFHash(uri)&lt;WBR&gt;;&lt;BR&gt;&gt; String a = Long.toString(&lt;WBR&gt;hash % 100);&lt;BR&gt;&gt; return a;&lt;BR&gt;&gt; }&lt;BR&gt;&gt; public long ELFHash(String str)&lt;BR&gt;&gt; {&lt;BR&gt;&gt; long hash = 0;&lt;BR&gt;&gt; long x = 0;&lt;BR&gt;&gt; for(int i = 0; i &lt; str.length()&lt;WBR&gt;; i++)&lt;BR&gt;&gt; {&lt;BR&gt;&gt; hash = (hash &lt;&lt; 4) + str.charAt(i)&lt;WBR&gt;;&lt;BR&gt;&gt; if((x = hash &amp; 0xF0000000L) != 0)&lt;BR&gt;&gt; {&lt;BR&gt;&gt; hash ^= (x &gt;&gt; 24);&lt;BR&gt;&gt; hash &amp;= ~x;&lt;BR&gt;&gt; }&lt;BR&gt;&gt; }&lt;BR&gt;&gt; return (hash &amp; 0x7FFFFFFF);&lt;BR&gt;&gt; }&lt;BR&gt;&gt; &lt;BR&gt;&gt; &lt;BR&gt;&gt; }&lt;BR&gt;&gt; &lt;BR&gt;&gt; my heritrix version is 1.12.1&lt;BR&gt;&gt; and i changed the AbstractFrontier as below:&lt;BR&gt;&gt; &lt;BR&gt;&gt; String queueStr =\n System.getProperty(&lt;WBR&gt;AbstractFrontier&lt;WBR&gt;.class.getName(&lt;WBR&gt;) &lt;BR&gt;&gt; +&lt;BR&gt;&gt; &quot;.&quot; + ATTR_QUEUE_ASSIGNME&lt;WBR&gt;NT_POLICY,&lt;BR&gt;&gt; NicknameQueueAssign&lt;WBR&gt;mentPolicy.&lt;WBR&gt;class.getName(&lt;WBR&gt;) + &quot; &quot; +&lt;BR&gt;&gt; HostnameQueueAssign&lt;WBR&gt;mentPolicy.&lt;WBR&gt;class.getName(&lt;WBR&gt;) + &quot; &quot; +&lt;BR&gt;&gt; IPQueueAssignmentPo&lt;WBR&gt;licy.class.&lt;WBR&gt;getName() + &quot; &quot; +&lt;BR&gt;&gt; BucketQueueAssignme&lt;WBR&gt;ntPolicy.&lt;WBR&gt;class.getName(&lt;WBR&gt;) + &quot; &quot; +&lt;BR&gt;&gt; SurtAuthorityQueueA&lt;WBR&gt;ssignmentPolicy.&lt;WBR&gt;class.getName(&lt;WBR&gt;));&lt;BR&gt;&gt; Pattern p = Pattern.compile(&lt;WBR&gt;&quot;&#92;&#92;s*,&#92;&#92;s*&lt;WBR&gt;|&#92;&#92;s+&quot;);&lt;BR&gt;&gt; String [] queues = p.split(queueStr)&lt;WBR&gt;;&lt;BR&gt;&gt; if (queues.length &lt;= 0) {&lt;BR&gt;&gt; throw new RuntimeException(&lt;WBR&gt;&quot;Failed parse of &quot; +&lt;BR&gt;&gt; &quot; assignment queue policy string: &quot; + queueStr);&lt;BR&gt;&gt; }&lt;BR&gt;&gt; t = addElementToDefinit&lt;WBR&gt;ion(new SimpleType&lt;BR&gt;&gt; (ATTR_QUEUE_&lt;WBR&gt;ASSIGNMENT_&lt;WBR&gt;POLICY,&lt;BR&gt;&gt; &quot;Defines how to assign URIs to queues. Can assign by &lt;BR&gt;&gt; host, &quot; +&lt;BR&gt;&gt; &quot;by ip, and into\n one of a fixed set of buckets (1k).&quot;,&lt;BR&gt;&gt; queues[0], queues));&lt;BR&gt;&gt; t.setExpertSetting(&lt;WBR&gt;true);&lt;BR&gt;&gt; t.setOverrideable(&lt;WBR&gt;true);&lt;BR&gt;&gt; &lt;BR&gt;&gt; i also change the heritrix.properties as below:&lt;BR&gt;&gt; &lt;BR&gt;&gt; org.archive.&lt;WBR&gt;crawler.frontier&lt;WBR&gt;.AbstractFrontie&lt;WBR&gt;r.queue-assignme&lt;WBR&gt;nt-policy &lt;BR&gt;&gt; = &#92;&lt;BR&gt;&gt; org.archive.&lt;WBR&gt;crawler.frontier&lt;WBR&gt;.NicknameQueueAs&lt;WBR&gt;signmentPolicy &#92;&lt;BR&gt;&gt; org.archive.&lt;WBR&gt;crawler.frontier&lt;WBR&gt;.HostnameQueueAs&lt;WBR&gt;signmentPolicy &#92;&lt;BR&gt;&gt; org.archive.&lt;WBR&gt;crawler.frontier&lt;WBR&gt;.IPQueueAssignme&lt;WBR&gt;ntPolicy &#92;&lt;BR&gt;&gt; org.archive.&lt;WBR&gt;crawler.frontier&lt;WBR&gt;.BucketQueueAssi&lt;WBR&gt;gnmentPolicy &#92;&lt;BR&gt;&gt; org.archive.&lt;WBR&gt;crawler.frontier&lt;WBR&gt;.SurtAuthorityQu&lt;WBR&gt;eueAssignmentPol&lt;WBR&gt;icy &lt;BR&gt;&gt; org.archive.&lt;WBR&gt;crawler.frontier&lt;WBR&gt;.BdbFrontier.&lt;WBR&gt;level = INFO&lt;BR&gt;&gt; &lt;BR&gt;&gt; but when reset the heritrix,i find the order.xml didn&#39;t accept my &lt;BR&gt;&gt; changes,&lt;BR&gt;&gt; &lt;newObject name=&quot;frontier&quot; &lt;BR&gt;&gt;\n class=&quot;org.archive.&lt;WBR&gt;crawler.frontier&lt;WBR&gt;.BdbFrontier&quot;&lt;WBR&gt;&gt;&lt;BR&gt;&gt; &lt;float name=&quot;delay-&lt;WBR&gt;factor&quot;&gt;5.&lt;WBR&gt;0&lt;/float&gt;&lt;BR&gt;&gt; &lt;integer name=&quot;max-delay-&lt;WBR&gt;ms&quot;&gt;30000&lt;&lt;WBR&gt;/integer&gt;&lt;BR&gt;&gt; &lt;integer name=&quot;min-delay-&lt;WBR&gt;ms&quot;&gt;3000&lt;&lt;WBR&gt;/integer&gt;&lt;BR&gt;&gt; &lt;integer name=&quot;max-retries&quot;&lt;WBR&gt;&gt;30&lt;/integer&gt;&lt;BR&gt;&gt; &lt;long name=&quot;retry-&lt;WBR&gt;delay-seconds&quot;&lt;WBR&gt;&gt;900&lt;/long&gt;&lt;BR&gt;&gt; &lt;integer name=&quot;preference-&lt;WBR&gt;embed-hops&quot;&lt;WBR&gt;&gt;1&lt;/integer&gt;&lt;BR&gt;&gt; &lt;integer name=&quot;total-&lt;WBR&gt;bandwidth-&lt;WBR&gt;usage-KB-&lt;WBR&gt;sec&quot;&gt;0&lt;/integer&gt;&lt;BR&gt;&gt; &lt;integer name=&quot;max-per-&lt;WBR&gt;host-bandwidth-&lt;WBR&gt;usage-KB-&lt;WBR&gt;sec&quot;&gt;0&lt;/integer&gt;&lt;BR&gt;&gt; &lt;string name=&quot;queue-&lt;WBR&gt;assignment-&lt;BR&gt;&gt; policy&quot;&gt;org.&lt;WBR&gt;archive.crawler.&lt;WBR&gt;frontier.&lt;WBR&gt;HostnameQueueAss&lt;WBR&gt;ignmentPolicy&lt;&lt;WBR&gt;/st&lt;BR&gt;&gt; ring&gt;&lt;BR&gt;&gt; &lt;string name=&quot;force-&lt;WBR&gt;queue-assignment&lt;WBR&gt;&quot;&gt;&lt;/string&gt;&lt;BR&gt;&gt; &lt;boolean\n name=&quot;pause-&lt;WBR&gt;at-start&quot;&lt;WBR&gt;&gt;false&lt;/boolean&gt;&lt;BR&gt;&gt; &lt;boolean name=&quot;pause-&lt;WBR&gt;at-finish&quot;&lt;WBR&gt;&gt;false&lt;/boolean&gt;&lt;BR&gt;&gt; &lt;boolean name=&quot;source-&lt;WBR&gt;tag-seeds&quot;&lt;WBR&gt;&gt;false&lt;/boolean&gt;&lt;BR&gt;&gt; &lt;boolean name=&quot;recovery-&lt;WBR&gt;log-enabled&quot;&lt;WBR&gt;&gt;true&lt;/boolean&gt;&lt;BR&gt;&gt; &lt;boolean name=&quot;hold-queues&quot;&lt;WBR&gt;&gt;true&lt;/boolean&gt;&lt;BR&gt;&gt; &lt;integer name=&quot;balance-&lt;WBR&gt;replenish-&lt;WBR&gt;amount&quot;&gt;3000&lt;&lt;WBR&gt;/integer&gt;&lt;BR&gt;&gt; &lt;integer name=&quot;error-&lt;WBR&gt;penalty-amount&quot;&lt;WBR&gt;&gt;100&lt;/integer&gt;&lt;BR&gt;&gt; &lt;long name=&quot;queue-&lt;WBR&gt;total-budget&quot;&lt;WBR&gt;&gt;-1&lt;/long&gt;&lt;BR&gt;&gt; &lt;string name=&quot;cost-&lt;BR&gt;&gt; policy&quot;&gt;org.&lt;WBR&gt;archive.crawler.&lt;WBR&gt;frontier.&lt;WBR&gt;UnitCostAssignme&lt;WBR&gt;ntPolicy&lt;&lt;WBR&gt;/string&gt;&lt;BR&gt;&gt; &lt;long name=&quot;snooze-&lt;WBR&gt;deactivate-&lt;WBR&gt;ms&quot;&gt;300000&lt;&lt;WBR&gt;/long&gt;&lt;BR&gt;&gt; &lt;integer name=&quot;target-&lt;WBR&gt;ready-backlog&quot;&lt;WBR&gt;&gt;50&lt;/integer&gt;&lt;BR&gt;&gt; &lt;string name=&quot;uri-included-&lt;BR&gt;&gt;\n structure&quot;&gt;org.&lt;WBR&gt;archive.crawler.&lt;WBR&gt;util.BdbUriUniqF&lt;WBR&gt;ilter&lt;/string&gt;&lt;BR&gt;&gt; &lt;/newObject&gt;&lt;BR&gt;&gt; &lt;BR&gt;&gt; i wonder how can i change the QueueAssignmentPoli&lt;WBR&gt;cy &lt;BR&gt;&gt; because when crawl one site,there is 1 active thread ,it is too slow &lt;BR&gt;&gt; and i want to speed heritrix &lt;BR&gt;&gt; i&#39;m looking forward to the answer&lt;BR&gt;&gt; &lt;BR&gt;&gt; &lt;BR&gt;&gt; &lt;BR&gt;&gt; &lt;BR&gt;&gt; Yahoo! Groups Links&lt;BR&gt;&gt; &lt;BR&gt;&gt; &lt;BR&gt;&gt; &lt;BR&gt;&lt;BR&gt;&lt;/div&gt;&lt;/DIV&gt;&lt;!--End group email --&gt;&lt;/BLOCKQUOTE&gt;&lt;BR&gt;&lt;p&gt;&#32;\n\n\n\n      &lt;hr size=1&gt;Boardwalk for $500? In 2007? Ha! &lt;br&gt;&lt;a href=&quot;http://us.rd.yahoo.com/evt=48223/*http://get.games.yahoo.com/proddesc?gamekey=monopolyherenow&quot;&gt;Play Monopoly Here and Now&lt;/a&gt; (it&#39;s updated for today&#39;s economy) at Yahoo! Games.\r\n--0-1522537890-1190166551=:81427--\r\n\n"}}