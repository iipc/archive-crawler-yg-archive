{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":168599281,"authorName":"stack@archive.org","from":"&quot;stack@...&quot; &lt;stack@...&gt;","profile":"stackarchiveorg","replyTo":"LIST","senderId":"WnXiNwKedDs9ZXED3B3kaewcEQP4VzmsT1wpg-Ddcr14G1ul0Q7KmhVGbKnpNLVv3kDSJFY6E6OjLnauPxkMNK0dWiFbym4MpbORYFqr","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Re: [archive-crawler] [Thoughts / Fixes] bugs 1507554,1517693","postDate":"1152654442","msgId":3041,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDQ0QjQxQzZBLjUwMzAzMDRAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PGIxM2YzZjA2MDYwNzEwMjEzM2gxNzg0OGRmY3BkNTBkYTFlYzdjYjQ2MjBlQG1haWwuZ21haWwuY29tPg==","referencesHeader":"PGIxM2YzZjA2MDYwNzA5MTQyN2czYmZkMTgyMXlhYmE5MTZjZDE5NmJkZTc1QG1haWwuZ21haWwuY29tPgkgPDQ0QjI5RUY5LjkwNDA4MDRAYXJjaGl2ZS5vcmc+IDw0NEIyREQ4MC43MDUwODA3QGFyY2hpdmUub3JnPiA8YjEzZjNmMDYwNjA3MTAyMTMzaDE3ODQ4ZGZjcGQ1MGRhMWVjN2NiNDYyMGVAbWFpbC5nbWFpbC5jb20+"},"prevInTopic":3040,"nextInTopic":3048,"prevInTime":3040,"nextInTime":3042,"topicId":3026,"numMessagesInTopic":10,"msgSnippet":"... This would be a nice addition. ... I can add apache commons-lang to Heritrix if you d like. ","rawEmail":"Return-Path: &lt;stack@...&gt;\r\nX-Sender: stack@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 3375 invoked from network); 11 Jul 2006 22:44:19 -0000\r\nReceived: from unknown (66.218.66.172)\n  by m29.grp.scd.yahoo.com with QMQP; 11 Jul 2006 22:44:19 -0000\r\nReceived: from unknown (HELO mail.archive.org) (207.241.227.188)\n  by mta4.grp.scd.yahoo.com with SMTP; 11 Jul 2006 22:44:18 -0000\r\nReceived: from localhost (localhost [127.0.0.1])\n\tby mail.archive.org (Postfix) with ESMTP id 9ABE414156C0D;\n\tTue, 11 Jul 2006 15:44:19 -0700 (PDT)\r\nReceived: from mail.archive.org ([127.0.0.1])\n\tby localhost (mail.archive.org [127.0.0.1]) (amavisd-new, port 10024)\n\twith LMTP id 24164-02-9; Tue, 11 Jul 2006 15:44:18 -0700 (PDT)\r\nReceived: from [192.168.1.19] (dns.duboce.net [63.203.238.114])\n\tby mail.archive.org (Postfix) with ESMTP id 5716B14156C06;\n\tTue, 11 Jul 2006 15:44:18 -0700 (PDT)\r\nMessage-ID: &lt;44B41C6A.5030304@...&gt;\r\nDate: Tue, 11 Jul 2006 14:47:22 -0700\r\nUser-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.0.1) Gecko/20060130 SeaMonkey/1.0\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;b13f3f060607091427g3bfd1821yaba916cd196bde75@...&gt;\t &lt;44B29EF9.9040804@...&gt; &lt;44B2DD80.7050807@...&gt; &lt;b13f3f060607102133h17848dfcpd50da1ec7cb4620e@...&gt;\r\nIn-Reply-To: &lt;b13f3f060607102133h17848dfcpd50da1ec7cb4620e@...&gt;\r\nContent-Type: multipart/mixed;\n boundary=&quot;------------030804080509050804050809&quot;\r\nX-Virus-Scanned: Debian amavisd-new at archive.org\r\nX-eGroups-Msg-Info: 1:0:0:0\r\nFrom: &quot;stack@...&quot; &lt;stack@...&gt;\r\nSubject: Re: [archive-crawler] [Thoughts / Fixes] bugs 1507554,1517693\r\nX-Yahoo-Group-Post: member; u=168599281; y=sncihh8hg9NMciOLCbi2nwpDLpS1qcmDp-EynuKfK9ohTMZqlZ595Vq_\r\nX-Yahoo-Profile: stackarchiveorg\r\n\r\n\r\n--------------030804080509050804050809\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\n\r\nYousef Ourabi wrote:\n&gt;\n&gt; Will, St.Ack, and Igor:\n&gt;\n&gt; Thanks for the input! The context for the eager link detection makes \n&gt; more sense now (from the archival point of view). I&#39;ve made \n&gt; overly-eager-link-detection and ignore-unexpected-html (there was a to \n&gt; do for it so I knocked it off) configurable via the UI under expert \n&gt; settings. This is the first step. What I plan on doing in the future \n&gt; is having levels of eagerness.\n&gt;\n\n\n\n\n\n\n\n\n\nThis would be a nice addition.\n\n....\n&gt;\n&gt;\n&gt;\n&gt; I&#39;m still pondering the most elegant / practical way of using the \n&gt; Translate class from the htmlParser project as Will suggested. I&#39;m \n&gt; kind of adverse to importing three new classes which would be the \n&gt; fastest (human time wise -- and then descapeHtmlForUri would just be a \n&gt; facade for Translate.decode() ) -- and copying and pasting the method \n&gt; is a bit sloppy. I&#39;ll submit that patch tomorrow evening. In any case \n&gt; I&#39;m pretty sure the descapeHtmlForUri method signature will remain \n&gt; unchanged so I&#39;ve left that in ExtractorHTML.\n&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\nI can add apache commons-lang to Heritrix if you&#39;d like.  \nhttp://jakarta.apache.org/commons/lang/api-release/org/apache/commons/lang/StringEscapeUtils.html#unescapeHtml(java.lang.String).  \nIts about 200k which is kinda big but has loads of utility we could make \nuse of elsewhere (I took a look at the implementation.  Looks grand)\n\nIn the past, addressing a similar issue in nutch, I first did a \nlookahead to see if String had HTML entity encodings present before \nhanding it off to a decoder (Nutch has one built-in).  I&#39;ve attached my \nold code.  The lookahead was to avoid creating new Strings if possible \n(It could have been done better. Once an Entity encoding was found, it \ngives complete String to decoder rather than just where the first Entity \nwas found).  Related, the ExtractorHTML does its best to not create \nobjects.  Its the Great Offender as far object creation is concerned in \nHeritrix, as can be expected.  Thats one reason its passing CharSequence \neverywhere.  What&#39;d be sweet would be a version of commons-lang \nStringEscapeUtils that took a CharSequence and only created a new \nString/CharSequence if entity encoding present (Or, would only invoke \ncommons-lang if entity encoding found).\n\nOtherwise, your patch looks good -- thanks for implementing the TODO -- \nexcept for this:\n\n@@ -220,6 +240,7 @@\n             assert start &gt;= 0: &quot;Start is: &quot; + start + &quot;, &quot; + curi;\n             assert end &gt;= 0: &quot;End is :&quot; + end + &quot;, &quot; + curi;\n             CharSequence value = cs.subSequence(start, end);\n+            value = TextUtils.descapeHtmlForURI(value.toString());\n             if (attr.start(2) &gt; -1) {\n                 // HREF\n                 CharSequence context =\n@@ -276,7 +297,7 @@\n\nIs the blanket decoding of the value CharSequence needed?  Especially \nconsidering it converts the CharSequence to String?  Can it be done only \nif there&#39;s a codebase match (regex group 6)?  Thats the only time the \nreplace of &amp; is currently done (Also, why the second call to descape \nif you&#39;ve dont it at the head of the if/else)?\n\nThanks for working on this Yousef.\n\nSt.Ack\n\r\n--------------030804080509050804050809\r\nContent-Type: text/plain;\n name=&quot;y.txt&quot;\r\nContent-Disposition: inline;\n filename=&quot;y.txt&quot;\r\n\r\n[ Attachment content not displayed ]\r\n--------------030804080509050804050809--\r\n\n"}}