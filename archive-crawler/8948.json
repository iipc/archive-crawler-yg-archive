{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":582247024,"authorName":"Colin Rosenthal","from":"Colin Rosenthal &lt;csr@...&gt;","replyTo":"LIST","senderId":"mKt6J6oPG2cihMVrmv7V_4m4F61Af2uJRpqvFLhHKmYFQ7Bq1YUhtUi9r3Sp2_C1mNOrf6RCcDUuit519O6_94Is","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Re: [archive-crawler] Pathological Regex Behaviour in MatchesListRegexDecideRule","postDate":"1538117521","msgId":8948,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDVCQURDRjkxLjkwMTA3MDhAa2IuZGs+","inReplyToHeader":"PDU2MWI1YzNkZmFmZTRhOGI4NzhmMDU5NDlhYTk0MWNiQGtiLmRrPg==","referencesHeader":"PDU2MWI1YzNkZmFmZTRhOGI4NzhmMDU5NDlhYTk0MWNiQGtiLmRrPg=="},"prevInTopic":8947,"nextInTopic":8949,"prevInTime":8947,"nextInTime":8949,"topicId":8947,"numMessagesInTopic":4,"msgSnippet":"Btw, if you don t believe me try running a crawl with a single seed: http://www.netarkivet.dk/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx and a single","rawEmail":"Return-Path: &lt;csr@...&gt;\r\nX-Sender: csr@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 6011 invoked by uid 102); 28 Sep 2018 06:52:08 -0000\r\nX-Received: from unknown (HELO mtaq4.grp.bf1.yahoo.com) (10.196.227.14)\n  by m9.grp.bf1.yahoo.com with SMTP; 28 Sep 2018 06:52:08 -0000\r\nX-Received: (qmail 25542 invoked from network); 28 Sep 2018 06:52:08 -0000\r\nX-Received: from unknown (HELO mta4002.groups.mail.bf1.yahoo.com) (10.201.195.45)\n  by mtaq4.grp.bf1.yahoo.com with SMTP; 28 Sep 2018 06:52:08 -0000\r\nX-Original-Return-Path: &lt;csr@...&gt;\r\nX-Received-SPF: pass (domain of kb.dk designates 89.104.206.35 as permitted sender)\r\nX-YMailISG: AE9wb8kWLDspQELYq_EGUF7p1NuNF7nUobzNtakfRITQDgm2\n WFcFbJYjvZroxDvZ7th.ChwycmF9iWPqdWS3SAsVW6k.c8BKltKLRgwCTIgH\n KAocARBZ_rSLsg1CzwYZjqHZ2.gR52oXZnWPjRcU_5ZXW2aEqMJHVTd.FCPx\n oNZL379kkZYLZ54MS7D7oduY9Mn6rjCJWy66lx93o0e3QBcy0X7OTX4TgTwe\n ceQPFd.3n4HThdMYEjj6aD3dkDmxexW7i9185D0_SZlbIPgNPvDsbgvp77XB\n YLe2aSFbIGUh_BYRfPyDBPg5bh5x_pmG3Gl8_RMbYt5jdscnUMPxlALHWVEd\n UaacJYybqizISt2uJu0Xcpm6_rHtqX8kKgP0CyTOwTmKZjgQjWk95ZWSud8w\n HS2uvYPfd7kTxxwpQjnCBzgmdapC.Wt65VP2py13iCl5wsODbpxj5N.r8btX\n 3dXrp8pmxuMZxS4bbBq2NcrjwABy7NmGb_JoU17x4sjBbUPU1WynlxBDW5_k\n JXf0GTzrbISASeNH9_kBR32b7T4FXn3NkCEp0KDTo2i_pLUEIyaroOdZZGR4\n BoVnzcpxkjgXI2pWE38wWlQhFTU62By_kMm4DS08cpCA22SEr_VeoPsiQwRM\n ZZxdLIGJ7FnfZ9T0Ad.58ZAvCMocpWO0auTS.NTForSiBD1lXA_JUICe1cN7\n I.NT7HwPluz03IGtbdYrRbbWJSLP0zcyz7Qd8Uli3_C2DbKo9mP95CeJ5rqu\n nevDTLRLUgBJ.DOq2EkQEl0hn4jZktavnbL5yMFVGWqv0VgMqagX8DcV.3wp\n vWY8C4LzGAwEI3_Lefs_qsBMDKL0JwryA5xYk6u5lpbBv3F1EByj5S5TGiYA\n SMGgZxv6PiLbUI2kLKVi.EkxPrYv0c2IaUX9KqkAMu1cKQ.TiovpiGAhUbh5\n pCyRT3RKX.42psjDIBCwLaJPQARVaP6vzlz6Vf_XyaJ0oedDWAg7id3V_v3x\n PtP50LMYtBjYoF6c5DApgQFPDnu9EdddNsG_S4ejge8tan0gh9K3wxai3Zjl\n eqpANLMOgouG4tug9E.4p3_005b_jUgygVfQywJe6Ov_.VNqK5XMGnrfRCFA\n cZTegY4WCqLawhJ8QzbIZi6.A9FyGk2LHiTo96A-\r\nAuthentication-Results: mta4002.groups.mail.bf1.yahoo.com  from=kb.dk; domainkeys=neutral (no sig);  from=kb.dk; dkim=neutral (no sig)\r\nX-Received: from 127.0.0.1  (EHLO smtp-out12.electric.net) (89.104.206.35)\n  by mta4002.groups.mail.bf1.yahoo.com with SMTPS; Fri, 28 Sep 2018 06:52:07 +0000\r\nX-Received: from 1g5md7-000Qxe-UZ by out12a.electric.net with emc1-ok (Exim 4.90_1)\n\t(envelope-from &lt;csr@...&gt;)\n\tid 1g5md7-000R1P-Vc\n\tfor archive-crawler@yahoogroups.com; Thu, 27 Sep 2018 23:52:01 -0700\r\nX-Received: by emcmailer; Thu, 27 Sep 2018 23:52:01 -0700\r\nX-Received: from [130.226.226.11] (helo=post.kb.dk)\n\tby out12a.electric.net with esmtp (Exim 4.90_1)\n\t(envelope-from &lt;csr@...&gt;)\n\tid 1g5md7-000Qxe-UZ\n\tfor archive-crawler@yahoogroups.com; Thu, 27 Sep 2018 23:52:01 -0700\r\nX-Received: from [172.18.100.202] (unknown [172.18.100.202])\n\tby post.kb.dk (Postfix) with ESMTP id 60B5F91F5B;\n\tFri, 28 Sep 2018 08:52:01 +0200 (CEST)\r\nMessage-ID: &lt;5BADCF91.9010708@...&gt;\r\nDate: Fri, 28 Sep 2018 08:52:01 +0200\r\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:31.0) Gecko/20100101 Thunderbird/31.1.2\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nCc: =?windows-1252?Q?K=E5re_Fiedler_Christiansen?= &lt;kfc@...&gt;, \n Jeppe Ravn-Grove &lt;jrg@...&gt;,\n =?windows-1252?Q?Knud_=C5ge_Hansen?= &lt;kaah@...&gt;\r\nReferences: &lt;561b5c3dfafe4a8b878f05949aa941cb@...&gt;\r\nIn-Reply-To: &lt;561b5c3dfafe4a8b878f05949aa941cb@...&gt;\r\nContent-Type: multipart/alternative;\n boundary=&quot;------------040008070504060604010406&quot;\r\nX-Outbound-IP: 130.226.226.11\r\nX-Env-From: csr@...\r\nX-Proto: esmtp\r\nX-Revdns: post-03.kb.dk\r\nX-HELO: post.kb.dk\r\nX-TLS: \r\nX-Authenticated_ID: \r\nX-PolicySMART: 10573177\r\nX-Virus-Status: Scanned by VirusSMART (c)\r\nX-Virus-Status: Scanned by VirusSMART (s)\r\nSubject: Re: [archive-crawler] Pathological Regex Behaviour in MatchesListRegexDecideRule\r\nX-Yahoo-Group-Post: member; u=582247024\r\nFrom: Colin Rosenthal &lt;csr@...&gt;\r\n\r\n\r\n--------------040008070504060604010406\r\nContent-Type: text/plain; charset=windows-1252; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\n\r\nBtw, if you don&#39;t believe me try running a crawl with a single seed:\n\nhttp://www.netarkivet.dk/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n\nand a single crawler-trap\n\nhttp://www&#92;.netarkivet&#92;.dk/((x+x+)+)y\n\n\n\n!\n/Colin\n\n\n\nOn 09/26/2018 08:02 AM, Colin Samuel Rosenthal csr@... \n[archive-crawler] wrote:\n&gt; This is a follow-up my recent email about hanging jobs. When we look at the ToeThreads on our hanging jobs, we often see a stacktrace like this:\n&gt;\n&gt;\n&gt;      java.util.regex.Pattern$Branch.match(Pattern.java:4604)\n&gt;      java.util.regex.Pattern$GroupHead.match(Pattern.java:4658)\n&gt;      .\n&gt;\n&gt;      .\n&gt;\n&gt;      .\n&gt;      java.util.regex.Pattern$Curly.match(Pattern.java:4234)\n&gt;      java.util.regex.Matcher.match(Matcher.java:1270)\n&gt;      java.util.regex.Matcher.matches(Matcher.java:604)\n&gt;      org.archive.modules.deciderules.MatchesListRegexDecideRule.evaluate(MatchesListRegexDecideRule.java:94)\n&gt;      org.archive.modules.deciderules.PredicatedDecideRule.innerDecide(PredicatedDecideRule.java:47)\n&gt;\n&gt; In other words the thread is taking forever to match a regex with a url.\n&gt;\n&gt;\n&gt; Our first thought was that was the code was using Java Pattern/Matcher in a non-threadsafe way. The actual code line (line 94 in MatchesListRegexDecideRule) is\n&gt;\n&gt; boolean matches = p.matcher(str).matches();\n&gt;\n&gt; but this looks ok. The Pattern (p) is reused across threads, but the Matcher p.matcher(str) is method local. So there shouldn&#39;t be a problem.\n&gt;\n&gt;\n&gt; A second possibility is that we have some pathological combination of uri and regex that just takes forever to evaluate. But in that case it should be easy to reproduce the problem, which we haven&#39;t been able to do.\n&gt;\n&gt;\n&gt; So we&#39;re still confused. I&#39;m thinking about modifying the code to place a timeout on the matches() call, but I&#39;d much rather understand the problem. Does anyone have any insights?\n&gt;\n&gt;\n&gt; cheers,\n&gt;\n&gt; Colin\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; --\n&gt; Colin Rosenthal PhD\n&gt; Senior IT Consultant\n&gt; Royal Danish Library (Aarhus)\n&gt;\n\n\n-- \nColin Rosenthal PhD\nSenior IT Consultant\nRoyal Danish Library (Aarhus)\n\n\r\n--------------040008070504060604010406\r\nContent-Type: text/html; charset=windows-1252\r\nContent-Transfer-Encoding: 7bit\r\n\r\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;meta content=&quot;text/html; charset=windows-1252&quot;\n      http-equiv=&quot;Content-Type&quot;&gt;\n  &lt;/head&gt;\n  &lt;body bgcolor=&quot;#FFFFFF&quot; text=&quot;#000000&quot;&gt;\n    &lt;div class=&quot;moz-cite-prefix&quot;&gt;Btw, if you don&#39;t believe me try\n      running a crawl with a single seed:&lt;br&gt;\n      &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;\n        charset=windows-1252&quot;&gt;\n      &lt;pre style=&quot;background-color:#ffffff;color:#000000;font-family:&#39;DejaVu Sans Mono&#39;;font-size:9.1pt;&quot;&gt;&lt;span style=&quot;color:#008000;font-weight:bold;&quot;&gt;&lt;a class=&quot;moz-txt-link-freetext&quot; href=&quot;http://www.netarkivet.dk/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;&gt;http://www.netarkivet.dk/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&lt;/a&gt;\n&lt;/span&gt;&lt;/pre&gt;\n      &lt;pre style=&quot;background-color:#ffffff;color:#000000;font-family:&#39;DejaVu Sans Mono&#39;;font-size:9.1pt;&quot;&gt;&lt;span style=&quot;color:#008000;font-weight:bold;&quot;&gt;and a single crawler-trap&lt;/span&gt;\n&lt;/pre&gt;\n      &lt;span style=&quot;color:#008000;font-weight:bold;&quot;&gt;&lt;/span&gt;\n      &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;\n        charset=windows-1252&quot;&gt;\n      &lt;pre&gt;&lt;span style=&quot;color:#008000;font-weight:bold;&quot;&gt;&lt;a class=&quot;moz-txt-link-freetext&quot; href=&quot;http://www&quot;&gt;http://www&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#000080;font-weight:bold;&quot;&gt;&#92;&lt;/span&gt;&lt;span style=&quot;color:#008000;font-weight:bold;&quot;&gt;.netarkivet&lt;/span&gt;&lt;span style=&quot;color:#000080;font-weight:bold;&quot;&gt;&#92;&lt;/span&gt;&lt;span style=&quot;color:#008000;font-weight:bold;&quot;&gt;.dk/((x+x+)+)y&lt;/span&gt;&lt;/pre&gt;\n      &lt;span style=&quot;color:#008000;font-weight:bold;&quot;&gt;&lt;br&gt;\n        &lt;br&gt;\n        !&lt;br&gt;\n        /Colin&lt;br&gt;\n      &lt;/span&gt;&lt;br&gt;\n      &lt;br&gt;\n      &lt;br&gt;\n      On 09/26/2018 08:02 AM, Colin Samuel Rosenthal &lt;a class=&quot;moz-txt-link-abbreviated&quot; href=&quot;mailto:csr@...&quot;&gt;csr@...&lt;/a&gt;\n      [archive-crawler] wrote:&lt;br&gt;\n    &lt;/div&gt;\n    &lt;blockquote cite=&quot;mid:561b5c3dfafe4a8b878f05949aa941cb@...&quot;\n      type=&quot;cite&quot;&gt;\n      &lt;pre wrap=&quot;&quot;&gt;This is a follow-up my recent email about hanging jobs. When we look at the ToeThreads on our hanging jobs, we often see a stacktrace like this:\n\n\n    java.util.regex.Pattern$Branch.match(Pattern.java:4604)\n    java.util.regex.Pattern$GroupHead.match(Pattern.java:4658)\n    .\n\n    .\n\n    .\n    java.util.regex.Pattern$Curly.match(Pattern.java:4234)\n    java.util.regex.Matcher.match(Matcher.java:1270)\n    java.util.regex.Matcher.matches(Matcher.java:604)\n    org.archive.modules.deciderules.MatchesListRegexDecideRule.evaluate(MatchesListRegexDecideRule.java:94)\n    org.archive.modules.deciderules.PredicatedDecideRule.innerDecide(PredicatedDecideRule.java:47)\n\nIn other words the thread is taking forever to match a regex with a url.\n\n\nOur first thought was that was the code was using Java Pattern/Matcher in a non-threadsafe way. The actual code line (line 94 in MatchesListRegexDecideRule) is\n\nboolean matches = p.matcher(str).matches();\n\nbut this looks ok. The Pattern (p) is reused across threads, but the Matcher p.matcher(str) is method local. So there shouldn&#39;t be a problem.\n\n\nA second possibility is that we have some pathological combination of uri and regex that just takes forever to evaluate. But in that case it should be easy to reproduce the problem, which we haven&#39;t been able to do.\n\n\nSo we&#39;re still confused. I&#39;m thinking about modifying the code to place a timeout on the matches() call, but I&#39;d much rather understand the problem. Does anyone have any insights?\n\n\ncheers,\n\nColin\n\n\n\n\n--\nColin Rosenthal PhD\nSenior IT Consultant\nRoyal Danish Library (Aarhus)\n\n&lt;/pre&gt;\n    &lt;/blockquote&gt;\n    &lt;br&gt;\n    &lt;br&gt;\n    &lt;pre class=&quot;moz-signature&quot; cols=&quot;72&quot;&gt;-- \nColin Rosenthal PhD\nSenior IT Consultant\nRoyal Danish Library (Aarhus)&lt;/pre&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n\r\n--------------040008070504060604010406--\r\n\n"}}