{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":333425599,"authorName":"xavier_sautejeau","from":"&quot;xavier_sautejeau&quot; &lt;xvrstj-registration@...&gt;","profile":"xavier_sautejeau","replyTo":"LIST","senderId":"NE7ribaGY2FW44CAa4YDKt9TtyOGGxnxh1O4aRUo76OnddE7ROCZoy75gZjX1Qo4k1Ir3ZTHldFgn2MrNuarvP1l6tVxCupIgVT6WPjA26RybB4P0AtR2Q","spamInfo":{"isSpam":false,"reason":"6"},"subject":"Re: embedding 2.0 in another app","postDate":"1201859882","msgId":4951,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PGZudXFmYStzMDRrQGVHcm91cHMuY29tPg==","inReplyToHeader":"PDQ3QTFGRjVGLjYwOTA0MDlAZW1vcnkuZWR1Pg=="},"prevInTopic":4949,"nextInTopic":4952,"prevInTime":4950,"nextInTime":4952,"topicId":4949,"numMessagesInTopic":6,"msgSnippet":"Hi, I ve tried something similar (integrating Heritrix with a Tomcat Webapp) and succeeded to a point. Unfortunately I wanted to use the MirrorWriter instead","rawEmail":"Return-Path: &lt;xvrstj-registration@...&gt;\r\nX-Sender: xvrstj-registration@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 43899 invoked from network); 1 Feb 2008 09:58:03 -0000\r\nX-Received: from unknown (66.218.67.94)\n  by m46.grp.scd.yahoo.com with QMQP; 1 Feb 2008 09:58:03 -0000\r\nX-Received: from unknown (HELO n44d.bullet.mail.sp1.yahoo.com) (66.163.169.158)\n  by mta15.grp.scd.yahoo.com with SMTP; 1 Feb 2008 09:58:03 -0000\r\nX-Received: from [216.252.122.219] by n44.bullet.mail.sp1.yahoo.com with NNFMP; 01 Feb 2008 09:58:03 -0000\r\nX-Received: from [66.218.69.6] by t4.bullet.sp1.yahoo.com with NNFMP; 01 Feb 2008 09:58:03 -0000\r\nX-Received: from [66.218.66.83] by t6.bullet.scd.yahoo.com with NNFMP; 01 Feb 2008 09:58:02 -0000\r\nDate: Fri, 01 Feb 2008 09:58:02 -0000\r\nTo: archive-crawler@yahoogroups.com\r\nMessage-ID: &lt;fnuqfa+s04k@...&gt;\r\nIn-Reply-To: &lt;47A1FF5F.6090409@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=&quot;ISO-8859-1&quot;\r\nContent-Transfer-Encoding: quoted-printable\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-compose\r\nX-eGroups-Msg-Info: 1:6:0:0:0\r\nFrom: &quot;xavier_sautejeau&quot; &lt;xvrstj-registration@...&gt;\r\nSubject: Re: embedding 2.0 in another app\r\nX-Yahoo-Group-Post: member; u=333425599; y=SDL1Z3QWEbfIs_ii6_dcbQlUpWb3DvswF5RPhGO4vRshM80XOhnjNj0N9Q\r\nX-Yahoo-Profile: xavier_sautejeau\r\n\r\nHi,\n\nI&#39;ve tried something similar (integrating Heritrix with a Tomcat\nWebap=\r\np) and succeeded to a point. Unfortunately I wanted to use the\nMirrorWriter=\r\n instead of the ArcWriter and was not able to use it with\nHeritrix 2.0. I t=\r\nherefore reverted to 1.12.\n\nAnyhow, here are the relevant excerpts of my co=\r\nde, hope this helps :\n\n--------------------------\nimport org.archive.crawle=\r\nr.Heritrix;\n\nimport org.archive.crawler.framework.JobStage;\nimport org.arch=\r\nive.util.JmxWaiter;\n\nimport java.io.*;\nimport java.util.Set;\nimport java.la=\r\nng.management.ManagementFactory;\n\nimport javax.management.MBeanServer;\nimpo=\r\nrt javax.management.ObjectName;\nimport javax.servlet.*;\nimport javax.servle=\r\nt.http.*;\n\nimport coreservlets.ServletUtilities;\n\n/**\n* Heritrix 2.0 Tentat=\r\nive Integration\n*/\npublic class HeritrixControl extends HttpServlet {\n\n\tfin=\r\nal static String HERITRIX_HOME =3D System.getenv(&quot;HERITRIX_HOME&quot;);\n\tfinal s=\r\ntatic String JAVA_LANG_STRING =3D &quot;java.lang.String&quot;;\n\tfinal static String =\r\nJAVA_LANG_INTEGER =3D &quot;java.lang.Integer&quot;;\n\tprivate boolean started =3D fal=\r\nse;\n\tprivate ObjectName engine =3D null;\n\tprivate MBeanServer server =3D nu=\r\nll;\n\n\n\n\tpublic void doPost(HttpServletRequest request,\n\t\t\t\t\t   HttpServletR=\r\nesponse response)\n\t\t\tthrows ServletException, IOException {\n\t\tdoGet(request=\r\n, response);\n\t}\n\n\tprotected void startHeritrix() {\n\t\ttry {\n\t\t\tString[] args=\r\n =3D {\n\t\t\t\t&quot;-b&quot;, &quot;localhost&quot;,\n\t\t\t\t&quot;-p&quot;, &quot;8100&quot;,\n\t\t\t\t//&quot;-a&quot;,&quot;LOGIN:PASSWORD&quot;=\r\n,\n\t\t\t\t&quot;-n&quot;, // no WEBUI\n\t\t\t\t//&quot;-r&quot;, &quot;profile-basic_seed_sites&quot;};\n\t\t\t\t&quot;-j&quot;, =\r\nHERITRIX_HOME + &quot;/jobs&quot;};\n\t\t\tHeritrix.main(args);\n\t\t// with Tomcat and Heri=\r\ntrix, we always get such an exception\n\t\t} catch (javax.naming.OperationNotS=\r\nupportedException e) {\n\t\t} catch (Exception e) {\n\t\t}\n\n\t\ttry {\n\t\t\tengine =3D=\r\n lazyGetEngine();\n\t\t\tserver =3D ManagementFactory.getPlatformMBeanServer();=\r\n\n\t\t\tthis.waitForCrawlFinish();\n\t\t} catch (Exception e) {\n\t\t}\n\n\t}\n\n\tprotecte=\r\nd void stopHeritrix() {\n\t\ttry {\n\t\t\tengine =3DlazyGetEngine();\n\t\t\tserver =3D=\r\n ManagementFactory.getPlatformMBeanServer();\n\t\t\tserver.invoke(engine, &quot;clos=\r\ne&quot;, new Object[0], new String[0]);\n\t\t\tengine =3D null;\n\t\t\tserver =3D null;\n=\r\n\t\t} catch (Exception e) {\n\t\t}\n\t}\n\n\tprotected void waitForCrawlFinish() thro=\r\nws Exception {\n\n\t\t// Above invocation should have created a new SheetManage=\r\nr and a new\n\t\t// CrawlController for the job.  Find the CrawlController.\n\t\t=\r\nObjectName crawlController =3D getCrawlController(&quot;basic&quot;);\n\t\twaitFor(crawl=\r\nController);\n\n\t\t// Set up utility to wait for signal from crawler.\n\t\tJmxWai=\r\nter waiter =3D new JmxWaiter(server, crawlController, &quot;FINISHED&quot;);\n\t\twaiter=\r\n.waitUntilNotification(0L);\n\t}\n\n\tprotected String createNewJob(final String=\r\n jobName, final String[]\nurls, int pathDepth) throws Exception {\n\t\tfinal St=\r\nring CONTACT_URL =3D &quot;http://www.mycompany.com&quot;;\n\t\tfinal String CONTACT_EMA=\r\nIL =3D &quot;yournam@...&quot;;\n\n\t\t//-- job creation --\n\t\tString stateJobName=\r\n =3D null;\n\t\tObject result =3D server.invoke(\n\t\t\t\tengine,\n\t\t\t\t&quot;listJobs&quot;,\n\t=\r\n\t\t\tnew Object[0],\n\t\t\t\tnew String[0]\n\t\t);\n\n\t\tfinal String[] resultAsStringAr=\r\nray =3D (String[]) result;\n\t\tboolean alreadyExists =3D false;\n\t\tlookup:\n\t\tf=\r\nor (String s : resultAsStringArray) {\n\t\t\tfor (JobStage js : JobStage.values=\r\n()) {\n\t\t\t\tif (s.equals(js.getPrefix() + jobName)) {\n\t\t\t\t\talreadyExists =3D =\r\ntrue;\n\t\t\t\t\tstateJobName =3D js.getPrefix() + jobName;\n\t\t\t\t\tbreak lookup;\n\t\t=\r\n\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (alreadyExists) {\n\t\t\tserver.invoke(\n\t\t\t\t\tengine,\n\t\t\t\t\t&quot;d=\r\neleteJob&quot;,\n\t\t\t\t\tnew Object[]{stateJobName},\n\t\t\t\t\tnew String[]{JAVA_LANG_STR=\r\nING}\n\t\t\t);\n\t\t}\n\n\t\tstateJobName =3D JobStage.READY.getPrefix() + jobName;\n\t\t=\r\nserver.invoke(\n\t\t\t\tengine,\n\t\t\t\t&quot;copy&quot;,\n\t\t\t\tnew Object[]{&quot;profile-basic_seed=\r\n_sites&quot;, stateJobName},\n\t\t\t\tnew String[]{JAVA_LANG_STRING, JAVA_LANG_STRING=\r\n}\n\t\t);\n\n\t\t//-- job configuration --\n\t\tserver.invoke(\n\t\t\t\tengine,\n\t\t\t\t&quot;getSh=\r\neetManagerStub&quot;,\n\t\t\t\tnew Object[]{stateJobName},\n\t\t\t\tnew String[]{JAVA_LANG=\r\n_STRING}\n\t\t);\n\n\t\tObjectName sheetManager =3D getSheetManager(jobName);\n\n\t\t/=\r\n/---- seeds setup ----\n\t\tObject seedsFile =3D server.invoke(\n\t\t\t\tsheetManag=\r\ner,\n\t\t\t\t&quot;resolve&quot;,\n\t\t\t\tnew Object[]{&quot;global&quot;, &quot;root:seeds:seedsfile&quot;},\n\t\t\t\t=\r\nnew String[]{JAVA_LANG_STRING, JAVA_LANG_STRING}\n\t\t);\n\n\t\tString pathToFile =\r\n=3D HERITRIX_HOME + &quot;/jobs/&quot; + stateJobName + &quot;/&quot; +\nseedsFile;\n\t\tFile f =3D=\r\n new File(pathToFile);\n\t\tif (f.exists() && f.isFile()) {\n\t\t\tFileWriter fw =\r\n=3D new FileWriter(f);\n\t\t\tfor (String url : urls) {\n\t\t\t\tfw.write(url);\n\t\t\t}=\r\n\n\t\t\tfw.close();\n\t\t}\n\n\t\t//---- other parameters ----\n\t\tserver.invoke(\n\t\t\t\tsh=\r\neetManager,\n\t\t\t\t&quot;checkout&quot;,\n\t\t\t\tnew Object[]{&quot;global&quot;},\n\t\t\t\tnew String[]{JA=\r\nVA_LANG_STRING}\n\t\t);\n\n\t\t//arguments to set: sheetName,path,type,value\n\t\tser=\r\nver.invoke(\n\t\t\t\tsheetManager,\n\t\t\t\t&quot;set&quot;,\n\t\t\t\tnew Object[]{&quot;global&quot;, &quot;root:m=\r\netadata:operator-contact-url&quot;,\n&quot;string&quot;, CONTACT_URL},\n\t\t\t\tnew String[]{JAV=\r\nA_LANG_STRING, JAVA_LANG_STRING, JAVA_LANG_STRING,\nJAVA_LANG_STRING}\n\t\t);\n\n=\r\n\t\tserver.invoke(\n\t\t\t\tsheetManager,\n\t\t\t\t&quot;set&quot;,\n\t\t\t\tnew Object[]{&quot;global&quot;, &quot;r=\r\noot:metadata:operator-from&quot;, &quot;string&quot;,\nCONTACT_EMAIL},\n\t\t\t\tnew String[]{JAV=\r\nA_LANG_STRING, JAVA_LANG_STRING, JAVA_LANG_STRING,\nJAVA_LANG_STRING}\n\t\t);\n\n=\r\n\t\tresult =3D server.invoke(\n\t\t\t\tsheetManager,\n\t\t\t\t&quot;set&quot;,\n\t\t\t\tnew Object[]{&quot;=\r\nglobal&quot;, &quot;root:scope:rules:5:max-path-depth&quot;, &quot;int&quot;,\n((Integer)pathDepth).t=\r\noString()},\n\t\t\t\tnew String[]{JAVA_LANG_STRING, JAVA_LANG_STRING, JAVA_LANG_=\r\nSTRING,\nJAVA_LANG_STRING}\n\t\t);\n\n//\t\tserver.invoke(\n//\t\t\t\tsheetManager,\n//\t\t=\r\n\t\t&quot;set&quot;,\n//\t\t\t\tnew Object[]{&quot;global&quot;, &quot;root:controller:processors:Archiver&quot;=\r\n,\n&quot;object&quot;, &quot;org.archive.modules.writer.MirrorWriterProcessor2&quot;},\n//\t\t\t\tnew=\r\n String[]{JAVA_LANG_STRING, JAVA_LANG_STRING,\nJAVA_LANG_STRING, JAVA_LANG_S=\r\nTRING}\n//\t\t);\n\n\t\tserver.invoke(\n\t\t\t\tsheetManager,\n\t\t\t\t&quot;commit&quot;,\n\t\t\t\tnew Obj=\r\nect[]{&quot;global&quot;},\n\t\t\t\tnew String[]{JAVA_LANG_STRING}\n\t\t);\n\n\t\treturn stateJob=\r\nName;\n\t}\n\n\tprotected void createJobs() throws Exception {\n\n\t\tfinal String j=\r\nobName1 =3D &quot;newJob1&quot;;\n\t\tfinal String jobName2 =3D &quot;newJob2&quot;;\n\t\tfinal Strin=\r\ng[] job1Urls =3D {&quot;http://www.company.com&quot;};\n\t\tfinal String[] job2Urls =3D =\r\n{&quot;http://www.organisation.org&quot;};\n\t\tfinal String stateJobName1 =3D createNew=\r\nJob(jobName1, job1Urls, 3);\n\t\tfinal String stateJobName2 =3D createNewJob(j=\r\nobName2, job2Urls, 3);\n\n\t\tserver.invoke(\n\t\t\t\tengine,\n\t\t\t\t&quot;launchJob&quot;,\n\t\t\t\tn=\r\new Object[]{stateJobName1},\n\t\t\t\tnew String[]{JAVA_LANG_STRING}\n\t\t);\n\n//\t\tse=\r\nrver.invoke(\n//\t\t\t\tengine,\n//\t\t\t\t&quot;launchJob&quot;,\n//\t\t\t\tnew Object[]{stateJobNa=\r\nme2},\n//\t\t\t\tnew String[]{JAVA_LANG_STRING}\n//\t\t);\n\n\t\tengine =3D null;\n\t\tser=\r\nver =3D null;\n\t}\n\n\tprotected static ObjectName getCrawlController(final Str=\r\ning job)\nthrows Exception {\n\t\tMBeanServer server =3D ManagementFactory.getP=\r\nlatformMBeanServer();\n\t\t@SuppressWarnings(&quot;unchecked&quot;)\n\t\tSet&lt;ObjectName&gt; se=\r\nt =3D server.queryNames(null, null);\n\t\tfor (ObjectName name : set) {\n\t\t\tif =\r\n(name.getDomain().equals(&quot;org.archive.crawler&quot;)\n\t\t\t\t\t&& name.getKeyProperty=\r\n(&quot;name&quot;).equals(job)\n\t\t\t\t\t&&\nname.getKeyProperty(&quot;type&quot;).equals(&quot;org.archiv=\r\ne.crawler.framework.CrawlController&quot;))\n{\n\t\t\t\treturn name;\n\t\t\t}\n\t\t}\n\t\treturn=\r\n null;\n\t}\n\n\tprotected static ObjectName getEngine() throws Exception {\n\t\tre=\r\nturn waitFor(&quot;org.archive.crawler:*,name=3DEngine&quot;, true);\n\t}\n\n\tprotected O=\r\nbjectName lazyGetEngine() throws Exception {\n\t\tif ( engine =3D=3D null ) {\n=\r\n\t\t\treturn getEngine();\n\t\t} else {\n\t\t\treturn engine;\n\t\t}\n\t}\n\n\tprotected stat=\r\nic ObjectName getSheetManager(String jobName) throws\nException {\n\t\treturn w=\r\naitFor(&quot;org.archive.crawler:*,name=3D&quot; + jobName, true);\n\t}\n\n\t//Utility met=\r\nhod to check existence of MBean with matching name on server\n\tprotected sta=\r\ntic void waitFor(ObjectName name) throws Exception {\n\t\tfinal MBeanServer se=\r\nrver =3D ManagementFactory.getPlatformMBeanServer();\n\t\tint count =3D 0;\n\t\tw=\r\nhile (server.queryNames(name, null).isEmpty()) {\n\t\t\tcount++;\n\t\t\tif (count &gt;=\r\n 40) {\n\t\t\t\tthrow new IllegalStateException(&quot;Could not find &quot; +\n\t\t\t\t\t\tname +=\r\n &quot; after 20 seconds.&quot;);\n\t\t\t}\n\t\t\tThread.sleep(500);\n\t\t}\n\t}\n\n\t//Utility metho=\r\nd to retrieve MBean matching query from server\n\tprotected static ObjectName=\r\n waitFor(final String query, final boolean\nexist) throws Exception {\n\t\tfina=\r\nl MBeanServer server =3D ManagementFactory.getPlatformMBeanServer();\n\t\tfina=\r\nl ObjectName name =3D new ObjectName(query);\n\n\t\tSet set =3D server.queryNam=\r\nes(null, name);\n\t\tint count =3D 0;\n\n\t\twhile (set.isEmpty() =3D=3D exist) {\n=\r\n\t\t\tcount++;\n\t\t\tif (count &gt; 40) {\n\t\t\t\tthrow new IllegalStateException(&quot;Could=\r\n not find &quot; +\n\t\t\t\t\t\tname + &quot; after 20 seconds.&quot;);\n\t\t\t}\n\t\t\tThread.sleep(500)=\r\n;\n\t\t\tset =3D server.queryNames(null, name);\n\t\t\tif (set.size() &gt; 1) {\n\t\t\t\tth=\r\nrow new IllegalStateException(set.size() + &quot; matches for &quot; + query);\n\t\t\t}\n\t=\r\n\t}\n\t\tif (set.isEmpty()) {\n\t\t\treturn null;\n\t\t} else {\n\t\t\treturn (ObjectName)=\r\n set.iterator().next();\n\t\t}\n\t}\n}\n--------------------------\n\nYou will want =\r\nto make the following calls at some point :\n\nthis.startHeritrix();\nthis.cre=\r\nateJobs();\nthis.stopHeritrix();\n\n\n--- In archive-crawler@yahoogroups.com, M=\r\nicah Wedemeyer &lt;mwedeme@...&gt;\nwrote:\n&gt;\n&gt; Hi,\n&gt; \n&gt; I&#39;ve been playing around w=\r\nith 1.12, and I embedded it into another \n&gt; application.  I am using the Cr=\r\nawlJobHandler in order to distance\nmyself \n&gt; from the internals.\n&gt; \n&gt; Now, =\r\nit looks like I&#39;ll have to provide a lot more configurability, and \n&gt; that =\r\nmeans tying in to heritrix a little more tightly.  So, rather than \n&gt; conti=\r\nnue with 1.12, I decided to try and jump in with 2.0\n&gt; \n&gt; Anyways, if I wan=\r\nt to treat heritrix as an API or a library for \n&gt; crawling, what&#39;s the proc=\r\nedure for setting everything up and\nexecuting a \n&gt; crawl?  Here&#39;s the basic=\r\n flow I want:\n&gt; \n&gt; 1) Configure settings (I assume this involves creating s=\r\nheets)\n&gt; 2) Pass settings to heritrix\n&gt; 3) Start up heritrix\n&gt; 4) Periodica=\r\nlly check status, and possibly send commands like pause\nor stop\n&gt; \n&gt;  From =\r\nwhat I&#39;ve seen in the javadocs, I&#39;m confused about where to\nstart. \n&gt;   Do =\r\nI need to instantiate an Engine object?  A CrawlController? \nHow do \n&gt; I cr=\r\neate the settings (sheets?) and pass them where they need to go?\n&gt; \n&gt; A few=\r\n pointers on how to start would be great.\n&gt; \n&gt; Thanks,\n&gt; Micah Wedemeyer\n&gt;\n=\r\n\n\n\n"}}