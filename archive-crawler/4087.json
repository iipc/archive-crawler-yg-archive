{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":191387937,"authorName":"pandae667","from":"&quot;pandae667&quot; &lt;aaron667@...&gt;","profile":"pandae667","replyTo":"LIST","senderId":"BFGqqugv0dmdTjZb8ovZK2CB_8kz9Yej_kX8-yAGNb8MwiA6YunKGm5IUWBDvy_fgurPM4I24SWjZAnfOyJibq21ZHUt","spamInfo":{"isSpam":false,"reason":"6"},"subject":"Re: questions about heritrix memory consumption","postDate":"1176294273","msgId":4087,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PGV2aWsyMStzbWdqQGVHcm91cHMuY29tPg==","inReplyToHeader":"PGV2aTVmbStydW1pQGVHcm91cHMuY29tPg=="},"prevInTopic":4085,"nextInTopic":4093,"prevInTime":4086,"nextInTime":4088,"topicId":4079,"numMessagesInTopic":8,"msgSnippet":"Hi Gordon, I spend some more time looking into the issue, made some heap dumps, tried to understand their content (first using jhat , but finally decided to","rawEmail":"Return-Path: &lt;aaron667@...&gt;\r\nX-Sender: aaron667@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 59660 invoked from network); 11 Apr 2007 12:24:48 -0000\r\nReceived: from unknown (66.218.67.33)\n  by m49.grp.scd.yahoo.com with QMQP; 11 Apr 2007 12:24:48 -0000\r\nReceived: from unknown (HELO n25.bullet.sp1.yahoo.com) (209.131.38.225)\n  by mta7.grp.scd.yahoo.com with SMTP; 11 Apr 2007 12:24:48 -0000\r\nReceived: from [216.252.122.217] by n25.bullet.sp1.yahoo.com with NNFMP; 11 Apr 2007 12:24:34 -0000\r\nReceived: from [66.218.69.6] by t2.bullet.sp1.yahoo.com with NNFMP; 11 Apr 2007 12:24:34 -0000\r\nReceived: from [66.218.66.87] by t6.bullet.scd.yahoo.com with NNFMP; 11 Apr 2007 12:24:34 -0000\r\nDate: Wed, 11 Apr 2007 12:24:33 -0000\r\nTo: archive-crawler@yahoogroups.com\r\nMessage-ID: &lt;evik21+smgj@...&gt;\r\nIn-Reply-To: &lt;evi5fm+rumi@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=&quot;ISO-8859-1&quot;\r\nContent-Transfer-Encoding: quoted-printable\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-compose\r\nX-eGroups-Msg-Info: 1:6:0:0\r\nFrom: &quot;pandae667&quot; &lt;aaron667@...&gt;\r\nSubject: Re: questions about heritrix memory consumption\r\nX-Yahoo-Group-Post: member; u=191387937; y=NT3gowDlzrGw0lS7-ZHYfPm8F4NADJ6bS_WYQpPbKRER9Tte\r\nX-Yahoo-Profile: pandae667\r\n\r\nHi Gordon,\n\nI spend some more time looking into the issue, made some heap d=\r\numps,\ntried to understand their content (first using &#39;jhat&#39;, but finally\nde=\r\ncided to use the convenience of netbeans profiler)... but I still\ndon&#39;t hav=\r\ne a real explaination for what I&#39;m seeing.\n\nBut there is one thing that con=\r\nfused me alot. I had about 50 jobs\nrunning on that machine (53 to be exact)=\r\n , all of them finished just fine.\nBut what I find are 53 instances of Enha=\r\nncedEnvironment still in\nmemory, 53 instances of com.sleepycat.je.Database =\r\nand also 53\ninstances of org.archive.crawler.framework.ToePool.\n\nSo its eit=\r\nher some cleanup code not being called - or the GC is god\ndamn lazy... \n\n(I=\r\n&#39;ll use &#39;jmap -histo:live&#39; next time the machine is in a similar\nstate to b=\r\ne 100% sure only to see live object in my dumps)\n\nRegards\n  Olaf Freyer\n\n\n\n=\r\n--- In archive-crawler@yahoogroups.com, &quot;pandae667&quot; &lt;aaron667@...&gt; wrote:\n&gt;=\r\n\n&gt; Hi Gordon,\n&gt; \n&gt; its once again me. \n&gt; I were able to trigger a GC via a =\r\nJMX call and now the reports of\n&gt; &#39;jmap -histo&#39; seem to be more consistent =\r\nwith the report of the webUI.\n&gt; (or maybe I just copied&pasted the wrong re=\r\nport last time)\n&gt; \n&gt; num   #instances    #bytes  class name\n&gt; -------------=\r\n-------------------------\n&gt;   1:    674736   292760720  [B\n&gt;   2:    451626=\r\n    18065040  com.sleepycat.je.tree.LN\n&gt;   3:      7239     7580688  [[B\n&gt; =\r\n  4:      7233     7580184  [Lcom.sleepycat.je.tree.Node;\n&gt;   5:     39884 =\r\n    5859680  &lt;constMethodKlass&gt;\n&gt;   6:     39884     4794544  &lt;methodKlass&gt;=\r\n\n&gt;   7:     28497     4725848  [Ljava.util.HashMap$Entry;\n&gt;   8:      3704 =\r\n    4580736  &lt;constantPoolKlass&gt;\n&gt;   9:     47991     4553240  [Ljava.lang.=\r\nObject;\n&gt;  10:     79118     3797664  java.util.HashMap$Entry\n&gt; \n&gt; (summing=\r\n up all the #bytes only differs by a few % to what the webUI\n&gt; reports)\n&gt; \n=\r\n&gt; But still... What I&#39;m seeing is about half the memory consumption\n&gt; being=\r\n caused by JBDB data structures - whilest heritrix says:\n&gt; \n&gt; Jobs\n&gt; None a=\r\nvailable\n&gt; 0 pending, 53 completed\n&gt; \n&gt; This doesn&#39;t seem all too reasonabl=\r\ne to me (or maybe I still just\n&gt; can&#39;t stand garbage collectors?).\n&gt; \n&gt; I&#39;l=\r\nl try to get a heap dump to retrieve some more informations about\n&gt; what is=\r\n going on.\n&gt; \n&gt; Regards\n&gt;   Olaf Freyer\n&gt; \n&gt; --- In archive-crawler@yahoogr=\r\noups.com, &quot;pandae667&quot; &lt;aaron667@&gt; wrote:\n&gt; &gt;\n&gt; &gt; Hi Gordon,\n&gt; &gt; \n&gt; &gt; thanks=\r\n for your quick reply.\n&gt; &gt; (1) I think it might be true, that &#39;jmap -histo&#39;=\r\n doesn&#39;t force a GC.\n&gt; &gt; I&#39;ll look into this and try if things change after=\r\n a forced GC.\n&gt; &gt; (2) The last 50 jobs all are in the &quot;Finished&quot; state, so =\r\nI&#39;d presume\n&gt; &gt; everything finished just fine. (This machine only does &quot;sma=\r\nll&quot; jobs)\n&gt; &gt; \n&gt; &gt; The main reason why I&#39;m mentioning all this is that my m=\r\nachines\n&gt; &gt; running the big crawls tend to &quot;die&quot; after about a week.\n&gt; &gt; Or=\r\n to be more correct, they run fine for one week. Then their task is\n&gt; &gt; eit=\r\nher finished - or I finish it via JMX. Now I enqueue the next job\n&gt; &gt; which=\r\n runs OOME within 1 or 2 days.\n&gt; &gt; \n&gt; &gt; After the first job has finished he=\r\nritrix remains in a state of 4.5GB\n&gt; &gt; of 5GB heap used -  so I think it se=\r\nems reasonable to believe that\n&gt; &gt; something from the previous job still re=\r\nmains in-memory.\n&gt; &gt; \n&gt; &gt; I&#39;m not sure why this happens - if this is either=\r\n a real memory leak\n&gt; &gt; or just the GC going nuts.\n&gt; &gt; \n&gt; &gt; I have to admit=\r\n that I still don&#39;t understand all of heritrix\n&gt; &gt; internals, but I found t=\r\nhis blog entry\n&gt; &gt; (http://blogs.oracle.com/charleslamb/2007/02/22) interes=\r\nting\n&gt; &gt; concerning java BDB and OOME issues. Not sure if it applies to\n&gt; &gt;=\r\n heritrix as I&#39;, not sure if we have one or multiple environments.\n&gt; &gt; \n&gt; &gt;=\r\n Regards\n&gt; &gt;   Olaf Freyer\n&gt; &gt; \n&gt; &gt; --- In archive-crawler@yahoogroups.com,=\r\n Gordon Mohr &lt;gojomo@&gt; wrote:\n&gt; &gt; &gt;\n&gt; &gt; &gt; Two possibilities come to mind:\n&gt;=\r\n &gt; &gt; \n&gt; &gt; &gt; (1) I don&#39;t think &#39;jmap -histo&#39; forces a GC first. And, its out=\r\nput\n&gt; &gt; seems \n&gt; &gt; &gt; peculiar given the webUI figures: it&#39;s showing over 1G=\r\nB of byte\n&gt; arrays \n&gt; &gt; &gt; (&quot;[B&quot;), though the webUi reports only ~400MB heap=\r\n in use. So I think\n&gt; &gt; the \n&gt; &gt; &gt; &#39;jmap -histo&#39; figures contain dead objec=\r\nts. Maybe a forced GC would\n&gt; &gt; give \n&gt; &gt; &gt; more sensible figures.\n&gt; &gt; &gt; \n&gt;=\r\n &gt; &gt; (2) The crawl didn&#39;t finish completely or cleanly. It&#39;s not \n&gt; &gt; &gt; pau=\r\nsed-at-finish waiting for a possible resume with more URIs,\nis it?\n&gt; &gt; &gt; \n&gt;=\r\n &gt; &gt; - Gordon @ IA\n&gt; &gt; &gt; \n&gt; &gt; &gt; pandae667 wrote:\n&gt; &gt; &gt; &gt; Dear IA-Team,\n&gt; &gt; =\r\n&gt; &gt; \n&gt; &gt; &gt; &gt; whilest analysing the results of a previous crawl I decided to=\r\n\nalso\n&gt; &gt; &gt; &gt; take a closer look at heritrix. To be more specific a closer\n=\r\nlook at\n&gt; &gt; &gt; &gt; the state heritrix was in after finishing the job.\n&gt; &gt; &gt; &gt; =\r\n(basically heritrix-1.12 with some minor patches running under\n&gt; &gt; java 1.6=\r\n)\n&gt; &gt; &gt; &gt; \n&gt; &gt; &gt; &gt; The webUI showed me the following stats:\n&gt; &gt; &gt; &gt; \n&gt; &gt; &gt; =\r\n&gt; Memory\n&gt; &gt; &gt; &gt; 402591 KB used\n&gt; &gt; &gt; &gt; 950456 KB current heap\n&gt; &gt; &gt; &gt; 3063=\r\n488 KB max heap\n&gt; &gt; &gt; &gt; \n&gt; &gt; &gt; &gt; Now this is quite a lot memory being used =\r\nwhile sitting there\nidle.\n&gt; &gt; &gt; &gt; So I wondered what is eating up all my pr=\r\necious memory and this is\n&gt; &gt; &gt; &gt; what jmap -histo &lt;pid&gt; was able to tell m=\r\ne:\n&gt; &gt; &gt; &gt; \n&gt; &gt; &gt; &gt; num   #instances    #bytes  class name\n&gt; &gt; &gt; &gt; --------=\r\n------------------------------\n&gt; &gt; &gt; &gt;   1:   7716610   1352335640  [B\n&gt; &gt; =\r\n&gt; &gt;   2:   5202265   208090600  com.sleepycat.je.tree.LN\n&gt; &gt; &gt; &gt;   3:     7=\r\n8155    81900656  [[B\n&gt; &gt; &gt; &gt;   4:     78149    81900152  [Lcom.sleepycat.j=\r\ne.tree.Node;\n&gt; &gt; &gt; &gt;   5:    469864    72832376  [C\n&gt; &gt; &gt; &gt;   6:     24169 =\r\n   25050392  [J\n&gt; &gt; &gt; &gt;   7:    421191    20217168  java.util.Hashtable$Ent=\r\nry\n&gt; &gt; &gt; &gt;   8:    467772    18710880  java.lang.String\n&gt; &gt; &gt; &gt;   9:     75=\r\n246    12641328  com.sleepycat.je.tree.BIN\n&gt; &gt; &gt; &gt;  10:    259687    124649=\r\n76  org.archive.crawler.admin.SeedRecord\n&gt; &gt; &gt; &gt;  ...\n&gt; &gt; &gt; &gt;  ...\n&gt; &gt; &gt; &gt; =\r\n ...\n&gt; &gt; &gt; &gt; \n&gt; &gt; &gt; &gt; So what I&#39;m asking myself is: why do I still see abou=\r\nt 5 million\n&gt; &gt; &gt; &gt; instances of com.sleepycat.je.tree.LN in memory whilest=\r\n sitting\n&gt; there\n&gt; &gt; &gt; &gt; idle and the last job having finished about 3 days=\r\n ago ?\n&gt; &gt; &gt; &gt; \n&gt; &gt; &gt; &gt; Anyone able to share some insights with me?\n&gt; &gt; &gt; &gt;=\r\n \n&gt; &gt; &gt; &gt; Regards\n&gt; &gt; &gt; &gt;   Olaf Freyer\n&gt; &gt; &gt; &gt; \n&gt; &gt; &gt; &gt; \n&gt; &gt; &gt; &gt; \n&gt; &gt; &gt; &gt; =\r\n \n&gt; &gt; &gt; &gt; Yahoo! Groups Links\n&gt; &gt; &gt; &gt; \n&gt; &gt; &gt; &gt; \n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt;\n&gt; &gt;\n&gt;\n\n\n\n"}}