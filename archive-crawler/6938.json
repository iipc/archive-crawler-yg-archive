{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":264138474,"authorName":"Kenji Nagahashi","from":"Kenji Nagahashi &lt;knagahashi@...&gt;","profile":"kenznag","replyTo":"LIST","senderId":"9maZoT4TzqR7bPPUrE-HS_SjZ510z8cisnplFoqsWT9I-U4LA1eofBWX_LnOTf1dW_Jcqyj1Ld97X0pJGCySch90ntHYk_OPrybhVpM","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Re: [archive-crawler] Too many open files Exception [1 Attachment]","postDate":"1293059965","msgId":6938,"canDelete":false,"contentTrasformed":false,"systemMessage":true,"headers":{"messageIdInHeader":"PDREMTI4NzdELjUwMzA4MDhAZ21haWwuY29tPg==","inReplyToHeader":"PEFBTkxrVGk9ZjYwK3QwNDZuelZna3gzcGhodThHcUo1ZjZ3MTlfRDVBa3FSQUBtYWlsLmdtYWlsLmNvbT4=","referencesHeader":"PEFBTkxrVGk9ZjYwK3QwNDZuelZna3gzcGhodThHcUo1ZjZ3MTlfRDVBa3FSQUBtYWlsLmdtYWlsLmNvbT4="},"prevInTopic":6936,"nextInTopic":6939,"prevInTime":6937,"nextInTime":6939,"topicId":6936,"numMessagesInTopic":5,"msgSnippet":"Hi Adam, Coincidentally, I ve been investigating the same too many open files error in our crawl projects. Based on what I ve found so far, it appears ","rawEmail":"Return-Path: &lt;knagahashi@...&gt;\r\nReceived: (qmail 52495 invoked from network); 23 Dec 2010 04:36:34 -0000\r\nReceived: from unknown (66.196.94.105)\n  by m14.grp.re1.yahoo.com with QMQP; 23 Dec 2010 04:36:34 -0000\r\nReceived: from unknown (HELO n40b.bullet.mail.sp1.yahoo.com) (66.163.168.154)\n  by mta1.grp.re1.yahoo.com with SMTP; 23 Dec 2010 04:36:34 -0000\r\nDKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoogroups.com; s=lima; t=1293078993; bh=iHQ7dL3Ucq/JwZAe4RUvXGxwV+UmONxPAdkRS6SUoSw=; h=Received:Received:X-Sender:X-Apparently-To:X-Received:X-Received:X-Received:X-Received:X-Received:X-Received:Message-ID:Date:User-Agent:MIME-Version:To:References:In-Reply-To:Content-Type:Content-Transfer-Encoding:X-Originating-IP:From:Subject:X-Yahoo-Group-Post:X-Yahoo-Profile:X-YGroups-SubInfo:Sender:X-Yahoo-Newman-Property:X-eGroups-Approved-By:X-eGroups-Auth; b=qrwbLlvlFlw8tHtEP2rlyGV8sZJsANJAZzSX+3o7tq9FcAr94SmSDTHoNmvp+3A84iUkqQDQRRpj5LrnblyQHJxfjgefj53buUtBLWjc0a+SKogyH15t/BjsIWk/O+rq\r\nReceived: from [69.147.65.151] by n40.bullet.mail.sp1.yahoo.com with NNFMP; 23 Dec 2010 04:36:33 -0000\r\nReceived: from [98.137.34.35] by t5.bullet.mail.sp1.yahoo.com with NNFMP; 23 Dec 2010 04:36:33 -0000\r\nX-Sender: knagahashi@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 70387 invoked from network); 22 Dec 2010 23:19:30 -0000\r\nX-Received: from unknown (66.196.94.107)\n  by m15.grp.re1.yahoo.com with QMQP; 22 Dec 2010 23:19:30 -0000\r\nX-Received: from unknown (HELO mail-gw0-f41.google.com) (74.125.83.41)\n  by mta3.grp.re1.yahoo.com with SMTP; 22 Dec 2010 23:19:30 -0000\r\nX-Received: by gwj22 with SMTP id 22so3036279gwj.28\n        for &lt;archive-crawler@yahoogroups.com&gt;; Wed, 22 Dec 2010 15:19:29 -0800 (PST)\r\nX-Received: by 10.151.9.9 with SMTP id m9mr10996240ybi.141.1293059968505;\n        Wed, 22 Dec 2010 15:19:28 -0800 (PST)\r\nX-Received: from Kenjis-MacBook-Pro.local (router300.sf.archive.org [208.70.27.190])\n        by mx.google.com with ESMTPS id u3sm9269732yba.4.2010.12.22.15.19.26\n        (version=TLSv1/SSLv3 cipher=RC4-MD5);\n        Wed, 22 Dec 2010 15:19:27 -0800 (PST)\r\nMessage-ID: &lt;4D12877D.5030808@...&gt;\r\nDate: Wed, 22 Dec 2010 15:19:25 -0800\r\nUser-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; ja-JP-mac; rv:1.9.2.13) Gecko/20101207 Thunderbird/3.1.7\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;AANLkTi=f60+t046nzVgkx3phhu8GqJ5f6w19_D5AkqRA@...&gt;\r\nIn-Reply-To: &lt;AANLkTi=f60+t046nzVgkx3phhu8GqJ5f6w19_D5AkqRA@...&gt;\r\nContent-Type: text/plain; charset=UTF-8; format=flowed\r\nContent-Transfer-Encoding: 8bit\r\nFrom: Kenji Nagahashi &lt;knagahashi@...&gt;\r\nSubject: Re: [archive-crawler] Too many open files Exception [1 Attachment]\r\nX-Yahoo-Group-Post: member; u=264138474; y=msYeVIxkK5pBNo6cPYNrsVTPAI2uEj5YoISrS1mvIWHRnw\r\nX-Yahoo-Profile: kenznag\r\nX-Yahoo-Newman-Property: groups-system\r\nX-eGroups-Approved-By: gojomo &lt;gojomo@...&gt; via web; 23 Dec 2010 04:36:33 -0000\r\n\r\nHi Adam,\n\nCoincidentally, I&#39;ve been investigating the same &quot;too many open files&quot; \nerror in our crawl projects. Based on what I&#39;ve found so far, it appears \nHeritrix hit per-process maximum of open file descriptors (1024 in our \ncase). Following is what I learned from monitoring 5 hour test crawl \n(Heritrix 3) - probably the something similar must be happening in your \ncrawl project, too.\n\nHeritrix 3 has ~80 always-open file descriptors for JARs, log files, \nARC/WARCs, BDB and listening sockets.\n\nEach active crawling thread can open up to 3 file descriptors at one \ntime for fetching and recording HTTP request/response. Our crawler is \nconfigured with max 200 threads, so there can be up to 600 open file \ndescriptors at one time, but usually much less than that (max 318 in our \ncase).\n\nIn addition to total 400 open fds above, there are other 4 kinds of file \ndescriptors, which reached 400 in total during the test. Now it is \npretty close to per-process limit of 1024.\n\nOne of &quot;additional&quot; open descriptors is UDP socket for DNS query. I saw \nmax 75 sockets open at one time. If DNS server gets overloaded and slows \ndown, there could be more.\n\nAlso as crawl job proceed, BDB gets bigger and BDB seems to keep more \ndatabase files open.\n\nSumming up, with following factors combined, Heritrix could run out of \nfile descriptors and start failing severely:\n\n- many threads\n- shallow crawl on many web sites (such crawl can go very fast, too)\n- long-running crawl\n- slow DNS queries\n\nProbably crawling with less threads is the easiest (but not so reliable) \nway to prevent this problem, but Heritrix could do a kind of throttling \nby limiting the number of concurrent DNS queries.\n\nKenji @ Internet Archive\n\n(12/22/10 4:17 AM), Adam Brokeš wrote:\n&gt; [Attachment(s) &lt;#TopText&gt; from =?UTF-8?B?QWRhbSBCcm9rZcWh?= included below]\n&gt;\n&gt; Hallo folks,\n&gt;\n&gt; I am working on domain crawl and I have encounter few strange\n&gt; problems. First of all, the crawl has some rapid slowdown (ten times\n&gt; slower). This was caused by managing (or comparing) cookies. Well, we\n&gt; have decided that disabling cookies for bulk crawl is not big issue.\n&gt; After few days, when 4 TB was harvested, heritrix threw too many open\n&gt; files exception. I tried to recover, but all my attempts failed. I\n&gt; restarted heritrix, build new job based on the old one. Lower the\n&gt; toethreads to 250 and started. This order xml is quite the same as I\n&gt; used last year for crawling 9.5 TB. After two and half days with 1TB\n&gt; crawled heritrix suddenly stop with exception threw on all threads. I\n&gt; have attached the exception in the bottom. The limit on the open files\n&gt; in the system is set to more than one million. Frankly, I am not sure\n&gt; how to track down this problem. Especially when this setting was\n&gt; working last year (probably on 1.14.3).\n&gt;\n&gt; Thank you very much.\n&gt;\n&gt; Best regards.\n&gt;\n&gt; Brokes\n&gt;\n&gt; HW & SW config\n&gt;\n&gt; 3485312 KB max heap\n&gt; 32bit java6 update22\n&gt; heritrix 1.14.4\n&gt; 4 core Intel(R) Xeon(R) CPU E5420 @ 2.50GHz\n&gt; 8 GiB RAM\n&gt; 64bit Debian 5.0.6\n&gt;\n&gt; Exception\n&gt;\n&gt; Fatal exception in ToeThread #181: (in thread &#39;ToeThread #181: &#39;)\n&gt; Exception:\n&gt; com.sleepycat.util.RuntimeExceptionWrapper: (JE 3.3.82) fetchTarget of\n&gt; 0x32/0x1ed6a7 parent IN=1266390 IN class=com.sleepycat.je.tree.BIN\n&gt; lastFullVersion=0x8b2/0x56a066 parent.getDirty()=false state=0\n&gt; com.sleepycat.je.log.LogFileNotFoundException: (JE 3.3.82)\n&gt; 0x32/0x1ed6a7 (JE 3.3.82) Couldn&#39;t open file\n&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb:\n&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb (Too many open files)\n&gt; Cause: com.sleepycat.je.DatabaseException: (JE 3.3.82) fetchTarget of\n&gt; 0x32/0x1ed6a7 parent IN=1266390 IN class=com.sleepycat.je.tree.BIN\n&gt; lastFullVersion=0x8b2/0x56a066 parent.getDirty()=false state=0\n&gt; com.sleepycat.je.log.LogFileNotFoundException: (JE 3.3.82)\n&gt; 0x32/0x1ed6a7 (JE 3.3.82) Couldn&#39;t open file\n&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb:\n&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb (Too many open files)\n&gt; at com.sleepycat.je.tree.IN.fetchTarget(IN.java:1230)\n&gt; at com.sleepycat.je.dbi.CursorImpl.searchAndPosition(CursorImpl.java:2103)\n&gt; at com.sleepycat.je.Cursor.searchInternal(Cursor.java:1778)\n&gt; at com.sleepycat.je.Cursor.searchAllowPhantoms(Cursor.java:1748)\n&gt; at com.sleepycat.je.Cursor.search(Cursor.java:1615)\n&gt; at com.sleepycat.je.Cursor.getSearchKey(Cursor.java:1067)\n&gt; at\n&gt; com.sleepycat.util.keyrange.RangeCursor.doGetSearchKey(RangeCursor.java:965)\n&gt; at\n&gt; com.sleepycat.util.keyrange.RangeCursor.getSearchKey(RangeCursor.java:592)\n&gt; at com.sleepycat.collections.DataCursor.doGetSearchKey(DataCursor.java:577)\n&gt; at com.sleepycat.collections.DataCursor.getSearchKey(DataCursor.java:559)\n&gt; at\n&gt; com.sleepycat.collections.StoredContainer.getValue(StoredContainer.java:299)\n&gt; at com.sleepycat.collections.StoredMap.get(StoredMap.java:227)\n&gt; at\n&gt; org.archive.util.ObjectIdentityBdbCache.getOrUse(ObjectIdentityBdbCache.java:264)\n&gt; at\n&gt; org.archive.util.ObjectIdentityBdbCache.get(ObjectIdentityBdbCache.java:217)\n&gt; at\n&gt; org.archive.util.ObjectIdentityBdbCache.get(ObjectIdentityBdbCache.java:75)\n&gt; at\n&gt; org.archive.crawler.frontier.WorkQueueFrontier.activateInactiveQueue(WorkQueueFrontier.java:732)\n&gt; at\n&gt; org.archive.crawler.frontier.WorkQueueFrontier.next(WorkQueueFrontier.java:634)\n&gt; at org.archive.crawler.framework.ToeThread.run(ToeThread.java:147)\n&gt;\n&gt; Stacktrace: com.sleepycat.util.RuntimeExceptionWrapper: (JE 3.3.82)\n&gt; fetchTarget of 0x32/0x1ed6a7 parent IN=1266390 IN\n&gt; class=com.sleepycat.je.tree.BIN lastFullVersion=0x8b2/0x56a066\n&gt; parent.getDirty()=false state=0\n&gt; com.sleepycat.je.log.LogFileNotFoundException: (JE 3.3.82)\n&gt; 0x32/0x1ed6a7 (JE 3.3.82) Couldn&#39;t open file\n&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb:\n&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb (Too many open files)\n&gt; at\n&gt; com.sleepycat.collections.StoredContainer.convertException(StoredContainer.java:466)\n&gt; at\n&gt; com.sleepycat.collections.StoredContainer.getValue(StoredContainer.java:306)\n&gt; at com.sleepycat.collections.StoredMap.get(StoredMap.java:227)\n&gt; at\n&gt; org.archive.util.ObjectIdentityBdbCache.getOrUse(ObjectIdentityBdbCache.java:264)\n&gt; at\n&gt; org.archive.util.ObjectIdentityBdbCache.get(ObjectIdentityBdbCache.java:217)\n&gt; at\n&gt; org.archive.util.ObjectIdentityBdbCache.get(ObjectIdentityBdbCache.java:75)\n&gt; at\n&gt; org.archive.crawler.frontier.WorkQueueFrontier.activateInactiveQueue(WorkQueueFrontier.java:732)\n&gt; at\n&gt; org.archive.crawler.frontier.WorkQueueFrontier.next(WorkQueueFrontier.java:634)\n&gt; at org.archive.crawler.framework.ToeThread.run(ToeThread.java:147)\n&gt; Caused by: com.sleepycat.je.DatabaseException: (JE 3.3.82) fetchTarget\n&gt; of 0x32/0x1ed6a7 parent IN=1266390 IN class=com.sleepycat.je.tree.BIN\n&gt; lastFullVersion=0x8b2/0x56a066 parent.getDirty()=false state=0\n&gt; com.sleepycat.je.log.LogFileNotFoundException: (JE 3.3.82)\n&gt; 0x32/0x1ed6a7 (JE 3.3.82) Couldn&#39;t open file\n&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb:\n&gt; /mnt/pole-c/cz2010/crawl2/state/00000032.jdb (Too many open files)\n&gt; at com.sleepycat.je.tree.IN.fetchTarget(IN.java:1230)\n&gt; at com.sleepycat.je.dbi.CursorImpl.searchAndPosition(CursorImpl.java:2103)\n&gt; at com.sleepycat.je.Cursor.searchInternal(Cursor.java:1778)\n&gt; at com.sleepycat.je.Cursor.searchAllowPhantoms(Cursor.java:1748)\n&gt; at com.sleepycat.je.Cursor.search(Cursor.java:1615)\n&gt; at com.sleepycat.je.Cursor.getSearchKey(Cursor.java:1067)\n&gt; at\n&gt; com.sleepycat.util.keyrange.RangeCursor.doGetSearchKey(RangeCursor.java:965)\n&gt; at\n&gt; com.sleepycat.util.keyrange.RangeCursor.getSearchKey(RangeCursor.java:592)\n&gt; at com.sleepycat.collections.DataCursor.doGetSearchKey(DataCursor.java:577)\n&gt; at com.sleepycat.collections.DataCursor.getSearchKey(DataCursor.java:559)\n&gt; at\n&gt; com.sleepycat.collections.StoredContainer.getValue(StoredContainer.java:299)\n&gt; ... 7 more\n&gt; --\n&gt; Adam Brokeš\n&gt; http://www.brokes.net\n&gt; adam.brokes@... &lt;mailto:adam.brokes%40gmail.com&gt;\n&gt; 42799740\n&gt;\n&gt; \n\n\n"}}