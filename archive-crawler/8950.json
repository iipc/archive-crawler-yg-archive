{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":582247024,"authorName":"Colin Rosenthal","from":"Colin Rosenthal &lt;csr@...&gt;","replyTo":"LIST","senderId":"ml9fbcREY5NwMv3I2V3nn30x01UoRX6XoA-lX0nhxnZ2mPXncJ6P3qHPS8KI1wORGJkkDryJ4FjYqE7HptuKqHzF","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Re: [archive-crawler] Pathological Regex Behaviour in MatchesListRegexDecideRule","postDate":"1538574943","msgId":8950,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDVCQjRDQTVGLjYwNDA0MDhAa2IuZGs+","inReplyToHeader":"PDA4ODQwQUJDQUU4MTVCNDM5N0MzNzIxNTUzQzY5MjMzMDE3NTYzNEE5NEBWOEItRVhDSEFOR0UwMi5hZC5ibC51az4=","referencesHeader":"PDU2MWI1YzNkZmFmZTRhOGI4NzhmMDU5NDlhYTk0MWNiQGtiLmRrPiA8NUJBRENGOTEuOTAxMDcwOEBrYi5kaz4gPDA4ODQwQUJDQUU4MTVCNDM5N0MzNzIxNTUzQzY5MjMzMDE3NTYzNEE5NEBWOEItRVhDSEFOR0UwMi5hZC5ibC51az4="},"prevInTopic":8949,"nextInTopic":0,"prevInTime":8949,"nextInTime":8951,"topicId":8947,"numMessagesInTopic":4,"msgSnippet":"Let s say there were definitely _some_ cases where MatchesListRegexDecideRule was taking unlimited time to match. But there s no way of seeing which of our 550","rawEmail":"Return-Path: &lt;csr@...&gt;\r\nX-Sender: csr@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 29805 invoked by uid 102); 3 Oct 2018 13:55:46 -0000\r\nX-Received: from unknown (HELO mtaq5.grp.bf1.yahoo.com) (10.198.29.78)\n  by m4.grp.bf1.yahoo.com with SMTP; 3 Oct 2018 13:55:46 -0000\r\nX-Received: (qmail 5957 invoked from network); 3 Oct 2018 13:55:46 -0000\r\nX-Received: from unknown (HELO mta4004.groups.mail.bf1.yahoo.com) (10.201.195.149)\n  by mtaq5.grp.bf1.yahoo.com with SMTP; 3 Oct 2018 13:55:46 -0000\r\nX-Original-Return-Path: &lt;csr@...&gt;\r\nX-Received-SPF: pass (domain of kb.dk designates 89.104.206.36 as permitted sender)\r\nX-YMailISG: cnDa92YWLDuRBO.e_7BST1k7Y4.5NAYQuRtE59Gfn6uicdmg\n 0efrodY2MVw06FiBzb514EwdkItB9BlcFHMcJ9xLIJLSKu5nuiFrJu_8PgpI\n oPN2hsazQC2TA74usU_LiMaK.DMU2C_KWY5o74g576BH7A9llagPCtmAR.Hw\n jmT5lKuKlu2d2.4s75bQkawgHosPRkxAGeRCwZDplodUdlJ9dLGxdGWkNBc_\n BzHP6HX6uK42dB9AMWdW_oFxKbUczoWE1wmnW.OtbpXarrr5g.ZmO_6KmaVa\n 2IS8iQZZ6_e_WfWP_eXaBoZT7yopN8OxCA.sXn1X9plqhC.zoq49EpVS0hzH\n wIZEvduGfedcGNcrPpsPd3A9fa_YHZEU63I6JTQ1uLj417VMV.AmyWuxXvvH\n yjyrC5WLDy9Hbaoq7XZ1s0sn52vTNnClbA9PQkfJSDucSa9BK.3MuVswL8q2\n n2ZWLhPXSi3Rnuz_B5Pl.7GyhxCa3IDGKUBs4TmDbWZvT3rBCnB_g2PkWC0p\n lXkZPlK1XwBBnOrvila5Cf6vMVovBO1l6ujwJ.urrvTqmzMXRJ37u9Xj.N1f\n jMYfLRmrXxtEsSzHBYROlJniPPo15XtFLbn0vB3RLlzfeH1OSbN.GABpmGpv\n lM_sSjEl9KiTN2Hpg1MHJ1o0lLgRVukch51RlbGTedjHlBc1VFayNgCon7N.\n m_RuTxI7YLVWl4bs9K_XAmNajFMzdtpmORcJqEtqefUdKEUMzKkRnnvH6dZt\n uhDgocHCSQJTIrjSXuJTzwfLd5SnbSt9DOxi.Pe.gZABDPjnQln2F3X7J4ce\n 5pRELODKmu6pe1WyjzOBbs4eYNawoV29PcON2XDNu2LpB46ulTLCj4JpofA9\n cKkt4665hjc8.SnH.2u0J4NeA7FuvxMjEQKR3djaC9.6hjAGMWSQtzRXa0YQ\n _k4H9yUvruwqomD_P.kyawRsQcApkuYABT3Gk7YMygy4zblzR58fTfE9xqbV\n E9C25IfeioFSKkk9rCQ0Cxsb5scACyUJufNQr3DF6Km5lonrKUNOImdVOVUv\n PNkbhCCgjgl9dspnyr7Mqc633N7bbvxWYckvIRbGYOn0iuUeJhiEFJti89I4\n WPh6gPbtNkYAddAJqcb.vOl3kkLc45SFMmUfLJeZ571vESP_cTmKkpXP4y_X\n ap_8DEAs2z2wDU1zOx0G4PAC11JPOsTTgb2AY52kamHxuKMb6imI0Wne4Vmk\n daQ94kDlVe..xRbxyqo-\r\nAuthentication-Results: mta4004.groups.mail.bf1.yahoo.com  from=kb.dk; domainkeys=neutral (no sig);  from=kb.dk; dkim=neutral (no sig)\r\nX-Received: from 127.0.0.1  (EHLO smtp-out12.electric.net) (89.104.206.36)\n  by mta4004.groups.mail.bf1.yahoo.com with SMTPS; Wed, 03 Oct 2018 13:55:46 +0000\r\nX-Received: from 1g7hct-000orP-Tj by out12b.electric.net with emc1-ok (Exim 4.90_1)\n\t(envelope-from &lt;csr@...&gt;)\n\tid 1g7hct-000osS-Uc\n\tfor archive-crawler@yahoogroups.com; Wed, 03 Oct 2018 06:55:43 -0700\r\nX-Received: by emcmailer; Wed, 03 Oct 2018 06:55:43 -0700\r\nX-Received: from [130.226.226.11] (helo=post.kb.dk)\n\tby out12b.electric.net with esmtp (Exim 4.90_1)\n\t(envelope-from &lt;csr@...&gt;)\n\tid 1g7hct-000orP-Tj\n\tfor archive-crawler@yahoogroups.com; Wed, 03 Oct 2018 06:55:43 -0700\r\nX-Received: from [172.18.100.202] (unknown [172.18.100.202])\n\tby post.kb.dk (Postfix) with ESMTP id 1E95069188;\n\tWed,  3 Oct 2018 15:55:43 +0200 (CEST)\r\nMessage-ID: &lt;5BB4CA5F.6040408@...&gt;\r\nDate: Wed, 03 Oct 2018 15:55:43 +0200\r\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:31.0) Gecko/20100101 Thunderbird/31.1.2\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nCc: =?UTF-8?B?S251ZCDDhWdlIEhhbnNlbg==?= &lt;kaah@...&gt;\r\nReferences: &lt;561b5c3dfafe4a8b878f05949aa941cb@...&gt; &lt;5BADCF91.9010708@...&gt; &lt;08840ABCAE815B4397C3721553C692330175634A94@...&gt;\r\nIn-Reply-To: &lt;08840ABCAE815B4397C3721553C692330175634A94@...&gt;\r\nContent-Type: text/plain; charset=utf-8; format=flowed\r\nContent-Transfer-Encoding: 8bit\r\nX-Outbound-IP: 130.226.226.11\r\nX-Env-From: csr@...\r\nX-Proto: esmtp\r\nX-Revdns: post-03.kb.dk\r\nX-HELO: post.kb.dk\r\nX-TLS: \r\nX-Authenticated_ID: \r\nX-Virus-Status: Scanned by VirusSMART (c)\r\nX-Virus-Status: Scanned by VirusSMART (s)\r\nX-PolicySMART: 10573177\r\nSubject: Re: [archive-crawler] Pathological Regex Behaviour in MatchesListRegexDecideRule\r\nX-Yahoo-Group-Post: member; u=582247024\r\nFrom: Colin Rosenthal &lt;csr@...&gt;\r\n\r\nLet&#39;s say there were definitely _some_ cases where \nMatchesListRegexDecideRule was taking unlimited time to match. But \nthere&#39;s no\nway of seeing which of our 550 crawler-traps is causing the problem. So \nwe&#39;ve wrapped the regex call in a CompleteableFuture with timeout\nand now we&#39;re trying again. That way we can also log the precise \nurl/regex combination that gave us trouble. That should help whether it&#39;s a\npathological regex or a concurrency issue.\n\n/Colin\n\nOn 09/28/2018 10:33 AM, &#39;Jackson, Andrew&#39; andrew.jackson@... \n[archive-crawler] wrote:\n&gt; Hi Colin,\n&gt;\n&gt; I’m guessing it turned out to be a pathological regex slowdown then!?\n&gt;\n&gt; Best,\n&gt; Andy\n&gt;\n&gt;\n&gt; From: archive-crawler@yahoogroups.com [mailto:archive-crawler@yahoogroups.com]\n&gt; Sent: 28 September 2018 07:52\n&gt; To: archive-crawler@yahoogroups.com\n&gt; Cc: Kåre Fiedler Christiansen; Jeppe Ravn-Grove; Knud Åge Hansen\n&gt; Subject: Re: [archive-crawler] Pathological Regex Behaviour in MatchesListRegexDecideRule\n&gt;\n&gt;\n&gt; Btw, if you don&#39;t believe me try running a crawl with a single seed:\n&gt;\n&gt; http://www.netarkivet.dk/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n&gt;\n&gt; and a single crawler-trap\n&gt;\n&gt; http://www&#92;.netarkivet&#92;.dk/((x+x+)+)y\n&gt;\n&gt;\n&gt; !\n&gt; /Colin\n&gt;\n&gt;\n&gt;\n&gt; On 09/26/2018 08:02 AM, Colin Samuel Rosenthal csr@...&lt;mailto:csr@...&gt; [archive-crawler] wrote:\n&gt;\n&gt; This is a follow-up my recent email about hanging jobs. When we look at the ToeThreads on our hanging jobs, we often see a stacktrace like this:\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;      java.util.regex.Pattern$Branch.match(Pattern.java:4604)\n&gt;\n&gt;      java.util.regex.Pattern$GroupHead.match(Pattern.java:4658)\n&gt;\n&gt;      .\n&gt;\n&gt;\n&gt;\n&gt;      .\n&gt;\n&gt;\n&gt;\n&gt;      .\n&gt;\n&gt;      java.util.regex.Pattern$Curly.match(Pattern.java:4234)\n&gt;\n&gt;      java.util.regex.Matcher.match(Matcher.java:1270)\n&gt;\n&gt;      java.util.regex.Matcher.matches(Matcher.java:604)\n&gt;\n&gt;      org.archive.modules.deciderules.MatchesListRegexDecideRule.evaluate(MatchesListRegexDecideRule.java:94)\n&gt;\n&gt;      org.archive.modules.deciderules.PredicatedDecideRule.innerDecide(PredicatedDecideRule.java:47)\n&gt;\n&gt;\n&gt;\n&gt; In other words the thread is taking forever to match a regex with a url.\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; Our first thought was that was the code was using Java Pattern/Matcher in a non-threadsafe way. The actual code line (line 94 in MatchesListRegexDecideRule) is\n&gt;\n&gt;\n&gt;\n&gt; boolean matches = p.matcher(str).matches();\n&gt;\n&gt;\n&gt;\n&gt; but this looks ok. The Pattern (p) is reused across threads, but the Matcher p.matcher(str) is method local. So there shouldn&#39;t be a problem.\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; A second possibility is that we have some pathological combination of uri and regex that just takes forever to evaluate. But in that case it should be easy to reproduce the problem, which we haven&#39;t been able to do.\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; So we&#39;re still confused. I&#39;m thinking about modifying the code to place a timeout on the matches() call, but I&#39;d much rather understand the problem. Does anyone have any insights?\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; cheers,\n&gt;\n&gt;\n&gt;\n&gt; Colin\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; --\n&gt;\n&gt; Colin Rosenthal PhD\n&gt;\n&gt; Senior IT Consultant\n&gt;\n&gt; Royal Danish Library (Aarhus)\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; --\n&gt;\n&gt; Colin Rosenthal PhD\n&gt;\n&gt; Senior IT Consultant\n&gt;\n&gt; Royal Danish Library (Aarhus)\n&gt;\n&gt;\n&gt;\n&gt; ******************************************************************************************************************\n&gt; Experience the British Library online at www.bl.uk&lt;http://www.bl.uk/&gt;\n&gt; The British Library’s latest Annual Report and Accounts : www.bl.uk/aboutus/annrep/index.html&lt;http://www.bl.uk/aboutus/annrep/index.html&gt;\n&gt; Help the British Library conserve the world&#39;s knowledge. Adopt a Book. www.bl.uk/adoptabook&lt;http://www.bl.uk/adoptabook&gt;\n&gt; The Library&#39;s St Pancras site is WiFi - enabled\n&gt; *****************************************************************************************************************\n&gt; The information contained in this e-mail is confidential and may be legally privileged. It is intended for the addressee(s) only. If you are not the intended recipient, please delete this e-mail and notify the postmaster@...&lt;mailto:postmaster@...&gt; : The contents of this e-mail must not be disclosed or copied without the sender&#39;s consent.\n&gt; The statements and opinions expressed in this message are those of the author and do not necessarily reflect those of the British Library. The British Library does not take any responsibility for the views of the author.\n&gt; *****************************************************************************************************************\n&gt; Think before you print\n\n\n-- \nColin Rosenthal PhD\nSenior IT Consultant\nRoyal Danish Library (Aarhus)\n\n\n"}}