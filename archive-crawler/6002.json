{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":140025715,"authorName":"progre55","from":"&quot;progre55&quot; &lt;ikromchik@...&gt;","profile":"progre55","replyTo":"LIST","senderId":"rkAF4nJcTJBghkc0lAWd7ho0keQxdriX0OljEj8UG5mh79CGNgqG0Md94vEpkukuNQfr2EnY7inJmSSRt4Lj9XFrUnTTOto","spamInfo":{"isSpam":false,"reason":"6"},"subject":"Re: H3 - Possible memory leak?","postDate":"1251150059","msgId":6002,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PGg2djFkYitpY3ZzQGVHcm91cHMuY29tPg==","inReplyToHeader":"PDRBOTJGMUVGLjYwOTA4MDRAYXJjaGl2ZS5vcmc+"},"prevInTopic":6001,"nextInTopic":6003,"prevInTime":6001,"nextInTime":6003,"topicId":5998,"numMessagesInTopic":7,"msgSnippet":"Well, I mostly crawl swedish sites, and as I have noticed, most of them use utf-8, but some use iso-8859-1, too. However, for me personally, utf-8 is admirable","rawEmail":"Return-Path: &lt;ikromchik@...&gt;\r\nX-Sender: ikromchik@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 20979 invoked from network); 24 Aug 2009 21:41:42 -0000\r\nX-Received: from unknown (69.147.108.201)\n  by m3.grp.re1.yahoo.com with QMQP; 24 Aug 2009 21:41:42 -0000\r\nX-Received: from unknown (HELO n37b.bullet.mail.sp1.yahoo.com) (66.163.168.151)\n  by mta2.grp.re1.yahoo.com with SMTP; 24 Aug 2009 21:41:42 -0000\r\nX-Received: from [69.147.65.151] by n37.bullet.mail.sp1.yahoo.com with NNFMP; 24 Aug 2009 21:41:00 -0000\r\nX-Received: from [98.137.34.73] by t5.bullet.mail.sp1.yahoo.com with NNFMP; 24 Aug 2009 21:41:00 -0000\r\nDate: Mon, 24 Aug 2009 21:40:59 -0000\r\nTo: archive-crawler@yahoogroups.com\r\nMessage-ID: &lt;h6v1db+icvs@...&gt;\r\nIn-Reply-To: &lt;4A92F1EF.6090804@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=&quot;ISO-8859-1&quot;\r\nContent-Transfer-Encoding: quoted-printable\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-compose\r\nX-eGroups-Msg-Info: 1:6:0:0:0\r\nFrom: &quot;progre55&quot; &lt;ikromchik@...&gt;\r\nSubject: Re: H3 - Possible memory leak?\r\nX-Yahoo-Group-Post: member; u=140025715; y=xB3XxvuQR-mjJJjs1ovnYn3fm3UlG9MExyFsyV8PQdhDosjE\r\nX-Yahoo-Profile: progre55\r\n\r\nWell, I mostly crawl swedish sites, and as I have noticed, most of them use=\r\n utf-8, but some use iso-8859-1, too. However, for me personally, utf-8 is =\r\nadmirable :)\n\n&gt; &quot;More than likely, much of the slowness you\nsee happens whe=\r\nn the GenericReplayCharSequence is created, since the\nentire file is decode=\r\nd and written to disk in UTF-16.&quot;\n\nHere is a screenshot I had posted some t=\r\nime ago http://files.getdropbox.com/u/1571029/profiler.jpg\nas can be seen h=\r\nere, much of the slowness is caused when I convert GenericReplayCharSequenc=\r\ne to String (GenericReplayCharSequence.toString()).\n\n\n&gt; &quot;Ikrom, thanks for =\r\nthe data -- but I think it&#39;s reflective of a lot of new allocation, rather =\r\nthan a memory/reference leak that fails to be freed. Otherwise, a large cra=\r\nwl would OOME fairly quickly.&quot;\n\nI haven&#39;t tried a huge crawl yet, but the m=\r\nore links I crawl, the more memory is consumed and not freed. I even explic=\r\nitly call the garbage collector, no use. And as the screenshot shows, 82% o=\r\nf the memory is held by java.nio.charset.CharsetDecoder.decode(ByteBuffer) =\r\nhttp://dl.getdropbox.com/u/1571029/yourkitprofiler.jpg\n\nI&#39;ll try to run a b=\r\nigger crawl and scrutinize it deeper soon.\n\ncheers,\nIkrom (@...) \n\n\n-=\r\n-- In archive-crawler@yahoogroups.com, Noah Levitt &lt;nlevitt@...&gt; wrote:\n&gt;\n&gt;=\r\n \n&gt; Gordon Mohr wrote:\n&gt; &gt; The thought that UTF-8 was a more appropriate mo=\r\ndern default (matching \n&gt; &gt; browser behavior) was the motivation, but furth=\r\ner analysis of the choice \n&gt; &gt; is a top priority issue before the final H3 =\r\nrelease.\n&gt; \n&gt; Actually I think latin1 is still the default fallback encodin=\r\ng in US browsers. At least, it is in my browser (firefox 3.0). Edit/Prefere=\r\nnces/Content/Fonts & Colors -&gt; Advanced...\n&gt; \n&gt; Noah\n&gt; \n&gt; \n&gt; &gt; \n&gt; &gt; Ikrom, =\r\nthanks for the data -- but I think it&#39;s reflective of a lot of \n&gt; &gt; new all=\r\nocation, rather than a memory/reference leak that fails to be \n&gt; &gt; freed. O=\r\ntherwise, a large crawl would OOME fairly quickly.\n&gt; &gt; \n&gt; &gt; Still, the perf=\r\normance hit is a concern. For the core crawler, our chief \n&gt; &gt; goal is to e=\r\nnsure all outlink URIs are found... though some applications \n&gt; &gt; may be mo=\r\nre interested in accurate non-URI content extraction. More \n&gt; &gt; research in=\r\nto tradeoffs is needed, probably involving some big \n&gt; &gt; comparative crawls=\r\n to discover cases where the different defaults yield \n&gt; &gt; different crawle=\r\nr behavior.\n&gt; &gt; \n&gt; &gt; - Gordon @ IA\n&gt; &gt; \n&gt; &gt; Noah Levitt wrote:\n&gt; &gt;&gt; Thanks =\r\nIkrom for the report. More than likely, much of the slowness you \n&gt; &gt;&gt; see =\r\nhappens when the GenericReplayCharSequence is created, since the \n&gt; &gt;&gt; enti=\r\nre file is decoded and written to disk in UTF-16.\n&gt; &gt;&gt;\n&gt; &gt;&gt; Do you have any=\r\n example urls that trigger the slowness?\n&gt; &gt;&gt;\n&gt; &gt;&gt; Gordon, I see the change=\r\n you made falls back to utf-8 when the web page \n&gt; &gt;&gt; specifies a bogus enc=\r\noding. Is that because you found cases where utf-8 \n&gt; &gt;&gt; was the correct en=\r\ncoding, or did you choose utf-8 just as a standard \n&gt; &gt;&gt; default? If the la=\r\ntter, it might be better to fall back on on \n&gt; &gt;&gt; single-byte encoding like=\r\n latin1. Then GenericReplayCharSequence will \n&gt; &gt;&gt; not need to create a sec=\r\nond UTF-16 temp file.\n&gt; &gt;&gt;\n&gt; &gt;&gt; Noah\n&gt; &gt;&gt;\n&gt; &gt;&gt;\n&gt; &gt;&gt; progre55 wrote:\n&gt; &gt;&gt;&gt; H=\r\ni people!\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt; I&#39;ve been using heritrix3 now, and as I have written =\r\nbefore, after Gordon has changed default character encding to utf-8 and the=\r\n ReplayCharSequence().toString() method, there has been some significant dr=\r\nop in the crawl performance. Here is a snapshot from a profiler that shows =\r\nthat there might even be a memory-leak in some of those methods http://dl.g=\r\netdropbox.com/u/1571029/yourkitprofiler.jpg\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt; Gordon, could you p=\r\nlease have a look at that and possibly try to fix it?\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt; Thanks in=\r\n advance.\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt; cheers,\n&gt; &gt;&gt;&gt; Ikrom (@...)\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt;\n&gt; =\r\n&gt;&gt;&gt; ------------------------------------\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt; Yahoo! Groups Links\n&gt; =\r\n&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt;   \n&gt; &gt;&gt;\n&gt; &gt;&gt; ------------------------------------\n&gt; &gt;=\r\n&gt;\n&gt; &gt;&gt; Yahoo! Groups Links\n&gt; &gt;&gt;\n&gt; &gt;&gt;\n&gt; &gt;&gt;\n&gt; &gt; \n&gt; &gt; \n&gt; &gt; -------------------=\r\n-----------------\n&gt; &gt; \n&gt; &gt; Yahoo! Groups Links\n&gt; &gt; \n&gt; &gt; \n&gt; &gt;\n&gt;\n\n\n\n"}}