{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":168599281,"authorName":"stack","from":"stack &lt;stack@...&gt;","profile":"stackarchiveorg","replyTo":"LIST","senderId":"lAkuoX6JsIgOsIWSvys7U9Dd7yDp6NesURMPTBRZMVnm12ketuZXNy3htRSBi5FcZUvdoLn5PMZftXikxYPlaQ","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Re: [archive-crawler] Re: URL Canonicalization regex to strip  sessionIds","postDate":"1109619579","msgId":1620,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDQyMjM3MzdCLjcwMjAzMDRAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PDYuMi4wLjE0LjIuMjAwNTAyMjMxNTAyNDAuMDJhOTMyODBAdmhvc3Q2LmF0b21pY3NlcnZlcnMuY29tPg==","referencesHeader":"PGN2Z3FjbCtpZTNkQGVHcm91cHMuY29tPiA8Y3Znc2k3K3EwZHZAZUdyb3Vwcy5jb20+IDw2LjIuMC4xNC4yLjIwMDUwMjIzMTUwMjQwLjAyYTkzMjgwQHZob3N0Ni5hdG9taWNzZXJ2ZXJzLmNvbT4="},"prevInTopic":1611,"nextInTopic":0,"prevInTime":1619,"nextInTime":1621,"topicId":1605,"numMessagesInTopic":5,"msgSnippet":"... Done. ... Yes. I should have been more clear. ... Thanks for the above.  I added logging of the IndexOutOfBoundsException as suggested and added an append","rawEmail":"Return-Path: &lt;stack@...&gt;\r\nX-Sender: stack@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 64822 invoked from network); 28 Feb 2005 19:48:27 -0000\r\nReceived: from unknown (66.218.66.167)\n  by m24.grp.scd.yahoo.com with QMQP; 28 Feb 2005 19:48:27 -0000\r\nReceived: from unknown (HELO ia00524.archive.org) (207.241.224.172)\n  by mta6.grp.scd.yahoo.com with SMTP; 28 Feb 2005 19:48:27 -0000\r\nReceived: (qmail 22814 invoked by uid 100); 28 Feb 2005 19:31:32 -0000\r\nReceived: from debord.archive.org (HELO ?207.241.238.140?) (stack@...@207.241.238.140)\n  by mail-dev.archive.org with SMTP; 28 Feb 2005 19:31:32 -0000\r\nMessage-ID: &lt;4223737B.7020304@...&gt;\r\nDate: Mon, 28 Feb 2005 11:39:39 -0800\r\nUser-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.7.3) Gecko/20041007 Debian/1.7.3-5\r\nX-Accept-Language: en\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nReferences: &lt;cvgqcl+ie3d@...&gt; &lt;cvgsi7+q0dv@...&gt; &lt;6.2.0.14.2.20050223150240.02a93280@...&gt;\r\nIn-Reply-To: &lt;6.2.0.14.2.20050223150240.02a93280@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-Spam-DCC: : \r\nX-Spam-Checker-Version: SpamAssassin 2.63 (2004-01-11) on ia00524.archive.org\r\nX-Spam-Level: \r\nX-Spam-Status: No, hits=0.7 required=6.5 tests=AWL,CLICK_BELOW autolearn=no \n\tversion=2.63\r\nX-eGroups-Remote-IP: 207.241.224.172\r\nFrom: stack &lt;stack@...&gt;\r\nSubject: Re: [archive-crawler] Re: URL Canonicalization regex to strip  sessionIds\r\nX-Yahoo-Group-Post: member; u=168599281\r\nX-Yahoo-Profile: stackarchiveorg\r\n\r\nMike Schwartz wrote:\n\n&gt; Hi,\n&gt;\n&gt; thanks for your answer.  The regex you suggested still didn&#39;t quite \n&gt; work, so I put some debugging output in \n&gt; org.archive.crawler.url.canonicalize.RegexRule.canonicalize() and \n&gt; figured out what was going on.  There were three problems:\n&gt;\n&gt; 1) you need to enter the regex into the settings page on the admin GUI \n&gt; without quotes.  In retrospect this seems obvious, but I suggest you \n&gt; change section 6.2.1.1. of the user manual to say that you should put \n&gt; the expression listed in quotes on the manual page into the admin GUI \n&gt; without quotes.\n&gt;\nDone.\n\n&gt; 2) the $ and ? escaping needs to be done with a single slash.  (I \n&gt; figured this out by printing the regex that was being passed to \n&gt; TextUtils.getMatcher() -- with two slashes it ended up with 2 slashes \n&gt; being passed to TextUtils.getMatcher(), but you need 1 slash at that \n&gt; level.)  I think maybe you were thinking of how you&#39;d format this \n&gt; string if it was being done from within some Java code, rather than as \n&gt; input via the admin GUI.\n\nYes. I should have been more clear.\n\n&gt;\n&gt; 3) I needed two different overrides to make things work for this case: \n&gt; one for handling the case of URLs that included a sessionId without a \n&gt; catid, and one where there was sessionId with a catid.  I needed this \n&gt; because cases that didn&#39;t have a catid would either not match on the \n&gt; regex (if I required 1 or more of the catid part of the pattern), or, \n&gt; if I allowed 0 or more of the catid part of the pattern, they would \n&gt; match but then cause a &quot;null&quot; to be put into the canonicalized URL \n&gt; where the ${2} was in my replacement pattern.  The two patterns I \n&gt; ended up using were:\n&gt;     ^(.+)(?:;&#92;$sessionid&#92;$[A-Za-z0-9]{32})$\n&gt;     with the format string ${1}\n&gt;     to canonicalize URLs like \n&gt; http://joann.com/search/search_results.jhtml;$sessionid$kd0pc4qaakvxip4sy5lrhor50ld3uepo\n&gt;\n&gt; and\n&gt;     ^(.+)(?:;&#92;$sessionid&#92;$[A-Za-z0-9]{32})(&#92;?.*)$\n&gt;     with the format string ${1}${2}\n&gt;     to canonicalize URLs like \n&gt; http://joann.com/catalog.jhtml;$sessionid$kd0pc4qaakvxip4sy5lrhor50ld3uepo?catid=5\n&gt;\n&gt; One other thing I noticed while debugging this: at one point I was \n&gt; confused about whether to use ${2} or ${3} when I had a capturing \n&gt; followed by non-capturing followed by capturing group.  When I used \n&gt; ${3} it silently started skipping crawling URLs, which happening \n&gt; because the call to \n&gt; org.archive.crawler.url.canonicalize.RegexRule.format() was getting an \n&gt; IndexOutOfBoundsException inside java.util.regex.group().  You might \n&gt; want to add a try/catch around the call:\n&gt;     buffer.append(matcher.group(groupIndex));\n&gt; and then log something about this to the log file.  I know this was a \n&gt; config error on my part, but having it fail silently made it harder to \n&gt; figure out what was wrong.\n\n Thanks for the above.  I added logging of the IndexOutOfBoundsException \nas suggested and added an append only if the group is non-null which \nshould make it so you no longer need two overrides: One should be sufficent.\n\nYours,\nSt.Ack\n\n&gt;\n&gt; Thanks\n&gt;  - Mike\n&gt;\n&gt;\n&gt; At 08:16 PM 2/22/2005, stackarchiveorg wrote:\n&gt;\n&gt;&gt; --- In archive-crawler@yahoogroups.com, &quot;stackarchiveorg&quot; &lt;stack@a...&gt;\n&gt;&gt; wrote:\n&gt;&gt; &gt; Try this for the matching regex --\n&gt;&gt; &gt; &quot;^(.+)(?:&#92;&#92;$sessionid&#92;&#92;$[A-Z0-9]{32})(&#92;&#92;?.*)+$&quot; -- and this for the\n&gt;&gt; &gt; formatting expression: &quot;$1$1&quot;.\n&gt;&gt; &gt;\n&gt;&gt; Upon review, you probably want to include the &#39;;&#39; in the non-capturing\n&gt;&gt; group and the formatting expression should be &#39;$1$2&#39;, not &#39;$1$1&#39;.\n&gt;&gt;\n&gt;&gt; St.Ack\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt; ------------------------------------------------------------------------\n&gt;&gt; Yahoo! Groups Links\n&gt;&gt;\n&gt;&gt;     * To visit your group on the web, go to:\n&gt;&gt;     * http://groups.yahoo.com/group/archive-crawler/\n&gt;&gt;     *  \n&gt;&gt;     * To unsubscribe from this group, send an email to:\n&gt;&gt;     * archive-crawler-unsubscribe@yahoogroups.com\n&gt;&gt;       &lt;mailto:archive-crawler-unsubscribe@yahoogroups.com?subject=Unsubscribe&gt;\n&gt;&gt;\n&gt;&gt;     *  \n&gt;&gt;     * Your use of Yahoo! Groups is subject to the Yahoo! Terms of\n&gt;&gt;       Service &lt;http://docs.yahoo.com/info/terms/&gt;.\n&gt;&gt;\n&gt;\n&gt; *Yahoo! Groups Sponsor*\n&gt; ADVERTISEMENT\n&gt; click here \n&gt; &lt;http://us.ard.yahoo.com/SIG=129969mlu/M=298184.6018725.7038619.3001176/D=groups/S=1705004924:HM/EXP=1109283483/A=2593423/R=0/SIG=11el9gslf/*http://www.netflix.com/Default?mqso=60190075&gt; \n&gt;\n&gt;\n&gt;\n&gt; ------------------------------------------------------------------------\n&gt; *Yahoo! Groups Links*\n&gt;\n&gt;     * To visit your group on the web, go to:\n&gt;       http://groups.yahoo.com/group/archive-crawler/\n&gt;        \n&gt;     * To unsubscribe from this group, send an email to:\n&gt;       archive-crawler-unsubscribe@yahoogroups.com\n&gt;       &lt;mailto:archive-crawler-unsubscribe@yahoogroups.com?subject=Unsubscribe&gt;\n&gt;        \n&gt;     * Your use of Yahoo! Groups is subject to the Yahoo! Terms of\n&gt;       Service &lt;http://docs.yahoo.com/info/terms/&gt;.\n&gt;\n&gt;\n\n\n"}}