{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":347605000,"authorName":"lpeterus","from":"&quot;lpeterus&quot; &lt;lpeterus@...&gt;","profile":"lpeterus","replyTo":"LIST","senderId":"35WKNuDAhSSDVEnrZvvbYArJgxIicKJPnCVLl175HtERlxW4YZpmPLk8Kj1W954eqbD-2cv-lYksKZ0-csZDwqFdgI-99A","spamInfo":{"isSpam":false,"reason":"6"},"subject":"Re: Database Processor in Heritrix","postDate":"1214596329","msgId":5335,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PGc0M2dkYStxanBjQGVHcm91cHMuY29tPg==","inReplyToHeader":"PGczZ3Jucyt1c2NsQGVHcm91cHMuY29tPg=="},"prevInTopic":5325,"nextInTopic":6436,"prevInTime":5334,"nextInTime":5336,"topicId":5313,"numMessagesInTopic":9,"msgSnippet":"I finally managed to get this to work. Turns out the driver wasn t the problem at all. Placing the jar file in lib folder does include it in the classpath","rawEmail":"Return-Path: &lt;lpeterus@...&gt;\r\nX-Sender: lpeterus@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 18086 invoked from network); 27 Jun 2008 19:52:11 -0000\r\nX-Received: from unknown (66.218.67.97)\n  by m52.grp.scd.yahoo.com with QMQP; 27 Jun 2008 19:52:11 -0000\r\nX-Received: from unknown (HELO n40b.bullet.mail.sp1.yahoo.com) (66.163.168.154)\n  by mta18.grp.scd.yahoo.com with SMTP; 27 Jun 2008 19:52:11 -0000\r\nX-Received: from [216.252.122.217] by n40.bullet.mail.sp1.yahoo.com with NNFMP; 27 Jun 2008 19:52:11 -0000\r\nX-Received: from [66.218.69.5] by t2.bullet.sp1.yahoo.com with NNFMP; 27 Jun 2008 19:52:10 -0000\r\nX-Received: from [66.218.66.82] by t5.bullet.scd.yahoo.com with NNFMP; 27 Jun 2008 19:52:10 -0000\r\nDate: Fri, 27 Jun 2008 19:52:09 -0000\r\nTo: archive-crawler@yahoogroups.com\r\nMessage-ID: &lt;g43gda+qjpc@...&gt;\r\nIn-Reply-To: &lt;g3grns+uscl@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=&quot;ISO-8859-1&quot;\r\nContent-Transfer-Encoding: quoted-printable\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-compose\r\nX-eGroups-Msg-Info: 1:6:0:0:0\r\nFrom: &quot;lpeterus&quot; &lt;lpeterus@...&gt;\r\nSubject: Re: Database Processor in Heritrix\r\nX-Yahoo-Group-Post: member; u=347605000; y=CA-LusT4nqBD0HahwE8HvnMaJtOdq2n3ceD_w-oSNnULa0k\r\nX-Yahoo-Profile: lpeterus\r\n\r\nI finally managed to get this to work. Turns out the driver wasn&#39;t the\nprob=\r\nlem at all. Placing the jar file in lib folder does include it in\nthe class=\r\npath properly. Thanks for pointing that out. \nWhat was wrong is the way the=\r\n processor access variables for input in\nthe webUI. I fixed that and everyt=\r\nhing works.\nI&#39;m posting the final version of the code here if anyone else i=\r\ns doing\nsomething similar. \n\n- Shawn\n\npackage org.archive.crawler.writer;\n\n=\r\nimport org.archive.crawler.datamodel.CoreAttributeConstants;\nimport org.arc=\r\nhive.crawler.datamodel.CrawlURI;\nimport org.archive.crawler.framework.Proce=\r\nssor;\nimport org.archive.crawler.settings.SimpleType;\nimport org.archive.io=\r\n.RecordingInputStream;\nimport org.archive.io.ReplayInputStream;\nimport org.=\r\narchive.net.UURI;\n\nimport java.io.ByteArrayOutputStream;\nimport java.io.IOE=\r\nxception;\nimport java.sql.*;\nimport java.util.logging.Logger ;\nimport javax=\r\n.management.AttributeNotFoundException;\n\n/**\n * Processor module that write=\r\ns the results of successful fetches to\n * Database via JDBC.\n */\npublic cla=\r\nss JDBCWriterProcessor\n        extends Processor implements CoreAttributeCo=\r\nnstants {\n\n    private static final long serialVersionUID =3D 1114075562383=\r\n89168L;\n\n    /**\n     * Key to use asking settings for JDBC driver.\n     */=\r\n\n    public static final String ATTR_JDBC_DRIVER =3D &quot;JDBC Driver&quot;;\n\n    /*=\r\n*\n     * Key to use asking settings for JDBC URL.\n     */\n    public static=\r\n final String ATTR_JDBC_URL =3D &quot;JDBC URL&quot;;\n    \n    //  Key to use asking =\r\ndatabase name\n    public static final String ATTR_JDBC_DBNAME =3D &quot;database=\r\n&quot;;\n\n    // Key to use asking table name\n    public static final String ATTR=\r\n_JDBC_TBNAME =3D &quot;table&quot;;\n\n    /**\n     * Key to use asking settings for us=\r\nername.\n     */\n    public static final String ATTR_JDBC_USERNAME =3D &quot;user=\r\nname&quot;;\n\n    /**\n     * Key to use asking settings for passwd.\n     */\n    p=\r\nublic static final String ATTR_JDBC_PASSWD =3D &quot;password&quot;;\n\n    /**\n     * =\r\nLogger.\n     */\n    private static final Logger logger =3D\n            Logg=\r\ner.getLogger(JDBCWriterProcessor.class.getName());\n\n    /**\n     * @param n=\r\name Name of this processor.\n     */\n    public JDBCWriterProcessor(String n=\r\name) {\n\t//for adding attributes to heritrix processor, appears in WebUI&#92;\n\t/=\r\n/be sure to define variables in the format up above first.\n        super(na=\r\nme, &quot;JDBCWriter processor. &quot; +\n                &quot;A writer that writes each U=\r\nRL to database via jdbc &quot;);\n        addElementToDefinition(new SimpleType(A=\r\nTTR_JDBC_DRIVER,\n                &quot;jdbc driver name&quot;, &quot;com.mysql.jdbc.Driver=\r\n&quot;));\n        addElementToDefinition(new SimpleType(ATTR_JDBC_URL,\n         =\r\n       &quot;jdbc url in this form:\njdbc:databasetype://URL_to_db:port/&quot;, &quot;&quot;));\n=\r\n\t//the last / is necessary after port b/c the full URL of a jdbc is\njdbc:da=\r\ntabasetype://URL_to_db:port/db_name\n\taddElementToDefinition(new SimpleType(=\r\nATTR_JDBC_DBNAME,\n\t\t&quot;database name&quot;, &quot;&quot;));\n\taddElementToDefinition(new Simp=\r\nleType(ATTR_JDBC_TBNAME,\n\t\t&quot;table name&quot;, &quot;&quot;));\n        addElementToDefiniti=\r\non(new SimpleType(ATTR_JDBC_USERNAME,\n                &quot;username&quot;, &quot;&quot;));\n   =\r\n     addElementToDefinition(new SimpleType(ATTR_JDBC_PASSWD,\n              =\r\n  &quot;password&quot;, &quot;&quot;));\n    }\n\n    protected void innerProcess(CrawlURI curi) {=\r\n\n        if (!curi.isSuccess()) {\n            return;\n        }\n        UUR=\r\nI uuri =3D curi.getUURI(); // Current URI.\n\n        // Only http and https =\r\nschemes are supported.\n        String scheme =3D uuri.getScheme();\n        =\r\nif (!&quot;http&quot;.equalsIgnoreCase(scheme)\n                && !&quot;https&quot;.equalsIgno=\r\nreCase(scheme)) {\n            return;\n        }\n\n        //Only xml file wi=\r\nll store in database, change this expression\nto accept different content ty=\r\npes\n        String contenttype =3D curi.getContentType();\n        if (null =\r\n=3D=3D contenttype ||\n!&quot;application/xml&quot;.equalsIgnoreCase(contenttype)) {\n =\r\n           return;\n        }\n\n        RecordingInputStream recis =3D\ncuri.g=\r\netHttpRecorder().getRecordedInput();\n        if (0L =3D=3D recis.getRespons=\r\neContentLength()) {\n            return;\n        }\n\n        try {\n          =\r\n  writeToDatabase(curi); //calls the function write to database\n        } c=\r\natch (IOException e) {\n            logger.warning(e.getLocalizedMessage());=\r\n\n        }\n    }\n\n    /**\n     * write into database\n     *\n     * @param c=\r\nuri the curi that recorded the contents\n     *             of the resource\n=\r\n     * @throws java.io.IOException when something error;\n     */\n    privat=\r\ne void writeToDatabase(CrawlURI curi) throws IOException {\n        ReplayIn=\r\nputStream replayis =3D\ncuri.getHttpRecorder().getRecordedInput().getContent=\r\nReplayInputStream();\n        ByteArrayOutputStream sContent =3D new ByteArr=\r\nayOutputStream(); \n\n        try {\n            replayis.readContentTo(sConte=\r\nnt);\n        } finally {\n            replayis.close();\n        }\n\n        C=\r\nonnection conn =3D null;\n        PreparedStatement stmt =3D null;\n\t//calls =\r\na function getAttrValue to set each variable from webUI settings\n\tString dr=\r\niver =3D getAttrValue(ATTR_JDBC_DRIVER);\n\tString URL =3D getAttrValue(ATTR_=\r\nJDBC_URL);\n\tString db =3D getAttrValue(ATTR_JDBC_DBNAME);\n\tString table =3D=\r\n getAttrValue(ATTR_JDBC_TBNAME);\n\tString user =3D getAttrValue(ATTR_JDBC_US=\r\nERNAME);\n\tString pass =3D getAttrValue(ATTR_JDBC_PASSWD);\n\n\tSystem.out.prin=\r\ntln(driver+&quot; &quot;+URL+&quot; &quot;+db+&quot; &quot;+table+&quot; &quot;+user+&quot; &quot;+pass);\n        try {// ERR=\r\nOR OCCURS HERE DUE TO INABILITY TO SEE THE DRIVER\n            Class.forName=\r\n(driver); //loads the JDBC driver. \n\t}  catch (Exception e) {\n\t\t//handle er=\r\nror\n\t\tSystem.out.println(&quot;Failed to load JDBC Driver.&quot;);\n\t\tlogger.warning(e=\r\n.getLocalizedMessage());\t\n\t   }\n\ttry {\n           conn =3D DriverManager.ge=\r\ntConnection(URL+db,user,pass);\n           //insert into table section, chan=\r\nge if column names are\ndifferent\n\t   //Note this assumes you already made t=\r\nhe table with these columns\n                                               =\r\n  \n             stmt =3D conn.prepareStatement(&quot;INSERT INTO\n&quot;+table+&quot;(site,=\r\nurl,content,creation_date) VALUES(?,?,?,NOW())&quot;);\n\t     stmt.setString(1, c=\r\nuri.getUURI().getHost()); //contains host\naddress\t\n             stmt.setStr=\r\ning(2, curi.getUURI().getURI());  //contains\nURL of content\n \t     stmt.set=\r\nString(3, sContent.toString()); //contains actual\ncontent of the page\n     =\r\n        stmt.executeUpdate();\n\t     stmt.close(); \n             conn.close(=\r\n);\n         }  catch (SQLException ex) {\n\t\t logger.warning(curi.getUURI().g=\r\netURI() + &quot;--&gt;&quot; +\nex.getLocalizedMessage());\n\t         System.out.println(&quot;=\r\nSQLException: &quot; + ex.getMessage());\n\t         System.out.println(&quot;SQLState:=\r\n &quot; + ex.getSQLState());\n\t         System.out.println(&quot;VendorError: &quot; + ex.g=\r\netErrorCode());\n\t    } finally {\n\t\t/*\n\t\t* close any jdbc instances here tha=\r\nt weren&#39;t\n\t\t* explicitly closed during normal code path, so\n\t\t* that we don=\r\n&#39;t &#39;leak&#39; resources...\n                */\n            \tif (stmt !=3D null) =\r\n{\n              \t  try {\n                \tstmt.close();\n              \t  } =\r\ncatch (SQLException sqlex) {\n              \t      // ignore -- as we can&#39;t =\r\ndo anything about it here\n              \t    }\n              \t  stmt =3D nu=\r\nll;\n            \t}\n           \tif (conn !=3D null) {\n          \t    try {\n =\r\n              \t    \tconn.close();\n                    } catch (SQLException=\r\n sqlex) {\n              \t     // ignore -- as we can&#39;t do anything about it=\r\n here\n              \t      }\n              \t    conn =3D null;\n\t\t}\n        =\r\n      }\n      } //function writeToDB ends\n    \n    public String getAttrVal=\r\nue(String settingvalue) { \n    //function gets and sets the attribute value=\r\ns entered in webUI, \n    //other similar functions with different return ty=\r\npes can be used\nif needed.\n\tString varname =3D null;\n\ttry {\n \t  varname =3D=\r\n ((String) getAttribute(settingvalue));\n\t}  catch (AttributeNotFoundExcepti=\r\non e) {\n\t\t logger.warning(e.getLocalizedMessage());\n\t   } finally { return =\r\nvarname; }\n    } \n}// end of class\n\n\n&gt; --- In archive-crawler@yahoogroups.c=\r\nom, Gordon Mohr &lt;gojomo@&gt; wrote:\n&gt; &gt;\n&gt; &gt; Our launch script (bin/heritrix) b=\r\nuilds its own CLASSPATH so any \n&gt; &gt; attempts to set an alternate CLASSPATH =\r\nbefore running our script may\n&gt; not \n&gt; &gt; have the intended effect. It autom=\r\natically builds a CLASSPATH\n&gt; containing \n&gt; &gt; every JAR it finds in the &#39;li=\r\nb&#39; directory -- you may want to try \n&gt; &gt; dropping your other JAR there.\n&gt; &gt;=\r\n \n&gt; &gt; But, it&#39;s impossible to tell for sure what&#39;s happening in your\n&gt; situ=\r\nation \n&gt; &gt; without seeing the errors.\n&gt; &gt; \n&gt; &gt; - Gordon @ IA\n&gt; &gt; \n&gt; &gt; lpete=\r\nrus wrote:\n&gt; &gt; &gt; --- In archive-crawler@yahoogroups.com, &quot;lpeterus&quot; &lt;lpeter=\r\nus@&gt;\nwrote:\n&gt; &gt; &gt;&gt; --- In archive-crawler@yahoogroups.com, Gordon Mohr &lt;goj=\r\nomo@&gt;\nwrote:\n&gt; &gt; &gt;&gt;&gt; lpeterus wrote:\n&gt; &gt; &gt;&gt;&gt;&gt; Hi!\n&gt; &gt; &gt;&gt;&gt;&gt;\n&gt; &gt; &gt;&gt;&gt;&gt; I made =\r\na processor for inserting content information into a mysql\n&gt; &gt; &gt;&gt;&gt;&gt; databas=\r\ne. I included the name in processor.options and placed the\n&gt; &gt; &gt;&gt;&gt;&gt; .java f=\r\nile into the writer folder in the source. Then built\n&gt; heritrix\n&gt; &gt; &gt;&gt;&gt;&gt; us=\r\ning Maven. The new processor does show up on the webUI but the\n&gt; &gt; &gt;&gt;&gt;&gt; pro=\r\ncessor doesn&#39;t work correctly when I do a crawl. I get\ntoethread\n&gt; &gt; &gt;&gt;&gt;&gt; e=\r\nrrors, am I doing this wrong? Thanks.\n&gt; &gt; &gt;&gt;&gt; Without knowing the error, it=\r\n&#39;s impossible to tell. If it&#39;s not \n&gt; &gt; &gt;&gt;&gt; something like &#39;class not found=\r\n&#39;, and the crawl launched\nbefore the \n&gt; &gt; &gt;&gt;&gt; error occurred, it&#39;s probably=\r\n a bug in your code.\n&gt; &gt; &gt;&gt;&gt;\n&gt; &gt; &gt;&gt;&gt; - Gordon @ IA\n&gt; &gt; &gt;&gt;&gt;\n&gt; &gt; &gt;&gt; I actuall=\r\ny modified the code seen in this article. I&#39;m not sure\n&gt; if its\n&gt; &gt; &gt;&gt; not =\r\nup to date with heritrix 1.14 or something I changed. For the\n&gt; most\n&gt; &gt; &gt;&gt;=\r\n part I just altered it to accept xml rather than html and got\nrid of\n&gt; &gt; &gt;=\r\n&gt; the strip tag function and where it was used. \n&gt; &gt; &gt;&gt; http://tech.groups.=\r\nyahoo.com/group/archive-crawler/message/4538\n&gt; &gt; &gt;&gt;\n&gt; &gt; &gt; \n&gt; &gt; &gt; Ok, I beli=\r\neve its not recognizing the driver. I&#39;m using the mysql\n&gt; &gt; &gt; supported JDB=\r\nC driver thats wrapped in a jar file. Its manual\nsays to\n&gt; &gt; &gt; add the path=\r\n to jar file into CLASSPATH like this:\n&gt; &gt; &gt; export set\n&gt; CLASSPATH=3D/path=\r\n/mysql-connector-java-[ver]-bin.jar:$CLASSPATH\n&gt; &gt; &gt; Since I don&#39;t have adm=\r\nin rights on the system, I&#39;m using the Java\n&gt; &gt; &gt; thats extracted/installed=\r\n in my home directory. When I run a\nscript to\n&gt; &gt; &gt; use the driver after ex=\r\nporting, it sees the driver and works. When I\n&gt; &gt; &gt; use it in heritrix, it =\r\ndoesn&#39;t work because the errors get caught by\n&gt; &gt; &gt; exceptions. \n&gt; &gt; &gt; Is i=\r\nt possible that adding it to CLASSPATH doesn&#39;t allow the Java\n&gt; &gt; &gt; program=\r\n (which I set JAVA_HOME to when running Heritrix) to see\nwhere\n&gt; &gt; &gt; the dr=\r\niver is?\n&gt; &gt; &gt; \n&gt; &gt; &gt; \n&gt; &gt; &gt; \n&gt; &gt; &gt; ------------------------------------\n&gt; =\r\n&gt; &gt; \n&gt; &gt; &gt; Yahoo! Groups Links\n&gt; &gt; &gt; \n&gt; &gt; &gt; \n&gt; &gt; &gt;\n&gt; &gt;\n&gt;\n\n\n\n"}}