{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr","from":"Gordon Mohr &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"WsUJ3LuhyDCj6HUCMGUESj1sbr1RFtN0C4ksgpz5zfShZTSHWWjSC0jRBnsC3iMHG-vBPsZZI-iWPPnb9avD9VtZKiFH_jI","spamInfo":{"isSpam":false,"reason":"6"},"subject":"Re: [archive-crawler] retiring a Queue, using Groovy.","postDate":"1272946199","msgId":6510,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDRCREY5RTE3LjYwMzA1MDhAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PDUyMjAwMi41OTcwOS5xbUB3ZWI0MzE0My5tYWlsLnNwMS55YWhvby5jb20+","referencesHeader":"PDUyMjAwMi41OTcwOS5xbUB3ZWI0MzE0My5tYWlsLnNwMS55YWhvby5jb20+"},"prevInTopic":6509,"nextInTopic":6514,"prevInTime":6509,"nextInTime":6511,"topicId":6508,"numMessagesInTopic":4,"msgSnippet":"... This approach is supposed to work; but after refreshing my recollection of what we tried at the SF Heritrix Expert gathering, I think you re hitting the","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nX-Received: (qmail 61384 invoked from network); 4 May 2010 04:10:05 -0000\r\nX-Received: from unknown (98.137.34.46)\n  by m10.grp.re1.yahoo.com with QMQP; 4 May 2010 04:10:05 -0000\r\nX-Received: from unknown (HELO relay01.pair.com) (209.68.5.15)\n  by mta3.grp.sp2.yahoo.com with SMTP; 4 May 2010 04:10:04 -0000\r\nX-Received: (qmail 33399 invoked from network); 4 May 2010 04:10:02 -0000\r\nX-Received: from 27.54.15.223 (HELO silverbook.local) (27.54.15.223)\n  by relay01.pair.com with SMTP; 4 May 2010 04:10:02 -0000\r\nX-pair-Authenticated: 27.54.15.223\r\nMessage-ID: &lt;4BDF9E17.6030508@...&gt;\r\nDate: Mon, 03 May 2010 21:09:59 -0700\r\nUser-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.1.9) Gecko/20100317 Thunderbird/3.0.4\r\nMIME-Version: 1.0\r\nTo: archive-crawler@yahoogroups.com\r\nCc: Pranay Pandey &lt;sspranay@...&gt;\r\nReferences: &lt;522002.59709.qm@...&gt;\r\nIn-Reply-To: &lt;522002.59709.qm@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-eGroups-Msg-Info: 1:6:0:0:0\r\nFrom: Gordon Mohr &lt;gojomo@...&gt;\r\nSubject: Re: [archive-crawler] retiring a Queue, using Groovy.\r\nX-Yahoo-Group-Post: member; u=137285340; y=qw-0-GeL__ETkFaA4A2sAXH4QVo67d4x5rftUGa7PxCh\r\nX-Yahoo-Profile: gojomo\r\n\r\nOn 5/3/10 1:54 PM, Pranay Pandey wrote:\n&gt; I am trying to retire a Queue that looks like a potential crawler-trap.\n&gt; I am using groovy script (pretty much following the notes I took at the\n&gt; Feb SFO Conference).\n&gt;\n&gt; I am experimenting with just 1 seed.\n&gt; For the only Queue I have, after running the crawler for a while, I\n&gt; pause and setSessionBalance to 2 (a very low value), also setTotalBudget(2).\n&gt; After unpausing and letting the crawler download couple of more URLs\n&gt; (ensuring that total expended exceeds the sessionBalance and the total\n&gt; Budget, I don&#39;t see the Queue being force retired.\n\nThis approach is supposed to work; but after refreshing my recollection \nof what we tried at the SF Heritrix Expert gathering, I think you&#39;re \nhitting the same confusing problems and bugs we did there.\n\nThere are at least two problems even in the latest H3 code which prevent \nthe desired result:\n\nFirst, the actual should-retire check isn&#39;t happening everywhere it \nshould. Specifically, it only happens when a queue activates from the \neligible-but-inactive list -- and that only happens in a crawl that is \nquite busy, with significantly more eligible queues than threads.\n\nSecond, in order to be sensitive to mid-crawl changes to the global \ntotalBudget value, or to overlay values (different values to apply to \ndiffernt URIs), each queue&#39;s internal totalBudget value is *reset* to \nthe current prevailing/overlaid value each time the queue the activated. \nSo, a value changed directly via the scripting facility may not persist \nas long as desired.\n\nI&#39;ve created a new issue to address these; see:\n\n  https://webarchive.jira.com/browse/HER-1768\n\n&gt; How often isOverBudget() runs for a queue?\n\nIt is checked each time URI is finished,but since it has two meanings -- \nover-session-budget (meaning, deactivate temporarily to allow other \nqueues a chance), and over-total-budget (meaning, retire indefinitely) \n-- merely being isOverBudget() isn&#39;t currently enough to force a queue \nto retired status.\n\n&gt; Am I failing to understand the behavior of these parameters?\n&gt; total expended\n&gt; active balance\n&gt; total budget\n\nI think you&#39;ve got the right idea, but arcane details in how this is \nimplemented are causing the problem.\n\n&gt; I even tried queue.setRetired(true).\n\nThis, I would not recommend or expect to work. Essentially, the \n&#39;isRetired&#39; flag is for recording whether other code has retired the \nqueue, *not* for triggering retirement. Setting it directly won&#39;t work, \nand may cause other problems.\n\n&gt; My script snippet:\n&gt; -------------------\n&gt; frontier=appCtx.getBean(&quot;frontier&quot;)\n&gt; queue = frontier.getQueueFor(&quot;com,mySite,www,&quot;)\n&gt; queue.setSessionBalance(2)\n&gt; queue.setTotalBudget(2)\n&gt; ------------------\n\nAs part of the work for the issue HER-1768 just created, we&#39;ll provide a \nspecific recommended way to get this done for a single queue. (It may \ninvolve creating an overlay-settings Sheet in the final recommendation.)\n\n&gt; Thanks for any pointers!\n&gt;\n&gt; ps. How do I use rawOut?\n\nBoth the &#39;htmlOut&#39; and &#39;rawOut&#39; variables are pre-initialized for use by \nscripts that are run in the web interface&#39;s Scripting Console. Each is a \nPrintWriter instance, and provide a way to return output to top of the \nweb page that is shown the operator after script execution.\n\nYou can just message them as a PrintWriter in your script, for example:\n\n  rawOut.println(&quot;hello&quot;);\n\nOutput printed to the &#39;htmlOut&#39; PrintWriter is inserted into the \nresulting HTML page without any escaping -- so *may* use HTML \ntags/styling to affect browser presentation.\n\nOutput printed to the &#39;rawOut&#39; PrintWriter is escaped and wrapped in a \n&lt;PRE&gt; element in the resulting HTML page. So, any HTML tags are rendered \ninert.\n\nIf you&#39;re sure the output is very simple, or it is intentionally using \nHTML for styling, use &#39;htmlOut&#39;. If it might contain inadvertent HTML, \nor you want to see (rather than have the browser interpret) any HTML in \nthe output, use &#39;rawOut&#39;.\n\n- Gordon @ IA\n\n"}}