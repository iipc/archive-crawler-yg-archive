{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":137285340,"authorName":"Gordon Mohr","from":"Gordon Mohr &lt;gojomo@...&gt;","profile":"gojomo","replyTo":"LIST","senderId":"S45DNfNdM7UX8nd1-tSiFHl99reeZEFWplIRaxludIVfzKClrhdjF2dZzpLabdYXtHOB60zFOnXi5GQ5tp2_urvh5ePtfRk","spamInfo":{"isSpam":false,"reason":"12"},"subject":"Re: [archive-crawler] BDB, state, and disk usage, and other questions","postDate":"1117568841","msgId":1898,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDQyOUNCRjQ5LjQwNDA0MDZAYXJjaGl2ZS5vcmc+","inReplyToHeader":"PDIwMDUwNTMwMTMyNC4yNzkyOS5jay1oZXJpdHJpeEBuZXdzY2x1Yi5kZT4=","referencesHeader":"PDE3MDQxLjYzNDc0LjkxNzcyLjkwMjI4MEB0aXBoYXJlcy5iYXNpc3RlY2gubmV0PiA8NDI5Mzg0MUUuMzA3MDcwM0BhcmNoaXZlLm9yZz4gPDQyOTRGMUE2LjMwMjAyMDFAYXJjaGl2ZS5vcmc+IDwyMDA1MDUzMDEzMjQuMjc5MjkuY2staGVyaXRyaXhAbmV3c2NsdWIuZGU+"},"prevInTopic":1894,"nextInTopic":1899,"prevInTime":1897,"nextInTime":1899,"topicId":1868,"numMessagesInTopic":9,"msgSnippet":"Thanks for the report. It seems that problem URIs that would be harmlessly ignored at a later step are now causing problems in the optimized serialization. ","rawEmail":"Return-Path: &lt;gojomo@...&gt;\r\nX-Sender: gojomo@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 64478 invoked from network); 31 May 2005 19:48:26 -0000\r\nReceived: from unknown (66.218.66.218)\n  by m29.grp.scd.yahoo.com with QMQP; 31 May 2005 19:48:26 -0000\r\nReceived: from unknown (HELO ia00524.archive.org) (207.241.224.172)\n  by mta3.grp.scd.yahoo.com with SMTP; 31 May 2005 19:48:26 -0000\r\nReceived: (qmail 32435 invoked by uid 100); 31 May 2005 19:47:22 -0000\r\nReceived: from b116-dyn-239.archive.org (HELO ?207.241.238.239?) (gojomo@...@207.241.238.239)\n  by mail-dev.archive.org with SMTP; 31 May 2005 19:47:22 -0000\r\nMessage-ID: &lt;429CBF49.4040406@...&gt;\r\nDate: Tue, 31 May 2005 12:47:21 -0700\r\nUser-Agent: Mozilla Thunderbird 1.0.2-1.3.2 (X11/20050324)\r\nX-Accept-Language: en-us, en\r\nMIME-Version: 1.0\r\nTo: Christian Kohlschuetter &lt;ck-heritrix@...&gt;\r\nCc: archive-crawler@yahoogroups.com\r\nReferences: &lt;17041.63474.91772.902280@...&gt; &lt;4293841E.3070703@...&gt; &lt;4294F1A6.3020201@...&gt; &lt;200505301324.27929.ck-heritrix@...&gt;\r\nIn-Reply-To: &lt;200505301324.27929.ck-heritrix@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-Spam-DCC: : \r\nX-Spam-Checker-Version: SpamAssassin 2.63 (2004-01-11) on ia00524.archive.org\r\nX-Spam-Level: \r\nX-Spam-Status: No, hits=-65.9 required=7.0 tests=AWL,USER_IN_WHITELIST \n\tautolearn=no version=2.63\r\nX-eGroups-Msg-Info: 1:12:0\r\nFrom: Gordon Mohr &lt;gojomo@...&gt;\r\nSubject: Re: [archive-crawler] BDB, state, and disk usage, and other questions\r\nX-Yahoo-Group-Post: member; u=137285340; y=vB7pCMuAkn0xaaJc1xampOwa1qxwGpsz_huW_AIYvtaV\r\nX-Yahoo-Profile: gojomo\r\n\r\nThanks for the report. It seems that problem URIs that would be\nharmlessly ignored at a later step are now causing problems in\nthe optimized serialization.\n\nI&#39;ve been able to reproduce the &quot;Relative URI but no base&quot;\nexception on serialization, but not the &quot;Invalid URL encoding&quot;\nesception on deserialization, even trying a URI with trailing\n&#39;%&#39;.  Can you suggest a URI or page context where this is\ntriggered?\n\nI think the fix will be twofold: (1) ensure these bad URIs are\ndiscarded earlier, so they are never queued; (2) making the\nqueueing more robust against any case where a bad URI slips\nthrough.\n\n- Gordon @ IA\n\nChristian Kohlschuetter wrote:\n&gt; On Wednesday 25 May 2005 23:44, Gordon Mohr wrote:\n&gt; \n&gt;&gt;Some quick investigation revealed no giant things being mistakenly\n&gt;&gt;serialized out, but revealed some opportunities for small changes that\n&gt;&gt;have cut the serialized size of CrawlURIs by 60% or more in short tests.\n&gt;&gt;(From averages of ~1100 bytes to ~420 bytes in some short test crawls\n&gt;&gt;generating ~20000 serialized CrawlURIs.)\n&gt;&gt;\n&gt;&gt;As serialized CrawlURIs in queues dominate our BDB contents -- both\n&gt;&gt;the in-memory cache, and on-disk files -- this could result in a\n&gt;&gt;noticeably smaller disk footprint (and effectively &quot;larger&quot; cache\n&gt;&gt;at the same memory cost).\n&gt;&gt;\n&gt;&gt;These changes have been committed to HEAD after some minimal testing,\n&gt;&gt;so those willing to risk the bleeding edge are invited to try them\n&gt;&gt;out.\n&gt;&gt;\n&gt;&gt;- Gordon @ IA\n&gt; \n&gt; \n&gt; Hello Gordon,\n&gt; \n&gt; I think these changes have broken something.\n&gt; \n&gt; With the changes applied, I get URIExceptions (usually hidden behind BDB&#39;s \n&gt; RuntimeExceptionWrapper), with messages like\n&gt; - &quot;Relative URI but no \n&gt; base: :http:/www.imagesjournal.com/issue02/reviews/mannoirs.htm&quot;\n&gt; - &quot;Invalid URL encoding&quot; (happens if URI&#39;s last character is &#39;%&#39;).\n&gt; \n&gt; Here is a partial stacktrace from my own &quot;NewFrontier&quot; implementation (it has \n&gt; the same problems as the BdbFrontier, but also shows the exception&#39;s cause):\n&gt; \n&gt; Caused by: org.apache.commons.httpclient.URIException: Invalid URL encoding\n&gt; \tat org.apache.commons.httpclient.URI.decode(URI.java:1768)\n&gt; \tat org.apache.commons.httpclient.URI.decode(URI.java:1724)\n&gt; \tat org.apache.commons.httpclient.URI.getURI(URI.java:3743)\n&gt; \tat \n&gt; org.archive.crawler.datamodel.CandidateURI.writeObject(CandidateURI.java:517)\n&gt; \tat sun.reflect.GeneratedMethodAccessor2.invoke(Unknown Source)\n&gt; \tat \n&gt; sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n&gt; \tat java.lang.reflect.Method.invoke(Method.java:585)\n&gt; \tat java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:890)\n&gt; \tat java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1333)\n&gt; \tat \n&gt; java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1284)\n&gt; \tat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1073)\n&gt; \tat java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:291)\n&gt; \tat \n&gt; de.kohlschuetter.collections.queues.BucketQueue.enqueue(BucketQueue.java:221)\n&gt; \tat org.archive.crawler.frontier.NewWorkQueue.insertItem(NewWorkQueue.java:53)\n&gt; \tat org.archive.crawler.frontier.WorkQueue.insert(WorkQueue.java:352)\n&gt; \tat org.archive.crawler.frontier.WorkQueue.enqueue(WorkQueue.java:122)\n&gt; \t... 12 more\n&gt; \n&gt; I am not sure how/why &quot;bad URIs&quot; reached that point, but without your patch, I \n&gt; do not get any exceptions.\n\n"}}