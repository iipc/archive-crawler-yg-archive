{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":191387937,"authorName":"pandae667","from":"&quot;pandae667&quot; &lt;aaron667@...&gt;","profile":"pandae667","replyTo":"LIST","senderId":"ToZk0C0_1kunBGu_zhdveD6PfgDP9rxa9hZjbpYzOOa13MMIFOmyCGVqg_tI0_RSPlJCbVIGauyevPJv21sreH6B8Exh","spamInfo":{"isSpam":false,"reason":"6"},"subject":"Re: questions about heritrix memory consumption","postDate":"1176720011","msgId":4117,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PGV2dmpxYitxOHFpQGVHcm91cHMuY29tPg==","inReplyToHeader":"PDQ2MUVBRDhFLjIwMzAwMDRAYXJjaGl2ZS5vcmc+"},"prevInTopic":4105,"nextInTopic":0,"prevInTime":4116,"nextInTime":4118,"topicId":4079,"numMessagesInTopic":8,"msgSnippet":"Thanks alot Gordon, I can confirm this issue being fixed in svn - same about the ToePool issue. Regards Olaf Freyer ... testing. ... code ... doing ... just","rawEmail":"Return-Path: &lt;aaron667@...&gt;\r\nX-Sender: aaron667@...\r\nX-Apparently-To: archive-crawler@yahoogroups.com\r\nReceived: (qmail 16219 invoked from network); 16 Apr 2007 10:40:54 -0000\r\nReceived: from unknown (66.218.67.33)\n  by m47.grp.scd.yahoo.com with QMQP; 16 Apr 2007 10:40:54 -0000\r\nReceived: from unknown (HELO n31a.bullet.sp1.yahoo.com) (209.131.38.208)\n  by mta7.grp.scd.yahoo.com with SMTP; 16 Apr 2007 10:40:54 -0000\r\nReceived: from [216.252.122.217] by n31.bullet.sp1.yahoo.com with NNFMP; 16 Apr 2007 10:40:12 -0000\r\nReceived: from [66.218.69.5] by t2.bullet.sp1.yahoo.com with NNFMP; 16 Apr 2007 10:40:12 -0000\r\nReceived: from [66.218.66.92] by t5.bullet.scd.yahoo.com with NNFMP; 16 Apr 2007 10:40:12 -0000\r\nDate: Mon, 16 Apr 2007 10:40:11 -0000\r\nTo: archive-crawler@yahoogroups.com\r\nMessage-ID: &lt;evvjqb+q8qi@...&gt;\r\nIn-Reply-To: &lt;461EAD8E.2030004@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=&quot;ISO-8859-1&quot;\r\nContent-Transfer-Encoding: quoted-printable\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-compose\r\nX-eGroups-Msg-Info: 1:6:0:0\r\nFrom: &quot;pandae667&quot; &lt;aaron667@...&gt;\r\nSubject: Re: questions about heritrix memory consumption\r\nX-Yahoo-Group-Post: member; u=191387937; y=tZ26E_CRHl8DyoLuUPSJcrOh9RKS_E5hoHoPgGU6bx7BhvVA\r\nX-Yahoo-Profile: pandae667\r\n\r\nThanks alot Gordon,\n\nI can confirm this issue being fixed in svn - same abo=\r\nut the ToePool\nissue.\n\nRegards\n  Olaf Freyer\n\n--- In archive-crawler@yahoog=\r\nroups.com, Gordon Mohr &lt;gojomo@...&gt; wrote:\n&gt;\n&gt; FYI: The BDB folks have prov=\r\nided a fix which is in SVN for further\ntesting.\n&gt; \n&gt; - Gordon\n&gt; \n&gt; Gordon M=\r\nohr wrote:\n&gt; &gt; Olaf -\n&gt; &gt; \n&gt; &gt; There&#39;s definitely something amiss here, and=\r\n it looks related to the \n&gt; &gt; BDB-JE library. I&#39;ve asked the Sleepycat expe=\r\nrts about some fishy\ncode \n&gt; &gt; related to the lingering Environments, see..=\r\n.\n&gt; &gt; \n&gt; &gt; http://forums.oracle.com/forums/thread.jspa?threadID=3D495531&ts=\r\ntart=3D0\n&gt; &gt; \n&gt; &gt; I&#39;ll report back to the list with what they say and I fin=\r\nd.\n&gt; &gt; \n&gt; &gt; I think the ToePool issue is separate; it looks like we should =\r\nbe\ndoing \n&gt; &gt; a ThreadGroup.setDaemon() on the ToePool.\n&gt; &gt; \n&gt; &gt; - Gordon @=\r\n IA\n&gt; &gt; \n&gt; &gt; pandae667 wrote:\n&gt; &gt;&gt; Hi Gordon,\n&gt; &gt;&gt;\n&gt; &gt;&gt; I spend some more t=\r\nime looking into the issue, made some heap dumps,\n&gt; &gt;&gt; tried to understand =\r\ntheir content (first using &#39;jhat&#39;, but finally\n&gt; &gt;&gt; decided to use the conv=\r\nenience of netbeans profiler)... but I still\n&gt; &gt;&gt; don&#39;t have a real explain=\r\nation for what I&#39;m seeing.\n&gt; &gt;&gt;\n&gt; &gt;&gt; But there is one thing that confused m=\r\ne alot. I had about 50 jobs\n&gt; &gt;&gt; running on that machine (53 to be exact) ,=\r\n all of them finished\njust fine.\n&gt; &gt;&gt; But what I find are 53 instances of E=\r\nnhancedEnvironment still in\n&gt; &gt;&gt; memory, 53 instances of com.sleepycat.je.D=\r\natabase and also 53\n&gt; &gt;&gt; instances of org.archive.crawler.framework.ToePool=\r\n.\n&gt; &gt;&gt;\n&gt; &gt;&gt; So its either some cleanup code not being called - or the GC is=\r\n god\n&gt; &gt;&gt; damn lazy... \n&gt; &gt;&gt;\n&gt; &gt;&gt; (I&#39;ll use &#39;jmap -histo:live&#39; next time th=\r\ne machine is in a similar\n&gt; &gt;&gt; state to be 100% sure only to see live objec=\r\nt in my dumps)\n&gt; &gt;&gt;\n&gt; &gt;&gt; Regards\n&gt; &gt;&gt;   Olaf Freyer\n&gt; &gt;&gt;\n&gt; &gt;&gt;\n&gt; &gt;&gt;\n&gt; &gt;&gt; ---=\r\n In archive-crawler@yahoogroups.com, &quot;pandae667&quot; &lt;aaron667@&gt;\nwrote:\n&gt; &gt;&gt;&gt; H=\r\ni Gordon,\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt; its once again me. \n&gt; &gt;&gt;&gt; I were able to trigger a GC=\r\n via a JMX call and now the reports of\n&gt; &gt;&gt;&gt; &#39;jmap -histo&#39; seem to be more =\r\nconsistent with the report of the\nwebUI.\n&gt; &gt;&gt;&gt; (or maybe I just copied&past=\r\ned the wrong report last time)\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt; num   #instances    #bytes  clas=\r\ns name\n&gt; &gt;&gt;&gt; --------------------------------------\n&gt; &gt;&gt;&gt;   1:    674736   =\r\n292760720  [B\n&gt; &gt;&gt;&gt;   2:    451626    18065040  com.sleepycat.je.tree.LN\n&gt; =\r\n&gt;&gt;&gt;   3:      7239     7580688  [[B\n&gt; &gt;&gt;&gt;   4:      7233     7580184  [Lcom=\r\n.sleepycat.je.tree.Node;\n&gt; &gt;&gt;&gt;   5:     39884     5859680  &lt;constMethodKlas=\r\ns&gt;\n&gt; &gt;&gt;&gt;   6:     39884     4794544  &lt;methodKlass&gt;\n&gt; &gt;&gt;&gt;   7:     28497    =\r\n 4725848  [Ljava.util.HashMap$Entry;\n&gt; &gt;&gt;&gt;   8:      3704     4580736  &lt;con=\r\nstantPoolKlass&gt;\n&gt; &gt;&gt;&gt;   9:     47991     4553240  [Ljava.lang.Object;\n&gt; &gt;&gt;&gt;=\r\n  10:     79118     3797664  java.util.HashMap$Entry\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt; (summing u=\r\np all the #bytes only differs by a few % to what the webUI\n&gt; &gt;&gt;&gt; reports)\n&gt;=\r\n &gt;&gt;&gt;\n&gt; &gt;&gt;&gt; But still... What I&#39;m seeing is about half the memory consumptio=\r\nn\n&gt; &gt;&gt;&gt; being caused by JBDB data structures - whilest heritrix says:\n&gt; &gt;&gt;&gt;=\r\n\n&gt; &gt;&gt;&gt; Jobs\n&gt; &gt;&gt;&gt; None available\n&gt; &gt;&gt;&gt; 0 pending, 53 completed\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt; =\r\nThis doesn&#39;t seem all too reasonable to me (or maybe I still just\n&gt; &gt;&gt;&gt; can=\r\n&#39;t stand garbage collectors?).\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt; I&#39;ll try to get a heap dump to r=\r\netrieve some more informations about\n&gt; &gt;&gt;&gt; what is going on.\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt; Re=\r\ngards\n&gt; &gt;&gt;&gt;   Olaf Freyer\n&gt; &gt;&gt;&gt;\n&gt; &gt;&gt;&gt; --- In archive-crawler@...=\r\nm, &quot;pandae667&quot; &lt;aaron667@&gt;\nwrote:\n&gt; &gt;&gt;&gt;&gt; Hi Gordon,\n&gt; &gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt; thanks fo=\r\nr your quick reply.\n&gt; &gt;&gt;&gt;&gt; (1) I think it might be true, that &#39;jmap -histo&#39;=\r\n doesn&#39;t force\na GC.\n&gt; &gt;&gt;&gt;&gt; I&#39;ll look into this and try if things change af=\r\nter a forced GC.\n&gt; &gt;&gt;&gt;&gt; (2) The last 50 jobs all are in the &quot;Finished&quot; stat=\r\ne, so I&#39;d\npresume\n&gt; &gt;&gt;&gt;&gt; everything finished just fine. (This machine only =\r\ndoes &quot;small&quot;\njobs)\n&gt; &gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt; The main reason why I&#39;m mentioning all thi=\r\ns is that my machines\n&gt; &gt;&gt;&gt;&gt; running the big crawls tend to &quot;die&quot; after abo=\r\nut a week.\n&gt; &gt;&gt;&gt;&gt; Or to be more correct, they run fine for one week. Then t=\r\nheir\ntask is\n&gt; &gt;&gt;&gt;&gt; either finished - or I finish it via JMX. Now I enqueue=\r\n the\nnext job\n&gt; &gt;&gt;&gt;&gt; which runs OOME within 1 or 2 days.\n&gt; &gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt; Afte=\r\nr the first job has finished heritrix remains in a state of\n4.5GB\n&gt; &gt;&gt;&gt;&gt; of=\r\n 5GB heap used -  so I think it seems reasonable to believe that\n&gt; &gt;&gt;&gt;&gt; som=\r\nething from the previous job still remains in-memory.\n&gt; &gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt; I&#39;m not=\r\n sure why this happens - if this is either a real memory\nleak\n&gt; &gt;&gt;&gt;&gt; or jus=\r\nt the GC going nuts.\n&gt; &gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt; I have to admit that I still don&#39;t under=\r\nstand all of heritrix\n&gt; &gt;&gt;&gt;&gt; internals, but I found this blog entry\n&gt; &gt;&gt;&gt;&gt; =\r\n(http://blogs.oracle.com/charleslamb/2007/02/22) interesting\n&gt; &gt;&gt;&gt;&gt; concern=\r\ning java BDB and OOME issues. Not sure if it applies to\n&gt; &gt;&gt;&gt;&gt; heritrix as =\r\nI&#39;, not sure if we have one or multiple environments.\n&gt; &gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt; Regards=\r\n\n&gt; &gt;&gt;&gt;&gt;   Olaf Freyer\n&gt; &gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt; --- In archive-crawler@yahoogroups.com,=\r\n Gordon Mohr &lt;gojomo@&gt;\nwrote:\n&gt; &gt;&gt;&gt;&gt;&gt; Two possibilities come to mind:\n&gt; &gt;&gt;&gt;=\r\n&gt;&gt;\n&gt; &gt;&gt;&gt;&gt;&gt; (1) I don&#39;t think &#39;jmap -histo&#39; forces a GC first. And, its outp=\r\nut\n&gt; &gt;&gt;&gt;&gt; seems \n&gt; &gt;&gt;&gt;&gt;&gt; peculiar given the webUI figures: it&#39;s showing ove=\r\nr 1GB of byte\n&gt; &gt;&gt;&gt; arrays \n&gt; &gt;&gt;&gt;&gt;&gt; (&quot;[B&quot;), though the webUi reports only ~=\r\n400MB heap in use. So I\nthink\n&gt; &gt;&gt;&gt;&gt; the \n&gt; &gt;&gt;&gt;&gt;&gt; &#39;jmap -histo&#39; figures con=\r\ntain dead objects. Maybe a forced GC\nwould\n&gt; &gt;&gt;&gt;&gt; give \n&gt; &gt;&gt;&gt;&gt;&gt; more sensib=\r\nle figures.\n&gt; &gt;&gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt;&gt; (2) The crawl didn&#39;t finish completely or clean=\r\nly. It&#39;s not \n&gt; &gt;&gt;&gt;&gt;&gt; paused-at-finish waiting for a possible resume with m=\r\nore URIs,\n&gt; &gt;&gt; is it?\n&gt; &gt;&gt;&gt;&gt;&gt; - Gordon @ IA\n&gt; &gt;&gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt;&gt; pandae667 wrote=\r\n:\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; Dear IA-Team,\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; whilest analysing the results of=\r\n a previous crawl I decided to\n&gt; &gt;&gt; also\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; take a closer look at her=\r\nitrix. To be more specific a closer\n&gt; &gt;&gt; look at\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; the state heritri=\r\nx was in after finishing the job.\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; (basically heritrix-1.12 with so=\r\nme minor patches running under\n&gt; &gt;&gt;&gt;&gt; java 1.6)\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; The webUI showed m=\r\ne the following stats:\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; Memory\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; 402591 KB used\n&gt; &gt;=\r\n&gt;&gt;&gt;&gt;&gt; 950456 KB current heap\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; 3063488 KB max heap\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;=\r\n Now this is quite a lot memory being used while sitting there\n&gt; &gt;&gt; idle.\n&gt;=\r\n &gt;&gt;&gt;&gt;&gt;&gt; So I wondered what is eating up all my precious memory and\nthis is\n=\r\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; what jmap -histo &lt;pid&gt; was able to tell me:\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; num =\r\n  #instances    #bytes  class name\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; -------------------------------=\r\n-------\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;   1:   7716610   1352335640  [B\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;   2:   5202265   =\r\n208090600  com.sleepycat.je.tree.LN\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;   3:     78155    81900656  [[=\r\nB\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;   4:     78149    81900152  [Lcom.sleepycat.je.tree.Node;\n&gt; &gt;&gt;&gt;&gt;=\r\n&gt;&gt;   5:    469864    72832376  [C\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;   6:     24169    25050392  [J\n&gt;=\r\n &gt;&gt;&gt;&gt;&gt;&gt;   7:    421191    20217168  java.util.Hashtable$Entry\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;   8:=\r\n    467772    18710880  java.lang.String\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;   9:     75246    1264132=\r\n8  com.sleepycat.je.tree.BIN\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;  10:    259687    12464976  org.archi=\r\nve.crawler.admin.SeedRecord\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;  ...\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;  ...\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;  ...\n&gt; &gt;&gt;&gt;=\r\n&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; So what I&#39;m asking myself is: why do I still see about 5 milli=\r\non\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; instances of com.sleepycat.je.tree.LN in memory whilest sitting=\r\n\n&gt; &gt;&gt;&gt; there\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; idle and the last job having finished about 3 days ag=\r\no ?\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; Anyone able to share some insights with me?\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;\n=\r\n&gt; &gt;&gt;&gt;&gt;&gt;&gt; Regards\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;   Olaf Freyer\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;=\r\n  \n&gt; &gt;&gt;&gt;&gt;&gt;&gt; Yahoo! Groups Links\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;\n&gt; &gt;&gt;&gt;&gt;&gt;&gt;\n&gt; &gt;&gt;\n&gt; &gt;&gt;\n&gt; &gt;&gt;\n&gt;=\r\n &gt;&gt;  \n&gt; &gt;&gt; Yahoo! Groups Links\n&gt; &gt;&gt;\n&gt; &gt;&gt;\n&gt; &gt;&gt;\n&gt; &gt; \n&gt; &gt; \n&gt; &gt; \n&gt; &gt;  \n&gt; &gt; Yaho=\r\no! Groups Links\n&gt; &gt; \n&gt; &gt; \n&gt; &gt;\n&gt;\n\n\n\n"}}